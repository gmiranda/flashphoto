<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <title>The CImg Library - C++ Template Image Processing Library</title>
    <meta content="David Tschumperle" name="author">
    <link rel="shortcut icon" type="image/x-icon" href="http://cimg.sourceforge.net/favicon.ico" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="doxygen.css" rel="stylesheet" type="text/css">
  </head>
  <body bgcolor="#ffffff" fgcolor="#000000" alink="#ff0000" link="#0000ee" vlink="#551a8b">
    <table align="center" border="0" cellpadding="0" cellspacing="0" width="1024">
      <tbody>
        <tr>
          <td>
            <hr noshade="noshade" size="1" width="100%">
            <center> 
              <a href="http://cimg.sourceforge.net"><img src="../img/CImgLogo2.jpg" border="0"><img src="../img/CImgLogo.jpg" border="0"></a><br>
	      <table style="width: 100%; text-align: left;" border="0"
		cellpadding="2" cellspacing="2">
		<tbody>
		  <tr>
		    <td style="vertical-align: top; text-align: right;"><font
			face="Arial,Helvetica"><big>&nbsp;&nbsp;<b>C++ Template Image Processing Library.</b></big></font></td>
		    <td style="vertical-align: top; text-align: right;">
		      <a href="http://www.cnrs.fr/"><img src="../img/logoCNRS.gif" border="0"></a>&nbsp;
		      <a href="http://www.greyc.ensicaen.fr/EquipeImage"><img src="../img/logoGREYC.gif" border="0"></a>&nbsp;
		      <a href="http://www-sop.inria.fr"><img src="../img/logoINRIA.gif" border="0"></a>
		    </td>
		  </tr>
		</tbody>
	      </table>
	      </center>

            <hr noshade="noshade" size="1" width="100%">
            <center>
              <table
                style="width: 100%; text-align: left; margin-left: auto; margin-right: auto; background-color: rgb(238, 238, 255);"
                border="0" cellpadding="3" cellspacing="0">
                <tbody>
                  <tr>
                    <td style="text-align: center; vertical-align: top;">
                      <font face="Arial,Helvetica" size="-1">
                        [<a target="_parent" href="../index.shtml">Introduction</a>]-
                        [<a target="_parent" href="../news.html">News</a>]-
                        [<a target="_parent" href="../download.shtml">Download</a>]-
                        [<a target="_parent" href="../screenshots.shtml">Screenshots</a>]-
                        [<a target="_parent" href="../reference/group__cimg__tutorial.html">Tutorial</a>]-
                        [<a target="_parent" href="http://sourceforge.net/forum/forum.php?forum_id=334630">Forums-Eng</a>]-
                        [<a target="_parent" href="http://sourceforge.net/forum/forum.php?forum_id=421080">Forums-Fr</a>]-
                        [<a target="_parent" href="../reference/index.html">Reference</a>]-
                        [<a target="_parent" href="http://sourceforge.net/projects/cimg/">SourceForge Repository</a> ]
                      </font></td>
                  </tr>
                </tbody>
              </table>
            </center>
            <hr noshade="noshade" size="1" width="100%">
            <noscript> </noscript>
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
<!-- Generated by Doxygen 1.3.9 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>CImg.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*------------------------------------------------------------------------------------------------------</span>
00002 <span class="comment">  </span>
00003 <span class="comment">  File        : CImg.h</span>
00004 <span class="comment">  </span>
00005 <span class="comment">  Description : The C++ Template Image Processing Library</span>
00006 <span class="comment">                ( http://cimg.sourceforge.net )</span>
00007 <span class="comment"></span>
00008 <span class="comment">  Copyright   : David Tschumperle</span>
00009 <span class="comment">                ( http://www.greyc.ensicaen.fr/~dtschump/ )</span>
00010 <span class="comment">   </span>
00011 <span class="comment">  This software is governed by the CeCILL  license under French law and</span>
00012 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00013 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00014 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00015 <span class="comment">  "http://www.cecill.info". </span>
00016 <span class="comment">  </span>
00017 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00018 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00019 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00020 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00021 <span class="comment">  liability. </span>
00022 <span class="comment">  </span>
00023 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00024 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00025 <span class="comment">  software by the user in light of its specific status of free software,</span>
00026 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00027 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00028 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00029 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00030 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00031 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00032 <span class="comment">  same conditions as regards security. </span>
00033 <span class="comment">  </span>
00034 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00035 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00036 <span class="comment">  </span>
00037 <span class="comment">  ----------------------------------------------------------------------------------------------------*/</span>
00038 
00039 <span class="preprocessor">#ifndef cimg_version</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define cimg_version 1.09</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#include &lt;cstdio&gt;</span>
00042 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00043 <span class="preprocessor">#include &lt;cstdarg&gt;</span>
00044 <span class="preprocessor">#include &lt;cstring&gt;</span>
00045 <span class="preprocessor">#include &lt;cmath&gt;</span>
00046 <span class="preprocessor">#include &lt;ctime&gt;</span>
00047 
00048 <span class="comment">// Overcome VisualC++ 6.0 and DMC compilers namespace 'std::' bug</span>
00049 <span class="preprocessor">#if ( defined(_MSC_VER) &amp;&amp; _MSC_VER&lt;=1200 ) || defined(__DMC__)</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define std</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>
00053 <span class="comment">/*-------------------------------------------------------------</span>
00054 <span class="comment">  </span>
00055 <span class="comment">  Set CImg configuration flags.</span>
00056 <span class="comment">    </span>
00057 <span class="comment">  If compilation flags are not adapted to your system,</span>
00058 <span class="comment">  you may override their values, before including</span>
00059 <span class="comment">  the header file "CImg.h" (use the #define directive).</span>
00060 <span class="comment">  </span>
00061 <span class="comment">  -------------------------------------------------------------*/</span>
00062 
00063 <span class="preprocessor">#ifndef cimg_OS</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#if defined(sun)        || defined(__sun)       || defined(linux)       || defined(__linux)    \</span>
00065 <span class="preprocessor"> || defined(__CYGWIN__) || defined(__FreeBSD__) || defined(__OPENBSD__) || defined(__MACOSX__) \</span>
00066 <span class="preprocessor"> || defined(__APPLE__)  || defined(sgi)         || defined(__sgi)</span>
00067 <span class="preprocessor"></span><span class="comment">// Unix (Linux,Solaris,BSD,Irix,...)</span>
00068 <span class="preprocessor">#define cimg_OS            1</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#ifndef cimg_display_type</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#define cimg_display_type  1</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00072 <span class="preprocessor"></span><span class="preprocessor">#ifndef cimg_color_terminal</span>
00073 <span class="preprocessor"></span><span class="preprocessor">#define cimg_color_terminal</span>
00074 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#elif defined(_WIN32) || defined(__WIN32__)</span>
00076 <span class="preprocessor"></span><span class="comment">// Windows</span>
00077 <span class="preprocessor">#define cimg_OS            2</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#ifndef cimg_display_type</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define cimg_display_type  2</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00082 <span class="preprocessor"></span><span class="comment">// Unknown configuration : compile with minimal dependencies.</span>
00083 <span class="preprocessor">#define cimg_OS            0</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#ifndef cimg_display_type</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define cimg_display_type  0</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00089 <span class="preprocessor"></span>
00090 <span class="comment">// Debug configuration.</span>
00091 <span class="comment">//--------------------</span>
00092 <span class="comment">// Define 'cimg_debug' to : 0 to remove dynamic debug messages (exceptions are still thrown)</span>
00093 <span class="comment">//                          1 to display dynamic debug messages (default behavior).</span>
00094 <span class="comment">//                          2 to add extra memory access controls (may slow down the code)</span>
00095 <span class="preprocessor">#ifndef cimg_debug</span>
00096 <span class="preprocessor"></span><span class="preprocessor">#define cimg_debug         1</span>
00097 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00098 <span class="preprocessor"></span>
00099 <span class="comment">// Architecture-dependent includes</span>
00100 <span class="comment">//---------------------------------</span>
00101 <span class="preprocessor">#if cimg_OS==1</span>
00102 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00103 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00104 <span class="preprocessor">#else</span>
00105 <span class="preprocessor"></span><span class="preprocessor">#include &lt;windows.h&gt;</span>
00106 <span class="comment">// Discard unuseful macros in windows.h</span>
00107 <span class="preprocessor">#ifdef min</span>
00108 <span class="preprocessor"></span><span class="preprocessor">#undef min</span>
00109 <span class="preprocessor"></span><span class="preprocessor">#undef max</span>
00110 <span class="preprocessor"></span><span class="preprocessor">#undef abs</span>
00111 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00112 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00113 <span class="preprocessor"></span><span class="preprocessor">#if cimg_display_type==1</span>
00114 <span class="preprocessor"></span><span class="preprocessor">#include &lt;X11/Xlib.h&gt;</span>
00115 <span class="preprocessor">#include &lt;X11/Xutil.h&gt;</span>
00116 <span class="preprocessor">#include &lt;X11/keysym.h&gt;</span>
00117 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
00118 <span class="preprocessor">#endif</span>
00119 <span class="preprocessor"></span>
00120 <span class="comment">// Native PNG and JPEG support</span>
00121 <span class="comment">//-----------------------------</span>
00122 <span class="comment">// Define 'cimg_use_png' or 'cimg_use_jpeg' to enable native PNG or JPEG files support.</span>
00123 <span class="comment">// This requires you link your code either with the zlib/png libraries or the jpeg library.</span>
00124 <span class="preprocessor">#ifdef cimg_use_png</span>
00125 <span class="preprocessor"></span><span class="preprocessor">#include "png.h"</span>
00126 <span class="preprocessor">#endif</span>
00127 <span class="preprocessor"></span><span class="preprocessor">#ifdef cimg_use_jpeg</span>
00128 <span class="preprocessor"></span><span class="preprocessor">#include "jpeglib.h"</span>
00129 <span class="preprocessor">#endif</span>
00130 <span class="preprocessor"></span>
00131 <span class="comment">/*-----------------------------------------------------------------------------------</span>
00132 <span class="comment"></span>
00133 <span class="comment"></span>
00134 <span class="comment">   Define some macros. Macros of the CImg Library are prefixed by 'cimg_'</span>
00135 <span class="comment">   Documented macros below may be safely used in your own code.</span>
00136 <span class="comment"></span>
00137 <span class="comment"></span>
00138 <span class="comment">   ---------------------------------------------------------------------------------*/</span>
00139 
00140 <span class="comment">// Macros used to describe the program usage, and retrieve command line arguments</span>
00141 <span class="comment">// (See corresponding module 'Retrieving command line arguments' in the generated documentation).</span>
00142 <span class="preprocessor">#define cimg_usage(usage) cimg_library::cimg::option((char*)NULL,(unsigned int)argc,(char**)argv,(char*)NULL,(char*)usage)</span>
00143 <span class="preprocessor"></span><span class="preprocessor">#define cimg_option(name,defaut,usage) cimg_library::cimg::option((char*)name,(unsigned int)argc,(char**)argv,defaut,(char*)usage)</span>
00144 <span class="preprocessor"></span>
00145 <span class="comment">// Macros used for dynamic debug messages. Shouldn't be used in your own source code.</span>
00146 <span class="preprocessor">#define cimg_test(x,func)                                               \</span>
00147 <span class="preprocessor">  if(!(x).width || !(x).height || !(x).depth || !(x).dim || !(x).data)  \</span>
00148 <span class="preprocessor">    throw CImgInstanceException("(Instance error) : In function '%s()' ('%s', line %d), CImg&lt;%s&gt; %s = (%d,%d,%d,%d,%p) is empty", \</span>
00149 <span class="preprocessor">                                func,__FILE__,__LINE__,(x).pixel_type(),#x,(x).width,(x).height,(x).depth,(x).dim,(x).data)</span>
00150 <span class="preprocessor"></span><span class="preprocessor">#define cimgl_test(x,func) \</span>
00151 <span class="preprocessor">  if(!(x).size || !(x).data) \</span>
00152 <span class="preprocessor">    throw CImgInstanceException("(Instance error) : In function '%s()' ('%s', line %d), CImgl&lt;%s&gt; %s = (%d,%p) is empty", \</span>
00153 <span class="preprocessor">                                func,__FILE__,__LINE__,(x).pixel_type(),#x,(x).size,(x).data)</span>
00154 <span class="preprocessor"></span><span class="preprocessor">#define cimg_test_scalar(x,func) \</span>
00155 <span class="preprocessor">  if(!(x).width || !(x).height || !(x).depth || (x).dim!=1 || !(x).data) \</span>
00156 <span class="preprocessor">    throw CImgInstanceException("(Instance error) : In function '%s()' ('%s', line %d), CImg&lt;%s&gt; %s = (%d,%d,%d,%d,%p) is not scalar", \</span>
00157 <span class="preprocessor">                                func,__FILE__,__LINE__,(x).pixel_type(),#x,(x).width,(x).height,(x).depth,(x).dim,(x).data)</span>
00158 <span class="preprocessor"></span><span class="preprocessor">#define cimg_test_matrix(x,func) \</span>
00159 <span class="preprocessor">  if(!(x).width || !(x).height || (x).depth!=1 || (x).dim!=1 || !(x).data) \</span>
00160 <span class="preprocessor">    throw CImgInstanceException("(Instance error) : In function '%s()' ('%s', line %d), CImg&lt;%s&gt; %s = (%d,%d,%d,%d,%p) is not a matrix", \</span>
00161 <span class="preprocessor">                                func,__FILE__,__LINE__,(x).pixel_type(),#x,(x).width,(x).height,(x).depth,(x).dim,(x).data)</span>
00162 <span class="preprocessor"></span><span class="preprocessor">#define cimg_test_square(x,func) \</span>
00163 <span class="preprocessor">  if(!(x).width || !(x).height || (x).depth!=1 || (x).dim!=1 || (x).width!=(x).height || !(x).data) \</span>
00164 <span class="preprocessor">    throw CImgInstanceException("(Instance error) : In function '%s()' ('%s', line %d), CImg&lt;%s&gt; %s = (%d,%d,%d,%d,%p) is not a square matrix", \</span>
00165 <span class="preprocessor">                                func,__FILE__,__LINE__,(x).pixel_type,#x,(x).width,(x).height,(x).depth,(x).dim,(x).data)</span>
00166 <span class="preprocessor"></span><span class="preprocessor">#define cimg_test_display(x,func) \</span>
00167 <span class="preprocessor">  if (!(x).width || !(x).height) \</span>
00168 <span class="preprocessor">    throw CImgInstanceException("(Instance error) : In function '%s()' ('%s', l.%d), CImgDisplay %s = (%d,%d) is not a valid display", \</span>
00169 <span class="preprocessor">                                func,__FILE__,__LINE__,#x,(x).width,(x).height)</span>
00170 <span class="preprocessor"></span>  
00171 <span class="comment">// Macros used for neighborhood definitions and manipulations (see module 'Using Image Loops' in the generated documentation).</span>
00172 <span class="preprocessor">#define CImg_2x2(I,T)     T I##cc,I##nc=0,I##cn,I##nn=0</span>
00173 <span class="preprocessor"></span><span class="preprocessor">#define CImg_3x3(I,T)     T I##pp,I##cp,I##np=0,I##pc,I##cc,I##nc=0,I##pn,I##cn,I##nn=0</span>
00174 <span class="preprocessor"></span><span class="preprocessor">#define CImg_4x4(I,T)     T I##pp,I##cp,I##np=0,I##ap=0, \</span>
00175 <span class="preprocessor">                            I##pc,I##cc,I##nc=0,I##ac=0, \</span>
00176 <span class="preprocessor">                            I##pn,I##cn,I##nn=0,I##an=0, \</span>
00177 <span class="preprocessor">                            I##pa,I##ca,I##na=0,I##aa=0</span>
00178 <span class="preprocessor"></span><span class="preprocessor">#define CImg_5x5(I,T)     T I##bb,I##pb,I##cb,I##nb=0,I##ab=0, \</span>
00179 <span class="preprocessor">                            I##bp,I##pp,I##cp,I##np=0,I##ap=0, \</span>
00180 <span class="preprocessor">                            I##bc,I##pc,I##cc,I##nc=0,I##ac=0, \</span>
00181 <span class="preprocessor">                            I##bn,I##pn,I##cn,I##nn=0,I##an=0, \</span>
00182 <span class="preprocessor">                            I##ba,I##pa,I##ca,I##na=0,I##aa=0</span>
00183 <span class="preprocessor"></span><span class="preprocessor">#define CImg_2x2x2(I,T)   T I##ccc,I##ncc=0,I##cnc,I##nnc=0, \</span>
00184 <span class="preprocessor">                            I##ccn,I##ncn=0,I##cnn,I##nnn=0</span>
00185 <span class="preprocessor"></span><span class="preprocessor">#define CImg_3x3x3(I,T)   T I##ppp,I##cpp,I##npp=0,I##pcp,I##ccp,I##ncp=0,I##pnp,I##cnp,I##nnp=0, \</span>
00186 <span class="preprocessor">                            I##ppc,I##cpc,I##npc=0,I##pcc,I##ccc,I##ncc=0,I##pnc,I##cnc,I##nnc=0, \</span>
00187 <span class="preprocessor">                            I##ppn,I##cpn,I##npn=0,I##pcn,I##ccn,I##ncn=0,I##pnn,I##cnn,I##nnn=0</span>
00188 <span class="preprocessor"></span>
00189 <span class="preprocessor">#define CImg_2x2_ref(I,T,tab)   T &amp;I##cc=(tab)[0],&amp;I##nc=(tab)[1],&amp;I##cn=(tab)[2],&amp;I##nn=(tab)[3];</span>
00190 <span class="preprocessor"></span><span class="preprocessor">#define CImg_3x3_ref(I,T,tab)   T &amp;I##pp=(tab)[0],&amp;I##cp=(tab)[1],&amp;I##np=(tab)[2], \</span>
00191 <span class="preprocessor">                                  &amp;I##pc=(tab)[3],&amp;I##cc=(tab)[4],&amp;I##nc=(tab)[5], \</span>
00192 <span class="preprocessor">                                  &amp;I##pn=(tab)[6],&amp;I##cn=(tab)[7],&amp;I##nn=(tab)[8]</span>
00193 <span class="preprocessor"></span><span class="preprocessor">#define CImg_4x4_ref(I,T,tab)   T &amp;I##pp=(tab)[0],&amp;I##cp=(tab)[1],&amp;I##np=(tab)[2],&amp;I##ap=(tab)[3], \</span>
00194 <span class="preprocessor">                                  &amp;I##pc=(tab)[4],&amp;I##cc=(tab)[5],&amp;I##nc=(tab)[6],&amp;I##ap=(tab)[7], \</span>
00195 <span class="preprocessor">                                  &amp;I##pn=(tab)[8],&amp;I##cn=(tab)[9],&amp;I##nn=(tab)[10],&amp;I##aa=(tab)[11], \</span>
00196 <span class="preprocessor">                                  &amp;I##pa=(tab)[12],&amp;I##ca=(tab)[13],&amp;I##na=(tab)[14],&amp;I##aa=(tab)[15]</span>
00197 <span class="preprocessor"></span><span class="preprocessor">#define CImg_5x5_ref(I,T,tab)   T &amp;I##bb=(tab)[0],&amp;I##pb=(tab)[1],&amp;I##cb=(tab)[2],&amp;I##nb=(tab)[3],&amp;I##ab=(tab)[4], \</span>
00198 <span class="preprocessor">                                  &amp;I##bp=(tab)[5],&amp;I##pp=(tab)[6],&amp;I##cp=(tab)[7],&amp;I##np=(tab)[8],&amp;I##ap=(tab)[9], \</span>
00199 <span class="preprocessor">                                  &amp;I##bc=(tab)[10],&amp;I##pc=(tab)[11],&amp;I##cc=(tab)[12],&amp;I##nc=(tab)[13],&amp;I##ac=(tab)[14], \</span>
00200 <span class="preprocessor">                                  &amp;I##bn=(tab)[15],&amp;I##pn=(tab)[16],&amp;I##cn=(tab)[17],&amp;I##nn=(tab)[18],&amp;I##an=(tab)[19], \</span>
00201 <span class="preprocessor">                                  &amp;I##ba=(tab)[20],&amp;I##pa=(tab)[21],&amp;I##ca=(tab)[22],&amp;I##na=(tab)[23],&amp;I##aa=(tab)[24]</span>
00202 <span class="preprocessor"></span><span class="preprocessor">#define CImg_2x2x2_ref(I,T,tab) T &amp;I##ccc=(tab)[0],&amp;I##ncc=(tab)[1],&amp;I##cnc=(tab)[2],&amp;I##nnc=(tab)[3], \</span>
00203 <span class="preprocessor">                                  &amp;I##ccn=(tab)[4],&amp;I##ncn=(tab)[5],&amp;I##cnn=(tab)[6],&amp;I##nnn=(tab)[7]</span>
00204 <span class="preprocessor"></span><span class="preprocessor">#define CImg_3x3x3_ref(I,T,tab) T &amp;I##ppp=(tab)[0],&amp;I##cpp=(tab)[1],&amp;I##npp=(tab)[2], \</span>
00205 <span class="preprocessor">                                  &amp;I##pcp=(tab)[3],&amp;I##ccp=(tab)[4],&amp;I##ncp=(tab)[5], \</span>
00206 <span class="preprocessor">                                  &amp;I##pnp=(tab)[6],&amp;I##cnp=(tab)[7],&amp;I##nnp=(tab)[8], \</span>
00207 <span class="preprocessor">                                  &amp;I##ppc=(tab)[9],&amp;I##cpc=(tab)[10],&amp;I##npc=(tab)[11], \</span>
00208 <span class="preprocessor">                                  &amp;I##pcc=(tab)[12],&amp;I##ccc=(tab)[13],&amp;I##ncc=(tab)[14], \</span>
00209 <span class="preprocessor">                                  &amp;I##pnc=(tab)[15],&amp;I##cnc=(tab)[16],&amp;I##nnc=(tab)[17], \</span>
00210 <span class="preprocessor">                                  &amp;I##ppn=(tab)[18],&amp;I##cpn=(tab)[19],&amp;I##npn=(tab)[20], \</span>
00211 <span class="preprocessor">                                  &amp;I##pcn=(tab)[21],&amp;I##ccn=(tab)[22],&amp;I##ncn=(tab)[23], \</span>
00212 <span class="preprocessor">                                  &amp;I##pnn=(tab)[24],&amp;I##cnn=(tab)[25],&amp;I##nnn=(tab)[26]</span>
00213 <span class="preprocessor"></span>
00214 <span class="preprocessor">#define cimg_squaresum2x2(I) ( I##cc*I##cc + I##nc*I##nc + I##cn*I##cn + I##nn*I##nn )</span>
00215 <span class="preprocessor"></span><span class="preprocessor">#define cimg_squaresum3x3(I) ( I##pp*I##pp + I##cp*I##cp + I##np*I##np + \</span>
00216 <span class="preprocessor">                               I##pc*I##pc + I##cc*I##cc + I##nc*I##nc + \</span>
00217 <span class="preprocessor">                               I##pn*I##pn + I##cn*I##cn + I##nn*I##nn )</span>
00218 <span class="preprocessor"></span><span class="preprocessor">#define cimg_squaresum4x4(I) ( I##pp*I##pp + I##cp*I##cp + I##np*I##np + I##ap*I##ap + \</span>
00219 <span class="preprocessor">                               I##pc*I##pc + I##cc*I##cc + I##nc*I##nc + I##ac*I##ac + \</span>
00220 <span class="preprocessor">                               I##pn*I##pn + I##cn*I##cn + I##nn*I##nn + I##an*I##an + \</span>
00221 <span class="preprocessor">                               I##pa*I##pa + I##ca*I##ca + I##na*I##na + I##aa*I##aa )</span>
00222 <span class="preprocessor"></span><span class="preprocessor">#define cimg_squaresum5x5(I) ( I##bb*I##bb + I##pb*I##pb + I##cb*I##cb + I##nb*I##nb + I##ab*I##ab + \</span>
00223 <span class="preprocessor">                               I##bp*I##bp + I##pp*I##pp + I##cp*I##cp + I##np*I##np + I##ap*I##ap + \</span>
00224 <span class="preprocessor">                               I##bc*I##bc + I##pc*I##pc + I##cc*I##cc + I##nc*I##nc + I##ac*I##ac + \</span>
00225 <span class="preprocessor">                               I##bn*I##bn + I##pn*I##pn + I##cn*I##cn + I##nn*I##nn + I##an*I##an + \</span>
00226 <span class="preprocessor">                               I##ba*I##ba + I##pa*I##pa + I##ca*I##ca + I##na*I##na + I##aa*I##aa )</span>
00227 <span class="preprocessor"></span><span class="preprocessor">#define cimg_squaresum2x2x2(I) ( I##ccc*I##ccc + I##ncc*I##ncc + I##cnc*I##cnc + I##nnc*I##nnc + \</span>
00228 <span class="preprocessor">                                 I##ccn*I##ccn + I##ncn*I##ncn + I##cnn*I##cnn + I##nnn*I##nnn )</span>
00229 <span class="preprocessor"></span><span class="preprocessor">#define cimg_squaresum3x3x3(I) ( I##ppp*I##ppp + I##cpp*I##cpp + I##npp*I##npp + \</span>
00230 <span class="preprocessor">                                 I##pcp*I##pcp + I##ccp*I##ccp + I##ncp*I##ncp + \</span>
00231 <span class="preprocessor">                                 I##pnp*I##pnp + I##cnp*I##cnp + I##nnp*I##nnp + \</span>
00232 <span class="preprocessor">                                 I##ppc*I##ppc + I##cpc*I##cpc + I##npc*I##npc + \</span>
00233 <span class="preprocessor">                                 I##pcc*I##pcc + I##ccc*I##ccc + I##ncc*I##ncc + \</span>
00234 <span class="preprocessor">                                 I##pnc*I##pnc + I##cnc*I##cnc + I##nnc*I##nnc + \</span>
00235 <span class="preprocessor">                                 I##ppn*I##ppn + I##cpn*I##cpn + I##npn*I##npn + \</span>
00236 <span class="preprocessor">                                 I##pcn*I##pcn + I##ccn*I##ccn + I##ncn*I##ncn + \</span>
00237 <span class="preprocessor">                                 I##pnn*I##pnn + I##cnn*I##cnn + I##nnn*I##nnn )</span>
00238 <span class="preprocessor"></span>
00239 <span class="preprocessor">#define cimg_corr2x2(I,m) ( I##cc*(m)(0,0)+I##nc*(m)(1,0)+I##cn*(m)(0,1)+I##nn*(m)(1,1) )</span>
00240 <span class="preprocessor"></span><span class="preprocessor">#define cimg_corr3x3(I,m) ( I##pp*(m)(0,0)+I##cp*(m)(1,0)+I##np*(m)(2,0) + \</span>
00241 <span class="preprocessor">                            I##pc*(m)(0,1)+I##cc*(m)(1,1)+I##nc*(m)(2,1) + \</span>
00242 <span class="preprocessor">                            I##pn*(m)(0,2)+I##cn*(m)(1,2)+I##nn*(m)(2,2) )</span>
00243 <span class="preprocessor"></span><span class="preprocessor">#define cimg_corr4x4(I,m) ( I##pp*(m)(0,0)+I##cp*(m)(1,0)+I##np*(m)(2,0)+I##ap*(m)(3,0) + \</span>
00244 <span class="preprocessor">                            I##pc*(m)(0,1)+I##cc*(m)(1,1)+I##nc*(m)(2,1)+I##ac*(m)(3,1) + \</span>
00245 <span class="preprocessor">                            I##pn*(m)(0,2)+I##cn*(m)(1,2)+I##nn*(m)(2,2)+I##an*(m)(3,2) + \</span>
00246 <span class="preprocessor">                            I##pa*(m)(0,3)+I##ca*(m)(1,3)+I##na*(m)(2,3)+I##aa*(m)(3,3) )</span>
00247 <span class="preprocessor"></span><span class="preprocessor">#define cimg_corr5x5(I,m) ( I##bb*(m)(0,0)+I##pb*(m)(1,0)+I##cb*(m)(2,0)+I##nb*(m)(3,0)+I##ab*(m)(4,0) + \</span>
00248 <span class="preprocessor">                            I##bp*(m)(0,1)+I##pp*(m)(1,1)+I##cp*(m)(2,1)+I##np*(m)(3,1)+I##ap*(m)(4,1) + \</span>
00249 <span class="preprocessor">                            I##bc*(m)(0,2)+I##pc*(m)(1,2)+I##cc*(m)(2,2)+I##nc*(m)(3,2)+I##ac*(m)(4,2) + \</span>
00250 <span class="preprocessor">                            I##bn*(m)(0,3)+I##pn*(m)(1,3)+I##cn*(m)(2,3)+I##nn*(m)(3,3)+I##an*(m)(4,3) + \</span>
00251 <span class="preprocessor">                            I##ba*(m)(0,4)+I##pa*(m)(1,4)+I##ca*(m)(2,4)+I##na*(m)(3,4)+I##aa*(m)(4,4) )</span>
00252 <span class="preprocessor"></span><span class="preprocessor">#define cimg_corr2x2x2(I,m) ( I##ccc*(m)(0,0,0)+I##ncc*(m)(1,0,0)+I##cnc*(m)(0,1,0)+I##nnc*(m)(1,1,0) + \</span>
00253 <span class="preprocessor">                              I##ccn*(m)(0,0,1)+I##ncn*(m)(1,0,1)+I##cnn*(m)(0,1,1)+I##nnn*(m)(1,1,1) )</span>
00254 <span class="preprocessor"></span><span class="preprocessor">#define cimg_corr3x3x3(I,m) ( I##ppp*(m)(0,0,0)+I##cpp*(m)(1,0,0)+I##npp*(m)(2,0,0) + \</span>
00255 <span class="preprocessor">                              I##pcp*(m)(0,1,0)+I##ccp*(m)(1,1,0)+I##ncp*(m)(2,1,0) + \</span>
00256 <span class="preprocessor">                              I##pnp*(m)(0,2,0)+I##cnp*(m)(1,2,0)+I##nnp*(m)(2,2,0) + \</span>
00257 <span class="preprocessor">                              I##ppc*(m)(0,0,1)+I##cpc*(m)(1,0,1)+I##npc*(m)(2,0,1) + \</span>
00258 <span class="preprocessor">                              I##pcc*(m)(0,1,1)+I##ccc*(m)(1,1,1)+I##ncc*(m)(2,1,1) + \</span>
00259 <span class="preprocessor">                              I##pnc*(m)(0,2,1)+I##cnc*(m)(1,2,1)+I##nnc*(m)(2,2,1) + \</span>
00260 <span class="preprocessor">                              I##ppn*(m)(0,0,2)+I##cpn*(m)(1,0,2)+I##npn*(m)(2,0,2) + \</span>
00261 <span class="preprocessor">                              I##pcn*(m)(0,1,2)+I##ccn*(m)(1,1,2)+I##ncn*(m)(2,1,2) + \</span>
00262 <span class="preprocessor">                              I##pnn*(m)(0,2,2)+I##cnn*(m)(1,2,2)+I##nnn*(m)(2,2,2) )</span>
00263 <span class="preprocessor"></span>
00264 <span class="preprocessor">#define cimg_conv2x2(I,m) ( I##cc*(m)(1,1)+I##nc*(m)(0,1)+I##cn*(m)(1,0)+I##nn*(m)(0,0) )</span>
00265 <span class="preprocessor"></span><span class="preprocessor">#define cimg_conv3x3(I,m) ( I##pp*(m)(2,2)+I##cp*(m)(1,2)+I##np*(m)(0,2) + \</span>
00266 <span class="preprocessor">                            I##pc*(m)(2,1)+I##cc*(m)(1,1)+I##nc*(m)(0,1) + \</span>
00267 <span class="preprocessor">                            I##pn*(m)(2,0)+I##cn*(m)(1,0)+I##nn*(m)(0,0) )</span>
00268 <span class="preprocessor"></span><span class="preprocessor">#define cimg_conv4x4(I,m) ( I##pp*(m)(3,3)+I##cp*(m)(2,3)+I##np*(m)(1,3)+I##ap*(m)(0,3) + \</span>
00269 <span class="preprocessor">                            I##pc*(m)(3,2)+I##cc*(m)(2,2)+I##nc*(m)(1,2)+I##ac*(m)(0,2) + \</span>
00270 <span class="preprocessor">                            I##pn*(m)(3,1)+I##cn*(m)(2,1)+I##nn*(m)(1,1)+I##an*(m)(0,1) + \</span>
00271 <span class="preprocessor">                            I##pa*(m)(3,0)+I##ca*(m)(2,0)+I##na*(m)(1,0)+I##aa*(m)(0,0) )</span>
00272 <span class="preprocessor"></span><span class="preprocessor">#define cimg_conv5x5(I,m) ( I##bb*(m)(4,4)+I##pb*(m)(3,4)+I##cb*(m)(2,4)+I##nb*(m)(1,4)+I##ab*(m)(0,4) + \</span>
00273 <span class="preprocessor">                            I##bp*(m)(4,3)+I##pp*(m)(3,3)+I##cp*(m)(2,3)+I##np*(m)(1,3)+I##ap*(m)(0,3) + \</span>
00274 <span class="preprocessor">                            I##bc*(m)(4,2)+I##pc*(m)(3,2)+I##cc*(m)(2,2)+I##nc*(m)(1,2)+I##ac*(m)(0,2) + \</span>
00275 <span class="preprocessor">                            I##bn*(m)(4,1)+I##pn*(m)(3,1)+I##cn*(m)(2,1)+I##nn*(m)(1,1)+I##an*(m)(0,1) + \</span>
00276 <span class="preprocessor">                            I##ba*(m)(4,0)+I##pa*(m)(3,0)+I##ca*(m)(2,0)+I##na*(m)(1,0)+I##aa*(m)(0,0) )</span>
00277 <span class="preprocessor"></span><span class="preprocessor">#define cimg_conv2x2x2(I,m) ( I##ccc*(m)(1,1,1)+I##ncc*(m)(0,1,1)+I##cnc*(m)(1,0,1)+I##nnc*(m)(0,0,1) + \</span>
00278 <span class="preprocessor">                              I##ccn*(m)(1,1,0)+I##ncn*(m)(0,1,0)+I##cnn*(m)(1,0,0)+I##nnn*(m)(0,0,0) )</span>
00279 <span class="preprocessor"></span><span class="preprocessor">#define cimg_conv3x3x3(I,m) ( I##ppp*(m)(2,2,2)+I##cpp*(m)(1,2,2)+I##npp*(m)(0,2,2) + \</span>
00280 <span class="preprocessor">                              I##pcp*(m)(2,1,2)+I##ccp*(m)(1,1,2)+I##ncp*(m)(0,1,2) + \</span>
00281 <span class="preprocessor">                              I##pnp*(m)(2,0,2)+I##cnp*(m)(1,0,2)+I##nnp*(m)(0,0,2) + \</span>
00282 <span class="preprocessor">                              I##ppc*(m)(2,2,1)+I##cpc*(m)(1,2,1)+I##npc*(m)(0,2,1) + \</span>
00283 <span class="preprocessor">                              I##pcc*(m)(2,1,1)+I##ccc*(m)(1,1,1)+I##ncc*(m)(0,1,1) + \</span>
00284 <span class="preprocessor">                              I##pnc*(m)(2,0,1)+I##cnc*(m)(1,0,1)+I##nnc*(m)(0,0,1) + \</span>
00285 <span class="preprocessor">                              I##ppn*(m)(2,2,0)+I##cpn*(m)(1,2,0)+I##npn*(m)(0,2,0) + \</span>
00286 <span class="preprocessor">                              I##pcn*(m)(2,1,0)+I##ccn*(m)(1,1,0)+I##ncn*(m)(0,1,0) + \</span>
00287 <span class="preprocessor">                              I##pnn*(m)(2,0,0)+I##cnn*(m)(1,0,0)+I##nnn*(m)(0,0,0) )</span>
00288 <span class="preprocessor"></span>
00289 <span class="preprocessor">#define cimg_get2x2(img,x,y,z,v,I) I##cc=(img)(x,    y,z,v), I##nc=(img)(_n##x,    y,z,v), \</span>
00290 <span class="preprocessor">    I##cn=(img)(x,_n##y,z,v), I##nn=(img)(_n##x,_n##y,z,v)</span>
00291 <span class="preprocessor"></span><span class="preprocessor">#define cimg_get3x3(img,x,y,z,v,I) I##pp=(img)(_p##x,_p##y,z,v), I##cp=(img)(x,_p##y,z,v), I##np=(img)(_n##x,_p##y,z,v), \</span>
00292 <span class="preprocessor">    I##pc=(img)(_p##x,    y,z,v), I##cc=(img)(x,    y,z,v), I##nc=(img)(_n##x,    y,z,v), \</span>
00293 <span class="preprocessor">    I##pn=(img)(_p##x,_n##y,z,v), I##cn=(img)(x,_n##y,z,v), I##nn=(img)(_n##x,_n##y,z,v)</span>
00294 <span class="preprocessor"></span><span class="preprocessor">#define cimg_get4x4(img,x,y,z,v,I)                                      \</span>
00295 <span class="preprocessor">  I##pp=(img)(_p##x,_p##y,z,v), I##cp=(img)(x,_p##y,z,v), I##np=(img)(_n##x,_p##y,z,v), I##ap=(img)(_a##x,_p##y,z,v), \</span>
00296 <span class="preprocessor">    I##pc=(img)(_p##x,    y,z,v), I##cc=(img)(x,    y,z,v), I##nc=(img)(_n##x,    y,z,v), I##ac=(img)(_a##x,    y,z,v), \</span>
00297 <span class="preprocessor">    I##pn=(img)(_p##x,_n##y,z,v), I##cn=(img)(x,_n##y,z,v), I##nn=(img)(_n##x,_n##y,z,v), I##an=(img)(_a##x,_n##y,z,v), \</span>
00298 <span class="preprocessor">    I##pa=(img)(_p##x,_a##y,z,v), I##ca=(img)(x,_a##y,z,v), I##na=(img)(_n##x,_a##y,z,v), I##aa=(img)(_a##x,_a##y,z,v)</span>
00299 <span class="preprocessor"></span><span class="preprocessor">#define cimg_get5x5(img,x,y,z,v,I)                                      \</span>
00300 <span class="preprocessor">  I##bb=(img)(_b##x,_b##y,z,v), I##pb=(img)(_p##x,_b##y,z,v), I##cb=(img)(x,_b##y,z,v), I##nb=(img)(_n##x,_b##y,z,v), I##ab=(img)(_a##x,_b##y,z,v), \</span>
00301 <span class="preprocessor">    I##bp=(img)(_b##x,_p##y,z,v), I##pp=(img)(_p##x,_p##y,z,v), I##cp=(img)(x,_p##y,z,v), I##np=(img)(_n##x,_p##y,z,v), I##ap=(img)(_a##x,_p##y,z,v), \</span>
00302 <span class="preprocessor">    I##bc=(img)(_b##x,    y,z,v), I##pc=(img)(_p##x,    y,z,v), I##cc=(img)(x,    y,z,v), I##nc=(img)(_n##x,    y,z,v), I##ac=(img)(_a##x,    y,z,v), \</span>
00303 <span class="preprocessor">    I##bn=(img)(_b##x,_n##y,z,v), I##pn=(img)(_p##x,_n##y,z,v), I##cn=(img)(x,_n##y,z,v), I##nn=(img)(_n##x,_n##y,z,v), I##an=(img)(_a##x,_n##y,z,v), \</span>
00304 <span class="preprocessor">    I##ba=(img)(_b##x,_a##y,z,v), I##pa=(img)(_p##x,_a##y,z,v), I##ca=(img)(x,_a##y,z,v), I##na=(img)(_n##x,_a##y,z,v), I##aa=(img)(_a##x,_a##y,z,v)</span>
00305 <span class="preprocessor"></span><span class="preprocessor">#define cimg_get2x2x2(img,x,y,z,v,I)                                    \</span>
00306 <span class="preprocessor">  I##ccc=(img)(x,y,    z,v), I##ncc=(img)(_n##x,y,    z,v), I##cnc=(img)(x,_n##y,    z,v), I##nnc=(img)(_n##x,_n##y,    z,v), \</span>
00307 <span class="preprocessor">    I##ccc=(img)(x,y,_n##z,v), I##ncc=(img)(_n##x,y,_n##z,v), I##cnc=(img)(x,_n##y,_n##z,v), I##nnc=(img)(_n##x,_n##y,_n##z,v)</span>
00308 <span class="preprocessor"></span><span class="preprocessor">#define cimg_get3x3x3(img,x,y,z,v,I)                                    \</span>
00309 <span class="preprocessor">  I##ppp=(img)(_p##x,_p##y,_p##z,v), I##cpp=(img)(x,_p##y,_p##z,v), I##npp=(img)(_n##x,_p##y,_p##z,v), \</span>
00310 <span class="preprocessor">    I##pcp=(img)(_p##x,    y,_p##z,v), I##ccp=(img)(x,    y,_p##z,v), I##ncp=(img)(_n##x,    y,_p##z,v), \</span>
00311 <span class="preprocessor">    I##pnp=(img)(_p##x,_n##y,_p##z,v), I##cnp=(img)(x,_n##y,_p##z,v), I##nnp=(img)(_n##x,_n##y,_p##z,v), \</span>
00312 <span class="preprocessor">    I##ppc=(img)(_p##x,_p##y,    z,v), I##cpc=(img)(x,_p##y,    z,v), I##npc=(img)(_n##x,_p##y,    z,v), \</span>
00313 <span class="preprocessor">    I##pcc=(img)(_p##x,    y,    z,v), I##ccc=(img)(x,    y,    z,v), I##ncc=(img)(_n##x,    y,    z,v), \</span>
00314 <span class="preprocessor">    I##pnc=(img)(_p##x,_n##y,    z,v), I##cnc=(img)(x,_n##y,    z,v), I##nnc=(img)(_n##x,_n##y,    z,v), \</span>
00315 <span class="preprocessor">    I##ppn=(img)(_p##x,_p##y,_n##z,v), I##cpn=(img)(x,_p##y,_n##z,v), I##npn=(img)(_n##x,_p##y,_n##z,v), \</span>
00316 <span class="preprocessor">    I##pcn=(img)(_p##x,    y,_n##z,v), I##ccn=(img)(x,    y,_n##z,v), I##ncn=(img)(_n##x,    y,_n##z,v), \</span>
00317 <span class="preprocessor">    I##pnn=(img)(_p##x,_n##y,_n##z,v), I##cnn=(img)(x,_n##y,_n##z,v), I##nnn=(img)(_n##x,_n##y,_n##z,v)</span>
00318 <span class="preprocessor"></span>
00319 <span class="preprocessor">#define cimg_3x3to5x5(I,u) u##bb=I##pp,u##cb=I##cp,u##ab=I##np,u##bc=I##pc,u##cc=I##cc,u##ac=I##nc,u##ba=I##pn,u##ca=I##cn,u##aa=I##nn, \</span>
00320 <span class="preprocessor">    u##pb=0.5*(u##bb+u##cb),u##nb=0.5*(u##cb+u##ab),u##pc=0.5*(u##bc+u##cc),u##nc=0.5*(u##cc+u##ac),u##pa=0.5*(u##ba+u##ca),u##na=0.5*(u##ca+u##aa), \</span>
00321 <span class="preprocessor">    u##bp=0.5*(u##bb+u##bc),u##bn=0.5*(u##bc+u##ba),u##cp=0.5*(u##cb+u##cc),u##cn=0.5*(u##cc+u##ca),u##ap=0.5*(u##ab+u##ac),u##an=0.5*(u##ac+u##aa), \</span>
00322 <span class="preprocessor">    u##pp=0.5*(u##bp+u##cp),u##np=0.5*(u##cp+u##ap),u##pn=0.5*(u##bn+u##cn),u##nn=0.5*(u##cn+u##an)</span>
00323 <span class="preprocessor"></span>
00324 <span class="comment">// Macros used to define special image loops (see module 'Using Image Loops' in the generated documentation).</span>
00325 <span class="preprocessor">#define cimg_map(img,ptr,T_ptr)   for (T_ptr *ptr=(img).data+(img).size()-1; ptr&gt;=(img).data; ptr--)</span>
00326 <span class="preprocessor"></span><span class="preprocessor">#define cimgl_map(list,l)         for (unsigned int l=0; l&lt;(list).size; l++)</span>
00327 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapoff(img,off)      for (unsigned int off=0; off&lt;(img).size(); off++)</span>
00328 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapX(img,x)          for (int x=0; x&lt;(int)((img).width); x++)</span>
00329 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapY(img,y)          for (int y=0; y&lt;(int)((img).height);y++)</span>
00330 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapZ(img,z)          for (int z=0; z&lt;(int)((img).depth); z++)</span>
00331 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapV(img,v)          for (int v=0; v&lt;(int)((img).dim);   v++)</span>
00332 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXY(img,x,y)       cimg_mapY(img,y) cimg_mapX(img,x)</span>
00333 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXZ(img,x,z)       cimg_mapZ(img,z) cimg_mapX(img,x)</span>
00334 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapYZ(img,y,z)       cimg_mapZ(img,z) cimg_mapY(img,y)</span>
00335 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXV(img,x,v)       cimg_mapV(img,v) cimg_mapX(img,x)</span>
00336 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapYV(img,y,v)       cimg_mapV(img,v) cimg_mapY(img,y)</span>
00337 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapZV(img,z,v)       cimg_mapV(img,v) cimg_mapZ(img,z)</span>
00338 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXYZ(img,x,y,z)    cimg_mapZ(img,z) cimg_mapXY(img,x,y)</span>
00339 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXYV(img,x,y,v)    cimg_mapV(img,v) cimg_mapXY(img,x,y)</span>
00340 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXZV(img,x,z,v)    cimg_mapV(img,v) cimg_mapXZ(img,x,z)</span>
00341 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapYZV(img,y,z,v)    cimg_mapV(img,v) cimg_mapYZ(img,y,z)</span>
00342 <span class="preprocessor"></span><span class="preprocessor">#define cimg_mapXYZV(img,x,y,z,v) cimg_mapV(img,v) cimg_mapXYZ(img,x,y,z)</span>
00343 <span class="preprocessor"></span><span class="preprocessor">#define cimg_imapX(img,x,n)       for (int x=n; x&lt;(int)((img).width-n); x++)</span>
00344 <span class="preprocessor"></span><span class="preprocessor">#define cimg_imapY(img,y,n)       for (int y=n; y&lt;(int)((img).height-n); y++)</span>
00345 <span class="preprocessor"></span><span class="preprocessor">#define cimg_imapZ(img,z,n)       for (int z=n; z&lt;(int)((img).depth-n); z++)</span>
00346 <span class="preprocessor"></span><span class="preprocessor">#define cimg_imapV(img,v,n)       for (int v=n; v&lt;(int)((img).dim-n); v++)</span>
00347 <span class="preprocessor"></span><span class="preprocessor">#define cimg_imapXY(img,x,y,n)    cimg_imapY(img,y,n) cimg_imapX(img,x,n)</span>
00348 <span class="preprocessor"></span><span class="preprocessor">#define cimg_imapXYZ(img,x,y,z,n) cimg_imapZ(img,z,n) cimg_imapXY(img,x,y,n)</span>
00349 <span class="preprocessor"></span><span class="preprocessor">#define cimg_bmapX(img,x,n)       for (int x=0; x&lt;(int)((img).width);  x==(n)-1?(x=(img).width-(n)): x++)</span>
00350 <span class="preprocessor"></span><span class="preprocessor">#define cimg_bmapY(img,y,n)       for (int y=0; y&lt;(int)((img).height); y==(n)-1?(x=(img).height-(n)):y++)</span>
00351 <span class="preprocessor"></span><span class="preprocessor">#define cimg_bmapZ(img,z,n)       for (int z=0; z&lt;(int)((img).depth);  z==(n)-1?(x=(img).depth-(n)): z++)</span>
00352 <span class="preprocessor"></span><span class="preprocessor">#define cimg_bmapV(img,v,n)       for (int v=0; v&lt;(int)((img).dim);    v==(n)-1?(x=(img).dim-(n)):   v++)</span>
00353 <span class="preprocessor"></span><span class="preprocessor">#define cimg_bmapXY(img,x,y,n)    cimg_mapY(img,y) for (int x=0; x&lt;(int)((img).width); (y&lt;(n) || y&gt;=(int)((img).height)-(n))?x++: \</span>
00354 <span class="preprocessor">                                                          ((x&lt;(n)-1 || x&gt;=(int)((img).width)-(n))?x++:(x=(img).width-(n))))</span>
00355 <span class="preprocessor"></span><span class="preprocessor">#define cimg_bmapXYZ(img,x,y,z,n) cimg_mapYZ(img,y,z) for (int x=0; x&lt;(int)((img).width); (y&lt;(n) || y&gt;=(int)((img).height)-(n) || z&lt;(n) || z&gt;=(int)((img).depth)-(n))?x++: \</span>
00356 <span class="preprocessor">                                                             ((x&lt;(n)-1 || x&gt;=(int)((img).width)-(n))?x++:(x=(img).width-(n))))</span>
00357 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapX(img,x)         for (int x=0,_n##x=1; _n##x&lt;(int)((img).width)   || x==--_n##x; x++, _n##x++)</span>
00358 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapY(img,y)         for (int y=0,_n##y=1; _n##y&lt;(int)((img).height)  || y==--_n##y; y++, _n##y++)</span>
00359 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapZ(img,z)         for (int z=0,_n##z=1; _n##z&lt;(int)((img).depth)   || z==--_n##z; z++, _n##z++)</span>
00360 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapXY(img,x,y)      cimg_2mapY(img,y) cimg_2mapX(img,x)</span>
00361 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapXZ(img,x,z)      cimg_2mapZ(img,z) cimg_2mapX(img,x)</span>
00362 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapYZ(img,y,z)      cimg_2mapZ(img,z) cimg_2mapY(img,y)</span>
00363 <span class="preprocessor"></span><span class="preprocessor">#define cimg_2mapXYZ(img,x,y,z)   cimg_2mapZ(img,z) cimg_2mapXY(img,x,y)</span>
00364 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapX(img,x)         for (int x=0,_p##x=0,_n##x=1; _n##x&lt;(int)((img).width)  || x==--_n##x;  _p##x=x++,_n##x++)</span>
00365 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapY(img,y)         for (int y=0,_p##y=0,_n##y=1; _n##y&lt;(int)((img).height) || y==--_n##y;  _p##y=y++,_n##y++)</span>
00366 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapZ(img,z)         for (int z=0,_p##z=0,_n##z=1; _n##z&lt;(int)((img).depth)  || z==--_n##z;  _p##z=z++,_n##z++)</span>
00367 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapXY(img,x,y)      cimg_3mapY(img,y) cimg_3mapX(img,x)</span>
00368 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapXZ(img,x,z)      cimg_3mapZ(img,z) cimg_3mapX(img,x)</span>
00369 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapYZ(img,y,z)      cimg_3mapZ(img,z) cimg_3mapY(img,y)</span>
00370 <span class="preprocessor"></span><span class="preprocessor">#define cimg_3mapXYZ(img,x,y,z)   cimg_3mapZ(img,z) cimg_3mapXY(img,x,y)</span>
00371 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapX(img,x)         for (int _p##x=0,x=0,_n##x=1,_a##x=2; \</span>
00372 <span class="preprocessor">                                       _a##x&lt;(int)((img).width)  || _n##x==--_a##x || x==(_a##x=--_n##x); \</span>
00373 <span class="preprocessor">                                       _p##x=x++,_n##x++,_a##x++)</span>
00374 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapY(img,y)         for (int _p##y=0,y=0,_n##y=1,_a##y=2; \</span>
00375 <span class="preprocessor">                                       _a##y&lt;(int)((img).height) || _n##y==--_a##y || y==(_a##y=--_n##y); \</span>
00376 <span class="preprocessor">                                       _p##y=y++,_n##y++,_a##y++)</span>
00377 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapZ(img,z)         for (int _p##z=0,z=0,_n##z=1,_a##z=2; \</span>
00378 <span class="preprocessor">                                       _a##z&lt;(int)((img).depth)  || _n##z==--_a##z || z==(_a##z=--_n##z); \</span>
00379 <span class="preprocessor">                                       _p##z=z++,_n##z++,_a##z++)</span>
00380 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapXY(img,x,y)      cimg_4mapY(img,y) cimg_4mapX(img,x)</span>
00381 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapXZ(img,x,z)      cimg_4mapZ(img,z) cimg_4mapX(img,x)</span>
00382 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapYZ(img,y,z)      cimg_4mapZ(img,z) cimg_4mapY(img,y)</span>
00383 <span class="preprocessor"></span><span class="preprocessor">#define cimg_4mapXYZ(img,x,y,z)   cimg_4mapZ(img,z) cimg_4mapXY(img,x,y)</span>
00384 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapX(img,x)         for (int _b##x=0,_p##x=0,x=0,_n##x=1,_a##x=2; \</span>
00385 <span class="preprocessor">                                       _a##x&lt;(int)((img).width)  || _n##x==--_a##x || x==(_a##x=--_n##x); \</span>
00386 <span class="preprocessor">                                       _b##x=_p##x,_p##x=x++,_n##x++,_a##x++)</span>
00387 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapY(img,y)         for (int _b##y=0,_p##y=0,y=0,_n##y=1,_a##y=2; \</span>
00388 <span class="preprocessor">                                       _a##y&lt;(int)((img).height) || _n##y==--_a##y || y==(_a##y=--_n##y); \</span>
00389 <span class="preprocessor">                                       _b##y=_p##y,_p##y=y++,_n##y++,_a##y++)</span>
00390 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapZ(img,z)         for (int _b##z=0,_p##z=0,z=0,_n##z=1,_a##z=2; \</span>
00391 <span class="preprocessor">                                       _a##z&lt;(int)((img).depth)  || _n##z==--_a##z || z==(_a##z=--_n##z); \</span>
00392 <span class="preprocessor">                                       _b##z=_p##z,_p##z=z++,_n##z++,_a##z++)</span>
00393 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapXY(img,x,y)      cimg_5mapY(img,y) cimg_5mapX(img,x)</span>
00394 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapXZ(img,x,z)      cimg_5mapZ(img,z) cimg_5mapX(img,x)</span>
00395 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapYZ(img,y,z)      cimg_5mapZ(img,z) cimg_5mapY(img,y)</span>
00396 <span class="preprocessor"></span><span class="preprocessor">#define cimg_5mapXYZ(img,x,y,z)   cimg_5mapZ(img,z) cimg_5mapXY(img,x,y)</span>
00397 <span class="preprocessor"></span>
00398 <span class="preprocessor">#define cimg_map2x2(img,x,y,z,v,I) cimg_2mapY(img,y)                    \</span>
00399 <span class="preprocessor">       for (int _n##x=1, x=((int)(I##cc=(img)(0,  y,z,v),               \</span>
00400 <span class="preprocessor">                                  I##cn=(img)(0,_n##y,z,v)),0);         \</span>
00401 <span class="preprocessor">            (_n##x&lt;(int)((img).width) &amp;&amp; (                              \</span>
00402 <span class="preprocessor">                                          I##nc=(img)(_n##x,    y,z,v), \</span>
00403 <span class="preprocessor">                                          I##nn=(img)(_n##x,_n##y,z,v), \</span>
00404 <span class="preprocessor">                                          1)) || x==--_n##x;            \</span>
00405 <span class="preprocessor">            I##cc=I##nc, I##cn=I##nn,                                   \</span>
00406 <span class="preprocessor">              x++,_n##x++ )</span>
00407 <span class="preprocessor"></span>
00408 <span class="preprocessor">#define cimg_map3x3(img,x,y,z,v,I) cimg_3mapY(img,y)                    \</span>
00409 <span class="preprocessor">       for (int _n##x=1, _p##x=(int)(I##cp=I##pp=(img)(0,_p##y,z,v),    \</span>
00410 <span class="preprocessor">                                     I##cc=I##pc=(img)(0,  y,z,v),      \</span>
00411 <span class="preprocessor">                                     I##cn=I##pn=(img)(0,_n##y,z,v)     \</span>
00412 <span class="preprocessor">                                     ), x=_p##x=0;                      \</span>
00413 <span class="preprocessor">            (_n##x&lt;(int)((img).width) &amp;&amp; (                              \</span>
00414 <span class="preprocessor">                                          I##np=(img)(_n##x,_p##y,z,v), \</span>
00415 <span class="preprocessor">                                          I##nc=(img)(_n##x,    y,z,v), \</span>
00416 <span class="preprocessor">                                          I##nn=(img)(_n##x,_n##y,z,v), \</span>
00417 <span class="preprocessor">                                          1)) || x==--_n##x;            \</span>
00418 <span class="preprocessor">            I##pp=I##cp, I##pc=I##cc, I##pn=I##cn,                      \</span>
00419 <span class="preprocessor">              I##cp=I##np, I##cc=I##nc, I##cn=I##nn,                    \</span>
00420 <span class="preprocessor">              _p##x=x++,_n##x++ )</span>
00421 <span class="preprocessor"></span>
00422 <span class="preprocessor">#define cimg_map4x4(img,x,y,z,v,I) cimg_4mapY(img,y)                    \</span>
00423 <span class="preprocessor">       for (int _a##x=2, _n##x=1, x=((int)(I##cp=I##pp=(img)(0,_p##y,z,v), \</span>
00424 <span class="preprocessor">                                           I##cc=I##pc=(img)(0,    y,z,v), \</span>
00425 <span class="preprocessor">                                           I##cn=I##pn=(img)(0,_n##y,z,v), \</span>
00426 <span class="preprocessor">                                           I##ca=I##pa=(img)(0,_a##y,z,v), \</span>
00427 <span class="preprocessor">                                           I##np=(img)(_n##x,_p##y,z,v), \</span>
00428 <span class="preprocessor">                                           I##nc=(img)(_n##x,    y,z,v), \</span>
00429 <span class="preprocessor">                                           I##nn=(img)(_n##x,_n##y,z,v), \</span>
00430 <span class="preprocessor">                                           I##na=(img)(_n##x,_a##y,z,v)),0), \</span>
00431 <span class="preprocessor">              _p##x=0;                                                  \</span>
00432 <span class="preprocessor">            (_a##x&lt;(int)((img).width) &amp;&amp; (                              \</span>
00433 <span class="preprocessor">                                          I##ap=(img)(_a##x,_p##y,z,v), \</span>
00434 <span class="preprocessor">                                          I##ac=(img)(_a##x,    y,z,v), \</span>
00435 <span class="preprocessor">                                          I##an=(img)(_a##x,_n##y,z,v), \</span>
00436 <span class="preprocessor">                                          I##aa=(img)(_a##x,_a##y,z,v), \</span>
00437 <span class="preprocessor">                                          1)) || _n##x==--_a##x || x==(_a##x=--_n##x); \</span>
00438 <span class="preprocessor">            I##pp=I##cp, I##pc=I##cc, I##pn=I##cn, I##pa=I##ca,         \</span>
00439 <span class="preprocessor">              I##cp=I##np, I##cc=I##nc, I##cn=I##nn, I##ca=I##na,       \</span>
00440 <span class="preprocessor">              I##np=I##ap, I##nc=I##ac, I##nn=I##an, I##na=I##aa,       \</span>
00441 <span class="preprocessor">              _p##x=x++, _n##x++, _a##x++ )</span>
00442 <span class="preprocessor"></span>
00443 <span class="preprocessor">#define cimg_map5x5(img,x,y,z,v,I) cimg_5mapY(img,y)                    \</span>
00444 <span class="preprocessor">       for (int _a##x=2, _n##x=1, _b##x=(int)(I##cb=I##pb=I##bb=(img)(0,_b##y,z,v), \</span>
00445 <span class="preprocessor">                                              I##cp=I##pp=I##bp=(img)(0,_p##y,z,v), \</span>
00446 <span class="preprocessor">                                              I##cc=I##pc=I##bc=(img)(0,    y,z,v), \</span>
00447 <span class="preprocessor">                                              I##cn=I##pn=I##bn=(img)(0,_n##y,z,v), \</span>
00448 <span class="preprocessor">                                              I##ca=I##pa=I##ba=(img)(0,_a##y,z,v), \</span>
00449 <span class="preprocessor">                                              I##nb=(img)(_n##x,_b##y,z,v), \</span>
00450 <span class="preprocessor">                                              I##np=(img)(_n##x,_p##y,z,v), \</span>
00451 <span class="preprocessor">                                              I##nc=(img)(_n##x,   y,z,v), \</span>
00452 <span class="preprocessor">                                              I##nn=(img)(_n##x,_n##y,z,v), \</span>
00453 <span class="preprocessor">                                              I##na=(img)(_n##x,_a##y,z,v)), \</span>
00454 <span class="preprocessor">              x=0, _p##x=_b##x=0;                                       \</span>
00455 <span class="preprocessor">            (_a##x&lt;(int)((img).width) &amp;&amp; (                              \</span>
00456 <span class="preprocessor">                                          I##ab=(img)(_a##x,_b##y,z,v), \</span>
00457 <span class="preprocessor">                                          I##ap=(img)(_a##x,_p##y,z,v), \</span>
00458 <span class="preprocessor">                                          I##ac=(img)(_a##x,    y,z,v), \</span>
00459 <span class="preprocessor">                                          I##an=(img)(_a##x,_n##y,z,v), \</span>
00460 <span class="preprocessor">                                          I##aa=(img)(_a##x,_a##y,z,v), \</span>
00461 <span class="preprocessor">                                          1)) || _n##x==--_a##x || x==(_a##x=--_n##x); \</span>
00462 <span class="preprocessor">            I##bb=I##pb, I##bp=I##pp, I##bc=I##pc, I##bn=I##pn, I##ba=I##pa, \</span>
00463 <span class="preprocessor">              I##pb=I##cb, I##pp=I##cp, I##pc=I##cc, I##pn=I##cn, I##pa=I##ca, \</span>
00464 <span class="preprocessor">              I##cb=I##nb, I##cp=I##np, I##cc=I##nc, I##cn=I##nn, I##ca=I##na, \</span>
00465 <span class="preprocessor">              I##nb=I##ab, I##np=I##ap, I##nc=I##ac, I##nn=I##an, I##na=I##aa, \</span>
00466 <span class="preprocessor">              _b##x=_p##x, _p##x=x++, _n##x++, _a##x++ )</span>
00467 <span class="preprocessor"></span>
00468 <span class="preprocessor">#define cimg_map2x2x2(img,x,y,z,v,I) cimg_2mapYZ(img,y,z)               \</span>
00469 <span class="preprocessor">       for (int _n##x=1, x=((int)(I##ccc=(img)(0,    y,    z,v),        \</span>
00470 <span class="preprocessor">                                  I##cnc=(img)(0,_n##y,    z,v),        \</span>
00471 <span class="preprocessor">                                  I##ccn=(img)(0,    y,_n##z,v),        \</span>
00472 <span class="preprocessor">                                  I##cnn=(img)(0,_n##y,_n##z,v)),0);    \</span>
00473 <span class="preprocessor">            (_n##x&lt;(int)((img).width) &amp;&amp; (                              \</span>
00474 <span class="preprocessor">                                          I##ncc=(img)(_n##x,    y,    z,v), \</span>
00475 <span class="preprocessor">                                          I##nnc=(img)(_n##x,_n##y,    z,v), \</span>
00476 <span class="preprocessor">                                          I##ncn=(img)(_n##x,    y,_n##z,v), \</span>
00477 <span class="preprocessor">                                          I##nnn=(img)(_n##x,_n##y,_n##z,v), \</span>
00478 <span class="preprocessor">                                          1)) || x==--_n##x;            \</span>
00479 <span class="preprocessor">            I##ccc=I##ncc, I##cnc=I##nnc,                               \</span>
00480 <span class="preprocessor">              I##ccn=I##ncn, I##cnn=I##nnn,                             \</span>
00481 <span class="preprocessor">              x++, _n##x++ )</span>
00482 <span class="preprocessor"></span>
00483 <span class="preprocessor">#define cimg_map3x3x3(img,x,y,z,v,I) cimg_3mapYZ(img,y,z)               \</span>
00484 <span class="preprocessor">       for (int _n##x=1, _p##x=(int)(I##cpp=I##ppp=(img)(0,_p##y,_p##z,v), \</span>
00485 <span class="preprocessor">                                     I##ccp=I##pcp=(img)(0,    y,_p##z,v), \</span>
00486 <span class="preprocessor">                                     I##cnp=I##pnp=(img)(0,_n##y,_p##z,v), \</span>
00487 <span class="preprocessor">                                     I##cpc=I##ppc=(img)(0,_p##y,    z,v), \</span>
00488 <span class="preprocessor">                                     I##ccc=I##pcc=(img)(0,    y,    z,v), \</span>
00489 <span class="preprocessor">                                     I##cnc=I##pnc=(img)(0,_n##y,    z,v), \</span>
00490 <span class="preprocessor">                                     I##cpn=I##ppn=(img)(0,_p##y,_n##z,v), \</span>
00491 <span class="preprocessor">                                     I##ccn=I##pcn=(img)(0,    y,_n##z,v), \</span>
00492 <span class="preprocessor">                                     I##cnn=I##pnn=(img)(0,_n##y,_n##z,v)),\</span>
00493 <span class="preprocessor">              x=_p##x=0;                                                \</span>
00494 <span class="preprocessor">            (_n##x&lt;(int)((img).width) &amp;&amp; (                              \</span>
00495 <span class="preprocessor">                                          I##npp=(img)(_n##x,_p##y,_p##z,v), \</span>
00496 <span class="preprocessor">                                          I##ncp=(img)(_n##x,    y,_p##z,v), \</span>
00497 <span class="preprocessor">                                          I##nnp=(img)(_n##x,_n##y,_p##z,v), \</span>
00498 <span class="preprocessor">                                          I##npc=(img)(_n##x,_p##y,    z,v), \</span>
00499 <span class="preprocessor">                                          I##ncc=(img)(_n##x,    y,    z,v), \</span>
00500 <span class="preprocessor">                                          I##nnc=(img)(_n##x,_n##y,    z,v), \</span>
00501 <span class="preprocessor">                                          I##npn=(img)(_n##x,_p##y,_n##z,v), \</span>
00502 <span class="preprocessor">                                          I##ncn=(img)(_n##x,    y,_n##z,v), \</span>
00503 <span class="preprocessor">                                          I##nnn=(img)(_n##x,_n##y,_n##z,v), \</span>
00504 <span class="preprocessor">                                          1)) || x==--_n##x;            \</span>
00505 <span class="preprocessor">            I##ppp=I##cpp, I##pcp=I##ccp, I##pnp=I##cnp,                \</span>
00506 <span class="preprocessor">              I##cpp=I##npp, I##ccp=I##ncp, I##cnp=I##nnp,              \</span>
00507 <span class="preprocessor">              I##ppc=I##cpc, I##pcc=I##ccc, I##pnc=I##cnc,              \</span>
00508 <span class="preprocessor">              I##cpc=I##npc, I##ccc=I##ncc, I##cnc=I##nnc,              \</span>
00509 <span class="preprocessor">              I##ppn=I##cpn, I##pcn=I##ccn, I##pnn=I##cnn,              \</span>
00510 <span class="preprocessor">              I##cpn=I##npn, I##ccn=I##ncn, I##cnn=I##nnn,              \</span>
00511 <span class="preprocessor">              _p##x=x++, _n##x++ )</span>
00512 <span class="preprocessor"></span>
00513 <span class="comment">/*-------------------------------------------------</span>
00514 <span class="comment">  -------------------------------------------------</span>
00515 <span class="comment"></span>
00516 <span class="comment"></span>
00517 <span class="comment">    Definition of the cimg_library:: namespace</span>
00518 <span class="comment"></span>
00519 <span class="comment"></span>
00520 <span class="comment">  -------------------------------------------------</span>
00521 <span class="comment">  -------------------------------------------------*/</span>
00522 
00524 
<a name="l00534"></a><a class="code" href="namespacecimg__library.html">00534</a> <span class="keyword">namespace </span>cimg_library {
00535   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>;
00536   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>;
00537   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a>;
00538   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T=<span class="keywordtype">float</span>&gt; <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImg.html">CImg</a>;
00539   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T=<span class="keywordtype">float</span>&gt; <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>;
00540   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T=<span class="keywordtype">float</span>&gt; <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a>;
00541  
<a name="l00542"></a><a class="code" href="namespacecimg__library_1_1cimg.html">00542</a>   <span class="keyword">namespace </span>cimg {
00543     <span class="keyword">static</span> <span class="keywordtype">int</span> dialog(<span class="keyword">const</span> <span class="keywordtype">char</span> *title,<span class="keyword">const</span> <span class="keywordtype">char</span> *msg,<span class="keyword">const</span> <span class="keywordtype">char</span> *button1_txt=<span class="stringliteral">"OK"</span>,
00544                       <span class="keyword">const</span> <span class="keywordtype">char</span> *button2_txt=NULL,<span class="keyword">const</span> <span class="keywordtype">char</span> *button3_txt=NULL,
00545                       <span class="keyword">const</span> <span class="keywordtype">char</span> *button4_txt=NULL,<span class="keyword">const</span> <span class="keywordtype">char</span> *button5_txt=NULL,
00546                       <span class="keyword">const</span> <span class="keywordtype">char</span> *button6_txt=NULL);
00547   }
00548   
00549   <span class="comment">/*----------------------------------------------------</span>
00550 <span class="comment">    </span>
00551 <span class="comment">  </span>
00552 <span class="comment">  </span>
00553 <span class="comment">  Definition of the CImgException structures</span>
00554 <span class="comment">  </span>
00555 <span class="comment">  </span>
00556 <span class="comment">  </span>
00557 <span class="comment">  -------------------------------------------------*/</span>
00558 
00559 <span class="preprocessor">#define cimg_exception_err(etype,disp_flag)                         \</span>
00560 <span class="preprocessor">  if (cimg_debug&gt;=1) {                                              \</span>
00561 <span class="preprocessor">    char tmp[1024];                                                 \</span>
00562 <span class="preprocessor">    std::va_list ap;                                                \</span>
00563 <span class="preprocessor">    va_start(ap,format);                                            \</span>
00564 <span class="preprocessor">    std::vsprintf(message,format,ap);                               \</span>
00565 <span class="preprocessor">    va_end(ap);                                                     \</span>
00566 <span class="preprocessor">    std::sprintf(tmp,"==&gt; %s \n\nGeneral : %s\n\n", message,etype); \</span>
00567 <span class="preprocessor">    if (disp_flag) cimg::dialog("CImg Error",tmp,"Abort");          \</span>
00568 <span class="preprocessor">    else std::fprintf(stderr,tmp);                                  \</span>
00569 <span class="preprocessor">  }</span>
00570 <span class="preprocessor"></span>    
00572 
<a name="l00607"></a><a class="code" href="structcimg__library_1_1CImgException.html">00607</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a> {
<a name="l00608"></a><a class="code" href="structcimg__library_1_1CImgException.html#o0">00608</a>     <span class="keywordtype">char</span> message[1024]; 
00609     <a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a>() { message[0]=<span class="charliteral">'\0'</span>; }
00610     <a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
00611       cimg_exception_err(<span class="stringliteral">"This error has been generated by a 'CImgException' throw,\n"</span>
00612                          <span class="stringliteral">"corresponding to a general exception problem."</span>,<span class="keyword">true</span>); 
00613     }
00614   };
00615 
00618 
<a name="l00629"></a><a class="code" href="structcimg__library_1_1CImgInstanceException.html">00629</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a> : <a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a> { 
00630     <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
00631       cimg_exception_err(<span class="stringliteral">"This error has been generated by a 'CImgInstanceException' throw.\n"</span>
00632                          <span class="stringliteral">"The instance passed through the function above has a bad structure\n"</span>
00633                          <span class="stringliteral">"(perhaps an empty image, list or display object ?)"</span>,<span class="keyword">true</span>);
00634     }};
00635 
00638 
<a name="l00649"></a><a class="code" href="structcimg__library_1_1CImgArgumentException.html">00649</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a> : <a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a> { 
00650     <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) { 
00651       cimg_exception_err(<span class="stringliteral">"This error has been generated by a 'CImgArgumentException' throw.\n"</span>
00652                          <span class="stringliteral">"At least one argument passed to the function above has been\n"</span>
00653                          <span class="stringliteral">"considered as not valid."</span>,<span class="keyword">true</span>);
00654     }};
00655 
00658 
<a name="l00668"></a><a class="code" href="structcimg__library_1_1CImgIOException.html">00668</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a> : <a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a> { 
00669     <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
00670       cimg_exception_err(<span class="stringliteral">"This error has been generated by a 'CImgIOException' throw.\n"</span>
00671                          <span class="stringliteral">"When trying to load or save a file, the function above has\n"</span>
00672                          <span class="stringliteral">"encountered a problem."</span>,<span class="keyword">true</span>);
00673     }};
00674 
00677 
<a name="l00685"></a><a class="code" href="structcimg__library_1_1CImgDisplayException.html">00685</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgDisplayException.html">CImgDisplayException</a> : <a class="code" href="structcimg__library_1_1CImgException.html">CImgException</a> {
00686     <a class="code" href="structcimg__library_1_1CImgDisplayException.html">CImgDisplayException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
00687       cimg_exception_err(<span class="stringliteral">"This error has been generated by a 'CImgDisplayException' throw.\n"</span>
00688                          <span class="stringliteral">"When trying to operate on a CImgDisplay instance, the function above\n"</span>
00689                          <span class="stringliteral">"has encountered a problem."</span>,<span class="keyword">false</span>); 
00690     }};
00691   
00692 
00693   <span class="comment">/*----------------------------------------</span>
00694 <span class="comment">    </span>
00695 <span class="comment">  </span>
00696 <span class="comment">  </span>
00697 <span class="comment">    Definition of the namespace 'cimg'</span>
00698 <span class="comment">  </span>
00699 <span class="comment">  </span>
00700 <span class="comment">  </span>
00701 <span class="comment">  --------------------------------------*/</span>
00702   
00704 
00712   <span class="keyword">namespace </span>cimg {
00713 
00714     <span class="comment">// Define internal library variables.</span>
00715     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lblock=1024;
00716 <span class="preprocessor">#if cimg_display_type==1</span>
00717 <span class="preprocessor"></span>    <span class="keyword">struct </span>X11info {
00718       pthread_mutex_t* mutex;
00719       pthread_t*       event_thread;
00720       <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>*     wins[1024];
00721       Display*         display;
00722       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     nb_wins;
00723       <span class="keywordtype">bool</span>             thread_finished;
00724       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>     nb_bits;
00725       GC*              gc;
00726       <span class="keywordtype">bool</span>             endian;
00727       X11info():mutex(NULL),event_thread(NULL),display(NULL),nb_wins(0),
00728                 thread_finished(false),nb_bits(0),gc(NULL),endian(false) {};
00729     };
00730 <span class="preprocessor">#if defined(cimg_module)</span>
00731 <span class="preprocessor"></span>    X11info&amp; X11attr();
00732 <span class="preprocessor">#elif defined(cimg_main)</span>
00733 <span class="preprocessor"></span>    X11info&amp; X11attr() { <span class="keyword">static</span> X11info val; <span class="keywordflow">return</span> val; }
00734 <span class="preprocessor">#else</span>
00735 <span class="preprocessor"></span>    <span class="keyword">inline</span> X11info&amp; X11attr() { <span class="keyword">static</span> X11info val; <span class="keywordflow">return</span> val; }
00736 <span class="preprocessor">#endif</span>
00737 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00738 <span class="preprocessor"></span><span class="preprocessor">#ifdef cimg_color_terminal</span>
00739 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> t_normal[9]  = {0x1b,<span class="charliteral">'['</span>,<span class="charliteral">'0'</span>,<span class="charliteral">';'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">';'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'m'</span>,<span class="charliteral">'\0'</span>};
00740     <span class="keyword">const</span> <span class="keywordtype">char</span> t_red[11]    = {0x1b,<span class="charliteral">'['</span>,<span class="charliteral">'4'</span>,<span class="charliteral">';'</span>,<span class="charliteral">'3'</span>,<span class="charliteral">'1'</span>,<span class="charliteral">';'</span>,<span class="charliteral">'5'</span>,<span class="charliteral">'9'</span>,<span class="charliteral">'m'</span>,<span class="charliteral">'\0'</span>};
00741     <span class="keyword">const</span> <span class="keywordtype">char</span> t_bold[5]    = {0x1b,<span class="charliteral">'['</span>,<span class="charliteral">'1'</span>,<span class="charliteral">'m'</span>,<span class="charliteral">'\0'</span>};
00742     <span class="keyword">const</span> <span class="keywordtype">char</span> t_purple[11] = {0x1b,<span class="charliteral">'['</span>,<span class="charliteral">'0'</span>,<span class="charliteral">';'</span>,<span class="charliteral">'3'</span>,<span class="charliteral">'5'</span>,<span class="charliteral">';'</span>,<span class="charliteral">'5'</span>,<span class="charliteral">'9'</span>,<span class="charliteral">'m'</span>,<span class="charliteral">'\0'</span>};
00743 <span class="preprocessor">#else</span>
00744 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> t_normal[1]  = {<span class="charliteral">'\0'</span>};
00745     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *t_red = cimg::t_normal, *t_bold = cimg::t_normal, *t_purple = cimg::t_normal;
00746 <span class="preprocessor">#endif</span>
00747 <span class="preprocessor"></span>    
00748 <span class="preprocessor">#if cimg_display_type==1</span>
00749 <span class="preprocessor"></span>    <span class="comment">// Keycodes for X11-based graphical systems</span>
00750     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyESC        = XK_Escape;
00751     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF1         = XK_F1;
00752     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF2         = XK_F2;
00753     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF3         = XK_F3;
00754     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF4         = XK_F4;
00755     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF5         = XK_F5;
00756     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF6         = XK_F6;
00757     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF7         = XK_F7;
00758     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF8         = XK_F8;
00759     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF9         = XK_F9;
00760     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF10        = XK_F10;
00761     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF11        = XK_F11;
00762     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF12        = XK_F12;
00763     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyPAUSE      = XK_Pause;
00764     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key1          = XK_1;
00765     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key2          = XK_2;
00766     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key3          = XK_3;
00767     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key4          = XK_4;
00768     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key5          = XK_5;
00769     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key6          = XK_6;
00770     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key7          = XK_7;
00771     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key8          = XK_8;
00772     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key9          = XK_9;
00773     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key0          = XK_0;
00774     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyBACKSPACE  = XK_BackSpace;
00775     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyINSERT     = XK_Insert;
00776     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyHOME       = XK_Home;
00777     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyPAGEUP     = XK_Page_Up;
00778     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyTAB        = XK_Tab;
00779     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyQ          = XK_q;
00780     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyW          = XK_w;
00781     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyE          = XK_e;
00782     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyR          = XK_r;
00783     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyT          = XK_t;
00784     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyY          = XK_y;
00785     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyU          = XK_u;
00786     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyI          = XK_i;
00787     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyO          = XK_o;
00788     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyP          = XK_p;
00789     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyDELETE     = XK_Delete;
00790     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyEND        = XK_End;
00791     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyPAGEDOWN   = XK_Page_Down;
00792     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyCAPSLOCK   = XK_Caps_Lock;
00793     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyA          = XK_a;
00794     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyS          = XK_s;
00795     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyD          = XK_d;
00796     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF          = XK_f;
00797     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyG          = XK_g;
00798     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyH          = XK_h;
00799     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyJ          = XK_j;
00800     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyK          = XK_k;
00801     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyL          = XK_l;
00802     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyENTER      = XK_Return;
00803     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keySHIFTLEFT  = XK_Shift_L;
00804     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyZ          = XK_z;
00805     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyX          = XK_x;
00806     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyC          = XK_c;
00807     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyV          = XK_v;
00808     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyB          = XK_b;
00809     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyN          = XK_n;
00810     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyM          = XK_m;
00811     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keySHIFTRIGHT = XK_Shift_R;
00812     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWUP    = XK_Up;
00813     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyCTRLLEFT   = XK_Control_L;
00814     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyAPPLEFT    = XK_Super_L;
00815     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keySPACE      = XK_space;
00816     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyALTGR      = XK_Alt_R;
00817     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyAPPRIGHT   = XK_Super_R;
00818     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyMENU       = XK_Menu;
00819     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyCTRLRIGHT  = XK_Control_R;
00820     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWLEFT  = XK_Left;
00821     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWDOWN  = XK_Down;
00822     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWRIGHT = XK_Right;  
00823 <span class="preprocessor">#endif</span>
00824 <span class="preprocessor"></span>
00825 <span class="preprocessor">#if cimg_display_type==2 &amp;&amp; cimg_OS==2</span>
00826 <span class="preprocessor"></span>    <span class="comment">// Keycodes for Windows-OS</span>
00828 <span class="comment"></span>
00829 
00837     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyESC        = 27;
00838     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF1         = 112;
00839     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF2         = 113;
00840     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF3         = 114;
00841     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF4         = 115;
00842     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF5         = 116;
00843     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF6         = 117;
00844     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF7         = 118;
00845     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF8         = 119;
00846     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF9         = 120;
00847     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF10        = 121;
00848     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF11        = 122;
00849     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF12        = 123;
00850     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyPAUSE      = 19;
00851     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key1          = 49;
00852     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key2          = 50;
00853     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key3          = 51;
00854     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key4          = 52;
00855     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key5          = 53;
00856     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key6          = 54;
00857     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key7          = 55;
00858     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key8          = 56;
00859     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key9          = 57;
00860     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key0          = 48;
00861     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyBACKSPACE  = 8;
00862     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyINSERT     = 45;
00863     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyHOME       = 36;
00864     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyPAGEUP     = 33;
00865     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyTAB        = 9;
00866     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyQ          = 81;
00867     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyW          = 87;
00868     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyE          = 69;
00869     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyR          = 82;
00870     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyT          = 84;
00871     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyY          = 89;
00872     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyU          = 85;
00873     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyI          = 73;
00874     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyO          = 79;
00875     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyP          = 80;
00876     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyDELETE     = 8;
00877     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyEND        = 35;
00878     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyPAGEDOWN   = 34;
00879     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyCAPSLOCK   = 20;
00880     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyA          = 65;
00881     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyS          = 83;
00882     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyD          = 68;
00883     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyF          = 70;
00884     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyG          = 71;
00885     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyH          = 72;
00886     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyJ          = 74;
00887     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyK          = 75;
00888     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyL          = 76;
00889     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyENTER      = 13;
00890     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keySHIFTLEFT  = 16;
00891     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyZ          = 90;
00892     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyX          = 88;
00893     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyC          = 67;
00894     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyV          = 86;
00895     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyB          = 66;
00896     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyN          = 78;
00897     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyM          = 77;
00898     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keySHIFTRIGHT = 16;
00899     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWUP    = 38;
00900     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyCTRLLEFT   = 17;
00901     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyAPPLEFT    = 91;
00902     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keySPACE      = 32;
00903     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyALTGR      = 17;
00904     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyAPPRIGHT   = 92;
00905     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyMENU       = 93;
00906     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyCTRLRIGHT  = 17;
00907     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWLEFT  = 37;
00908     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWDOWN  = 40;
00909     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> keyARROWRIGHT = 39;
00910 <span class="preprocessor">#endif</span>
00911 <span class="preprocessor"></span>
00912 
00913 <span class="preprocessor">#ifdef PI</span>
00914 <span class="preprocessor"></span><span class="preprocessor">#undef PI</span>
00915 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00916"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a3">00916</a> <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a3">PI</a> = 3.14159265358979323846;   
00917     <span class="keyword">const</span> <span class="keywordtype">int</span> infinity_int  = 0x7f800000;
00918     <span class="keyword">const</span> <span class="keywordtype">double</span> infinity = (double)*(<span class="keywordtype">float</span>*)&amp;cimg::infinity_int;
00919     
00920     <span class="comment">// Definition of a 10x13 font (used in dialog boxes).</span>
00921     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> font10x13[256*10*13/8] = {
00922       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00923       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80100c0,
00924       0x68000300,0x801,0xc00010,0x100c000,0x68100,0x100c0680,0x2,0x403000,0x1000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00925       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00926       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xfc,0x0,0x0,0x0,0x0,0x0,0x4020120,
00927       0x58120480,0x402,0x1205008,0x2012050,0x58080,0x20120581,0x40000001,0x804812,0x2000000,0x0,0x300,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00928       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x140,0x80000,0x200402,0x800000,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00929       0x0,0x7010,0x7000000,0x8000200,0x20000,0xc0002000,0x8008,0x0,0x0,0x0,0x0,0x808,0x4000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00930       0x0,0x0,0x80000000,0x0,0x0,0x0,0x40000,0x0,0x0,0x0,0x0,0x480,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x70,0x80100c0,0x68000480,0x1001,
00931       0xc00010,0x1018000,0x68100,0x100c0680,0x4,0x403000,0x1020000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20140,0x28081883,0x200801,
00932       0x2a00000,0x10,0x1c0201c0,0x70040f80,0xc0f81c07,0x0,0x70,0x3e0303c0,0x3c3c0f83,0xe03c2107,0xe08810,0x18c31070,0x3c0703c0,
00933       0x783e0842,0x22222208,0x83e04010,0x1008000,0x4000200,0x20001,0x2002,0x408008,0x0,0x0,0x100000,0x0,0x1008,0x2000000,0x0,0x0,0x0,
00934       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20080,0x38000880,0x8078140f,0x81c00000,0x3e000,0xc020180,0x60080001,0xe0000002,0xc00042,0x108e2010,
00935       0xc0300c0,0x300c0303,0xf83c3e0f,0x83e0f81c,0x701c070,0x3c0c41c0,0x701c0701,0xc0001d08,0x42108421,0x8820088,0x4020120,0x58140480,
00936       0x802,0x1205008,0x3014050,0xc058080,0x20120581,0x40000002,0x804814,0x2020050,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20140,
00937       0x281e2484,0x80200801,0x1c02000,0x10,0x22060220,0x880c0801,0x82208,0x80000001,0x20008,0x41030220,0x40220802,0x402102,0x209010,
00938       0x18c31088,0x22088220,0x80080842,0x22222208,0x80204010,0x1014000,0x200,0x20001,0x2000,0x8008,0x0,0x0,0x100000,0x0,0x1008,
00939       0x2000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80,0x40000500,0x80800010,0x40200000,0x41000,0x12020040,0x10000003,0xa0000006,
00940       0x12000c4,0x31014000,0xc0300c0,0x300c0302,0x80402008,0x2008008,0x2008020,0x220c4220,0x88220882,0x20002208,0x42108421,0x8820088,
00941       0x0,0x300,0x0,0x0,0x0,0x14000000,0x0,0x200200,0x0,0x20000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20000,0xfc282504,0x80001000,
00942       0x82a02000,0x20,0x22020020,0x8140802,0x102208,0x80801006,0x18008,0x9c848220,0x80210802,0x802102,0x20a010,0x15429104,0x22104220,
00943       0x80080842,0x22221405,0x404008,0x1022000,0x703c0,0x381e0701,0xc0783c02,0xc09008,0x1d83c070,0x3c078140,0x381c0882,0x21242208,
00944       0x81e01008,0x2000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x201e0,0x40220500,0x80800027,0x20e02800,0x9c800,0x12020040,
00945       0x20000883,0xa0200002,0x120a044,0x11064010,0x12048120,0x48120484,0x80802008,0x2008008,0x2008020,0x210a4411,0x4411044,0x10884508,
00946       0x42108421,0x503c0b0,0x1c0701c0,0x701c0707,0x70381c07,0x1c07008,0x2008020,0x20f01c0,0x701c0701,0xc0201c08,0x82208822,0x883c088,
00947       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20000,0x50281903,0x20001000,0x80802000,0x20,0x22020040,0x30240f03,0xc0101c08,0x80801018,
00948       0x1fc06010,0xa48483c0,0x80210f03,0xe0803f02,0x20c010,0x15429104,0x22104220,0x70080841,0x41540805,0x804008,0x1041000,0x8220,
00949       0x40220881,0x882202,0x40a008,0x12422088,0x22088180,0x40100882,0x21241408,0x80201008,0x2031000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00950       0x0,0x20280,0x401c0200,0x700028,0x21205000,0x92800,0xc1fc080,0x10000883,0xa0200002,0x1205049,0x12c19010,0x12048120,0x48120484,
00951       0xf0803c0f,0x3c0f008,0x2008020,0x790a4411,0x4411044,0x10504908,0x42108421,0x5022088,0x2008020,0x8020080,0x88402208,0x82208808,
00952       0x2008020,0x1e088220,0x88220882,0x20002608,0x82208822,0x8822088,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20000,0x501c0264,
00953       0xa0001000,0x8001fc00,0x7000020,0x22020080,0x83e0082,0x20202207,0x80000020,0x1020,0xa4848220,0x80210802,0x9c2102,0x20c010,
00954       0x12425104,0x3c1043c0,0x8080841,0x41540802,0x804008,0x1000000,0x78220,0x40220f81,0x882202,0x40c008,0x12422088,0x22088100,
00955       0x60100881,0x41540805,0x406008,0x1849000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20280,0xf0140200,0x880028,0x20e0a03f,0x709c800,
00956       0x201c0,0x60000881,0xa0000007,0xc0284b,0x122eb020,0x12048120,0x48120487,0x80802008,0x2008008,0x2008020,0x21094411,0x4411044,
00957       0x10204908,0x42108421,0x2022088,0x1e0781e0,0x781e0787,0xf8403e0f,0x83e0f808,0x2008020,0x22088220,0x88220882,0x21fc2a08,0x82208822,
00958       0x5022050,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20001,0xf80a0294,0x40001000,0x80002000,0x20,0x22020100,0x8040082,0x20202200,
00959       0x80000018,0x1fc06020,0xa48fc220,0x80210802,0x842102,0x20a010,0x12425104,0x20104240,0x8080841,0x41541402,0x1004008,0x1000000,
00960       0x88220,0x40220801,0x882202,0x40a008,0x12422088,0x22088100,0x18100881,0x41540805,0x801008,0x2046000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00961       0x0,0x0,0x0,0x20280,0x401c0f80,0x80880028,0x20005001,0x94800,0x20000,0x880,0xa0000000,0x5015,0x4215040,0x3f0fc3f0,0xfc3f0fc8,
00962       0x80802008,0x2008008,0x2008020,0x21094411,0x4411044,0x10505108,0x42108421,0x203c088,0x22088220,0x88220888,0x80402008,0x2008008,
00963       0x2008020,0x22088220,0x88220882,0x20002a08,0x82208822,0x5022050,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xa00a0494,0x60001000,
00964       0x80002004,0x8020,0x22020200,0x88040882,0x20402201,0x801006,0x18000,0x9f084220,0x40220802,0x442102,0x209010,0x10423088,0x20088220,
00965       0x8080840,0x80882202,0x2004008,0x1000000,0x88220,0x40220881,0x882202,0x409008,0x12422088,0x22088100,0x8100880,0x80881402,
00966       0x1001008,0x2000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20280,0x40220200,0x80700027,0x20002801,0x92800,0x1fc000,0x980,
00967       0xa0000000,0xa017,0x84417840,0x21084210,0x84210848,0x80402008,0x2008008,0x2008020,0x2208c220,0x88220882,0x20882208,0x42108421,
00968       0x2020088,0x22088220,0x88220888,0xc8402208,0x82208808,0x2008020,0x22088220,0x88220882,0x20203208,0x82208822,0x2022020,0x0,0x0,0x0,
00969       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x20000,0xa03c0463,0x90000801,0x2004,0x8040,0x1c0703e0,0x70040701,0xc0401c06,0x801001,0x20020,
00970       0x400843c0,0x3c3c0f82,0x3c2107,0x1c0881e,0x10423070,0x20070210,0xf0080780,0x80882202,0x3e04004,0x1000000,0x783c0,0x381e0701,
00971       0x782202,0x408808,0x12422070,0x3c078100,0x700c0780,0x80882202,0x1e01008,0x2000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x201e0,
00972       0xf8000200,0x80080010,0x40000001,0x41000,0x0,0xe80,0xa0000000,0x21,0x8e21038,0x21084210,0x84210848,0xf83c3e0f,0x83e0f81c,
00973       0x701c070,0x3c08c1c0,0x701c0701,0xc0005c07,0x81e0781e,0x20200b0,0x1e0781e0,0x781e0787,0x30381c07,0x1c07008,0x2008020,0x1c0881c0,
00974       0x701c0701,0xc0201c07,0x81e0781e,0x203c020,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80000,0x801,0x4,0x40,0x0,0x0,0x0,0x1000,
00975       0x0,0x3c000000,0x0,0x0,0x0,0x0,0x10000,0x0,0x0,0x4004,0x1000000,0x0,0x0,0x80000,0x400000,0x0,0x20008000,0x0,0x4,0x1008,0x2000000,
00976       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80,0x0,0x8008000f,0x80000000,0x3e000,0x0,0x800,0xa0000400,0x0,0x0,0x0,0x0,0x80000,0x0,
00977       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x100000,0x0,0x0,0x0,0x0,0x2000,0x0,0x4020040,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80000,
00978       0x402,0x8,0x40,0x0,0x0,0x0,0x2000,0x0,0x0,0x0,0x0,0x0,0x0,0xc000,0x0,0x0,0x7004,0x70000fc,0x0,0x0,0x700000,0x800000,0x0,0x20008000,
00979       0x0,0x4,0x808,0x4000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80,0x0,0x80f00000,0x0,0x0,0x0,0x800,0xa0001800,0x0,0x0,0x0,0x0,
00980       0x300000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x600000,0x0,0x0,0x0,0x0,0x0,0x0,0x4020040
00981     };
00982     
00983     <span class="comment">// Definition of a 7x11 font, used to return a default font for drawing text.</span>
00984     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> font7x11[7*11*256/8] = {
00985       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80000000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00986       0x0,0x0,0x0,0x0,0x0,0x0,0x90,0x0,0x7f0000,0x40000,0x0,0x0,0x4010c0a4,0x82000040,0x11848402,0x18480050,0x80430292,0x8023,0x9008000,
00987       0x40218140,0x4000040,0x21800402,0x18000051,0x1060500,0x8083,0x10000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x24002,0x4031,0x80000000,0x10000,
00988       0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7,0x81c0400,0x40020000,0x80070080,0x40440e00,0x0,0x0,0x1,0x88180000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00989       0x0,0x200000,0x0,0x0,0x80000,0x0,0x0,0x20212140,0x5000020,0x22400204,0x240000a0,0x40848500,0x4044,0x80010038,0x20424285,0xa000020,
00990       0x42428204,0x2428e0a0,0x82090a14,0x4104,0x85022014,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x10240a7,0x88484040,0x40800000,0x270c3,0x87811e0e,
00991       0x7c70e000,0x78,0x3c23c1ef,0x1f3e1e89,0xf1c44819,0xa23cf0f3,0xc3cff120,0xc18307f4,0x4040400,0x20000,0x80080080,0x40200,0x0,
00992       0x40000,0x2,0x8040000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x8188,0x50603800,0xf3c00000,0x1c004003,0xc700003e,0x18180,0xc993880,0x10204081,
00993       0x2071ef9,0xf3e7cf9f,0x3e7c7911,0xe3c78f1e,0x7d1224,0x48906048,0x0,0x4000000,0x0,0x9000,0x0,0x0,0x2000,0x0,0x0,0x0,0x0,0x0,0x0,
00994       0x0,0x10240aa,0x14944080,0x23610000,0x68940,0x40831010,0x8891306,0x802044,0x44522208,0x90202088,0x40448819,0xb242890a,0x24011111,
00995       0x49448814,0x4040a00,0xe2c3c7,0x8e3f3cb9,0xc1c44216,0xee38b0f2,0xe78f9120,0xc18507e2,0x8040000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00996       0x101c207,0x88a04001,0x9c00000,0x2200a041,0x8200113a,0x8240,0x50a3110,0x2850a142,0x850c2081,0x2040204,0x8104592,0x142850a1,
00997       0x42cd1224,0x4888bc48,0x70e1c387,0xe3b3c70,0xe1c38e1c,0x38707171,0xc3870e1c,0x10791224,0x48906c41,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
00998       0x10003ee,0x15140080,0x21810000,0x48840,0x40851020,0x8911306,0x31fd804,0x9c522408,0x90204088,0x4045081a,0xba42890a,0x24011111,
00999       0x49285024,0x2041b00,0x132408,0x910844c8,0x4044821b,0x7244c913,0x24041111,0x49488822,0x8040000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
01000       0x28204,0x85006001,0x6a414000,0x3a004043,0xc700113a,0x8245,0x50a3a00,0x2850a142,0x850c4081,0x2040204,0x81045d2,0x142850a1,
01001       0x24951224,0x48852250,0x8102040,0x81054089,0x12244204,0x8108992,0x24489122,0x991224,0x4888b222,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
01002       0x1000143,0xa988080,0x2147c01f,0x88840,0x83091c2c,0x1070f000,0xc000608,0xa48bc408,0x9e3c46f8,0x40460816,0xaa42f10b,0xc3811111,
01003       0x35102044,0x1041100,0xf22408,0x9f084488,0x40470212,0x62448912,0x6041111,0x55308846,0x8061c80,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
01004       0x1028704,0x8f805801,0x4be28fdf,0x220001f0,0x111a,0x60000182,0x82c5c710,0x44891224,0x489640f1,0xe3c78204,0x810e552,0x142850a1,
01005       0x18a51224,0x48822250,0x78f1e3c7,0x8f1f40f9,0xf3e7c204,0x8108912,0x24489122,0x7ea91224,0x4888a222,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
01006       0x10007e2,0x85648080,0x20010000,0x88841,0x8f8232,0x20881000,0xc1fc610,0xbefa2408,0x90204288,0x40450816,0xa642810a,0x4041110a,
01007       0x36282084,0x1042080,0x1122408,0x90084488,0x40450212,0x62448912,0x184110a,0x55305082,0x8042700,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
01008       0x1028207,0x82004801,0x68050040,0x1c000040,0x110a,0x60000001,0x45484d10,0x7cf9f3e7,0xcf944081,0x2040204,0x8104532,0x142850a1,
01009       0x18a51224,0x48822248,0x89122448,0x91244081,0x2040204,0x8108912,0x24489122,0xc91224,0x48852214,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x282,
01010       0x89630080,0x20010c00,0x30108842,0x810222,0x20882306,0x3001800,0x408a2208,0x90202288,0x40448814,0xa642810a,0x2041110a,0x26442104,
01011       0x840000,0x1122408,0x90084488,0x40448212,0x62448912,0x84130a,0x36485102,0x8040000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x101c208,0x4f802801,
01012       0x8028040,0x40,0x130a,0x2,0x85e897a0,0x44891224,0x489c2081,0x2040204,0x8104532,0x142850a1,0x24cd1224,0x48823c44,0x89122448,
01013       0x91244081,0x2040204,0x8108912,0x24489122,0xc93264,0xc9852214,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x100028f,0x109f0080,0x20010c00,
01014       0x303071f3,0xc7011c1c,0x4071c306,0x802010,0x3907c1ef,0x1f201e89,0xf3844f90,0xa23c80f2,0x17810e04,0x228223f4,0x840000,0xfbc3c7,
01015       0x8f083c88,0x40444212,0x6238f0f2,0x7039d04,0x228423e2,0x8040000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1008780,0x2201800,0xf0014000,0x1f0,
01016       0x1d0a,0x5,0x851e140,0x83060c18,0x30671ef9,0xf3e7cf9f,0x3e7c7911,0xe3c78f1e,0x42f8e1c3,0x8702205c,0x7cf9f3e7,0xcf9b3c78,0xf1e3c204,
01017       0x8107111,0xc3870e1c,0x10f1d3a7,0x4e823c08,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x40,0x40000400,0x200000,0x0,0x2,0x0,0x0,0x0,0x0,0x18,
01018       0x0,0x4,0x44007f,0x0,0x400,0x400000,0x8010,0x0,0x6002,0x8040000,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1000000,0x200800,0x0,0x0,0x100a,
01019       0x400000,0x44,0x0,0x400,0x0,0x0,0x0,0x0,0x0,0x0,0x800,0x0,0x0,0x0,0x0,0x62018,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x31,0x80000800,
01020       0x400000,0x0,0x4,0x0,0x0,0x0,0x0,0xc,0x0,0x7,0x3c0000,0x0,0x3800,0x3800000,0x8010,0x0,0x1c001,0x881c0000,0x0,0x0,0x0,0x0,0x0,0x0,
01021       0x0,0x0,0x207000,0x0,0x0,0x100a,0xc00000,0x3c,0x0,0xc00,0x0,0x0,0x0,0x0,0x0,0x0,0x1800,0x0,0x0,0x0,0x0,0x1c2070
01022     };
01023 
01024     <span class="comment">// Definition of a 40x38 'danger' color logo</span>
01025     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> logo40x38[4576] = {
01026       177,200,200,200,3,123,123,0,36,200,200,200,1,123,123,0,2,255,255,0,1,189,189,189,1,0,0,0,34,200,200,200,
01027       1,123,123,0,4,255,255,0,1,189,189,189,1,0,0,0,1,123,123,123,32,200,200,200,1,123,123,0,5,255,255,0,1,0,0,
01028       0,2,123,123,123,30,200,200,200,1,123,123,0,6,255,255,0,1,189,189,189,1,0,0,0,2,123,123,123,29,200,200,200,
01029       1,123,123,0,7,255,255,0,1,0,0,0,2,123,123,123,28,200,200,200,1,123,123,0,8,255,255,0,1,189,189,189,1,0,0,0,
01030       2,123,123,123,27,200,200,200,1,123,123,0,9,255,255,0,1,0,0,0,2,123,123,123,26,200,200,200,1,123,123,0,10,255,
01031       255,0,1,189,189,189,1,0,0,0,2,123,123,123,25,200,200,200,1,123,123,0,3,255,255,0,1,189,189,189,3,0,0,0,1,189,
01032       189,189,3,255,255,0,1,0,0,0,2,123,123,123,24,200,200,200,1,123,123,0,4,255,255,0,5,0,0,0,3,255,255,0,1,189,
01033       189,189,1,0,0,0,2,123,123,123,23,200,200,200,1,123,123,0,4,255,255,0,5,0,0,0,4,255,255,0,1,0,0,0,2,123,123,123,
01034       22,200,200,200,1,123,123,0,5,255,255,0,5,0,0,0,4,255,255,0,1,189,189,189,1,0,0,0,2,123,123,123,21,200,200,200,
01035       1,123,123,0,5,255,255,0,5,0,0,0,5,255,255,0,1,0,0,0,2,123,123,123,20,200,200,200,1,123,123,0,6,255,255,0,5,0,0,
01036       0,5,255,255,0,1,189,189,189,1,0,0,0,2,123,123,123,19,200,200,200,1,123,123,0,6,255,255,0,1,123,123,0,3,0,0,0,1,
01037       123,123,0,6,255,255,0,1,0,0,0,2,123,123,123,18,200,200,200,1,123,123,0,7,255,255,0,1,189,189,189,3,0,0,0,1,189,
01038       189,189,6,255,255,0,1,189,189,189,1,0,0,0,2,123,123,123,17,200,200,200,1,123,123,0,8,255,255,0,3,0,0,0,8,255,255,
01039       0,1,0,0,0,2,123,123,123,16,200,200,200,1,123,123,0,9,255,255,0,1,123,123,0,1,0,0,0,1,123,123,0,8,255,255,0,1,189,
01040       189,189,1,0,0,0,2,123,123,123,15,200,200,200,1,123,123,0,9,255,255,0,1,189,189,189,1,0,0,0,1,189,189,189,9,255,255,
01041       0,1,0,0,0,2,123,123,123,14,200,200,200,1,123,123,0,11,255,255,0,1,0,0,0,10,255,255,0,1,189,189,189,1,0,0,0,2,123,
01042       123,123,13,200,200,200,1,123,123,0,23,255,255,0,1,0,0,0,2,123,123,123,12,200,200,200,1,123,123,0,11,255,255,0,1,189,
01043       189,189,2,0,0,0,1,189,189,189,9,255,255,0,1,189,189,189,1,0,0,0,2,123,123,123,11,200,200,200,1,123,123,0,11,255,255,
01044       0,4,0,0,0,10,255,255,0,1,0,0,0,2,123,123,123,10,200,200,200,1,123,123,0,12,255,255,0,4,0,0,0,10,255,255,0,1,189,189,
01045       189,1,0,0,0,2,123,123,123,9,200,200,200,1,123,123,0,12,255,255,0,1,189,189,189,2,0,0,0,1,189,189,189,11,255,255,0,1,
01046       0,0,0,2,123,123,123,9,200,200,200,1,123,123,0,27,255,255,0,1,0,0,0,3,123,123,123,8,200,200,200,1,123,123,0,26,255,
01047       255,0,1,189,189,189,1,0,0,0,3,123,123,123,9,200,200,200,1,123,123,0,24,255,255,0,1,189,189,189,1,0,0,0,4,123,123,
01048       123,10,200,200,200,1,123,123,0,24,0,0,0,5,123,123,123,12,200,200,200,27,123,123,123,14,200,200,200,25,123,123,123,86,
01049       200,200,200,91,49,124,118,124,71,32,124,95,49,56,114,52,82,121,0};
01050   
01051     <span class="comment">// Return a 'stringification' of standart integral types.</span>
01052     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> bool_st    = <span class="stringliteral">"bool"</span>;
01053     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> uchar_st   = <span class="stringliteral">"unsigned char"</span>;
01054     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> char_st    = <span class="stringliteral">"char"</span>;
01055     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> ushort_st  = <span class="stringliteral">"unsigned short"</span>;
01056     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> short_st   = <span class="stringliteral">"short"</span>;
01057     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> uint_st    = <span class="stringliteral">"unsigned int"</span>;
01058     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> int_st     = <span class="stringliteral">"int"</span>;
01059     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> ulong_st   = <span class="stringliteral">"unsigned long"</span>;
01060     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> long_st    = <span class="stringliteral">"long"</span>;
01061     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> float_st   = <span class="stringliteral">"float"</span>;
01062     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> double_st  = <span class="stringliteral">"double"</span>;
01063     <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> unknown_st = <span class="stringliteral">"unknown"</span>;
01064     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> t&amp;) { <span class="keywordflow">return</span> cimg::unknown_st; }
01065     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">bool</span>&amp;          ) { <span class="keywordflow">return</span> cimg::bool_st;   }
01066     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>&amp; ) { <span class="keywordflow">return</span> cimg::uchar_st;  }
01067     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">char</span>&amp;          ) { <span class="keywordflow">return</span> cimg::char_st;   }
01068     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&amp;) { <span class="keywordflow">return</span> cimg::ushort_st; }
01069     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">short</span>&amp;         ) { <span class="keywordflow">return</span> cimg::short_st;  }
01070     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp;  ) { <span class="keywordflow">return</span> cimg::uint_st;   }
01071     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp;           ) { <span class="keywordflow">return</span> cimg::int_st;    }
01072     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>&amp; ) { <span class="keywordflow">return</span> cimg::ulong_st;  }
01073     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">long</span>&amp;          ) { <span class="keywordflow">return</span> cimg::long_st;   }
01074     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">float</span>&amp;         ) { <span class="keywordflow">return</span> cimg::float_st;  }
01075     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* get_type(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp;        ) { <span class="keywordflow">return</span> cimg::double_st; }
01076     
<a name="l01078"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a34">01078</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">inline</span> <span class="keyword">const</span> t <a class="code" href="namespacecimg__library_1_1cimg.html#a34">get_type_min</a>(<span class="keyword">const</span> t&amp;) {
01079       <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> p = std::pow(2.0,8.0*<span class="keyword">sizeof</span>(t)-1.0);
01080       <span class="keyword">static</span> <span class="keyword">const</span> t res = (t)(((t)-1)&gt;=0?0:(-p)); 
01081       <span class="keywordflow">return</span> res;
01082     }
01083     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">float</span> get_type_min(<span class="keyword">const</span> <span class="keywordtype">float</span>&amp;)   { <span class="keywordflow">return</span> -(float)cimg::infinity; }
01084     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">double</span> get_type_min(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp;) { <span class="keywordflow">return</span> -cimg::infinity; }
01085 
<a name="l01087"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a37">01087</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">inline</span> <span class="keyword">const</span> t <a class="code" href="namespacecimg__library_1_1cimg.html#a37">get_type_max</a>(<span class="keyword">const</span> t&amp;) {
01088       <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> p = std::pow(2.0,8.0*<span class="keyword">sizeof</span>(t)-1.0);
01089       <span class="keyword">static</span> <span class="keyword">const</span> t res = (t)(((t)-1)&gt;=0?(2*p-1):(p-1));
01090       <span class="keywordflow">return</span> res;
01091     }
01092     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">float</span> get_type_max(<span class="keyword">const</span> <span class="keywordtype">float</span>&amp;)   { <span class="keywordflow">return</span> (float)cimg::infinity; }
01093     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">double</span> get_type_max(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp;) { <span class="keywordflow">return</span> cimg::infinity; }
01094                                                                        
01095     <span class="comment">// Display a warning message</span>
01096 <span class="preprocessor">#if cimg_debug&gt;=1    </span>
01097 <span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> warn(<span class="keyword">const</span> <span class="keywordtype">bool</span> cond,<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
01098       <span class="keywordflow">if</span> (cond) {
01099         std::va_list ap;
01100         va_start(ap,format);
01101         std::fprintf(stderr,<span class="stringliteral">"&lt;CImg Warning&gt; "</span>);
01102         std::vfprintf(stderr,format,ap);
01103         std::fputc(<span class="charliteral">'\n'</span>,stderr);
01104         va_end(ap);
01105       }
01106     }
01107 <span class="preprocessor">#else</span>
01108 <span class="preprocessor"></span>    <span class="keyword">inline</span> <span class="keywordtype">void</span> warn(<span class="keyword">const</span> <span class="keywordtype">bool</span> cond,<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {}
01109 <span class="preprocessor">#endif</span>
01110 <span class="preprocessor"></span>
01111     <span class="keyword">inline</span> <span class="keywordtype">int</span> xln(<span class="keyword">const</span> <span class="keywordtype">int</span> x) { <span class="keywordflow">return</span> x&gt;0?(int)(1+std::log10((<span class="keywordtype">double</span>)x)):1; }
01112     <span class="keyword">inline</span> <span class="keywordtype">char</span> uncase(<span class="keyword">const</span> <span class="keywordtype">char</span> x) { <span class="keywordflow">return</span> (char)((x&lt;'A'||x&gt;<span class="charliteral">'Z'</span>)?x:x-<span class="charliteral">'A'</span>+<span class="charliteral">'a'</span>); }
01113     <span class="keyword">inline</span> <span class="keywordtype">float</span> atof(<span class="keyword">const</span> <span class="keywordtype">char</span> *str) {
01114       <span class="keywordtype">float</span> x=0,y=1;
01115       <span class="keywordflow">if</span> (!str) <span class="keywordflow">return</span> 0; <span class="keywordflow">else</span> { std::sscanf(str,<span class="stringliteral">"%g/%g"</span>,&amp;x,&amp;y); <span class="keywordflow">return</span> x/y; }
01116     }
01117     <span class="keyword">inline</span> <span class="keywordtype">int</span> strlen(<span class="keyword">const</span> <span class="keywordtype">char</span> *s) { <span class="keywordflow">if</span> (s) { <span class="keywordtype">int</span> k; <span class="keywordflow">for</span> (k=0; s[k]; k++) ; <span class="keywordflow">return</span> k; } <span class="keywordflow">return</span> -1; }
01118     <span class="keyword">inline</span> <span class="keywordtype">int</span> strncmp(<span class="keyword">const</span> <span class="keywordtype">char</span> *s1,<span class="keyword">const</span> <span class="keywordtype">char</span> *s2,<span class="keyword">const</span> <span class="keywordtype">int</span> l) {
01119       <span class="keywordflow">if</span> (s1 &amp;&amp; s2) { <span class="keywordtype">int</span> n=0; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;l; k++) n+=std::abs(s1[k] - s2[k]); <span class="keywordflow">return</span> n; }
01120       <span class="keywordflow">return</span> 0;
01121     }
01122     <span class="keyword">inline</span> <span class="keywordtype">int</span> strncasecmp(<span class="keyword">const</span> <span class="keywordtype">char</span> *s1,<span class="keyword">const</span> <span class="keywordtype">char</span> *s2,<span class="keyword">const</span> <span class="keywordtype">int</span> l) {
01123       <span class="keywordflow">if</span> (s1 &amp;&amp; s2) { <span class="keywordtype">int</span> n=0; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;l; k++) n+=std::abs(uncase(s1[k])-uncase(s2[k])); <span class="keywordflow">return</span> n; }
01124       <span class="keywordflow">return</span> 0;
01125     }
01126     <span class="keyword">inline</span> <span class="keywordtype">int</span> strcmp(<span class="keyword">const</span> <span class="keywordtype">char</span> *s1,<span class="keyword">const</span> <span class="keywordtype">char</span> *s2) { 
01127       <span class="keyword">const</span> <span class="keywordtype">int</span> l1 = cimg::strlen(s1), l2 = cimg::strlen(s2);
01128       <span class="keywordflow">return</span> cimg::strncmp(s1,s2,1+(l1&lt;l2?l1:l2));
01129     }
01130     <span class="keyword">inline</span> <span class="keywordtype">int</span> strcasecmp(<span class="keyword">const</span> <span class="keywordtype">char</span> *s1,<span class="keyword">const</span> <span class="keywordtype">char</span> *s2) { 
01131       <span class="keyword">const</span> <span class="keywordtype">int</span> l1 = cimg::strlen(s1), l2 = cimg::strlen(s2);
01132       <span class="keywordflow">return</span> cimg::strncasecmp(s1,s2,1+(l1&lt;l2?l1:l2));
01133     }
01134     <span class="keyword">inline</span> <span class="keywordtype">int</span> strfind(<span class="keyword">const</span> <span class="keywordtype">char</span> *s,<span class="keyword">const</span> <span class="keywordtype">char</span> c) {
01135       <span class="keywordflow">if</span> (s) { 
01136         <span class="keywordtype">int</span> l; <span class="keywordflow">for</span> (l=cimg::strlen(s); l&gt;=0 &amp;&amp; s[l]!=c; l--) ;
01137         <span class="keywordflow">return</span> l; 
01138       }
01139       <span class="keywordflow">return</span> -1; 
01140     }
01141     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* basename(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)  {
01142       <span class="keywordflow">return</span> (cimg_OS!=2)?(s?s+1+cimg::strfind(s,<span class="charliteral">'/'</span>):NULL):(s?s+1+cimg::strfind(s,'\\'):NULL); 
01143     }
01144 
01145     <span class="keyword">inline</span> <span class="keywordtype">void</span> system(<span class="keyword">const</span> <span class="keywordtype">char</span> *command) {
01146 <span class="preprocessor">#if cimg_OS==2</span>
01147 <span class="preprocessor"></span>      PROCESS_INFORMATION pi;
01148       STARTUPINFO si;
01149       GetStartupInfo(&amp;si);
01150       si.wShowWindow = SW_HIDE;
01151       si.dwFlags |= SW_HIDE;
01152       BOOL res = CreateProcess(NULL,(LPTSTR)command,NULL,NULL,FALSE,0,NULL,NULL,&amp;si,&amp;pi);
01153       <span class="keywordflow">if</span> (res) {
01154         WaitForSingleObject(pi.hProcess, INFINITE);
01155         CloseHandle(pi.hThread);
01156         CloseHandle(pi.hProcess);
01157       }
01158 <span class="preprocessor">#else</span>
01159 <span class="preprocessor"></span>      std::system(command);
01160 <span class="preprocessor">#endif</span>
01161 <span class="preprocessor"></span>    }
01162     
01164 
<a name="l01183"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a52">01183</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>() {
01184       <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a> = NULL;
01185       <span class="keywordflow">if</span> (!convert_path) {
01186 <span class="preprocessor">#if cimg_OS==2 || defined(cimg_convert_path)</span>
01187 <span class="preprocessor"></span>        <span class="keywordtype">bool</span> stopflag = <span class="keyword">false</span>;
01188         std::FILE *file;
01189 <span class="preprocessor">#endif</span>
01190 <span class="preprocessor"></span>        <a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[1024];
01191 <span class="preprocessor">#ifdef cimg_convert_path</span>
01192 <span class="preprocessor"></span>        std::strcpy(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,cimg_convert_path);
01193         <span class="keywordflow">if</span> ((file=std::fopen(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"r"</span>))!=NULL) { std::fclose(file); stopflag = <span class="keyword">true</span>; }
01194 <span class="preprocessor">#endif</span>
01195 <span class="preprocessor"></span><span class="preprocessor">#if cimg_OS==2</span>
01196 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;=9 &amp;&amp; !stopflag; k++) {
01197           std::sprintf(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"C:\\PROGRA~1\\IMAGEM~1.%u-Q\\convert.exe"</span>,k);
01198           <span class="keywordflow">if</span> ((file=std::fopen(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"r"</span>))!=NULL) { std::fclose(file); stopflag = <span class="keyword">true</span>; }
01199         }
01200         <span class="keywordflow">if</span> (!stopflag) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;=9 &amp;&amp; !stopflag; k++) {
01201           std::sprintf(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"C:\\PROGRA~1\\IMAGEM~1.%u\\convert.exe"</span>,k);
01202           <span class="keywordflow">if</span> ((file=std::fopen(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"r"</span>))!=NULL) { std::fclose(file); stopflag = <span class="keyword">true</span>; }
01203         }
01204         <span class="keywordflow">if</span> (!stopflag) std::strcpy(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"convert.exe"</span>);
01205 <span class="preprocessor">#else</span>
01206 <span class="preprocessor"></span>        std::strcpy(<a class="code" href="namespacecimg__library_1_1cimg.html#a52">convert_path</a>,<span class="stringliteral">"convert"</span>);
01207 <span class="preprocessor">#endif</span>
01208 <span class="preprocessor"></span>      }
01209       <span class="keywordflow">return</span> convert_path;
01210     }
01211     
01213 
<a name="l01230"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a53">01230</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacecimg__library_1_1cimg.html#a53">temporary_path</a>() {
01231       <span class="keyword">static</span> <span class="keywordtype">char</span> *st_temporary_path = NULL;
01232       <span class="keywordflow">if</span> (!st_temporary_path) {
01233         st_temporary_path = <span class="keyword">new</span> <span class="keywordtype">char</span>[1024];
01234 <span class="preprocessor">#ifdef cimg_temporary_path</span>
01235 <span class="preprocessor"></span>        std::strcpy(st_temporary_path,cimg_temporary_path);
01236         <span class="keyword">const</span> <span class="keywordtype">char</span>* testing_path[7] = { st_temporary_path, <span class="stringliteral">"/tmp"</span>,<span class="stringliteral">"C:\\WINNT\\Temp"</span>, <span class="stringliteral">"C:\\WINDOWS\\Temp"</span>,<span class="stringliteral">""</span>,<span class="stringliteral">"C:"</span>,NULL };
01237 <span class="preprocessor">#else</span>
01238 <span class="preprocessor"></span>        <span class="keyword">const</span> <span class="keywordtype">char</span>* testing_path[6] = { <span class="stringliteral">"/tmp"</span>,<span class="stringliteral">"C:\\WINNT\\Temp"</span>, <span class="stringliteral">"C:\\WINDOWS\\Temp"</span>,<span class="stringliteral">""</span>,<span class="stringliteral">"C:"</span>,NULL };
01239 <span class="preprocessor">#endif</span>
01240 <span class="preprocessor"></span>        <span class="keywordtype">char</span> filetmp[1024];
01241         std::FILE *file=NULL;
01242         <span class="keywordtype">int</span> i=-1;
01243         <span class="keywordflow">while</span> (!file &amp;&amp; testing_path[++i]) {
01244           std::sprintf(filetmp,<span class="stringliteral">"%s/CImg%.4d.ppm"</span>,testing_path[i],std::rand()%10000);
01245           <span class="keywordflow">if</span> ((file=std::fopen(filetmp,<span class="stringliteral">"w"</span>))!=NULL) { std::fclose(file); std::remove(filetmp); }
01246         }
01247         <span class="keywordflow">if</span> (!file) 
01248           <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"cimg::temporary_path() : Unable to find a temporary path accessible for writing\n"</span>
01249                                 <span class="stringliteral">"you have to set the macro 'cimg_temporary_path' to a valid path where you have writing access :\n"</span>
01250                                 <span class="stringliteral">"#define cimg_temporary_path \"path\" (before including 'CImg.h')"</span>);
01251         std::strcpy(st_temporary_path,testing_path[i]);
01252       }
01253       <span class="keywordflow">return</span> st_temporary_path;
01254     }
01255     
01256     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *filename_split(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> filename, <span class="keywordtype">char</span> *<span class="keyword">const</span> body=NULL) {
01257       <span class="keywordflow">if</span> (!filename) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"cimg::filename_split() : Can't split the (null) filename"</span>);
01258       <span class="keywordtype">int</span> l = cimg::strfind(filename,<span class="charliteral">'.'</span>);
01259       <span class="keywordflow">if</span> (l&gt;=0) { <span class="keywordflow">if</span> (body) { std::strncpy(body,filename,l); body[l]=<span class="charliteral">'\0'</span>; }}
01260       <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (body) std::strcpy(body,filename); l=(int)std::strlen(filename)-1; }
01261       <span class="keywordflow">return</span> filename+l+1;
01262     }
01263     
01264     <span class="keyword">inline</span> <span class="keywordtype">char</span>* filename_number(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">int</span> number,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n,<span class="keywordtype">char</span> *<span class="keyword">const</span> string) {
01265       <span class="keywordtype">char</span> format[1024],body[1024];
01266       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename,body);
01267       <span class="keywordflow">if</span> (n&gt;0) std::sprintf(format,<span class="stringliteral">"%s_%%.%ud.%s"</span>,body,n,ext);
01268       <span class="keywordflow">else</span> std::sprintf(format,<span class="stringliteral">"%s_%%d.%s"</span>,body,ext);
01269       std::sprintf(string,format,number);
01270       <span class="keywordflow">return</span> string;
01271     }
01272     <span class="keyword">inline</span> std::FILE *fopen(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> path,<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> mode) {
01273       <span class="keywordflow">if</span>(!path || !mode) <span class="keywordflow">throw</span> CImgArgumentException(<span class="stringliteral">"cimg::fopen() : Can't open file '%s' with mode '%s'"</span>,path,mode);
01274       <span class="keywordflow">if</span> (path[0]==<span class="charliteral">'-'</span>) <span class="keywordflow">return</span> (mode[0]==<span class="charliteral">'r'</span>)?stdin:stdout; <span class="keywordflow">else</span> {
01275         std::FILE *dest=std::fopen(path,mode);
01276         <span class="keywordflow">if</span>(!dest) <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"cimg::fopen() : File '%s' cannot be opened %s"</span>,
01277                                         path,mode[0]==<span class="charliteral">'r'</span>?<span class="stringliteral">"for reading"</span>:(mode[0]==<span class="charliteral">'w'</span>?<span class="stringliteral">"for writing"</span>:<span class="stringliteral">""</span>),path);
01278         <span class="keywordflow">return</span> dest;
01279       }
01280     }
01281     <span class="keyword">inline</span> <span class="keywordtype">int</span> fclose(std::FILE *file) {
01282       warn(!file,<span class="stringliteral">"cimg::fclose() : Can't close (null) file"</span>);
01283       <span class="keywordflow">if</span> (!file || file==stdin || file==stdout) <span class="keywordflow">return</span> 0;
01284       <span class="keyword">const</span> <span class="keywordtype">int</span> errn=std::fclose(file);
01285       warn(errn!=0,<span class="stringliteral">"cimg::fclose() : Error %d during file closing"</span>,errn);
01286       <span class="keywordflow">return</span> errn;
01287     }
01288     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">int</span> fread(T *ptr,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nmemb,std::FILE *stream) {
01289       <span class="keywordflow">if</span> (!ptr || size&lt;=0 || nmemb&lt;=0 || !stream)
01290         <span class="keywordflow">throw</span> CImgArgumentException(<span class="stringliteral">"cimg::fread() : Can't read %u x %u bytes of file pointer '%p' in buffer '%p'"</span>,
01291                                     nmemb,size,stream,ptr);
01292       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errn = (<span class="keywordtype">unsigned</span> int)std::fread((<span class="keywordtype">void</span>*)ptr,size,nmemb,stream);
01293       cimg::warn(errn!=nmemb,<span class="stringliteral">"cimg::fread() : File reading problems, only %u/%u elements read"</span>,errn,nmemb);
01294       <span class="keywordflow">return</span> errn;
01295     }
01296     <span class="keyword">inline</span> <span class="keywordtype">int</span> fwrite(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nmemb,std::FILE *stream) {
01297       <span class="keywordflow">if</span> (!ptr || size&lt;=0 || nmemb&lt;=0 || !stream)
01298         <span class="keywordflow">throw</span> CImgArgumentException(<span class="stringliteral">"cimg::fwrite() : Can't write %u x %u bytes of file pointer '%p' from buffer '%p'"</span>,
01299                                     nmemb,size,stream,ptr);
01300       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errn = (<span class="keywordtype">unsigned</span> int)std::fwrite(ptr,size,nmemb,stream);
01301       <span class="keywordflow">if</span>(errn!=nmemb)
01302         <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"cimg::fwrite() : File writing problems, only %u/%u elements written"</span>,errn,nmemb);
01303       <span class="keywordflow">return</span> errn;
01304     }
01305     
01306     <span class="comment">// Exchange the values of variables \p a and \p b</span>
01307     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> swap(T&amp; a,T&amp; b) { T t=a; a=b; b=t; }
01308     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> swap(T&amp; a1,T&amp; b1,T&amp; a2,T&amp; b2) {
01309       cimg::swap(a1,b1); cimg::swap(a2,b2); 
01310     }
01311     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> swap(T&amp; a1,T&amp; b1,T&amp; a2,T&amp; b2,T&amp; a3,T&amp; b3) {
01312       cimg::swap(a1,b1,a2,b2); cimg::swap(a3,b3); 
01313     }
01314     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> swap(T&amp; a1,T&amp; b1,T&amp; a2,T&amp; b2,T&amp; a3,T&amp; b3,T&amp; a4,T&amp; b4) {
01315       cimg::swap(a1,b1,a2,b2,a3,b3); cimg::swap(a4,b4); 
01316     }
01317     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> swap(T&amp; a1,T&amp; b1,T&amp; a2,T&amp; b2,T&amp; a3,T&amp; b3,T&amp; a4,T&amp; b4,T&amp; a5,T&amp; b5) {
01318       cimg::swap(a1,b1,a2,b2,a3,b3,a4,b4); cimg::swap(a5,b5); 
01319     }
01320     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> swap(T&amp; a1,T&amp; b1,T&amp; a2,T&amp; b2,T&amp; a3,T&amp; b3,T&amp; a4,T&amp; b4,T&amp; a5,T&amp; b5,T&amp; a6,T&amp; b6) {
01321       cimg::swap(a1,b1,a2,b2,a3,b3,a4,b4,a5,b5); cimg::swap(a6,b6);
01322     }
01323     
01324     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T&amp; endian_swap(T&amp; a) {  
01325       <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(a)!=1) {
01326         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pb=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;a, *pe=pb+<span class="keyword">sizeof</span>(a);
01327         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;(int)<span class="keyword">sizeof</span>(a)/2; i++) cimg::swap(*(pb++),*(--pe));
01328       }
01329       <span class="keywordflow">return</span> a;
01330     }
01331 
01332     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> endian_swap(T *<span class="keyword">const</span> buffer,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size) {
01333       T *ptr = buffer;
01334       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;size; i++) cimg::endian_swap(*(ptr++));
01335     }
01336 
01337     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* option(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> name,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv,<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> defaut,
01338                               <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> usage=NULL) {
01339       <span class="keyword">static</span> <span class="keywordtype">bool</span> first=<span class="keyword">true</span>, visu=<span class="keyword">false</span>;
01340       <span class="keyword">const</span> <span class="keywordtype">char</span> *res = NULL;
01341       <span class="keywordflow">if</span> (first) { first=<span class="keyword">false</span>; visu = cimg::option(<span class="stringliteral">"-h"</span>,argc,argv,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL)!=NULL; }
01342       <span class="keywordflow">if</span> (!name &amp;&amp; visu) {
01343         std::fprintf(stderr,<span class="stringliteral">"\n %s%s%s"</span>,cimg::t_red,cimg::basename(argv[0]),cimg::t_normal);
01344         <span class="keywordflow">if</span> (usage) std::fprintf(stderr,<span class="stringliteral">" : %s"</span>,usage);
01345         std::fprintf(stderr,<span class="stringliteral">" (%s, %s)\n\n"</span>,__DATE__,__TIME__);
01346       }
01347       <span class="keywordflow">if</span> (name) {
01348         <span class="keywordflow">if</span> (argc&gt;0) {
01349           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0,i;
01350           <span class="keywordflow">while</span> (k&lt;argc &amp;&amp; cimg::strcmp(argv[k],name)) k++;
01351           i=k;
01352           res=(k++==argc?defaut:(k==argc?argv[--k]:argv[k]));
01353         } <span class="keywordflow">else</span> res = defaut;
01354         <span class="keywordflow">if</span> (visu &amp;&amp; usage) std::fprintf(stderr,<span class="stringliteral">"    %s%-8s%s = %-12s : %s%s%s\n"</span>,
01355                                         cimg::t_bold,name,cimg::t_normal,res?res:<span class="stringliteral">"NULL"</span>,cimg::t_purple,usage,cimg::t_normal);
01356       }
01357       <span class="keywordflow">return</span> res;
01358     }
01359 
01360     <span class="keyword">inline</span> <span class="keywordtype">bool</span> option(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> name,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv,
01361                        <span class="keyword">const</span> <span class="keywordtype">bool</span> defaut,<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> usage=NULL) {
01362       <span class="keyword">const</span> <span class="keywordtype">char</span> *s = cimg::option(name,argc,argv,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL);
01363       <span class="keyword">const</span> <span class="keywordtype">bool</span> res = s?(cimg::strcasecmp(s,<span class="stringliteral">"false"</span>) &amp;&amp; cimg::strcasecmp(s,<span class="stringliteral">"off"</span>) &amp;&amp; cimg::strcasecmp(s,<span class="stringliteral">"0"</span>)):defaut;
01364       cimg::option(name,0,NULL,res?<span class="stringliteral">"true"</span>:<span class="stringliteral">"false"</span>,usage);
01365       <span class="keywordflow">return</span> res;
01366     }
01367 
01368     <span class="keyword">inline</span> <span class="keywordtype">int</span> option(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> name,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv,
01369                       <span class="keyword">const</span> <span class="keywordtype">int</span> defaut,<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> usage=NULL) {
01370       <span class="keyword">const</span> <span class="keywordtype">char</span> *s = cimg::option(name,argc,argv,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL);
01371       <span class="keyword">const</span> <span class="keywordtype">int</span> res = s?std::atoi(s):defaut;
01372       <span class="keywordtype">char</span> tmp[256];
01373       std::sprintf(tmp,<span class="stringliteral">"%d"</span>,res);
01374       cimg::option(name,0,NULL,tmp,usage);
01375       <span class="keywordflow">return</span> res;
01376     }
01377 
01378     <span class="keyword">inline</span> <span class="keywordtype">char</span> option(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> name,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv,
01379                        <span class="keyword">const</span> <span class="keywordtype">char</span> defaut,<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> usage=NULL) {
01380       <span class="keyword">const</span> <span class="keywordtype">char</span> *s = cimg::option(name,argc,argv,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL);
01381       <span class="keyword">const</span> <span class="keywordtype">char</span> res = s?s[0]:defaut;
01382       <span class="keywordtype">char</span> tmp[8];
01383       tmp[0] = res;
01384       tmp[1] =<span class="charliteral">'\0'</span>;
01385       cimg::option(name,0,NULL,tmp,usage);
01386       <span class="keywordflow">return</span> res;
01387     }
01388 
01389     <span class="keyword">inline</span> <span class="keywordtype">double</span> option(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> name,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argc,<span class="keywordtype">char</span> **argv,
01390                          <span class="keyword">const</span> <span class="keywordtype">double</span> defaut,<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> usage=NULL) {
01391       <span class="keyword">const</span> <span class="keywordtype">char</span> *s = cimg::option(name,argc,argv,(<span class="keyword">const</span> <span class="keywordtype">char</span>*)NULL);
01392       <span class="keyword">const</span> <span class="keywordtype">double</span> res = s?cimg::atof(s):defaut;
01393       <span class="keywordtype">char</span> tmp[256];
01394       std::sprintf(tmp,<span class="stringliteral">"%g"</span>,res);
01395       cimg::option(name,0,NULL,tmp,usage);
01396       <span class="keywordflow">return</span> res;
01397     }
01398     
<a name="l01400"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a73">01400</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a73">endian</a>() { <span class="keyword">const</span> <span class="keywordtype">int</span> x=1; <span class="keywordflow">return</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;x)[0]?<span class="keyword">false</span>:<span class="keyword">true</span>; }
01401 
<a name="l01403"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a74">01403</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a74">info</a>() {
01404       std::fprintf(stderr,<span class="stringliteral">"\n %sCImg Library %g%s, compiled %s ( %s ) with the following flags :\n\n"</span>,
01405                    cimg::t_red,cimg_version,cimg::t_normal,__DATE__,__TIME__);
01406       std::fprintf(stderr,<span class="stringliteral">"  &gt; Architecture   : %s%-12s%s %s(cimg_OS=%d)\n%s"</span>,
01407                    cimg::t_bold,
01408                    cimg_OS==1?<span class="stringliteral">"Unix"</span>:(cimg_OS==2?<span class="stringliteral">"Windows"</span>:<span class="stringliteral">"Unknown"</span>),
01409                    cimg::t_normal,cimg::t_purple,cimg_OS,cimg::t_normal);
01410       std::fprintf(stderr,<span class="stringliteral">"  &gt; Display type   : %s%-12s%s %s(cimg_display_type=%d)%s\n"</span>,
01411                    cimg::t_bold,cimg_display_type==0?<span class="stringliteral">"No"</span>:
01412                    (cimg_display_type==1?<span class="stringliteral">"X11"</span>:
01413                     (cimg_display_type==2?<span class="stringliteral">"WindowsGDI"</span>:
01414                      <span class="stringliteral">"Unknown"</span>)),
01415                    cimg::t_normal,cimg::t_purple,cimg_display_type,cimg::t_normal);
01416 <span class="preprocessor">#ifdef cimg_color_terminal</span>
01417 <span class="preprocessor"></span>      std::fprintf(stderr,<span class="stringliteral">"  &gt; Color terminal : %s%-12s%s %s(cimg_color_terminal defined)%s\n"</span>,
01418                    cimg::t_bold,<span class="stringliteral">"Yes"</span>,cimg::t_normal,cimg::t_purple,cimg::t_normal);
01419 <span class="preprocessor">#else</span>
01420 <span class="preprocessor"></span>      std::fprintf(stderr,<span class="stringliteral">"  &gt; Color terminal : %-12s (cimg_color_terminal undefined)\n"</span>,<span class="stringliteral">"No"</span>);
01421 <span class="preprocessor">#endif</span>
01422 <span class="preprocessor"></span>      std::fprintf(stderr,<span class="stringliteral">"  &gt; Debug messages : %s%-12s%s %s(cimg_debug=%d)%s\n"</span>,cimg::t_bold,
01423                    cimg_debug==2?<span class="stringliteral">"High"</span>:(cimg_debug==1?<span class="stringliteral">"Yes"</span>:<span class="stringliteral">"No"</span>),
01424                    cimg::t_normal,cimg::t_purple,cimg_debug,cimg::t_normal);
01425       std::fprintf(stderr,<span class="stringliteral">"\n"</span>);
01426     }
01427     
<a name="l01429"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a75">01429</a>     <span class="keyword">inline</span> <span class="keywordtype">long</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a75">time</a>() {
01430 <span class="preprocessor">#if cimg_OS==1</span>
01431 <span class="preprocessor"></span>      <span class="keyword">struct </span>timeval st_time;
01432       gettimeofday(&amp;st_time,NULL);
01433       <span class="keywordflow">return</span> (long)(st_time.tv_usec/1000 + st_time.tv_sec*1000);
01434 <span class="preprocessor">#elif cimg_OS==2</span>
01435 <span class="preprocessor"></span>      <span class="keyword">static</span> SYSTEMTIME st_time;
01436       GetSystemTime(&amp;st_time);
01437       <span class="keywordflow">return</span> (long)(st_time.wMilliseconds + 1000*(st_time.wSecond + 60*(st_time.wMinute + 60*st_time.wHour)));
01438 <span class="preprocessor">#else </span>
01439 <span class="preprocessor"></span>      <span class="keywordflow">return</span> 0;
01440 <span class="preprocessor">#endif</span>
01441 <span class="preprocessor"></span>    }
01442 
01444 
<a name="l01449"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a76">01449</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a76">sleep</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> milliseconds) {
01450 <span class="preprocessor">#if cimg_OS==1</span>
01451 <span class="preprocessor"></span>      <span class="keyword">struct </span>timespec tv;
01452       tv.tv_sec = milliseconds/1000;
01453       tv.tv_nsec = (milliseconds%1000)*1000000;
01454       nanosleep(&amp;tv,NULL);
01455 <span class="preprocessor">#elif cimg_OS==2</span>
01456 <span class="preprocessor"></span>      Sleep(milliseconds);
01457 <span class="preprocessor">#endif</span>
01458 <span class="preprocessor"></span>    }
01459 
01461 
<a name="l01466"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a77">01466</a>     <span class="keyword">inline</span> <span class="keywordtype">long</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a77">wait</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> milliseconds=20,<span class="keywordtype">long</span> reference_time=-1) {
01467       <span class="keyword">static</span> <span class="keywordtype">long</span> latest_time = cimg::time();
01468       <span class="keywordflow">if</span> (reference_time&gt;=0) latest_time = reference_time;
01469       <span class="keyword">const</span> <span class="keywordtype">long</span> current_time = cimg::time(), time_diff = milliseconds + latest_time - current_time;
01470       <span class="keywordflow">if</span> (time_diff&gt;0) { cimg::sleep(time_diff); <span class="keywordflow">return</span> (latest_time = current_time + time_diff); }
01471       <span class="keywordflow">else</span> <span class="keywordflow">return</span> (latest_time = current_time);
01472     }
01473 
<a name="l01475"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a78">01475</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a78">rol</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=1) { <span class="keywordflow">return</span> (a&lt;&lt;n)|(a&gt;&gt;((<span class="keyword">sizeof</span>(T)&lt;&lt;3)-n)); }
<a name="l01477"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a79">01477</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a79">ror</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=1) { <span class="keywordflow">return</span> (a&gt;&gt;n)|(a&lt;&lt;((<span class="keyword">sizeof</span>(T)&lt;&lt;3)-n)); }
01478 
01479 <span class="preprocessor">#if ( !defined(_MSC_VER) || _MSC_VER&gt;1200 )</span>
01480 <span class="preprocessor"></span>
<a name="l01481"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a80">01481</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a80">abs</a>(<span class="keyword">const</span> T&amp; a) { <span class="keywordflow">return</span> a&gt;=0?a:-a; }
01482     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">double</span> abs(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; a) { <span class="keywordflow">return</span> std::fabs(a); }
01483     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">float</span> abs(<span class="keyword">const</span> <span class="keywordtype">float</span>&amp; a)   { <span class="keywordflow">return</span> (float)std::fabs((<span class="keywordtype">double</span>)a); }
01484     <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a80">abs</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; a)       { <span class="keywordflow">return</span> std::abs(a); }
01485     
<a name="l01487"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a84">01487</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b) { <span class="keywordflow">return</span> a&lt;=b?a:b; }
<a name="l01489"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a85">01489</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b,<span class="keyword">const</span> T&amp; c) { <span class="keywordflow">return</span> cimg::min(cimg::min(a,b),c); }
<a name="l01491"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a86">01491</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b,<span class="keyword">const</span> T&amp; c,<span class="keyword">const</span> T&amp; d) { <span class="keywordflow">return</span> cimg::min(cimg::min(a,b,c),d); }
<a name="l01493"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a87">01493</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b) { <span class="keywordflow">return</span> a&gt;=b?a:b; }
<a name="l01495"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a88">01495</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b,<span class="keyword">const</span> T&amp; c) { <span class="keywordflow">return</span> cimg::max(cimg::max(a,b),c); }
<a name="l01497"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a89">01497</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b,<span class="keyword">const</span> T&amp; c,<span class="keyword">const</span> T&amp; d) { <span class="keywordflow">return</span> cimg::max(cimg::max(a,b,c),d); }
<a name="l01499"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a90">01499</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">char</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a90">sign</a>(<span class="keyword">const</span> T&amp; x) { <span class="keywordflow">return</span> (x&lt;0)?-1:(x==0?0:1); }
01500 <span class="preprocessor">#else</span>
01501 <span class="preprocessor"></span>    <span class="comment">// Special versions due to object reference bug in VisualC++ 6.0.</span>
01502     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T abs(<span class="keyword">const</span> T a) { <span class="keywordflow">return</span> a&gt;=0?a:-a; }
01503     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T min(<span class="keyword">const</span> T a,<span class="keyword">const</span> T b) { <span class="keywordflow">return</span> a&lt;=b?a:b; }
01504     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(<span class="keyword">const</span> T a,<span class="keyword">const</span> T b,<span class="keyword">const</span> T c) { <span class="keywordflow">return</span> cimg::min(cimg::min(a,b),c); }
01505     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(<span class="keyword">const</span> T a,<span class="keyword">const</span> T b,<span class="keyword">const</span> T c,<span class="keyword">const</span> T&amp; d) { <span class="keywordflow">return</span> cimg::min(cimg::min(a,b,c),d); }
01506     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(<span class="keyword">const</span> T a,<span class="keyword">const</span> T b) { <span class="keywordflow">return</span> a&gt;=b?a:b; }
01507     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(<span class="keyword">const</span> T a,<span class="keyword">const</span> T b,<span class="keyword">const</span> T c) { <span class="keywordflow">return</span> cimg::max(cimg::max(a,b),c); }
01508     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keyword">const</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(<span class="keyword">const</span> T a,<span class="keyword">const</span> T b,<span class="keyword">const</span> T c,<span class="keyword">const</span> T&amp; d) { <span class="keywordflow">return</span> cimg::max(cimg::max(a,b,c),d); }
01509     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="keywordtype">char</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a90">sign</a>(<span class="keyword">const</span> T x) { <span class="keywordflow">return</span> (x&lt;0)?-1:(x==0?0:1); }
01510 <span class="preprocessor">#endif</span>
01511 <span class="preprocessor"></span>
01513 
<a name="l01516"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a91">01516</a>     <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a91">mod</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x,<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; m) { <span class="keywordflow">return</span> x-m*std::floor(x/m); }
01517     <span class="keyword">inline</span> <span class="keywordtype">float</span>  mod(<span class="keyword">const</span> <span class="keywordtype">float</span>&amp; x,<span class="keyword">const</span> <span class="keywordtype">float</span>&amp; m)   { <span class="keywordflow">return</span> (float)(x-m*std::floor((<span class="keywordtype">double</span>)x/m)); }
01518     <span class="keyword">inline</span> <span class="keywordtype">int</span>    mod(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> m)         { <span class="keywordflow">return</span> x&gt;=0?x%m:(x%m?m+x%m:0); }
01519 
01521 
<a name="l01526"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a94">01526</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T <a class="code" href="namespacecimg__library_1_1cimg.html#a94">minmod</a>(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b) { <span class="keywordflow">return</span> a*b&lt;=0?0:(a&gt;0?(a&lt;b?a:b):(a&lt;b?b:a)); }
<a name="l01528"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a95">01528</a>     <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a95">rand</a>() { <span class="keywordflow">return</span> (double)std::rand()/RAND_MAX; }
<a name="l01530"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a96">01530</a>     <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a96">crand</a>() { <span class="keywordflow">return</span> 1-2*cimg::rand(); }
<a name="l01532"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a97">01532</a>     <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a97">grand</a>() {
01533       <span class="keywordflow">return</span> std::sqrt(-2*std::log((<span class="keywordtype">double</span>)(1e-10 + (1-2e-10)*cimg::rand())))*std::cos((<span class="keywordtype">double</span>)(2*<a class="code" href="namespacecimg__library_1_1cimg.html#a3">PI</a>*cimg::rand())); 
01534     }
01535 
01536     <span class="comment">// Return (a^2+b^2)^0.5</span>
01537     <span class="keyword">inline</span> <span class="keywordtype">double</span> pythagore(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b) {
01538       <span class="keyword">const</span> <span class="keywordtype">double</span> absa = cimg::abs(a), absb = cimg::abs(b);
01539       <span class="keywordflow">if</span> (absa&gt;absb) { <span class="keyword">const</span> <span class="keywordtype">double</span> tmp = absb/absa; <span class="keywordflow">return</span> absa*std::sqrt(1.0+tmp*tmp); }
01540       <span class="keywordflow">else</span> { <span class="keyword">const</span> <span class="keywordtype">double</span> tmp = absa/absb; <span class="keywordflow">return</span> (absb==0?0:absb*std::sqrt(1.0+tmp*tmp)); }
01541     }
01542   }
01543 
01544   <span class="comment">/*-------------------------------------------------------</span>
01545 <span class="comment">    </span>
01546 <span class="comment">  </span>
01547 <span class="comment">  </span>
01548 <span class="comment">  </span>
01549 <span class="comment">    Definition of the CImgStats structure</span>
01550 <span class="comment">  </span>
01551 <span class="comment">  </span>
01552 <span class="comment">  </span>
01553 <span class="comment">    </span>
01554 <span class="comment">    ------------------------------------------------------*/</span>
01556 
<a name="l01570"></a><a class="code" href="structcimg__library_1_1CImgStats.html">01570</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> {
<a name="l01571"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o0">01571</a>     <span class="keywordtype">double</span> min;                 
<a name="l01572"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o1">01572</a>     <span class="keywordtype">double</span> max;                 
<a name="l01573"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o2">01573</a>     <span class="keywordtype">double</span> mean;                
<a name="l01574"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o3">01574</a>     <span class="keywordtype">double</span> variance;            
<a name="l01575"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o4">01575</a>     <span class="keywordtype">int</span> xmin;                   
<a name="l01576"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o5">01576</a>     <span class="keywordtype">int</span> ymin;                   
<a name="l01577"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o6">01577</a>     <span class="keywordtype">int</span> zmin;                   
<a name="l01578"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o7">01578</a>     <span class="keywordtype">int</span> vmin;                   
<a name="l01579"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o8">01579</a>     <span class="keywordtype">int</span> lmin;                   
<a name="l01580"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o9">01580</a>     <span class="keywordtype">int</span> xmax;                   
<a name="l01581"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o10">01581</a>     <span class="keywordtype">int</span> ymax;                   
<a name="l01582"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o11">01582</a>     <span class="keywordtype">int</span> zmax;                   
<a name="l01583"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o12">01583</a>     <span class="keywordtype">int</span> vmax;                   
<a name="l01584"></a><a class="code" href="structcimg__library_1_1CImgStats.html#o13">01584</a>     <span class="keywordtype">int</span> lmax;                   
01585 
<a name="l01587"></a><a class="code" href="structcimg__library_1_1CImgStats.html#a0">01587</a>     <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>():min(0),max(0),mean(0),variance(0),xmin(-1),ymin(-1),zmin(-1),vmin(-1),lmin(-1),
01588                 xmax(-1),ymax(-1),zmax(-1),vmax(-1),lmax(-1) {}
<a name="l01590"></a><a class="code" href="structcimg__library_1_1CImgStats.html#a1">01590</a>     <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>&amp; stats):min(stats.min),max(stats.max),mean(stats.mean),variance(stats.variance),
01591                                       xmin(stats.xmin),ymin(stats.ymin),zmin(stats.zmin),vmin(stats.vmin),lmin(stats.lmin),
01592                                       xmax(stats.xmax),ymax(stats.ymax),zmax(stats.zmax),vmax(stats.vmax),lmax(stats.lmax) {};
01593 
01595 
<a name="l01598"></a><a class="code" href="structcimg__library_1_1CImgStats.html#a2">01598</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">bool</span> compute_variance=<span class="keyword">true</span>):mean(0),variance(0),lmin(-1),lmax(-1) {
01599       cimg_test(img,<span class="stringliteral">"CImgStats::CImgStats"</span>);
01600       T pmin=img[0], pmax=pmin, *ptrmin=img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>, *ptrmax=ptrmin;
01601       cimg_map(img,ptr,T) {
01602         <span class="keyword">const</span> T&amp; a=*ptr;
01603         mean+=(double)a;
01604         <span class="keywordflow">if</span> (a&lt;pmin) { pmin=a; ptrmin = ptr; }
01605         <span class="keywordflow">if</span> (a&gt;pmax) { pmax=a; ptrmax = ptr; }
01606       }
01607       mean/=img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
01608       min=(double)pmin;
01609       max=(double)pmax;
01610       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> offmin = (<span class="keywordtype">unsigned</span> long)(ptrmin-img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>), offmax = (<span class="keywordtype">unsigned</span> long)(ptrmax-img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>);
01611       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> whz = img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>, wh = img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>;      
01612       vmin = offmin/whz; offmin%=whz; zmin = offmin/wh; offmin%=wh; ymin = offmin/img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; xmin = offmin%img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
01613       vmax = offmax/whz; offmax%=whz; zmax = offmax/wh; offmax%=wh; ymax = offmax/img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; xmax = offmax%img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
01614       <span class="keywordflow">if</span> (compute_variance) {
01615         cimg_map(img,ptr,T) { <span class="keyword">const</span> <span class="keywordtype">double</span> tmpf=(*ptr)-mean; variance+=tmpf*tmpf; }
01616         variance/=img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
01617       }
01618     }
01619 
01621 
<a name="l01625"></a><a class="code" href="structcimg__library_1_1CImgStats.html#a3">01625</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list,<span class="keyword">const</span> <span class="keywordtype">bool</span> compute_variance=<span class="keyword">true</span>):mean(0),variance(0) {
01626       cimgl_test(list,<span class="stringliteral">"CImgStats::CImgStats"</span>);
01627       T pmin=list[0][0], pmax=pmin, *ptrmin=list[0].<a class="code" href="structcimg__library_1_1CImgl.html#o1">data</a>, *ptrmax=ptrmin;
01628       <span class="keywordtype">int</span> psize=0;
01629       cimgl_map(list,l) {
01630         cimg_map(list[l],ptr,T) {
01631           <span class="keyword">const</span> T&amp; a=*ptr;
01632           mean+=(double)a;
01633           <span class="keywordflow">if</span> (a&lt;pmin) { pmin=a; ptrmin = ptr; lmin = l; }
01634           <span class="keywordflow">if</span> (a&gt;pmax) { pmax=a; ptrmax = ptr; lmax = l; }
01635         }
01636         psize+=list[l].<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>();
01637       }
01638       mean/=psize;
01639       min=(double)pmin;
01640       max=(double)pmax;
01641       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> &amp;imin = list[lmin], &amp;imax = list[lmax];
01642       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> offmin = (ptrmin-imin.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>), offmax = (ptrmax-imax.data);
01643       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> whz1 = imin.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*imin.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*imin.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>, wh1 = imin.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*imin.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>;
01644       vmin = offmin/whz1; offmin%=whz1; zmin = offmin/wh1; offmin%=wh1; ymin = offmin/imin.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; xmin = offmin%imin.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
01645       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> whz2 = imax.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*imax.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*imax.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>, wh2 = imax.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*imax.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>;
01646       vmax = offmax/whz2; offmax%=whz2; zmax = offmax/wh2; offmax%=wh2; ymax = offmax/imax.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; xmax = offmax%imax.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
01647       <span class="keywordflow">if</span> (compute_variance) {
01648         cimgl_map(list,l) cimg_map(list[l],ptr,T) { <span class="keyword">const</span> <span class="keywordtype">double</span> tmpf=(*ptr)-mean; variance+=tmpf*tmpf; }
01649         variance/=psize;
01650       }
01651     }
01652 
<a name="l01654"></a><a class="code" href="structcimg__library_1_1CImgStats.html#a4">01654</a>     <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> stats) {
01655       min = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>;
01656       max = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>;
01657       mean = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o2">mean</a>;
01658       variance = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o3">variance</a>;
01659       xmin = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o4">xmin</a>; ymin = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o5">ymin</a>; zmin = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o6">zmin</a>; vmin = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o7">vmin</a>; lmin = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o8">lmin</a>;
01660       xmax = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o9">xmax</a>; ymax = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o10">ymax</a>; zmax = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o11">zmax</a>; vmax = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o12">vmax</a>; lmax = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o13">lmax</a>;
01661       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
01662     }
<a name="l01664"></a><a class="code" href="structcimg__library_1_1CImgStats.html#a5">01664</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>&amp; print(<span class="keyword">const</span> <span class="keywordtype">char</span>* title=NULL)<span class="keyword"> const </span>{
01665       <span class="keywordflow">if</span> (lmin&gt;=0 &amp;&amp; lmax&gt;=0)
01666         std::fprintf(stderr,<span class="stringliteral">"%-8s(this=%p) : { min=%g, mean=%g [var=%g], max=%g, "</span>
01667                      <span class="stringliteral">"pmin=[%d](%d,%d,%d,%d), pmax=[%d](%d,%d,%d,%d) }\n"</span>,
01668                      title?title:<span class="stringliteral">"CImgStats"</span>,(<span class="keywordtype">void</span>*)<span class="keyword">this</span>,min,mean,variance,max,
01669                      lmin,xmin,ymin,zmin,vmin,lmax,xmax,ymax,zmax,vmax);
01670       <span class="keywordflow">else</span>
01671         std::fprintf(stderr,<span class="stringliteral">"%-8s(this=%p) : { min=%g, mean=%g [var=%g], max=%g, "</span>
01672                      <span class="stringliteral">"pmin=(%d,%d,%d,%d), pmax=(%d,%d,%d,%d) }\n"</span>,
01673                      title?title:<span class="stringliteral">"CImgStats"</span>,(<span class="keywordtype">void</span>*)<span class="keyword">this</span>,min,mean,variance,max,
01674                      xmin,ymin,zmin,vmin,xmax,ymax,zmax,vmax);
01675       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
01676     }
01677     
01678 <span class="preprocessor">#ifdef cimgstats_plugin</span>
01679 <span class="preprocessor"></span><span class="preprocessor">#include cimgstats_plugin</span>
01680 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01681 <span class="preprocessor"></span>
01682   };
01683 
01684   <span class="comment">/*-------------------------------------------------------</span>
01685 <span class="comment">  </span>
01686 <span class="comment"></span>
01687 <span class="comment"></span>
01688 <span class="comment"></span>
01689 <span class="comment">    Definition of the CImgDisplay structure</span>
01690 <span class="comment"></span>
01691 <span class="comment"></span>
01692 <span class="comment"></span>
01693 <span class="comment"></span>
01694 <span class="comment">  ------------------------------------------------------*/</span>
01695 
01697 
<a name="l01705"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html">01705</a>   <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a> {
01706 
01707     <span class="comment">//------------------------</span>
01708     <span class="comment">//</span>
01709     <span class="comment">// CImgDisplay variables</span>
01710     <span class="comment">//</span>
01711     <span class="comment">//------------------------</span>
01712 
01714 
<a name="l01727"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">01727</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width;
01728 
01730 
<a name="l01743"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">01743</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> height;
01744 
01746 
<a name="l01752"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o2">01752</a>     <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> window_width;
01753 
01755 
<a name="l01761"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o3">01761</a>     <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> window_height;
01762 
<a name="l01764"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o4">01764</a>     <span class="keyword">volatile</span> <span class="keywordtype">int</span> window_x;
01765 
<a name="l01767"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o5">01767</a>     <span class="keyword">volatile</span> <span class="keywordtype">int</span> window_y;
01768 
01770 
<a name="l01780"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o6">01780</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization;
01781 
01783 
<a name="l01794"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o7">01794</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events;
01795 
01797 
<a name="l01802"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o8">01802</a>     <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen;
01803 
01805 
<a name="l01813"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o9">01813</a>     <span class="keyword">volatile</span> <span class="keywordtype">int</span> mouse_x;
01814 
01816 
<a name="l01824"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o10">01824</a>     <span class="keyword">volatile</span> <span class="keywordtype">int</span> mouse_y;
01825 
01828 
<a name="l01843"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o11">01843</a>     <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> button;
01844 
01846 
<a name="l01871"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o12">01871</a>     <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key;
01872 
01874 
<a name="l01897"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o13">01897</a>     <span class="keyword">volatile</span> <span class="keywordtype">bool</span> closed;
01898 
<a name="l01900"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#o14">01900</a>     <span class="keyword">volatile</span> <span class="keywordtype">bool</span> resized;
01901     <span class="keyword">volatile</span> <span class="keywordtype">bool</span> moved;
01902 
01903     <span class="comment">// Not documented, internal use only.</span>
01904     <span class="keywordtype">double</span> min,max;
01905 
01906     <span class="comment">//------------------------</span>
01907     <span class="comment">//</span>
01908     <span class="comment">// CImgDisplay functions</span>
01909     <span class="comment">//</span>
01910     <span class="comment">//------------------------</span>
01911 
01913 
<a name="l01919"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a0">01919</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> dimx()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)width; }
01920 
01922 
<a name="l01928"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a1">01928</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> dimy()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)height; }
01929 
01930     <span class="keyword">const</span> <span class="keywordtype">int</span> window_dimx()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)window_width; }
01931     <span class="keyword">const</span> <span class="keywordtype">int</span> window_dimy()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)window_height; }    
01932 
01933     <span class="comment">// operator=(). It is actually defined to avoid its use, and throw a CImgDisplay exception.</span>
01934     CImgDisplay&amp; operator=(<span class="keyword">const</span> CImgDisplay&amp;) {
01935       <span class="keywordflow">throw</span> CImgDisplayException(<span class="stringliteral">"CImgDisplay()::operator=() : Assignement of CImgDisplay is not allowed. Use pointers instead !"</span>);
01936       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
01937     }
01938     
01940 
<a name="l01942"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a5">01942</a>       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; wait(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> milliseconds)<span class="keyword"> const </span>{ cimg::wait(milliseconds); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
01943 
01945 
<a name="l01954"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a6">01954</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; display(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'c'</span>) { 
01955       <span class="keywordflow">return</span> display(list.<a class="code" href="structcimg__library_1_1CImgl.html#z33_3">get_append</a>(axe,align)); 
01956     } 
01957 
01959 
<a name="l01967"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a7">01967</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; resize(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">bool</span> redraw=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> force=<span class="keyword">true</span>) { 
01968       <span class="keywordflow">return</span> resize(img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,redraw,force); 
01969     }
01970 
01971     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; resize(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; disp,<span class="keyword">const</span> <span class="keywordtype">bool</span> redraw=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> force=<span class="keyword">true</span>) {
01972       <span class="keywordflow">return</span> resize(disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>,disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>,redraw,force);
01973     }
01974 
01975     CImgDisplay&amp; resize(<span class="keyword">const</span> <span class="keywordtype">bool</span> redraw=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> force=<span class="keyword">false</span>) {
01976       resize(window_width,window_height,redraw,force);
01977       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
01978     }
01979 
01980     <span class="comment">// When no display available</span>
01981     <span class="comment">//---------------------------</span>
01982 <span class="preprocessor">#if cimg_display_type==0</span>
01983 <span class="preprocessor"></span>    <span class="keywordtype">void</span> nodisplay_available() {
01984       <span class="keyword">static</span> <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
01985       <span class="keywordflow">if</span> (first) {
01986         cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImgDisplay() : Display has been required but is not available (cimg_display_type=0)"</span>);
01987         first = <span class="keyword">false</span>;
01988       }    
01989     }  
01991 
<a name="l02000"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a11">02000</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimw,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimh,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02001                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02002                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):fullscreen(false) {
02003       nodisplay_available(); 
02004     }
02005 
02007 
02014     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; 
<a name="l02015"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a12">02015</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02016                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02017                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):fullscreen(false) {
02018       nodisplay_available(); 
02019     }
02020     
02022 
02029     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; 
<a name="l02030"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a13">02030</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02031                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02032                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):fullscreen(false) {
02033       nodisplay_available(); 
02034     }
02035   
02037 
<a name="l02040"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a14">02040</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; win, <span class="keywordtype">char</span> *title=NULL):fullscreen(false) { nodisplay_available(); }
02041 
<a name="l02043"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a15">02043</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; resize(<span class="keyword">const</span> <span class="keywordtype">int</span> width, <span class="keyword">const</span> <span class="keywordtype">int</span> height,<span class="keyword">const</span> <span class="keywordtype">bool</span> redraw=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> force=<span class="keyword">true</span>) {
02044       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
02045     }
<a name="l02047"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a16">02047</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; move(<span class="keyword">const</span> <span class="keywordtype">int</span> posx,<span class="keyword">const</span> <span class="keywordtype">int</span> posy) { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
02048 
<a name="l02050"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a17">02050</a>     ~<a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>() {}
<a name="l02052"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a18">02052</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> render(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymax=~0) {}
<a name="l02054"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a19">02054</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; display(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymax=-1) { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l02056"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a20">02056</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; wait()  { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l02058"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a21">02058</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; show()  { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l02060"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#a22">02060</a>     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; close() { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
02061   
<a name="l02063"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#e0">02063</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> screen_dimx() { <span class="keywordflow">return</span> 0; }
02064 
<a name="l02066"></a><a class="code" href="structcimg__library_1_1CImgDisplay.html#e1">02066</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> screen_dimy() { <span class="keywordflow">return</span> 0; }
02067 
02068     <span class="comment">// X11-based display</span>
02069     <span class="comment">//------------------</span>
02070 <span class="preprocessor">#elif cimg_display_type==1</span>
02071 <span class="preprocessor"></span>    <span class="keywordtype">void</span> *data;
02072     Window window;
02073     XImage *image;
02074  
02075     <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimw,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimh,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02076                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02077                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):
02078       width(dimw),height(dimh),normalization(normalization_type&amp;3),events(events_type&amp;3),
02079       fullscreen(fullscreen_flag),closed(closed_flag),min(0),max(0) {
02080       <span class="keywordflow">if</span> (!dimw || !dimh) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImgDisplay::CImgDisplay() : null size specified"</span>);
02081       new_lowlevel(title);
02082       std::memset(data,0,(cimg::X11attr().nb_bits&gt;16?<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>):<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>))*width*height);
02083       pthread_mutex_lock(cimg::X11attr().mutex);
02084       XPutImage(cimg::X11attr().display,window,*cimg::X11attr().gc,image,0,0,0,0,width,height);
02085       XFlush(cimg::X11attr().display);
02086       pthread_mutex_unlock(cimg::X11attr().mutex);
02087     }
02088 
02089     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; 
02090     CImgDisplay(<span class="keyword">const</span> CImg&lt;T&gt;&amp; img,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02091                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02092                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):
02093       normalization(normalization_type&amp;3),events(events_type&amp;3),
02094       fullscreen(fullscreen_flag),closed(closed_flag),min(0),max(0) {
02095       cimg_test(img,<span class="stringliteral">"CImgDisplay::CImgDisplay"</span>);
02096       CImg&lt;T&gt; tmp;
02097       <span class="keyword">const</span> CImg&lt;T&gt;&amp; nimg = (img.depth==1)?img:(tmp=img.get_3dplanes(img.width/2,img.height/2,img.depth/2));
02098       width  = nimg.width;
02099       height = nimg.height;
02100       <span class="keywordflow">if</span> (normalization==2) { CImgStats st(img,<span class="keyword">false</span>); min=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; max=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
02101       new_lowlevel(title);
02102       display(nimg);
02103     }
02104 
02105     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; 
02106     CImgDisplay(<span class="keyword">const</span> CImgl&lt;T&gt;&amp; list,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02107                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02108                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):
02109       normalization(normalization_type&amp;3),events(events_type&amp;3),fullscreen(fullscreen_flag),
02110       closed(closed_flag),<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(0),<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(0) {
02111       cimgl_test(list,<span class="stringliteral">"CImgDisplay::CImgDisplay"</span>);
02112       CImg&lt;T&gt; tmp;
02113       <span class="keyword">const</span> CImg&lt;T&gt; 
02114         img0 = list.get_append(<span class="charliteral">'x'</span>), 
02115         &amp;img = (img0.depth==1)?img0:(tmp=img0.get_3dplanes(img0.width/2,img0.height/2,img0.depth/2));
02116       width  = img.width; 
02117       height = img.height;
02118       <span class="keywordflow">if</span> (normalization==2) { CImgStats st(img,<span class="keyword">false</span>); <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
02119       new_lowlevel(title);
02120       display(img);
02121     }
02122 
02123     CImgDisplay(<span class="keyword">const</span> CImgDisplay&amp; win, <span class="keywordtype">char</span> *title=<span class="stringliteral">"[Copy]"</span>):
02124       width(win.width),height(win.height),normalization(win.normalization&amp;3),events(win.events&amp;3),
02125       fullscreen(win.fullscreen),closed(win.closed),<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(win.<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>),<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(win.<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>) {
02126       new_lowlevel(title);
02127       std::memcpy(data,win.data,(cimg::X11attr().nb_bits&gt;16?<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>):<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>))*width*height);
02128       pthread_mutex_lock(cimg::X11attr().mutex);
02129       XPutImage(cimg::X11attr().display,window,*cimg::X11attr().gc,image,0,0,0,0,width,height);
02130       XFlush(cimg::X11attr().display);
02131       pthread_mutex_unlock(cimg::X11attr().mutex);
02132     }
02133 
02134     CImgDisplay&amp; resize(<span class="keyword">const</span> <span class="keywordtype">int</span> nwidth, <span class="keyword">const</span> <span class="keywordtype">int</span> nheight,<span class="keyword">const</span> <span class="keywordtype">bool</span> redraw=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> force=<span class="keyword">true</span>) {
02135       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
02136         dimx=(nwidth&gt;0)?nwidth:(-width*nwidth/100),
02137         dimy=(nheight&gt;0)?nheight:(-height*nheight/100);
02138       <span class="keywordflow">if</span> (!dimx || !dimy) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02139       pthread_mutex_lock(cimg::X11attr().mutex);
02140       <span class="keywordflow">if</span> (dimx!=width || dimy!=height) {
02141         <span class="keywordflow">if</span> (cimg::X11attr().nb_bits&gt;16) {
02142           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ndata = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[dimx*dimy];
02143           <span class="keywordflow">if</span> (redraw) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;dimy; y++) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;dimx; x++)
02144             ndata[x+y*dimx] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)data)[x*width/dimx + width*(y*height/dimy)];
02145           <span class="keywordflow">else</span> std::memset(ndata,0,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)*dimx*dimy);
02146           data = (<span class="keywordtype">void</span>*)ndata;
02147         } <span class="keywordflow">else</span> {
02148           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ndata = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[dimx*dimy];
02149           <span class="keywordflow">if</span> (redraw) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;dimy; y++) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;dimx; x++)
02150             ndata[x+y*dimx] = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)data)[x*width/dimx + width*(y*height/dimy)];
02151           <span class="keywordflow">else</span> std::memset(ndata,0,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)*dimx*dimy);
02152           data = (<span class="keywordtype">void</span>*)ndata;
02153         }
02154         XDestroyImage(image);
02155         image = XCreateImage(cimg::X11attr().display,DefaultVisual(cimg::X11attr().display,DefaultScreen(cimg::X11attr().display)),
02156                              cimg::X11attr().nb_bits,ZPixmap,0,(<span class="keywordtype">char</span>*)data,dimx,dimy,8,0);
02157       }
02158       width  = dimx;
02159       height = dimy;
02160       <span class="keywordflow">if</span> (force &amp;&amp; (window_width!=width || window_height!=height)) {
02161         XResizeWindow(cimg::X11attr().display,window,width,height);
02162         window_width = width;
02163         window_height = height;
02164       }
02165       XPutImage(cimg::X11attr().display,window,*cimg::X11attr().gc,image,0,0,0,0,width,height);
02166       XFlush(cimg::X11attr().display);
02167       resized = <span class="keyword">false</span>;
02168       pthread_mutex_unlock(cimg::X11attr().mutex);
02169       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02170     }
02171   
02172     CImgDisplay&amp; move(<span class="keyword">const</span> <span class="keywordtype">int</span> posx,<span class="keyword">const</span> <span class="keywordtype">int</span> posy) {
02173       pthread_mutex_lock(cimg::X11attr().mutex);
02174       window_x = posx;
02175       window_y = posy;
02176       XMoveWindow(cimg::X11attr().display,window,posx,posy);
02177       XFlush(cimg::X11attr().display);
02178       moved = <span class="keyword">false</span>;
02179       pthread_mutex_unlock(cimg::X11attr().mutex);
02180       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02181     }
02182     
02183     ~CImgDisplay() {
02184       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
02185       pthread_mutex_lock(cimg::X11attr().mutex);
02186       <span class="keywordflow">for</span> (i=0; i&lt;cimg::X11attr().nb_wins &amp;&amp; cimg::X11attr().wins[i]!=<span class="keyword">this</span>; i++) i++;
02187       <span class="keywordflow">for</span> (; i&lt;cimg::X11attr().nb_wins-1; i++) cimg::X11attr().wins[i]=cimg::X11attr().wins[i+1];
02188       cimg::X11attr().nb_wins--;
02189       XDestroyWindow(cimg::X11attr().display,window);
02190       XDestroyImage(image);
02191       <span class="keywordflow">if</span> (!cimg::X11attr().nb_wins) {
02192         pthread_cancel(*cimg::X11attr().event_thread);
02193         pthread_join(*cimg::X11attr().event_thread,NULL);
02194         XCloseDisplay(cimg::X11attr().display);
02195         cimg::X11attr().display=NULL;
02196         pthread_mutex_unlock(cimg::X11attr().mutex);
02197         pthread_mutex_destroy(cimg::X11attr().mutex);
02198         <span class="keyword">delete</span> cimg::X11attr().event_thread;
02199         <span class="keyword">delete</span> cimg::X11attr().mutex;
02200         <span class="keyword">delete</span> cimg::X11attr().gc;
02201       } <span class="keywordflow">else</span> pthread_mutex_unlock(cimg::X11attr().mutex);
02202     }
02203   
02204     <span class="keywordtype">void</span> new_lowlevel(<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL) {
02205       cimg::warn(fullscreen,<span class="stringliteral">"CImgDisplay::new_lowlevel() : Fullscreen mode requested, "</span>
02206                  <span class="stringliteral">"but not supported on X11 Displays"</span>);
02207       <span class="keywordflow">if</span> (!cimg::X11attr().display) { <span class="comment">// Open X11 Display if not already done.</span>
02208         cimg::X11attr().nb_wins = 0;
02209         cimg::X11attr().thread_finished = <span class="keyword">false</span>;
02210         cimg::X11attr().mutex = <span class="keyword">new</span> pthread_mutex_t;
02211         pthread_mutex_init(cimg::X11attr().mutex,NULL);
02212         pthread_mutex_lock(cimg::X11attr().mutex);
02213         cimg::X11attr().display = XOpenDisplay((std::getenv(<span class="stringliteral">"DISPLAY"</span>) ? std::getenv(<span class="stringliteral">"DISPLAY"</span>) : <span class="stringliteral">":0.0"</span>));
02214         <span class="keywordflow">if</span> (!cimg::X11attr().display) <span class="keywordflow">throw</span> CImgDisplayException(<span class="stringliteral">"CImgDisplay::new_lowlevel() : Can't open X11 display"</span>);
02215         cimg::X11attr().nb_bits = DefaultDepth(cimg::X11attr().display, DefaultScreen(cimg::X11attr().display));
02216         <span class="keywordflow">if</span> (cimg::X11attr().nb_bits!=16 &amp;&amp; cimg::X11attr().nb_bits!=24)
02217           <span class="keywordflow">throw</span> CImgDisplayException(<span class="stringliteral">"CImgDisplay::new_lowlevel() : %u bits mode is not supported "</span>
02218                                      <span class="stringliteral">"(only 16 and 24 bits are supported)"</span>,cimg::X11attr().nb_bits);
02219         cimg::X11attr().gc = <span class="keyword">new</span> GC;
02220         *cimg::X11attr().gc = DefaultGC(cimg::X11attr().display,DefaultScreen(cimg::X11attr().display));
02221         Visual *visual = DefaultVisual(cimg::X11attr().display,0);
02222         XVisualInfo vtemplate;
02223         vtemplate.visualid = XVisualIDFromVisual(visual);
02224         <span class="keywordtype">int</span> nb_visuals;
02225         XVisualInfo *vinfo = XGetVisualInfo(cimg::X11attr().display,VisualIDMask,&amp;vtemplate,&amp;nb_visuals);
02226         <span class="keywordflow">if</span> (vinfo &amp;&amp; vinfo-&gt;red_mask&lt;vinfo-&gt;blue_mask) cimg::X11attr().endian = <span class="keyword">true</span>;
02227         cimg::X11attr().event_thread = <span class="keyword">new</span> pthread_t;
02228         pthread_create(cimg::X11attr().event_thread,NULL,thread_lowlevel,NULL);
02229       } <span class="keywordflow">else</span> pthread_mutex_lock(cimg::X11attr().mutex);
02230       
02231       <span class="comment">// Create display window and image data.</span>
02232       window = XCreateSimpleWindow(cimg::X11attr().display,RootWindow(cimg::X11attr().display,DefaultScreen(cimg::X11attr().display)),
02233                                      0,0,width,height,2,0,0x0L);
02234       <span class="keywordflow">if</span> (cimg::X11attr().nb_bits&gt;16) data = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[width*height]; <span class="keywordflow">else</span> data = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[width*height];
02235       image = XCreateImage(cimg::X11attr().display,DefaultVisual(cimg::X11attr().display,DefaultScreen(cimg::X11attr().display)),
02236                              cimg::X11attr().nb_bits,ZPixmap,0,(<span class="keywordtype">char</span>*)data,width,height,8,0);      
02237       XStoreName(cimg::X11attr().display,window,title?title:<span class="stringliteral">""</span>);
02238       <span class="keywordflow">if</span> (!closed) {
02239         XEvent event;
02240         XSelectInput(cimg::X11attr().display,window,StructureNotifyMask);
02241         XMapWindow(cimg::X11attr().display,window);
02242         <span class="keywordflow">do</span> XWindowEvent(cimg::X11attr().display,window,StructureNotifyMask,&amp;event); <span class="keywordflow">while</span> (event.type!=MapNotify);
02243         XWindowAttributes attr;
02244         XGetWindowAttributes(cimg::X11attr().display,window,&amp;attr);
02245         window_x = attr.x;
02246         window_y = attr.y;
02247       } <span class="keywordflow">else</span> window_x = window_y = 0;
02248       <span class="keywordflow">if</span> (events) { 
02249         Atom atom = XInternAtom(cimg::X11attr().display, <span class="stringliteral">"WM_DELETE_WINDOW"</span>, False); 
02250         XSetWMProtocols(cimg::X11attr().display, window, &amp;atom, 1); 
02251       }
02252       window_width = width;
02253       window_height = height;
02254       mouse_x = mouse_y = -1;
02255       button = key = 0;
02256       resized = moved = <span class="keyword">false</span>;
02257       cimg::X11attr().wins[cimg::X11attr().nb_wins++]=<span class="keyword">this</span>;
02258       pthread_mutex_unlock(cimg::X11attr().mutex);
02259     }
02260   
02261     <span class="keywordtype">void</span> proc_lowlevel(XEvent *pevent) {
02262       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buttoncode[3] = { 1,4,2 };
02263       XEvent event=*pevent;
02264       <span class="keywordflow">switch</span> (event.type) {
02265       <span class="keywordflow">case</span> ClientMessage:
02266         XUnmapWindow(cimg::X11attr().display,window);
02267         mouse_x=mouse_y=-1; 
02268         button=key=0;
02269         closed=<span class="keyword">true</span>; 
02270         <span class="keywordflow">break</span>;
02271      <span class="keywordflow">case</span> ConfigureNotify: {
02272         <span class="keywordflow">while</span> (::XCheckWindowEvent(cimg::X11attr().display,window,StructureNotifyMask,&amp;event));
02273         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
02274           nw = event.xconfigure.width,
02275           nh = event.xconfigure.height;
02276         <span class="keyword">const</span> <span class="keywordtype">int</span>
02277           nx = event.xconfigure.x,
02278           ny = event.xconfigure.y;
02279         <span class="keywordflow">if</span> (nw &amp;&amp; nh &amp;&amp; (nw!=window_width || nh!=window_height)) { 
02280           window_width = nw; 
02281           window_height = nh; 
02282           mouse_x = mouse_y = -1;
02283           XResizeWindow(cimg::X11attr().display,window,window_width,window_height);
02284           resized = <span class="keyword">true</span>;
02285         }
02286         <span class="keywordflow">if</span> (nx!=window_x || ny!=window_y) {
02287           window_x = nx;
02288           window_y = ny;
02289           moved = <span class="keyword">true</span>;
02290         }
02291       } <span class="keywordflow">break</span>;
02292       <span class="keywordflow">case</span> Expose:
02293         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,ExposureMask,&amp;event));
02294         XPutImage(cimg::X11attr().display,window,*cimg::X11attr().gc,image,0,0,0,0,width,height);
02295         <span class="keywordflow">break</span>;
02296       <span class="keywordflow">case</span> ButtonPress:
02297         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,ButtonPressMask,&amp;event));
02298         button |= buttoncode[event.xbutton.button-1];
02299         <span class="keywordflow">break</span>;
02300       <span class="keywordflow">case</span> ButtonRelease:
02301         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,ButtonReleaseMask,&amp;event));
02302         button &amp;= ~buttoncode[event.xbutton.button-1];
02303         <span class="keywordflow">break</span>;
02304       <span class="keywordflow">case</span> KeyPress: {
02305         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,KeyPressMask,&amp;event));
02306         <span class="keywordtype">char</span> tmp;
02307         KeySym ksym;
02308         XLookupString(&amp;event.xkey,&amp;tmp,1,&amp;ksym,NULL);
02309         key = (<span class="keywordtype">unsigned</span> int)ksym;
02310       }
02311         <span class="keywordflow">break</span>;
02312       <span class="keywordflow">case</span> KeyRelease:
02313         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,KeyReleaseMask,&amp;event));
02314         key = 0;
02315         <span class="keywordflow">break</span>;
02316       <span class="keywordflow">case</span> LeaveNotify:
02317         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,LeaveWindowMask,&amp;event));
02318         mouse_x = mouse_y =-1; 
02319         <span class="keywordflow">break</span>;
02320       <span class="keywordflow">case</span> MotionNotify:
02321         <span class="keywordflow">while</span> (XCheckWindowEvent(cimg::X11attr().display,window,PointerMotionMask,&amp;event));
02322         mouse_x = event.xmotion.x; 
02323         mouse_y = event.xmotion.y;
02324         <span class="keywordflow">if</span> (mouse_x&lt;0 || mouse_y&lt;0 || mouse_x&gt;=dimx() || mouse_y&gt;=dimy()) mouse_x=mouse_y=-1; 
02325         <span class="keywordflow">break</span>;
02326       }
02327     }
02328   
02329     <span class="keyword">static</span> <span class="keywordtype">void</span>* thread_lowlevel(<span class="keywordtype">void</span> *arg) {
02330       XEvent event;
02331       pthread_setcanceltype(PTHREAD_CANCEL_ASYNCHRONOUS,NULL);
02332       <span class="keywordflow">for</span> (;;) {
02333         pthread_mutex_lock(cimg::X11attr().mutex);
02334         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;cimg::X11attr().nb_wins; i++) {
02335           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xevent_type = (cimg::X11attr().wins[i]-&gt;events)&amp;3;
02336           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> emask =
02337             ((xevent_type&gt;=1)?ExposureMask|StructureNotifyMask:0)|
02338             ((xevent_type&gt;=2)?ButtonPressMask|KeyPressMask|PointerMotionMask|LeaveWindowMask:0)|
02339             ((xevent_type&gt;=3)?ButtonReleaseMask|KeyReleaseMask:0);
02340           XSelectInput(cimg::X11attr().display,cimg::X11attr().wins[i]-&gt;window,emask);
02341         }
02342         <span class="keywordtype">bool</span> event_flag = XCheckTypedEvent(cimg::X11attr().display, ClientMessage, &amp;event);
02343         <span class="keywordflow">if</span> (!event_flag) event_flag = XCheckMaskEvent(cimg::X11attr().display,
02344                                                       ExposureMask|StructureNotifyMask|ButtonPressMask|
02345                                                       KeyPressMask|PointerMotionMask|LeaveWindowMask|ButtonReleaseMask|
02346                                                       KeyReleaseMask,&amp;event);
02347         <span class="keywordflow">if</span> (event_flag) {
02348           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;cimg::X11attr().nb_wins; i++)
02349             <span class="keywordflow">if</span> (!cimg::X11attr().wins[i]-&gt;closed &amp;&amp; event.xany.window==cimg::X11attr().wins[i]-&gt;window)
02350               cimg::X11attr().wins[i]-&gt;proc_lowlevel(&amp;event);
02351           cimg::X11attr().thread_finished = <span class="keyword">true</span>;
02352         }
02353         pthread_mutex_unlock(cimg::X11attr().mutex);
02354         cimg::wait(25);
02355       }
02356       <span class="keywordflow">return</span> NULL;
02357     }
02358 
02359     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; XImage* render(<span class="keyword">const</span> CImg&lt;T&gt;&amp; img,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymax=~0) {
02360       cimg_test(img,<span class="stringliteral">"CImgDisplay::render"</span>);
02361       <span class="keywordflow">if</span> (img.depth!=1) <span class="keywordflow">return</span> render(img.get_3dplanes(img.width/2,img.height/2,img.depth/2),0,~0);
02362       <span class="keywordflow">if</span> (img.width!=width || img.height!=height) <span class="keywordflow">return</span> render(img.get_resize(width,height,1,-100,1),0,~0);
02363       <span class="keyword">const</span> <span class="keywordtype">bool</span> by = (ymin&lt;=ymax);
02364       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
02365         nymin = (by?ymin:ymax),
02366         nymax = (by?(ymax&lt;height?ymax:height-1):(ymin&lt;height?ymin:height-1)),
02367         xymax = (nymax+1)*width;
02368       <span class="keyword">const</span> T 
02369         *data1 = img.ptr(0,nymin,0,0),
02370         *data2 = (img.dim&gt;=2)?img.ptr(0,nymin,0,1):data1,
02371         *data3 = (img.dim&gt;=3)?img.ptr(0,nymin,0,2):data1;
02372       <span class="keywordflow">if</span> (cimg::X11attr().endian) cimg::swap(data1,data3);
02373       pthread_mutex_lock(cimg::X11attr().mutex);
02374       <span class="keywordflow">if</span> (!normalization) {
02375         <span class="keywordflow">switch</span> (cimg::X11attr().nb_bits) {
02376         <span class="keywordflow">case</span> 16: {
02377           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xy=nymin*width; xy&lt;xymax; xy++) {
02378             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> R = (<span class="keywordtype">unsigned</span> char)*(data1++), G = (<span class="keywordtype">unsigned</span> char)*(data2++), B = (<span class="keywordtype">unsigned</span> char)*(data3++);
02379             XPutPixel(image,xy,0,((R&gt;&gt;3)&lt;&lt;11) | ((G&gt;&gt;2)&lt;&lt;5) | (B&gt;&gt;3));
02380           }
02381         } <span class="keywordflow">break</span>;
02382         <span class="keywordflow">case</span> 24: {
02383           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xy=nymin*width; xy&lt;xymax; xy++) {       
02384             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> R = (<span class="keywordtype">unsigned</span> char)*(data1++), G = (<span class="keywordtype">unsigned</span> char)*(data2++), B = (<span class="keywordtype">unsigned</span> char)*(data3++);
02385             XPutPixel(image,xy,0,(R&lt;&lt;16) | (G&lt;&lt;8) | B);
02386           }
02387         } <span class="keywordflow">break</span>;
02388         };
02389       } <span class="keywordflow">else</span> {
02390         <span class="keywordflow">if</span> (normalization==1) { CImgStats st(img,<span class="keyword">false</span>); <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
02391         <span class="keyword">const</span> T nmin = (T)min, delta = (T)<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>-nmin, mm=delta?delta:(T)1;
02392         <span class="keywordflow">switch</span> (cimg::X11attr().nb_bits) {
02393         <span class="keywordflow">case</span> 16: {
02394           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xy=nymin*width; xy&lt;xymax; xy++) {
02395             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
02396               R = (<span class="keywordtype">unsigned</span> char)(255*(*(data1++)-nmin)/mm),
02397               G = (<span class="keywordtype">unsigned</span> char)(255*(*(data2++)-nmin)/mm),
02398               B = (<span class="keywordtype">unsigned</span> char)(255*(*(data3++)-nmin)/mm);
02399             XPutPixel(image,xy,0,((R&gt;&gt;3)&lt;&lt;11) | ((G&gt;&gt;2)&lt;&lt;5) | (B&gt;&gt;3));
02400           }
02401         } <span class="keywordflow">break</span>;
02402         <span class="keywordflow">case</span> 24: {
02403           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xy=nymin*width; xy&lt;xymax; xy++) {
02404             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
02405               R = (<span class="keywordtype">unsigned</span> char)(255*(*(data1++)-nmin)/mm),
02406               G = (<span class="keywordtype">unsigned</span> char)(255*(*(data2++)-nmin)/mm),
02407               B = (<span class="keywordtype">unsigned</span> char)(255*(*(data3++)-nmin)/mm);
02408             XPutPixel(image,xy,0,(R&lt;&lt;16) | (G&lt;&lt;8) | B);
02409           } 
02410         } <span class="keywordflow">break</span>;
02411         } 
02412       }
02413       pthread_mutex_unlock(cimg::X11attr().mutex);
02414       <span class="keywordflow">return</span> image;
02415     }
02416     
02417     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; CImgDisplay&amp; display(<span class="keyword">const</span> CImg&lt;T&gt;&amp; pimg,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pymax=~0) {
02418       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
02419         ymin = pymin&lt;pymax?pymin:pymax,
02420         ymax = pymin&lt;pymax?(pymax&gt;=height?height-1:pymax):(pymin&gt;=height?height-1:pymin);
02421       render(pimg,ymin,ymax);
02422       <span class="keywordflow">if</span> (!closed) {      
02423         pthread_mutex_lock(cimg::X11attr().mutex);
02424         XPutImage(cimg::X11attr().display,window,*cimg::X11attr().gc,image,0,ymin,0,ymin,width,ymax-ymin+1);
02425         XFlush(cimg::X11attr().display);
02426         pthread_mutex_unlock(cimg::X11attr().mutex);
02427       }
02428       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02429     }
02430   
02431     CImgDisplay&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a77">wait</a>() {
02432       <span class="keywordflow">if</span> (!closed &amp;&amp; events) {
02433         XEvent event;
02434         <span class="keywordflow">do</span> {
02435           pthread_mutex_lock(cimg::X11attr().mutex);
02436           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
02437             emask = ExposureMask|StructureNotifyMask|
02438             ((events&gt;=2)?ButtonPressMask|KeyPressMask|PointerMotionMask|LeaveWindowMask:0)|
02439             ((events&gt;=3)?ButtonReleaseMask|KeyReleaseMask:0);
02440           XSelectInput(cimg::X11attr().display,window,emask);
02441           XPeekEvent(cimg::X11attr().display,&amp;event);
02442           cimg::X11attr().thread_finished = <span class="keyword">false</span>;
02443           pthread_mutex_unlock(cimg::X11attr().mutex);
02444         } <span class="keywordflow">while</span> (event.xany.window!=window);
02445         <span class="keywordflow">while</span> (!cimg::X11attr().thread_finished) cimg::wait(25);
02446       }
02447       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02448     }
02449 
02450     CImgDisplay&amp; show() {
02451       <span class="keywordflow">if</span> (closed) {
02452         pthread_mutex_lock(cimg::X11attr().mutex);
02453         XEvent event;
02454         XSelectInput(cimg::X11attr().display,window,StructureNotifyMask);
02455         XMapWindow(cimg::X11attr().display,window);
02456         <span class="keywordflow">do</span> XWindowEvent(cimg::X11attr().display,window,StructureNotifyMask,&amp;event);
02457         <span class="keywordflow">while</span> (event.type!=MapNotify);
02458         XWindowAttributes attr;
02459         XGetWindowAttributes(cimg::X11attr().display,window,&amp;attr);
02460         window_x = attr.x;
02461         window_y = attr.y;
02462         XPutImage(cimg::X11attr().display,window,*cimg::X11attr().gc,image,0,0,0,0,width,height);
02463         XFlush(cimg::X11attr().display);
02464         closed = <span class="keyword">false</span>;
02465         pthread_mutex_unlock(cimg::X11attr().mutex);
02466       }
02467       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02468     }
02469     CImgDisplay&amp; close() {
02470       <span class="keywordflow">if</span> (!closed) {
02471         pthread_mutex_lock(cimg::X11attr().mutex);
02472         XUnmapWindow(cimg::X11attr().display,window);
02473         XFlush(cimg::X11attr().display);
02474         closed = <span class="keyword">true</span>;
02475         window_x = window_y = 0;        
02476         pthread_mutex_unlock(cimg::X11attr().mutex);
02477       }
02478       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02479     }
02480 
02481     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> screen_dimx() { 
02482       <span class="keywordtype">int</span> res = 0;
02483       <span class="keywordflow">if</span> (!cimg::X11attr().display) {
02484         Display *disp = XOpenDisplay((std::getenv(<span class="stringliteral">"DISPLAY"</span>) ? std::getenv(<span class="stringliteral">"DISPLAY"</span>) : <span class="stringliteral">":0.0"</span>));
02485         <span class="keywordflow">if</span> (!disp) <span class="keywordflow">throw</span> CImgDisplayException(<span class="stringliteral">"CImgDisplay::screen_dimx() : Can't open X11 display"</span>);
02486         res = DisplayWidth(disp,DefaultScreen(disp));
02487         XCloseDisplay(disp);
02488       } <span class="keywordflow">else</span> res = DisplayWidth(cimg::X11attr().display,DefaultScreen(cimg::X11attr().display));
02489       <span class="keywordflow">return</span> res;
02490     }
02491 
02492     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> screen_dimy() { 
02493       <span class="keywordtype">int</span> res = 0;
02494       <span class="keywordflow">if</span> (!cimg::X11attr().display) {
02495         Display *disp = XOpenDisplay((std::getenv(<span class="stringliteral">"DISPLAY"</span>) ? std::getenv(<span class="stringliteral">"DISPLAY"</span>) : <span class="stringliteral">":0.0"</span>));
02496         <span class="keywordflow">if</span> (!disp) <span class="keywordflow">throw</span> CImgDisplayException(<span class="stringliteral">"CImgDisplay::screen_dimy() : Can't open X11 display"</span>);
02497         res = DisplayHeight(disp,DefaultScreen(disp));
02498         XCloseDisplay(disp);
02499       } <span class="keywordflow">else</span> res = DisplayHeight(cimg::X11attr().display,DefaultScreen(cimg::X11attr().display));
02500       <span class="keywordflow">return</span> res;
02501     }
02502 
02503     <span class="comment">// Windows-based display</span>
02504     <span class="comment">//-----------------------</span>
02505 <span class="preprocessor">#elif cimg_display_type==2</span>
02506 <span class="preprocessor"></span>    CLIENTCREATESTRUCT ccs;
02507     BITMAPINFO bmi;
02508     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *data;
02509     DEVMODE curr_mode;
02510     HWND window;
02511     HDC hdc;
02512     HANDLE thread;
02513     HANDLE wait_disp;
02514     HANDLE created;
02515     HANDLE mutex;
02516 
02517     CImgDisplay(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimw,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimh,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02518                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02519                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):
02520       width(dimw),height(dimh),normalization(normalization_type&amp;3),events(events_type&amp;3),
02521       fullscreen(fullscreen_flag),closed(closed_flag),<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(0),<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(0) {
02522       <span class="keywordflow">if</span> (!dimw || !dimh) <span class="keywordflow">throw</span> CImgArgumentException(<span class="stringliteral">"CImgDisplay::CImgDisplay() : null size specified. "</span>);
02523       new_lowlevel(title);
02524       std::memset(data,0,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)*width*height);
02525       SetDIBitsToDevice(hdc,0,0,width,height,0,0,0,height,data,&amp;bmi,DIB_RGB_COLORS);
02526     }
02527 
02528     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; 
02529     CImgDisplay(<span class="keyword">const</span> CImg&lt;T&gt;&amp; img,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02530                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02531                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):
02532       normalization(normalization_type&amp;3),events(events_type&amp;3),
02533       fullscreen(fullscreen_flag),closed(closed_flag),<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(0),<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(0) {
02534       cimg_test(img,<span class="stringliteral">"CImgDisplay::CImgDisplay"</span>);
02535       CImg&lt;T&gt; tmp;
02536       <span class="keyword">const</span> CImg&lt;T&gt;&amp; nimg = (img.depth==1)?img:(tmp=img.get_3dplanes(img.width/2,img.height/2,img.depth/2));
02537       width  = nimg.width;
02538       height = nimg.height;
02539       <span class="keywordflow">if</span> (normalization==2) { CImgStats st(img,<span class="keyword">false</span>); <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
02540       new_lowlevel(title);
02541       display(nimg);
02542     }
02543 
02544     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
02545     CImgDisplay(<span class="keyword">const</span> CImgl&lt;T&gt;&amp; list,<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,
02546                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> normalization_type=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> events_type=3,
02547                 <span class="keyword">const</span> <span class="keywordtype">bool</span> fullscreen_flag=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> closed_flag=<span class="keyword">false</span>):
02548       normalization(normalization_type&amp;3),events(events_type&amp;3),fullscreen(fullscreen_flag),
02549       closed(closed_flag),<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(0),<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(0) {
02550       cimgl_test(list,<span class="stringliteral">"CImgDisplay::CImgDisplay"</span>);
02551       CImg&lt;T&gt; tmp;
02552       <span class="keyword">const</span> CImg&lt;T&gt;
02553         img0 = list.get_append(<span class="charliteral">'x'</span>),
02554         &amp;img = (img0.depth==1)?img0:(tmp=img0.get_3dplanes(img0.width/2,img0.height/2,img0.depth/2));
02555       width  = img.width;
02556       height = img.height;
02557       <span class="keywordflow">if</span> (normalization==2) { CImgStats st(img,<span class="keyword">false</span>); <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
02558       new_lowlevel(title);
02559       display(img);
02560     }
02561 
02562     CImgDisplay(<span class="keyword">const</span> CImgDisplay&amp; win, <span class="keywordtype">char</span> *title=<span class="stringliteral">"[Copy]"</span>):
02563       width(win.width),height(win.height),normalization(win.normalization&amp;3),events(win.events&amp;3),
02564       fullscreen(win.fullscreen),closed(win.closed),<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>(win.<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>),<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>(win.<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>) {
02565       new_lowlevel(title);
02566       std::memcpy(data,win.data,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)*width*height);
02567       SetDIBitsToDevice(hdc,0,0,width,height,0,0,0,height,data,&amp;bmi,DIB_RGB_COLORS);
02568     }
02569 
02570     CImgDisplay&amp; resize(<span class="keyword">const</span> <span class="keywordtype">int</span> nwidth, <span class="keyword">const</span> <span class="keywordtype">int</span> nheight,<span class="keyword">const</span> <span class="keywordtype">bool</span> redraw=<span class="keyword">false</span>,<span class="keyword">const</span> <span class="keywordtype">bool</span> force=<span class="keyword">true</span>) {
02571       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
02572         dimx=(nwidth&gt;0)?nwidth:(-nwidth*width/100),
02573         dimy=(nheight&gt;0)?nheight:(-nheight*height/100);
02574       <span class="keywordflow">if</span> (!dimx || !dimy) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02575       <span class="keywordflow">if</span> (dimx!=width || dimy!=height) {
02576         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ndata = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[dimx*dimy];
02577         <span class="keywordflow">if</span> (redraw) 
02578           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;dimy; y++) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;dimx; x++)
02579             ndata[x+y*dimx] = data[x*width/dimx + width*(y*height/dimy)];
02580         <span class="keywordflow">else</span> std::memset(ndata,0x80,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)*dimx*dimy);
02581         <span class="keyword">delete</span>[] data;
02582         data = ndata;
02583         bmi.bmiHeader.biWidth=dimx;
02584         bmi.bmiHeader.biHeight=-(int)dimy;
02585       }
02586       width  = dimx;
02587       height = dimy;
02588       <span class="keywordflow">if</span> (force &amp;&amp; (window_width!=width || window_height!=height)) {
02589         RECT rect; rect.left=rect.top=0; rect.right=width-1; rect.bottom=height-1;
02590         AdjustWindowRect(&amp;rect,WS_CAPTION | WS_SYSMENU | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX,<span class="keyword">false</span>);
02591         <span class="keyword">const</span> <span class="keywordtype">int</span> cwidth = rect.right-rect.left+1, cheight = rect.bottom-rect.top+1;
02592         SetWindowPos(window,0,0,0,cwidth,cheight,SWP_NOMOVE | SWP_NOZORDER | SWP_NOCOPYBITS);
02593         window_width  = width;
02594         window_height = height;
02595       }
02596       SetDIBitsToDevice(hdc,0,0,width,height,0,0,0,height,data,&amp;bmi,DIB_RGB_COLORS);
02597       resized = <span class="keyword">false</span>;
02598       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02599     }
02600     
02601     CImgDisplay&amp; move(<span class="keyword">const</span> <span class="keywordtype">int</span> posx,<span class="keyword">const</span> <span class="keywordtype">int</span> posy) {
02602       RECT rect; rect.left=rect.top=0; rect.right=width-1; rect.bottom=height-1;
02603       AdjustWindowRect(&amp;rect,WS_CAPTION | WS_SYSMENU | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX,<span class="keyword">false</span>);
02604       <span class="keyword">const</span> <span class="keywordtype">int</span> border1 = (rect.right-rect.left+1-width)/2, border2 = rect.bottom-rect.top+1-height-border1;
02605       window_x = posx;
02606       window_y = posy;
02607       SetWindowPos(window,0,posx-border1,posy-border2,0,0,SWP_NOSIZE | SWP_NOZORDER);
02608       moved = <span class="keyword">false</span>;
02609       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02610     }
02611 
02612     ~CImgDisplay() {
02613       DestroyWindow(window);
02614       <span class="keywordflow">if</span> (events) TerminateThread(thread,0);
02615       <span class="keyword">delete</span>[] data;
02616       <span class="keywordflow">if</span> (curr_mode.dmSize) ChangeDisplaySettings(&amp;curr_mode,0);
02617     }
02618   
02619     <span class="keywordtype">void</span> new_lowlevel(<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL) {
02620       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ThreadID;
02621       DEVMODE mode;
02622       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> imode=0,ibest=0,bestbpp=0;
02623       <span class="keywordtype">void</span> *arg = (<span class="keywordtype">void</span>*)(<span class="keyword">new</span> <span class="keywordtype">void</span>*[2]);
02624       ((<span class="keywordtype">void</span>**)arg)[0]=(<span class="keywordtype">void</span>*)<span class="keyword">this</span>;
02625       ((<span class="keywordtype">void</span>**)arg)[1]=(<span class="keywordtype">void</span>*)title;
02626       <span class="keywordflow">if</span> (fullscreen) {
02627         <span class="keywordflow">for</span> (mode.dmSize = <span class="keyword">sizeof</span>(DEVMODE), mode.dmDriverExtra = 0; EnumDisplaySettings(NULL,imode,&amp;mode); imode++)
02628           <span class="keywordflow">if</span> (mode.dmPelsWidth==width &amp;&amp; mode.dmPelsHeight==height &amp;&amp; mode.dmBitsPerPel&gt;bestbpp) {
02629             bestbpp = mode.dmBitsPerPel;
02630             ibest=imode; 
02631           }
02632         cimg::warn(!bestbpp,<span class="stringliteral">"CImgDisplay::new_lowlevel() : Could not initialize fullscreen mode %ux%u\n"</span>,width,height);
02633         <span class="keywordflow">if</span> (bestbpp) {
02634           curr_mode.dmSize = <span class="keyword">sizeof</span>(DEVMODE); curr_mode.dmDriverExtra = 0;
02635           EnumDisplaySettings(NULL,ENUM_CURRENT_SETTINGS,&amp;curr_mode);
02636           EnumDisplaySettings(NULL,ibest,&amp;mode);
02637           ChangeDisplaySettings(&amp;mode,0);
02638         }
02639         <span class="keywordflow">else</span> curr_mode.dmSize = 0;
02640       }
02641       <span class="keywordflow">else</span> curr_mode.dmSize = 0;
02642       <span class="keywordflow">if</span> (events) {
02643         mutex     = CreateMutex(NULL,FALSE,NULL);
02644         created   = CreateEvent(NULL,FALSE,FALSE,NULL);
02645         wait_disp = CreateEvent(NULL,FALSE,FALSE,NULL);
02646         thread    = CreateThread(NULL,0,thread_lowlevel,arg,0,&amp;ThreadID);
02647         WaitForSingleObject(created,INFINITE);
02648       } <span class="keywordflow">else</span> thread_lowlevel(arg);
02649     }
02650   
02651     <span class="keyword">static</span> LRESULT APIENTRY proc_lowlevel(HWND window,UINT msg,WPARAM wParam,LPARAM lParam) {
02652       CImgDisplay* disp = (CImgDisplay*)GetWindowLong(window,GWL_USERDATA);
02653       MSG st_msg;
02654 
02655       <span class="keywordflow">switch</span>(msg) {
02656       <span class="keywordflow">case</span> WM_CLOSE:
02657         disp-&gt;mouse_x=disp-&gt;mouse_y=-1;
02658         disp-&gt;key=disp-&gt;button=disp-&gt;window_x=disp-&gt;window_y=0;
02659         disp-&gt;closed=<span class="keyword">true</span>;
02660         ReleaseMutex(disp-&gt;mutex);
02661         ShowWindow(disp-&gt;window,SW_HIDE);
02662         <span class="keywordflow">return</span> 0;
02663       <span class="keywordflow">case</span> WM_SIZE: {
02664         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_SIZE,WM_SIZE,PM_REMOVE));
02665         WaitForSingleObject(disp-&gt;mutex,INFINITE);
02666         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nw = LOWORD(lParam),nh = HIWORD(lParam);
02667         <span class="keywordflow">if</span> (nw &amp;&amp; nh &amp;&amp; (nw!=disp-&gt;width || nh!=disp-&gt;height)) { 
02668           disp-&gt;window_width  = nw; 
02669           disp-&gt;window_height = nh;
02670           disp-&gt;mouse_x = disp-&gt;mouse_y = -1;
02671           disp-&gt;resized = <span class="keyword">true</span>;
02672         }
02673         ReleaseMutex(disp-&gt;mutex);
02674       } <span class="keywordflow">break</span>;
02675       <span class="keywordflow">case</span> WM_MOVE: {
02676         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_SIZE,WM_SIZE,PM_REMOVE));
02677         WaitForSingleObject(disp-&gt;mutex,INFINITE);
02678         <span class="keyword">const</span> <span class="keywordtype">int</span> nx = (int)(short)(LOWORD(lParam)), ny = (int)(short)(HIWORD(lParam));
02679         <span class="keywordflow">if</span> (nx!=disp-&gt;window_x || ny!=disp-&gt;window_y) {
02680           disp-&gt;window_x = nx;
02681           disp-&gt;window_y = ny;
02682           disp-&gt;moved = <span class="keyword">true</span>;
02683         }
02684         ReleaseMutex(disp-&gt;mutex);
02685       } <span class="keywordflow">break</span>;
02686       <span class="keywordflow">case</span> WM_PAINT:
02687         WaitForSingleObject(disp-&gt;mutex,INFINITE);
02688         SetDIBitsToDevice(disp-&gt;hdc,0,0,disp-&gt;width,disp-&gt;height,0,0,0,disp-&gt;height,disp-&gt;data,&amp;(disp-&gt;bmi),DIB_RGB_COLORS);
02689         ReleaseMutex(disp-&gt;mutex);
02690         <span class="keywordflow">break</span>;
02691       }
02692       <span class="keywordflow">if</span> (disp-&gt;events&gt;=2) <span class="keywordflow">switch</span>(msg) {
02693       <span class="keywordflow">case</span> WM_KEYDOWN:
02694         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_KEYDOWN,WM_KEYDOWN,PM_REMOVE)); 
02695         disp-&gt;key=(int)wParam;
02696         <span class="keywordflow">break</span>;
02697       <span class="keywordflow">case</span> WM_MOUSEMOVE: {
02698         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_MOUSEMOVE,WM_MOUSEMOVE,PM_REMOVE));
02699         disp-&gt;mouse_x = LOWORD(lParam);
02700         disp-&gt;mouse_y = HIWORD(lParam);
02701         <span class="keywordflow">if</span> (disp-&gt;mouse_x&lt;0 || disp-&gt;mouse_y&lt;0 ||       disp-&gt;mouse_x&gt;=disp-&gt;dimx() || disp-&gt;mouse_y&gt;=disp-&gt;dimy())
02702           disp-&gt;mouse_x=disp-&gt;mouse_y=-1;
02703       }
02704         <span class="keywordflow">break</span>;
02705       <span class="keywordflow">case</span> WM_LBUTTONDOWN: 
02706         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_LBUTTONDOWN,WM_LBUTTONDOWN,PM_REMOVE));
02707         disp-&gt;button |= 1; 
02708         <span class="keywordflow">break</span>;
02709       <span class="keywordflow">case</span> WM_RBUTTONDOWN: 
02710         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_RBUTTONDOWN,WM_RBUTTONDOWN,PM_REMOVE));
02711         disp-&gt;button |= 2; 
02712         <span class="keywordflow">break</span>;
02713       <span class="keywordflow">case</span> WM_MBUTTONDOWN: 
02714         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_MBUTTONDOWN,WM_MBUTTONDOWN,PM_REMOVE));
02715         disp-&gt;button |= 4; 
02716         <span class="keywordflow">break</span>;
02717       }
02718       <span class="keywordflow">if</span> (disp-&gt;events&gt;=3) <span class="keywordflow">switch</span>(msg) {
02719       <span class="keywordflow">case</span> WM_KEYUP:
02720         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_KEYUP,WM_KEYUP,PM_REMOVE));
02721         disp-&gt;key=0;
02722         <span class="keywordflow">break</span>;
02723       <span class="keywordflow">case</span> WM_LBUTTONUP:
02724         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_LBUTTONUP,WM_LBUTTONUP,PM_REMOVE));
02725         disp-&gt;button &amp;= ~1; 
02726         <span class="keywordflow">break</span>;
02727       <span class="keywordflow">case</span> WM_RBUTTONUP:
02728         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_RBUTTONUP,WM_RBUTTONUP,PM_REMOVE)); 
02729         disp-&gt;button &amp;= ~2;
02730         <span class="keywordflow">break</span>;
02731       <span class="keywordflow">case</span> WM_MBUTTONUP:
02732         <span class="keywordflow">while</span> (PeekMessage(&amp;st_msg,window,WM_MBUTTONUP,WM_MBUTTONUP,PM_REMOVE)); 
02733         disp-&gt;button &amp;= ~4;
02734         <span class="keywordflow">break</span>;
02735       }
02736       <span class="keywordflow">return</span> DefWindowProc(window,msg,wParam,lParam);
02737     }
02738   
02739     <span class="keyword">static</span> DWORD WINAPI thread_lowlevel(<span class="keywordtype">void</span>* arg) {
02740       CImgDisplay *disp  = (CImgDisplay*)(((<span class="keywordtype">void</span>**)arg)[0]);
02741       <span class="keyword">const</span> <span class="keywordtype">char</span> *title = (<span class="keyword">const</span> <span class="keywordtype">char</span>*)(((<span class="keywordtype">void</span>**)arg)[1]);
02742       MSG msg;
02743       <span class="keyword">delete</span>[] (<span class="keywordtype">void</span>**)arg;
02744       disp-&gt;bmi.bmiHeader.biSize=<span class="keyword">sizeof</span>(BITMAPINFOHEADER);
02745       disp-&gt;bmi.bmiHeader.biWidth=disp-&gt;width;
02746       disp-&gt;bmi.bmiHeader.biHeight=-(int)disp-&gt;height;
02747       disp-&gt;bmi.bmiHeader.biPlanes=1;
02748       disp-&gt;bmi.bmiHeader.biBitCount=32;
02749       disp-&gt;bmi.bmiHeader.biCompression=BI_RGB;
02750       disp-&gt;bmi.bmiHeader.biSizeImage=0;
02751       disp-&gt;bmi.bmiHeader.biXPelsPerMeter=1;
02752       disp-&gt;bmi.bmiHeader.biYPelsPerMeter=1;
02753       disp-&gt;bmi.bmiHeader.biClrUsed=0;
02754       disp-&gt;bmi.bmiHeader.biClrImportant=0;
02755       disp-&gt;data = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[disp-&gt;width*disp-&gt;height];
02756       <span class="keywordflow">if</span> (!disp-&gt;curr_mode.dmSize) { <span class="comment">// Normal window</span>
02757         RECT rect;
02758         rect.left=rect.top=0; rect.right=disp-&gt;width-1; rect.bottom=disp-&gt;height-1;
02759         AdjustWindowRect(&amp;rect,WS_CAPTION | WS_SYSMENU | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX,<span class="keyword">false</span>);
02760         <span class="keyword">const</span> <span class="keywordtype">int</span> border1 = (rect.right-rect.left+1-disp-&gt;width)/2, border2 = rect.bottom-rect.top+1-disp-&gt;height-border1;
02761         disp-&gt;window = CreateWindow(<span class="stringliteral">"MDICLIENT"</span>,title?title:<span class="stringliteral">""</span>,
02762                                     WS_OVERLAPPEDWINDOW | (disp-&gt;closed?0:WS_VISIBLE), CW_USEDEFAULT,CW_USEDEFAULT,
02763                                     disp-&gt;width + 2*border1, disp-&gt;height + border1 + border2,
02764                                     NULL,NULL,NULL,&amp;(disp-&gt;ccs));
02765         <span class="keywordflow">if</span> (!disp-&gt;closed) {
02766           GetWindowRect(disp-&gt;window,&amp;rect);    
02767           disp-&gt;window_x = rect.left + border1;
02768           disp-&gt;window_y = rect.top + border2;
02769         } <span class="keywordflow">else</span> disp-&gt;window_x = disp-&gt;window_y = 0;
02770       } <span class="keywordflow">else</span> { <span class="comment">// Fullscreen window</span>
02771         disp-&gt;window = CreateWindow(<span class="stringliteral">"MDICLIENT"</span>,title?title:<span class="stringliteral">""</span>,
02772                                     WS_POPUP | (disp-&gt;closed?0:WS_VISIBLE), CW_USEDEFAULT,CW_USEDEFAULT,
02773                                     disp-&gt;width,disp-&gt;height,NULL,NULL,NULL,&amp;(disp-&gt;ccs));
02774         disp-&gt;window_x = disp-&gt;window_y = 0;
02775       }
02776       SetForegroundWindow(disp-&gt;window);
02777       disp-&gt;hdc = GetDC(disp-&gt;window);
02778       disp-&gt;window_width = disp-&gt;width;
02779       disp-&gt;window_height = disp-&gt;height;
02780       disp-&gt;mouse_x = disp-&gt;mouse_y = -1;
02781       disp-&gt;button = disp-&gt;key = 0;
02782       disp-&gt;resized = disp-&gt;moved = <span class="keyword">false</span>;      
02783       <span class="keywordflow">if</span> (disp-&gt;events) {
02784         SetWindowLong(disp-&gt;window,GWL_USERDATA,(LONG)disp);
02785         SetWindowLong(disp-&gt;window,GWL_WNDPROC,(LONG)proc_lowlevel);
02786         SetEvent(disp-&gt;created);
02787         <span class="keywordflow">while</span>( GetMessage( &amp;msg, NULL, 0, 0 ) ) { DispatchMessage( &amp;msg ); SetEvent(disp-&gt;wait_disp); }
02788       }
02789       <span class="keywordflow">return</span> 0;
02790     }
02791 
02792     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; BITMAPINFO* render(<span class="keyword">const</span> CImg&lt;T&gt;&amp; img,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymax=~0) {
02793       cimg_test(img,<span class="stringliteral">"CImgDisplay::render"</span>);
02794       <span class="keywordflow">if</span> (img.depth!=1) <span class="keywordflow">return</span> render(img.get_3dplanes(img.width/2,img.height/2,img.depth/2),
02795                                       (<span class="keywordtype">unsigned</span> int)0,~(<span class="keywordtype">unsigned</span> int)0);
02796       <span class="keywordflow">if</span> (img.width!=width || img.height!=height) <span class="keywordflow">return</span> render(img.get_resize(width,height,1,-100,1),
02797                                                                 (<span class="keywordtype">unsigned</span> int)0,~(<span class="keywordtype">unsigned</span> int)0);
02798       <span class="keyword">const</span> <span class="keywordtype">bool</span> by=(ymin&lt;=ymax);
02799       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nymin = by?ymin:ymax, nymax = by?(ymax&gt;=height?height-1:ymax):(ymin&gt;=height?height-1:ymin);
02800       <span class="keyword">const</span> T 
02801         *data1 = img.ptr(0,nymin,0,0),
02802         *data2 = (img.dim&gt;=2)?img.ptr(0,nymin,0,1):data1,
02803         *data3 = (img.dim&gt;=3)?img.ptr(0,nymin,0,2):data1;
02804       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ximg = data + nymin*width;
02805       WaitForSingleObject(mutex,INFINITE);
02806       <span class="keywordflow">if</span> (!normalization) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xy = (nymax-nymin+1)*width; xy&gt;0; xy--)
02807         *(ximg++) = ((<span class="keywordtype">unsigned</span> char)*(data1++)&lt;&lt;16) | ((<span class="keywordtype">unsigned</span> char)*(data2++)&lt;&lt;8) | (<span class="keywordtype">unsigned</span> char)*(data3++);
02808       <span class="keywordflow">else</span> {
02809         <span class="keywordflow">if</span> (normalization==1) { CImgStats st(img,<span class="keyword">false</span>); <a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; <a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>=st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
02810         <span class="keyword">const</span> T nmin = (T)min, delta = (T)(<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>-nmin), mm = delta?delta:(T)1;
02811         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xy = (nymax-nymin+1)*width; xy&gt;0; xy--) {
02812           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
02813             R = (<span class="keywordtype">unsigned</span> char)(255*(*(data1++)-nmin)/mm),
02814             G = (<span class="keywordtype">unsigned</span> char)(255*(*(data2++)-nmin)/mm),
02815             B = (<span class="keywordtype">unsigned</span> char)(255*(*(data3++)-nmin)/mm);
02816           *(ximg++) = (R&lt;&lt;16) | (G&lt;&lt;8) | (B);
02817         }
02818       }
02819       ReleaseMutex(mutex);
02820       <span class="keywordflow">return</span> &amp;bmi;
02821     }
02822 
02823     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; CImgDisplay&amp; display(<span class="keyword">const</span> CImg&lt;T&gt;&amp; img,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pymax=~0) {
02824       cimg_test(img,<span class="stringliteral">"CImgDisplay::display"</span>);
02825       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
02826         ymin = pymin&lt;pymax?pymin:pymax,
02827         ymax = pymin&lt;pymax?(pymax&gt;=height?height-1:pymax):(pymin&gt;=height?height-1:pymin);
02828       render(img,ymin,ymax);
02829       <span class="keywordflow">if</span> (!closed) {
02830         WaitForSingleObject(mutex,INFINITE);
02831         SetDIBitsToDevice(hdc,0,ymin,width,ymax-ymin+1,0,0,0,ymax-ymin+1,data+ymin*width,&amp;bmi,DIB_RGB_COLORS);
02832         ReleaseMutex(mutex);
02833       }
02834       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02835     }
02836   
02837     CImgDisplay&amp; <a class="code" href="namespacecimg__library_1_1cimg.html#a77">wait</a>() {
02838       <span class="keywordflow">if</span> (!closed &amp;&amp; events) WaitForSingleObject(wait_disp,INFINITE);
02839       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02840     }
02841 
02842     CImgDisplay&amp; show() {
02843       <span class="keywordflow">if</span> (closed) {
02844         ShowWindow(window,SW_SHOW);     
02845         SetDIBitsToDevice(hdc,0,0,width,height,0,0,0,height,data,&amp;bmi,DIB_RGB_COLORS);
02846         RECT rect; 
02847         rect.left=rect.top=0; rect.right=width-1; rect.bottom=height-1;
02848         AdjustWindowRect(&amp;rect,WS_CAPTION | WS_SYSMENU | WS_THICKFRAME | WS_MINIMIZEBOX | WS_MAXIMIZEBOX,<span class="keyword">false</span>);
02849         <span class="keyword">const</span> <span class="keywordtype">int</span> border1 = (rect.right-rect.left+1-width)/2, border2 = rect.bottom-rect.top+1-height-border1;
02850         GetWindowRect(window,&amp;rect);
02851         window_x = rect.left + border1;
02852         window_y = rect.top + border2;
02853         closed = <span class="keyword">false</span>;
02854       }
02855       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02856     }
02857 
02858     CImgDisplay&amp; close() {
02859       <span class="keywordflow">if</span> (!closed) {
02860         ShowWindow(window,SW_HIDE);
02861         closed = <span class="keyword">true</span>;
02862         window_x = window_y = 0;
02863       }
02864       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
02865     }
02866 
02867     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> screen_dimx() { 
02868       DEVMODE mode;
02869       mode.dmSize = <span class="keyword">sizeof</span>(DEVMODE); mode.dmDriverExtra = 0;
02870       EnumDisplaySettings(NULL,ENUM_CURRENT_SETTINGS,&amp;mode);
02871       <span class="keywordflow">return</span> mode.dmPelsWidth;      
02872     }
02873 
02874     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> screen_dimy() {
02875       DEVMODE mode;
02876       mode.dmSize = <span class="keyword">sizeof</span>(DEVMODE); mode.dmDriverExtra = 0;
02877       EnumDisplaySettings(NULL,ENUM_CURRENT_SETTINGS,&amp;mode);
02878       <span class="keywordflow">return</span> mode.dmPelsHeight;      
02879     }
02880 
02881 <span class="preprocessor">#endif</span>
02882 <span class="preprocessor"></span>
02883 <span class="preprocessor">#ifdef cimgdisplay_plugin</span>
02884 <span class="preprocessor"></span><span class="preprocessor">#include cimgdisplay_plugin</span>
02885 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02886 <span class="preprocessor"></span>    
02887   };
02888 
02889   <span class="comment">/*-------------------------------------------------------</span>
02890 <span class="comment"></span>
02891 <span class="comment"></span>
02892 <span class="comment"></span>
02893 <span class="comment">  </span>
02894 <span class="comment">    Definition of the CImg&lt;T&gt; structure</span>
02895 <span class="comment">        </span>
02896 <span class="comment">        </span>
02897 <span class="comment">        </span>
02898 <span class="comment">        </span>
02899 <span class="comment">  ------------------------------------------------------*/</span>
02900 
02902 
<a name="l02973"></a><a class="code" href="structcimg__library_1_1CImg.html">02973</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImg.html">CImg</a> {
02974     
02976 
<a name="l02984"></a><a class="code" href="structcimg__library_1_1CImg.html#o0">02984</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width;       
02985     
02987 
<a name="l02995"></a><a class="code" href="structcimg__library_1_1CImg.html#o1">02995</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> height;
02996     
02998 
<a name="l03006"></a><a class="code" href="structcimg__library_1_1CImg.html#o2">03006</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth;
03007     
03009 
<a name="l03017"></a><a class="code" href="structcimg__library_1_1CImg.html#o3">03017</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim;
03018     
03020 
<a name="l03028"></a><a class="code" href="structcimg__library_1_1CImg.html#o4">03028</a>     T *data;
03029 
03030     <span class="comment">//------------------------------------------</span>
03031     <span class="comment">//------------------------------------------</span>
03032     <span class="comment">//</span>
03034 <span class="comment"></span>
03035     <span class="comment">//------------------------------------------</span>
03036     <span class="comment">//------------------------------------------</span>
03037   
03039 
<a name="l03049"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_0">03049</a>     <span class="keyword">explicit</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dy=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dz=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dv=1):
03050       width(dx),height(dy),depth(dz),dim(dv) {
03051       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> siz = size();
03052       <span class="keywordflow">if</span> (siz) data = <span class="keyword">new</span> T[siz]; <span class="keywordflow">else</span> { data=NULL; width=height=depth=dim=0; }
03053     }
03054 
03057 
<a name="l03064"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_1">03064</a>     <span class="keyword">explicit</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dy,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dz,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dv,<span class="keyword">const</span> T&amp; val):
03065       width(dx),height(dy),depth(dz),dim(dv) {
03066       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> siz = size();
03067       <span class="keywordflow">if</span> (siz) { data = <span class="keyword">new</span> T[siz]; fill(val); } <span class="keywordflow">else</span> { data=NULL; width=height=depth=dim=0; }
03068     }
03069 
03071 
<a name="l03076"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_2">03076</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img):width(img.width),height(img.height),depth(img.depth),dim(img.dim) {
03077       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> siz = size();
03078       <span class="keywordflow">if</span> (siz) {
03079         data = <span class="keyword">new</span> T[siz];
03080         <span class="keyword">const</span> t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> + siz;
03081         cimg_map(*<span class="keyword">this</span>,ptrd,T) (*ptrd)=(T)*(--ptrs);
03082       } <span class="keywordflow">else</span> data = NULL;
03083     }
03084 
03085     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img):width(img.width),height(img.height),depth(img.depth),dim(img.dim) {
03086       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> siz = size();
03087       <span class="keywordflow">if</span> (siz) {
03088         data = <span class="keyword">new</span> T[width*height*depth*dim];
03089         std::memcpy(data,img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,siz*<span class="keyword">sizeof</span>(T));
03090       } <span class="keywordflow">else</span> data = NULL;
03091     }
03092 
03093 
03095 
<a name="l03110"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_4">03110</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">bool</span> pixel_copy):width(0),height(0),depth(0),dim(0),data(NULL) {
03111       <span class="keywordflow">if</span> (pixel_copy) <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>);
03112       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>);
03113     }
03114 
03116 
<a name="l03122"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_5">03122</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> filename):width(0),height(0),depth(0),dim(0),data(NULL) { load(filename).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
03123 
03125 
<a name="l03135"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_6">03135</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> t *<span class="keyword">const</span> data_buffer,
03136                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dy=1,
03137                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dz=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dv=1,
03138                               <span class="keyword">const</span> <span class="keywordtype">bool</span> multiplexed=<span class="keyword">false</span>):width(dx),height(dy),depth(dz),dim(dv) {
03139       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> siz = size();
03140       <span class="keywordflow">if</span> (data_buffer &amp;&amp; siz) {
03141         data = <span class="keyword">new</span> T[siz];
03142         <span class="keywordflow">if</span> (multiplexed) {
03143           <span class="keyword">const</span> t *ptrs = data_buffer;
03144           T *ptrd = data;
03145           cimg_mapV(*<span class="keyword">this</span>,k) { cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) { *(ptrd++) = (T)(*(ptrs)); ptrs+=dim; } ptrs-=siz-1; }
03146         } <span class="keywordflow">else</span> { <span class="keyword">const</span> t *ptrs = data_buffer+siz; cimg_map(*<span class="keyword">this</span>,ptrd,T) *ptrd = (T)(*(--ptrs)); }
03147       } <span class="keywordflow">else</span> { width=height=depth=dim=0; data = NULL; }
03148     }
03149     <span class="comment">// Add template overloading if VC&gt;7.1 (optimized version)</span>
03150 <span class="preprocessor">#if !defined(_MSC_VER) &amp;&amp; _MSC_VER&gt;1300</span>
03151 <span class="preprocessor"></span>    <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>(<span class="keyword">const</span> T *<span class="keyword">const</span> data_buffer,
03152          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dy=1,
03153          <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dz=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dv=1,
03154          <span class="keyword">const</span> <span class="keywordtype">bool</span> multiplexed=<span class="keyword">false</span>):width(dx),height(dy),depth(dz),dim(dv) {
03155       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> siz = size();
03156       <span class="keywordflow">if</span> (data_buffer &amp;&amp; siz) {
03157         data = <span class="keyword">new</span> T[siz];
03158         <span class="keywordflow">if</span> (multiplexed) {
03159           <span class="keyword">const</span> T *ptrs = data_buffer;
03160           T *ptrd = data;
03161           cimg_mapV(*<span class="keyword">this</span>,k) { cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) { *(ptrd++) = (T)(*(ptrs)); ptrs+=dim; } ptrs-=siz-1; }
03162         } <span class="keywordflow">else</span> std::memcpy(data,data_buffer,siz*<span class="keyword">sizeof</span>(T));
03163       } <span class="keywordflow">else</span> { width=height=depth=dim=0; data = NULL; }
03164     }
03165 <span class="preprocessor">#endif</span>
03166 <span class="preprocessor"></span>    
03168 
<a name="l03171"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_7">03171</a>     ~<a class="code" href="structcimg__library_1_1CImg.html">CImg</a>() { <span class="keywordflow">if</span> (data) <span class="keyword">delete</span>[] data; }
03172     
03174 
<a name="l03180"></a><a class="code" href="structcimg__library_1_1CImg.html#z1_8">03180</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; empty() { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>().<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
03181 
03183     <span class="comment">//-----------------------------------------------------</span>
03184     <span class="comment">//-----------------------------------------------------</span>
03185     <span class="comment">//</span>
03187 <span class="comment"></span>
03188     <span class="comment">//-----------------------------------------------------</span>
03189     <span class="comment">//-----------------------------------------------------</span>
03190   
03192 
<a name="l03198"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_25">03198</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* pixel_type() { T val; <span class="keywordflow">return</span> cimg::get_type(val); }
03199 
03201 
<a name="l03205"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_0">03205</a>     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> width*height*depth*dim; }  
03206 
03208 
<a name="l03215"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_1">03215</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> dimx()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)width; }  
03216 
03218 
<a name="l03225"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_2">03225</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> dimy()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)height; }
03226   
03228 
<a name="l03234"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_3">03234</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> dimz()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)depth; }
03235   
03237 
<a name="l03243"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_4">03243</a>     <span class="keyword">const</span> <span class="keywordtype">int</span> dimv()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)dim; }
03244   
03246     <span class="comment">// with respect to the pixel data pointer \ref data.</span>
<a name="l03255"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_5">03255</a> <span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">long</span> offset(<span class="keyword">const</span> <span class="keywordtype">int</span> x=0, <span class="keyword">const</span> <span class="keywordtype">int</span> y=0, <span class="keyword">const</span> <span class="keywordtype">int</span> z=0, <span class="keyword">const</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{ 
03256       <span class="keywordflow">return</span> x+width*(y+height*(z+depth*v)); }
03257   
03259 
<a name="l03268"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_6">03268</a>     T* ptr(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03269       <span class="keyword">const</span> <span class="keywordtype">long</span> off = offset(x,y,z,v);
03270 <span class="preprocessor">#if cimg_debug&gt;1</span>
03271 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (off&lt;0 || off&gt;=size()) {
03272         cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImg&lt;%s&gt;::ptr() : Trying to get a pointer at (%u,%u,%u,%u) (offset=%d) which is"</span>
03273                    <span class="stringliteral">"outside the data of the image (%u,%u,%u,%u) (size=%u)"</span>,
03274                    pixel_type(),x,y,z,v,off,width,height,depth,dim,size());
03275         <span class="keywordflow">return</span> data;
03276       }
03277 <span class="preprocessor">#endif</span>
03278 <span class="preprocessor"></span>      <span class="keywordflow">return</span> data+off;
03279     }
03280 
03282 
<a name="l03289"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_7">03289</a>     T&amp; operator()(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03290       <span class="keyword">const</span> <span class="keywordtype">int</span> off = offset(x,y,z,v);
03291 <span class="preprocessor">#if cimg_debug&gt;1</span>
03292 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!data || off&gt;=(int)size()) {
03293         cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImg&lt;%s&gt;::operator() : Pixel access requested at (%u,%u,%u,%u) (offset=%d) "</span>
03294                    <span class="stringliteral">"outside the image range (%u,%u,%u,%u) (size=%u)"</span>,
03295                    pixel_type(),x,y,z,v,off,width,height,depth,dim,size());                     
03296         <span class="keywordflow">return</span> *data;
03297       }
03298 <span class="preprocessor">#endif</span>
03299 <span class="preprocessor"></span>      <span class="keywordflow">return</span> data[off];
03300     }
03301     
03303 
<a name="l03307"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_8">03307</a>     T&amp; operator[](<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> off)<span class="keyword"> const </span>{
03308 <span class="preprocessor">#if cimg_debug&gt;1</span>
03309 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!data || off&gt;=size()) {
03310         cimg::warn(<span class="keyword">true</span>,
03311                    <span class="stringliteral">"CImg&lt;%s&gt;::operator[] : Trying to get a pixel at offset=%d, outside the range of the image (%u,%u,%u,%u) (size=%u)"</span>,
03312                    pixel_type(),off,width,height,depth,dim,size());                     
03313         <span class="keywordflow">return</span> *data;
03314       }
03315 <span class="preprocessor">#endif</span>
03316 <span class="preprocessor"></span>      <span class="keywordflow">return</span> data[off];
03317     }
03318 
03320 
<a name="l03327"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_9">03327</a>     T dirichlet_pix4d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0,<span class="keyword">const</span> T out_val=(T)0)<span class="keyword"> const </span>{
03328       <span class="keywordflow">return</span> (x&lt;0 || y&lt;0 || z&lt;0 || v&lt;0 || x&gt;=dimx() || y&gt;=dimy() || z&gt;=dimz() || v&gt;=dimv())?out_val:(*this)(x,y,z,v);
03329     }
03330 
03332 
<a name="l03339"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_10">03339</a>     T dirichlet_pix3d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0,<span class="keyword">const</span> T out_val=(T)0)<span class="keyword"> const </span>{
03340       <span class="keywordflow">return</span> (x&lt;0 || y&lt;0 || z&lt;0 || x&gt;=dimx() || y&gt;=dimy() || z&gt;=dimz())?out_val:(*this)(x,y,z,v);
03341     }
03343 
<a name="l03350"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_11">03350</a>     T dirichlet_pix2d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0,<span class="keyword">const</span> T out_val=(T)0)<span class="keyword"> const </span>{
03351       <span class="keywordflow">return</span> (x&lt;0 || y&lt;0 || x&gt;=dimx() || y&gt;=dimy())?out_val:(*this)(x,y,z,v);
03352     }
03353 
03355 
<a name="l03362"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_12">03362</a>     T dirichlet_pix1d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0,<span class="keyword">const</span> T out_val=(T)0)<span class="keyword"> const </span>{
03363       <span class="keywordflow">return</span> (x&lt;0 || x&gt;=dimx())?out_val:(*this)(x,y,z,v);
03364     }
03365 
03367 
<a name="l03373"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_13">03373</a>     <span class="keyword">const</span> T&amp; neumann_pix4d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03374       <span class="keywordflow">return</span> (*this)(x&lt;0?0:(x&gt;=dimx()?dimx()-1:x),
03375                      y&lt;0?0:(y&gt;=dimy()?dimy()-1:y),
03376                      z&lt;0?0:(z&gt;=dimz()?dimz()-1:z),
03377                      v&lt;0?0:(v&gt;=dimv()?dimv()-1:v));
03378     }
03380 
<a name="l03386"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_14">03386</a>     <span class="keyword">const</span> T&amp; neumann_pix3d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03387       <span class="keywordflow">return</span> (*this)(x&lt;0?0:(x&gt;=dimx()?dimx()-1:x),
03388                      y&lt;0?0:(y&gt;=dimy()?dimy()-1:y),
03389                      z&lt;0?0:(z&gt;=dimz()?dimz()-1:z),v);
03390     }
03391 
03393 
<a name="l03399"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_15">03399</a>     <span class="keyword">const</span> T&amp; neumann_pix2d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03400       <span class="keywordflow">return</span> (*this)(x&lt;0?0:(x&gt;=dimx()?dimx()-1:x),
03401                      y&lt;0?0:(y&gt;=dimy()?dimy()-1:y),z,v);
03402     }
03404 
<a name="l03410"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_16">03410</a>     <span class="keyword">const</span> T&amp; neumann_pix1d(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03411       <span class="keywordflow">return</span> (*this)(x&lt;0?0:(x&gt;=dimx()?dimx()-1:x),y,z,v);
03412     }
03413     
03415 
<a name="l03421"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_17">03421</a>     <span class="keywordtype">double</span> linear_pix4d(<span class="keyword">const</span> <span class="keywordtype">float</span> ffx,<span class="keyword">const</span> <span class="keywordtype">float</span> ffy=0,<span class="keyword">const</span> <span class="keywordtype">float</span> ffz=0,<span class="keyword">const</span> <span class="keywordtype">float</span> ffv=0)<span class="keyword"> const </span>{
03422       <span class="keywordtype">double</span> valx0,valx1,valy0,valy1,valz0,valz1;
03423       <span class="keyword">const</span> <span class="keywordtype">float</span> fx = ffx&lt;0?0:(ffx&gt;width-1?width-1:ffx), fy = ffy&lt;0?0:(ffy&gt;height-1?height-1:ffy),
03424         fz = ffz&lt;0?0:(ffz&gt;depth-1?depth-1:ffz), fv = ffv&lt;0?0:(ffv&gt;dim-1?dim-1:ffv);
03425       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = (<span class="keywordtype">unsigned</span> int)fx, y = (<span class="keywordtype">unsigned</span> int)fy,  z = (<span class="keywordtype">unsigned</span> int)fz, v = (<span class="keywordtype">unsigned</span> int)fv;
03426       <span class="keyword">const</span> <span class="keywordtype">float</span> dx = fx-x, dy = fy-y, dz = fz-z, dv = fv-v;
03427       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nx = dx&gt;0?x+1:x, ny = dy&gt;0?y+1:y,  nz = dz&gt;0?z+1:z, nv = dv&gt;0?v+1:v;
03428       valx0 = (1-dx)*(*this)(x,y,z,v)  + (dx)*(*this)(nx,y,z,v);
03429       valx1 = (1-dx)*(*this)(x,ny,z,v) + (dx)*(*this)(nx,ny,z,v);
03430       valy0 = (1-dy)*valx0 + (dy)*valx1;
03431       valx0 = (1-dx)*(*this)(x,y,nz,v)  + (dx)*(*this)(nx,y,nz,v);
03432       valx1 = (1-dx)*(*this)(x,ny,nz,v) + (dx)*(*this)(nx,ny,nz,v);
03433       valy1 = (1-dy)*valx0 + (dy)*valx1;
03434       valz0 = (1-dz)*valy0 + (dz)*valy1;
03435       valx0 = (1-dx)*(*this)(x,y,z,nv)  + (dx)*(*this)(nx,y,z,nv);
03436       valx1 = (1-dx)*(*this)(x,ny,z,nv) + (dx)*(*this)(nx,ny,z,nv);
03437       valy0 = (1-dy)*valx0 + (dy)*valx1;
03438       valx0 = (1-dx)*(*this)(x,y,nz,nv)  + (dx)*(*this)(nx,y,nz,nv);
03439       valx1 = (1-dx)*(*this)(x,ny,nz,nv) + (dx)*(*this)(nx,ny,nz,nv);
03440       valy1 = (1-dy)*valx0 + (dy)*valx1;
03441       valz1 = (1-dz)*valy0 + (dz)*valy1;
03442       <span class="keywordflow">return</span> (1-dv)*valz0 + (dv)*valz1;
03443     }
03444 
03446 
<a name="l03452"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_18">03452</a>     <span class="keywordtype">double</span> linear_pix3d(<span class="keyword">const</span> <span class="keywordtype">float</span> ffx,<span class="keyword">const</span> <span class="keywordtype">float</span> ffy=0,<span class="keyword">const</span> <span class="keywordtype">float</span> ffz=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03453       <span class="keywordtype">double</span> valx0,valx1,valy0,valy1;
03454       <span class="keyword">const</span> <span class="keywordtype">float</span> fx = ffx&lt;0?0:(ffx&gt;width-1?width-1:ffx), fy = ffy&lt;0?0:(ffy&gt;height-1?height-1:ffy), fz = ffz&lt;0?0:(ffz&gt;depth-1?depth-1:ffz);
03455       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = (<span class="keywordtype">unsigned</span> int)fx, y = (<span class="keywordtype">unsigned</span> int)fy, z = (<span class="keywordtype">unsigned</span> int)fz;
03456       <span class="keyword">const</span> <span class="keywordtype">float</span> dx = fx-x, dy = fy-y, dz = fz-z;
03457       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nx = dx&gt;0?x+1:x, ny = dy&gt;0?y+1:y, nz = dz&gt;0?z+1:z;
03458       valx0 = (1-dx)*(*this)(x,y,z,v)  + (dx)*(*this)(nx,y,z,v);
03459       valx1 = (1-dx)*(*this)(x,ny,z,v) + (dx)*(*this)(nx,ny,z,v);
03460       valy0 = (1-dy)*valx0 + (dy)*valx1;
03461       valx0 = (1-dx)*(*this)(x,y,nz,v)  + (dx)*(*this)(nx,y,nz,v);
03462       valx1 = (1-dx)*(*this)(x,ny,nz,v) + (dx)*(*this)(nx,ny,nz,v);
03463       valy1 = (1-dy)*valx0 + (dy)*valx1;
03464       <span class="keywordflow">return</span> (1-dz)*valy0 + (dz)*valy1;
03465     }
03466 
03468 
<a name="l03474"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_19">03474</a>     <span class="keywordtype">double</span> linear_pix2d(<span class="keyword">const</span> <span class="keywordtype">float</span> ffx,<span class="keyword">const</span> <span class="keywordtype">float</span> ffy=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03475       <span class="keywordtype">double</span> valx0,valx1;
03476       <span class="keyword">const</span> <span class="keywordtype">float</span> fx = ffx&lt;0?0:(ffx&gt;width-1?width-1:ffx), fy = ffy&lt;0?0:(ffy&gt;height-1?height-1:ffy);
03477       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = (<span class="keywordtype">unsigned</span> int)fx, y = (<span class="keywordtype">unsigned</span> int)fy;
03478       <span class="keyword">const</span> <span class="keywordtype">float</span> dx = fx-x, dy = fy-y;
03479       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nx = dx&gt;0?x+1:x, ny = dy&gt;0?y+1:y;
03480       valx0 = (1-dx)*(*this)(x,y,z,v)  + (dx)*(*this)(nx,y,z,v);
03481       valx1 = (1-dx)*(*this)(x,ny,z,v) + (dx)*(*this)(nx,ny,z,v);
03482       <span class="keywordflow">return</span> (1-dy)*valx0 + (dy)*valx1;
03483     }
03484 
03486 
<a name="l03492"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_20">03492</a>     <span class="keywordtype">double</span> linear_pix1d(<span class="keyword">const</span> <span class="keywordtype">float</span> ffx,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03493       <span class="keyword">const</span> <span class="keywordtype">float</span> fx = ffx&lt;0?0:(ffx&gt;width-1?width-1:ffx);
03494       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = (<span class="keywordtype">unsigned</span> int)fx;
03495       <span class="keyword">const</span> <span class="keywordtype">float</span> dx = fx-x;
03496       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nx = dx&gt;0?x+1:x;
03497       <span class="keywordflow">return</span> (1-dx)*(*this)(x,y,z,v)  + (dx)*(*this)(nx,y,z,v);
03498     }
03499 
03501 
<a name="l03507"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_21">03507</a>     <span class="keywordtype">double</span> cubic_pix2d(<span class="keyword">const</span> <span class="keywordtype">float</span> pfx,<span class="keyword">const</span> <span class="keywordtype">float</span> pfy=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03508       <span class="keyword">const</span> <span class="keywordtype">float</span> fx = pfx&lt;0?0:(pfx&gt;width-1?width-1:pfx), fy = pfy&lt;0?0:(pfy&gt;height-1?height-1:pfy);
03509       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
03510         x = (<span class="keywordtype">unsigned</span> int)fx,  px = (int)x-1&gt;=0?x-1:0, nx = x+1&lt;width?x+1:width-1, ax = nx+1&lt;width?nx+1:width-1,
03511         y = (<span class="keywordtype">unsigned</span> int)fy,  py = (int)y-1&gt;=0?y-1:0, ny = y+1&lt;height?y+1:height-1, ay = ny+1&lt;height?ny+1:height-1;
03512       <span class="keyword">const</span> <span class="keywordtype">float</span> dx = fx-x, dy = fy-y;
03513       <span class="keyword">const</span> T&amp; 
03514         a = (*this)(px,py,z,v), b = (*this)(x,py,z,v), c = (*this)(nx,py,z,v), d = (*this)(ax,py,z,v),
03515         e = (*this)(px, y,z,v), f = (*this)(x, y,z,v), g = (*this)(nx, y,z,v), h = (*this)(ax, y,z,v),
03516         i = (*this)(px,ny,z,v), j = (*this)(x,ny,z,v), k = (*this)(nx,ny,z,v), l = (*this)(ax,ny,z,v),
03517         m = (*this)(px,ay,z,v), n = (*this)(x,ay,z,v), o = (*this)(nx,ay,z,v), p = (*this)(ax,ay,z,v);
03518       <span class="keyword">const</span> <span class="keywordtype">double</span> 
03519         A = dx*dx*dx*(2*(b-c)+0.5*(c-a+d-b)) + dx*dx*(2*c-2.5*b+a-0.5*d) + dx*0.5*(c-a) + b,
03520         B = dx*dx*dx*(2*(f-g)+0.5*(g-e+h-f)) + dx*dx*(2*g-2.5*f+e-0.5*h) + dx*0.5*(g-e) + f,
03521         C = dx*dx*dx*(2*(j-k)+0.5*(k-i+l-j)) + dx*dx*(2*k-2.5*j+i-0.5*l) + dx*0.5*(k-i) + j,
03522         D = dx*dx*dx*(2*(n-o)+0.5*(o-m+p-n)) + dx*dx*(2*o-2.5*n+m-0.5*p) + dx*0.5*(o-m) + n;
03523       <span class="keywordflow">return</span> dy*dy*dy*(2*(B-C)+0.5*(C-A+D-B)) + dy*dy*(2*C-2.5*B+A-0.5*D) + dy*0.5*(C-A) + B;
03524     }
03525 
03527 
<a name="l03533"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_22">03533</a>     <span class="keywordtype">double</span> cubic_pix1d(<span class="keyword">const</span> <span class="keywordtype">float</span> pfx,<span class="keyword">const</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z=0,<span class="keywordtype">int</span> v=0)<span class="keyword"> const </span>{
03534       <span class="keyword">const</span> <span class="keywordtype">float</span> fx = pfx&lt;0?0:(pfx&gt;width-1?width-1:pfx);
03535       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = (<span class="keywordtype">unsigned</span> int)fx, px = (int)x-1&gt;=0?x-1:0, nx = x+1&lt;width?x+1:width-1, ax = nx+1&lt;width?nx+1:width-1;
03536       <span class="keyword">const</span> <span class="keywordtype">float</span> dx = fx-x;
03537       <span class="keyword">const</span> T&amp; a = (*this)(px,y,z,v), b = (*this)(x,y,z,v), c = (*this)(nx,y,z,v), d = (*this)(ax,y,z,v);
03538       <span class="keywordflow">return</span> dx*dx*dx*(2*(b-c)+0.5*(c-a+d-b)) + dx*dx*(2*c-2.5*b+a-0.5*d) + dx*0.5*(c-a) + b;
03539     }
03540     
03542 
<a name="l03548"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_23">03548</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; print(<span class="keyword">const</span> <span class="keywordtype">char</span> *title=NULL,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> print_flag=1)<span class="keyword"> const </span>{
03549       std::fprintf(stderr,<span class="stringliteral">"%-8s(this=%p): { size=(%u,%u,%u,%u), data=(%s*)%p"</span>,
03550                    title?title:<span class="stringliteral">"CImg"</span>,(<span class="keywordtype">void</span>*)<span class="keyword">this</span>,
03551                    width,height,depth,dim,pixel_type(),(<span class="keywordtype">void</span>*)data);
03552       <span class="keywordflow">if</span> (size()==0 || !data) { std::fprintf(stderr,<span class="stringliteral">", [Undefined pixel data] }\n"</span>); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03553       <span class="keywordflow">if</span> (print_flag&gt;=1) { 
03554         <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(*<span class="keyword">this</span>);
03555         std::fprintf(stderr,<span class="stringliteral">", min=%g, mean=%g [var=%g], max=%g, pmin=(%d,%d,%d,%d), pmax=(%d,%d,%d,%d)"</span>,
03556                      st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o2">mean</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o3">variance</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o4">xmin</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o5">ymin</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o6">zmin</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o7">vmin</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o9">xmax</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o10">ymax</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o11">zmax</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o12">vmax</a>); 
03557       }     
03558       <span class="keywordflow">if</span> (print_flag&gt;=2 || size()&lt;=16) {
03559         std::fprintf(stderr,<span class="stringliteral">" }\n%s = [ "</span>,title?title:<span class="stringliteral">"data"</span>);
03560         cimg_mapXYZV(*<span class="keyword">this</span>,x,y,z,k) 
03561           std::fprintf(stderr,<span class="stringliteral">"%g%s"</span>,(<span class="keywordtype">double</span>)(*<span class="keyword">this</span>)(x,y,z,k),
03562                        ((x+1)*(y+1)*(z+1)*(k+1)==(<span class="keywordtype">int</span>)size()?<span class="stringliteral">" ]\n"</span>:(((x+1)%width==0)?<span class="stringliteral">" ; "</span>:<span class="stringliteral">" "</span>)));
03563       } <span class="keywordflow">else</span> std::fprintf(stderr,<span class="stringliteral">" }\n"</span>);
03564       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03565     }
03566 
03568 
<a name="l03573"></a><a class="code" href="structcimg__library_1_1CImg.html#z3_24">03573</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; print(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> print_flag)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> print(NULL,print_flag); }
03574   
03576     <span class="comment">//--------------------------------------------------</span>
03577     <span class="comment">//--------------------------------------------------</span>
03578     <span class="comment">//</span>
03580 <span class="comment"></span>
03581     <span class="comment">//--------------------------------------------------</span>
03582     <span class="comment">//--------------------------------------------------</span>
03583   
03585 
<a name="l03589"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_0">03589</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) { 
03590       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sizes = img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>(), sized = size();
03591       <span class="keywordflow">if</span> (sizes!=sized) <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); 
03592       <span class="keyword">const</span> t* ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> + sized;
03593       <span class="keywordflow">for</span> (T *ptrd = data+sized; ptrd&gt;data; ) *(--ptrd) = (T)*(--ptrs);
03594       width = img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; height = img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; depth = img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>; dim = img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>;
03595       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03596     }
03597     
03598     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
03599       <span class="keywordflow">if</span> (&amp;img==<span class="keyword">this</span>) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03600       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sizes = img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>(), sized = size();
03601       <span class="keywordflow">if</span> (sizes!=sized) <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); 
03602       std::memcpy(data,img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(T)*sized);
03603       width = img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; height = img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; depth = img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>; dim = img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>;
03604       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03605     }
03606       
03608 
<a name="l03611"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_2">03611</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator=(<span class="keyword">const</span> T&amp; val) { <span class="keywordflow">return</span> fill(val); }
03612 
03614 
<a name="l03617"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_3">03617</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator=(<span class="keyword">const</span> T *buf) {
03618       <span class="keywordflow">if</span> (buf) std::memcpy(data,buf,size()*<span class="keyword">sizeof</span>(T));
03619       <span class="keywordflow">else</span> <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;T&gt;::operator=() : Given array pointer 'ptr' is NULL"</span>);
03620       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
03621     }
03622        
03624 
<a name="l03627"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_4">03627</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator+=(<span class="keyword">const</span> T&amp; val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)+=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03628 
<a name="l03630"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_5">03630</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator++() { <span class="keywordflow">return</span> (*this)+=1; }
03631 
03633 
<a name="l03636"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_6">03636</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator-=(<span class="keyword">const</span> T&amp; val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)-=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03637 
<a name="l03639"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_7">03639</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator--() { <span class="keywordflow">return</span> (*this)-=1; }
03640 
03642 
<a name="l03645"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_8">03645</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator%=(<span class="keyword">const</span> T&amp; val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)%=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03646 
03648 
<a name="l03651"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_9">03651</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator&amp;=(<span class="keyword">const</span> T&amp; val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)&amp;=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03652 
<a name="l03654"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_10">03654</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator|=(<span class="keyword">const</span> T&amp; val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)|=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03655 
<a name="l03657"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_11">03657</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator^=(<span class="keyword">const</span> T&amp; val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)^=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03658 
<a name="l03660"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_12">03660</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator+(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)+=val; }
03661 
<a name="l03663"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_13">03663</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator-(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)-=val; }
03664 
<a name="l03666"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_14">03666</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator%(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)%=val; }  
03667 
<a name="l03669"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_15">03669</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator&amp;(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)&amp;=val; }
03670 
<a name="l03672"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_16">03672</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator|(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)|=val; }
03673 
<a name="l03675"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_17">03675</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator^(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)^=val; }
03676 
<a name="l03678"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_18">03678</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator!()<span class="keyword"> const </span>{
03679       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> res(*<span class="keyword">this</span>,<span class="keyword">false</span>);
03680       <span class="keyword">const</span> T *ptrs = ptr() + size();
03681       cimg_map(res,ptrd,T) *ptrd=!(*(--ptrs));
03682       <span class="keywordflow">return</span> res;
03683     }
03684 
<a name="l03686"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_19">03686</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator~()<span class="keyword"> const </span>{
03687       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> res(*<span class="keyword">this</span>,<span class="keyword">false</span>);
03688       <span class="keyword">const</span> T *ptrs = ptr() + size();
03689       cimg_map(res,ptrd,T) *ptrd=~(*(--ptrs));
03690       <span class="keywordflow">return</span> res;
03691     }
03692     
<a name="l03694"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_20">03694</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator+=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) {
03695       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smin = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03696       t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+smin;
03697       <span class="keywordflow">for</span> (T *ptrd = data+smin; ptrd&gt;data; --ptrd, (*ptrd)=(T)((*ptrd)+(*(--ptrs))));
03698       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03699     }
<a name="l03701"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_21">03701</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator-=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) {
03702       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smin = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03703       t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+smin;
03704       <span class="keywordflow">for</span> (T *ptrd = data+smin; ptrd&gt;data; --ptrd, (*ptrd)=(T)((*ptrd)-(*(--ptrs))));
03705       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03706     }
<a name="l03708"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_22">03708</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator%=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
03709       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smin = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03710       <span class="keywordflow">for</span> (T *ptrs=img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+smin, *ptrd=data+smin; ptrd&gt;data; *(--ptrd)%=*(--ptrs));
03711       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03712     }
<a name="l03714"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_23">03714</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator&amp;=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
03715       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smin = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03716       <span class="keywordflow">for</span> (T *ptrs=img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+smin, *ptrd=data+smin; ptrd&gt;data; *(--ptrd)&amp;=*(--ptrs));
03717       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03718     }
<a name="l03720"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_24">03720</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator|=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
03721       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smin = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03722       <span class="keywordflow">for</span> (T *ptrs=img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+smin, *ptrd=data+smin; ptrd&gt;data; *(--ptrd)|=*(--ptrs));
03723       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03724     }
<a name="l03726"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_25">03726</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator^=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
03727       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> smin = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03728       <span class="keywordflow">for</span> (T *ptrs=img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+smin, *ptrd=data+smin; ptrd&gt;data; *(--ptrd)^=*(--ptrs));
03729       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03730     }
03731 
<a name="l03733"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_26">03733</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator+(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword">  const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)+=img; }
03734 
<a name="l03736"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_27">03736</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator-(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword">  const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)-=img; }
03737 
<a name="l03739"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_28">03739</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator%(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)%=img; }
03740 
<a name="l03742"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_29">03742</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator&amp;(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)&amp;=img; } 
03743 
<a name="l03745"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_30">03745</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator|(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)|=img; }
03746 
<a name="l03748"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_31">03748</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator^(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)^=img; }  
03749 
<a name="l03751"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_32">03751</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator*=(<span class="keyword">const</span> <span class="keywordtype">double</span> val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)((*ptr)*val); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03752 
<a name="l03754"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_33">03754</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator/=(<span class="keyword">const</span> <span class="keywordtype">double</span> val) { cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)((*ptr)/val); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03755 
<a name="l03757"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_34">03757</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator*(<span class="keyword">const</span> <span class="keywordtype">double</span> val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)*=val; }
03758 
<a name="l03760"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_35">03760</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator/(<span class="keyword">const</span> <span class="keywordtype">double</span> val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this)/=val; }
03761 
<a name="l03763"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_38">03763</a>     <span class="keyword">friend</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator+(<span class="keyword">const</span> T&amp; val, <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img)+=val; }
03764 
<a name="l03766"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_39">03766</a>     <span class="keyword">friend</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator*(<span class="keyword">const</span> <span class="keywordtype">double</span> val,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> &amp;img) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img)*=val; }
03767 
<a name="l03769"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_40">03769</a>     <span class="keyword">friend</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator-(<span class="keyword">const</span> T&amp; val, <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,val)-=img; }
03770 
<a name="l03772"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_36">03772</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{
03773       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> siz = size();
03774       <span class="keywordtype">bool</span> vequal = <span class="keyword">true</span>;
03775       <span class="keywordflow">if</span> (siz!=img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
03776       t *ptrs=img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+siz;
03777       <span class="keywordflow">for</span> (T *ptrd=data+siz; vequal &amp;&amp; ptrd&gt;data; vequal=vequal&amp;&amp;((*(--ptrd))==(*(--ptrs))));
03778       <span class="keywordflow">return</span> vequal;
03779     }
<a name="l03781"></a><a class="code" href="structcimg__library_1_1CImg.html#z5_37">03781</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <span class="keywordtype">bool</span> operator!=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !((*this)==img); }
03782 
03784     <span class="comment">//--------------------------------------------------</span>
03785     <span class="comment">//--------------------------------------------------</span>
03786     <span class="comment">//</span>
03788 <span class="comment"></span>
03789     <span class="comment">//--------------------------------------------------</span>
03790     <span class="comment">//--------------------------------------------------</span>
03791      
03793 
<a name="l03797"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_0">03797</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; mul(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) {
03798       t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>;
03799       T *ptrf = data + cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03800       <span class="keywordflow">for</span> (T* ptrd = data; ptrd&lt;ptrf; ptrd++) (*ptrd)=(T)(*ptrd*(*(ptrs++)));
03801       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03802     }
03803 
03805 
<a name="l03811"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_1">03811</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_mul(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_0">mul</a>(img); }
03812   
03814 
<a name="l03818"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_2">03818</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; div(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) {
03819       t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>;
03820       T *ptrf = data + cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03821       <span class="keywordflow">for</span> (T* ptrd = data; ptrd&lt;ptrf; ptrd++) (*ptrd)=(T)(*ptrd/(*(ptrs++)));
03822       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03823     }
03824 
03826 
<a name="l03832"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_3">03832</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_div(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_2">div</a>(img); }
03833   
03835 
<a name="l03839"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_4">03839</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; max(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) {
03840       t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>;
03841       T *ptrf = data + cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03842       <span class="keywordflow">for</span> (T* ptrd = data; ptrd&lt;ptrf; ptrd++) (*ptrd)=cimg::max((T)(*(ptrs++)),*ptrd);
03843       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03844     }
03846 
<a name="l03850"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_5">03850</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_max(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_4">max</a>(img); }
03851   
03853 
<a name="l03857"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_6">03857</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; min(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) {
03858       t *ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>;
03859       T *ptrf = data + cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
03860       <span class="keywordflow">for</span> (T* ptrd = data; ptrd&lt;ptrf; ptrd++) (*ptrd)=cimg::min((T)(*(ptrs++)),*ptrd);
03861       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03862     }
03864 
<a name="l03868"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_7">03868</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_min(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_6">min</a>(img); }
03869 
03871 
<a name="l03874"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_8">03874</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; sqrt() {
03875       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::sqrt((<span class="keywordtype">double</span>)(*ptr));
03876       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03877     }
03878 
03880 
<a name="l03883"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_9">03883</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_sqrt()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_8">sqrt</a>(); }
03884   
03886 
<a name="l03889"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_10">03889</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; log() {
03890       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::log((<span class="keywordtype">double</span>)(*ptr));
03891       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03892     }
03893 
03895 
<a name="l03898"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_11">03898</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_log()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_10">log</a>(); }
03899 
03901 
<a name="l03904"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_12">03904</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; log10() {
03905       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::log10((<span class="keywordtype">double</span>)(*ptr));
03906       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03907     }
03908 
03910 
<a name="l03913"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_13">03913</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_log10()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_12">log10</a>(); }
03914 
03916 
<a name="l03920"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_14">03920</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; pow(<span class="keyword">const</span> <span class="keywordtype">double</span> p) {
03921       <span class="keywordflow">if</span> (p==0) <span class="keywordflow">return</span> fill(1);
03922       <span class="keywordflow">if</span> (p==1) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03923       <span class="keywordflow">if</span> (p==2) { cimg_map(*<span class="keyword">this</span>,ptr,T) { <span class="keyword">const</span> T&amp; val = *ptr; *ptr=val*val; } <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03924       <span class="keywordflow">if</span> (p==3) { cimg_map(*<span class="keyword">this</span>,ptr,T) { <span class="keyword">const</span> T&amp; val = *ptr; *ptr=val*val*val; } <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03925       <span class="keywordflow">if</span> (p==4) { cimg_map(*<span class="keyword">this</span>,ptr,T) { <span class="keyword">const</span> T&amp; val = *ptr; *ptr=val*val*val*val; } <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
03926       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::pow((<span class="keywordtype">double</span>)(*ptr),p);
03927       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03928     }
03929 
03931 
<a name="l03935"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_15">03935</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_pow(<span class="keyword">const</span> <span class="keywordtype">double</span> p)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_14">pow</a>(p); }
03936   
03938 
<a name="l03941"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_16">03941</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; abs() {
03942       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=cimg::abs(*ptr);
03943       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03944     }
03945 
03947 
<a name="l03950"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_17">03950</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_abs()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_16">abs</a>(); }
03951   
03953 
<a name="l03956"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_18">03956</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; cos() {
03957       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::cos((<span class="keywordtype">double</span>)(*ptr));
03958       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03959     }
03960 
03962 
<a name="l03965"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_19">03965</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_cos()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_18">cos</a>(); }
03966  
03968 
<a name="l03971"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_20">03971</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; sin() {
03972       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::sin((<span class="keywordtype">double</span>)(*ptr));
03973       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03974     }
03975 
03977 
<a name="l03980"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_21">03980</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_sin()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_20">sin</a>(); }
03981   
03983 
<a name="l03986"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_22">03986</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; tan() {
03987       cimg_map(*<span class="keyword">this</span>,ptr,T) (*ptr)=(T)std::tan((<span class="keywordtype">double</span>)(*ptr));
03988       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
03989     }
03990 
03992 
<a name="l03995"></a><a class="code" href="structcimg__library_1_1CImg.html#z7_23">03995</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_tan()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z7_22">tan</a>(); }
03996   
03997 
03999     <span class="comment">//------------------------------------------</span>
04000     <span class="comment">//------------------------------------------</span>
04001     <span class="comment">//</span>
04003 <span class="comment"></span>
04004     <span class="comment">//------------------------------------------</span>
04005     <span class="comment">//------------------------------------------</span>
04006     
04008 
<a name="l04013"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_0">04013</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val) {
04014       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);      
04015       <span class="keywordflow">if</span> (val!=0 &amp;&amp; <span class="keyword">sizeof</span>(T)!=1) cimg_map(*<span class="keyword">this</span>,ptr,T) *ptr=val; 
04016       <span class="keywordflow">else</span> std::memset(data,(<span class="keywordtype">int</span>)val,size()*<span class="keyword">sizeof</span>(T));
04017       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04018     }
04019 
04021 
<a name="l04025"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_1">04025</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1) {
04026       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04027       T *ptr, *ptr_end = data+size();
04028       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-1; ) { *(ptr++)=val0; *(ptr++)=val1; }
04029       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0;
04030       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04031     }
04032     
04034 
<a name="l04039"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_2">04039</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2) {
04040       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04041       T *ptr, *ptr_end = data+size();
04042       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-2; ) { *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; }     
04043       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1;
04044       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04045     }
04046     
04048 
<a name="l04054"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_3">04054</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3) {
04055       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04056       T *ptr, *ptr_end = data+size();
04057       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-3; ) { *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; }
04058       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04059       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04060     }
04061 
04063 
<a name="l04070"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_4">04070</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,<span class="keyword">const</span> T&amp; val4) {
04071       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04072       T *ptr, *ptr_end = data+size();
04073       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-4; ) { *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; *(ptr++)=val4; }
04074       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04075       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3;
04076       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04077     }
04078     
04080 
<a name="l04088"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_5">04088</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,<span class="keyword">const</span> T&amp; val4,<span class="keyword">const</span> T&amp; val5) {
04089       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04090       T *ptr, *ptr_end = data+size(); 
04091       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-5; ) {
04092         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; *(ptr++)=val4; *(ptr++)=val5; 
04093       }
04094       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04095       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4;
04096       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04097     }
04098 
04100 
<a name="l04109"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_6">04109</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,
04110                <span class="keyword">const</span> T&amp; val4,<span class="keyword">const</span> T&amp; val5,<span class="keyword">const</span> T&amp; val6) {
04111       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04112       T *ptr, *ptr_end = data+size(); 
04113       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-6; ) {
04114         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; *(ptr++)=val4; *(ptr++)=val5; *(ptr++)=val6;
04115       }
04116       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04117       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val5;
04118       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04119     }
04120 
04122 
<a name="l04132"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_7">04132</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,
04133                <span class="keyword">const</span> T&amp; val4,<span class="keyword">const</span> T&amp; val5,<span class="keyword">const</span> T&amp; val6,<span class="keyword">const</span> T&amp; val7) {
04134       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04135       T *ptr, *ptr_end = data+size();
04136       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-7; ) {
04137         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3;
04138         *(ptr++)=val4; *(ptr++)=val5; *(ptr++)=val6; *(ptr++)=val7;
04139       }
04140       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04141       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val5;
04142       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val6;
04143       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04144     }
04145 
04147 
<a name="l04158"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_8">04158</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,
04159                <span class="keyword">const</span> T&amp; val3,<span class="keyword">const</span> T&amp; val4,<span class="keyword">const</span> T&amp; val5,
04160                <span class="keyword">const</span> T&amp; val6,<span class="keyword">const</span> T&amp; val7,<span class="keyword">const</span> T&amp; val8) {
04161       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04162       T *ptr, *ptr_end = data+size();
04163       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-8; ) {
04164         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; 
04165         *(ptr++)=val3; *(ptr++)=val4; *(ptr++)=val5; 
04166         *(ptr++)=val6; *(ptr++)=val7; *(ptr++)=val8;
04167       }
04168       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04169       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val5;
04170       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val6; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val7;
04171       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04172     }
04173 
04175 
<a name="l04187"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_9">04187</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,<span class="keyword">const</span> T&amp; val4,
04188                <span class="keyword">const</span> T&amp; val5,<span class="keyword">const</span> T&amp; val6,<span class="keyword">const</span> T&amp; val7,<span class="keyword">const</span> T&amp; val8,<span class="keyword">const</span> T&amp; val9) {
04189       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04190       T *ptr, *ptr_end = data+size();
04191       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-9; ) {
04192         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; *(ptr++)=val4;
04193         *(ptr++)=val5; *(ptr++)=val6; *(ptr++)=val7; *(ptr++)=val8; *(ptr++)=val9;
04194       }
04195       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04196       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val5;
04197       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val6; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val7; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val8;
04198       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04199     }
04200 
04202 
<a name="l04216"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_10">04216</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,
04217                <span class="keyword">const</span> T&amp; val4,<span class="keyword">const</span> T&amp; val5,<span class="keyword">const</span> T&amp; val6,<span class="keyword">const</span> T&amp; val7,
04218                <span class="keyword">const</span> T&amp; val8,<span class="keyword">const</span> T&amp; val9,<span class="keyword">const</span> T&amp; val10,<span class="keyword">const</span> T&amp; val11) {
04219       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04220       T *ptr, *ptr_end = data+size();
04221       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-11; ) {
04222         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; *(ptr++)=val4; *(ptr++)=val5; 
04223         *(ptr++)=val6; *(ptr++)=val7; *(ptr++)=val8; *(ptr++)=val9; *(ptr++)=val10; *(ptr++)=val11;
04224       }
04225       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04226       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val5;
04227       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val6; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val7; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val8;
04228       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val9; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val10;
04229       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04230     }
04232 
<a name="l04250"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_11">04250</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; fill(<span class="keyword">const</span> T&amp; val0,<span class="keyword">const</span> T&amp; val1,<span class="keyword">const</span> T&amp; val2,<span class="keyword">const</span> T&amp; val3,
04251                <span class="keyword">const</span> T&amp; val4,<span class="keyword">const</span> T&amp; val5,<span class="keyword">const</span> T&amp; val6,<span class="keyword">const</span> T&amp; val7,
04252                <span class="keyword">const</span> T&amp; val8,<span class="keyword">const</span> T&amp; val9,<span class="keyword">const</span> T&amp; val10,<span class="keyword">const</span> T&amp; val11,
04253                <span class="keyword">const</span> T&amp; val12,<span class="keyword">const</span> T&amp; val13,<span class="keyword">const</span> T&amp; val14,<span class="keyword">const</span> T&amp; val15) {
04254       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::fill"</span>);
04255       T *ptr, *ptr_end = data+size();
04256       <span class="keywordflow">for</span> (ptr=data; ptr&lt;ptr_end-15; ) {
04257         *(ptr++)=val0; *(ptr++)=val1; *(ptr++)=val2; *(ptr++)=val3; *(ptr++)=val4; *(ptr++)=val5; 
04258         *(ptr++)=val6; *(ptr++)=val7; *(ptr++)=val8; *(ptr++)=val9; *(ptr++)=val10; *(ptr++)=val11;
04259         *(ptr++)=val12; *(ptr++)=val13; *(ptr++)=val14; *(ptr++)=val15;
04260       }
04261       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val0; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val1; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val2;
04262       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val3; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val4; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val5;
04263       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val6; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val7; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val8;
04264       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val9; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val10; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val11;
04265       <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val12; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val13; <span class="keywordflow">if</span> (ptr!=ptr_end) *(ptr++)=val14;
04266       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04267     }
04268   
04270 
<a name="l04275"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_12">04275</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; normalize(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b) {
04276       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::normalize"</span>);
04277       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(*<span class="keyword">this</span>,<span class="keyword">false</span>);
04278       <span class="keywordflow">if</span> (st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>==st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>) fill(0);
04279       <span class="keywordflow">else</span> cimg_map(*<span class="keyword">this</span>,ptr,T) *ptr=(T)((*ptr-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)/(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)*(b-a)+a);
04280       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04281     }
04282 
04284 
<a name="l04289"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_13">04289</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_normalize(<span class="keyword">const</span> T&amp; a,<span class="keyword">const</span> T&amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z9_12">normalize</a>(a,b); }
04290   
04292 
<a name="l04297"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_14">04297</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; cut(<span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b) {
04298       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::cut"</span>);
04299       cimg_map(*<span class="keyword">this</span>,ptr,T) *ptr = (*ptr&lt;a)?a:((*ptr&gt;b)?b:*ptr);
04300       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04301     }
04302 
04304 
<a name="l04309"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_15">04309</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_cut(<span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z9_14">cut</a>(a,b); }
04310 
04312 
<a name="l04316"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_16">04316</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; quantify(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=256) {
04317       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::quantify"</span>);
04318       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(*<span class="keyword">this</span>,<span class="keyword">false</span>);
04319       <span class="keyword">const</span> <span class="keywordtype">double</span> range = st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>;
04320       cimg_map(*<span class="keyword">this</span>,ptr,T) *ptr = (T)(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a> + range*(int)((*ptr-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)*(int)n/range)/n);
04321       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04322     }
04323 
04325 
<a name="l04329"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_17">04329</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_quantify(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=256)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).quantify(n); }
04330 
04332 
<a name="l04336"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_18">04336</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; threshold(<span class="keyword">const</span> T&amp; thres) {
04337       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::threshold"</span>);
04338       cimg_map(*<span class="keyword">this</span>,ptr,T) *ptr = *ptr&lt;=thres?(T)0:(T)1;
04339       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04340     }
04341 
04343 
<a name="l04347"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_19">04347</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_threshold(<span class="keyword">const</span> T&amp; thres)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).threshold(thres); }
04348   
04350 
<a name="l04359"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_20">04359</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_rotate(<span class="keyword">const</span> <span class="keywordtype">float</span> angle,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=2)<span class="keyword"> const </span>{
04360       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_rotate"</span>);
04361       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest;
04362       <span class="keyword">const</span> <span class="keywordtype">float</span> nangle = cimg::mod(angle,360.0f), rad = (float)((nangle*cimg::PI)/180.0),
04363         ca=(float)std::cos(rad), sa=(float)std::sin(rad);
04364     
04365       <span class="keywordflow">if</span> (cond!=1 &amp;&amp; cimg::mod(nangle,90.0f)==0) { <span class="comment">// optimized version for orthogonal angles</span>
04366         <span class="keyword">const</span> <span class="keywordtype">int</span> iangle = (int)nangle/90;
04367         <span class="keywordflow">switch</span> (iangle) {
04368         <span class="keywordflow">case</span> 1: {
04369           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(height,width,depth,dim); 
04370           cimg_mapXYZV(dest,x,y,z,v) dest(x,y,z,v) = (*this)(y,height-1-x,z,v); 
04371         } <span class="keywordflow">break</span>; 
04372         <span class="keywordflow">case</span> 2: {
04373           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,depth,dim);
04374           cimg_mapXYZV(dest,x,y,z,v) dest(x,y,z,v) = (*this)(width-1-x,height-1-y,z,v); 
04375         } <span class="keywordflow">break</span>;
04376         <span class="keywordflow">case</span> 3: {
04377           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(height,width,depth,dim); 
04378           cimg_mapXYZV(dest,x,y,z,v) dest(x,y,z,v) = (*this)(width-1-y,x,z,v); 
04379         } <span class="keywordflow">break</span>;
04380         <span class="keywordflow">default</span>: 
04381           <span class="keywordflow">return</span> *<span class="keyword">this</span>;        
04382         }
04383       } <span class="keywordflow">else</span> { <span class="comment">// generic version</span>
04384         <span class="keyword">const</span> <span class="keywordtype">float</span> 
04385           ux  = (float)(cimg::abs(width*ca)),  uy  = (float)(cimg::abs(width*sa)),
04386           vx  = (float)(cimg::abs(height*sa)), vy  = (float)(cimg::abs(height*ca)),
04387           w2  = 0.5f*width,           h2  = 0.5f*height,
04388           dw2 = 0.5f*(ux+vx),         dh2 = 0.5f*(uy+vy);
04389         dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>((int)(ux+vx), (int)(uy+vy),depth,dim);
04390 
04391         <span class="keywordflow">switch</span> (cond) {
04392         <span class="keywordflow">case</span> 0: { 
04393           cimg_mapXY(dest,x,y)
04394             cimg_mapZV(*<span class="keyword">this</span>,z,v) 
04395             dest(x,y,z,v) = dirichlet_pix2d((<span class="keywordtype">int</span>)(w2 + (x-dw2)*ca + (y-dh2)*sa),(<span class="keywordtype">int</span>)(h2 - (x-dw2)*sa + (y-dh2)*ca),z,v);
04396         } <span class="keywordflow">break</span>;
04397         <span class="keywordflow">case</span> 1: {
04398           cimg_mapXY(dest,x,y)
04399             cimg_mapZV(*<span class="keyword">this</span>,z,v) 
04400             dest(x,y,z,v) = (*this)(cimg::mod((<span class="keywordtype">int</span>)(w2 + (x-dw2)*ca + (y-dh2)*sa),width),
04401                                     cimg::mod((<span class="keywordtype">int</span>)(h2 - (x-dw2)*sa + (y-dh2)*ca),height),z,v);
04402         } <span class="keywordflow">break</span>;
04403         <span class="keywordflow">default</span>: {
04404           cimg_mapXY(dest,x,y) {
04405             <span class="keyword">const</span> <span class="keywordtype">float</span> X = w2 + (x-dw2)*ca + (y-dh2)*sa, Y = h2 - (x-dw2)*sa + (y-dh2)*ca;
04406             <span class="keyword">const</span> <span class="keywordtype">int</span> ix = (int)X, iy = (int)Y;
04407             <span class="keywordflow">if</span> (ix&lt;0 || ix&gt;=dimx() || iy&lt;0 || iy&gt;=dimy()) cimg_mapZV(*<span class="keyword">this</span>,z,v) dest(x,y,z,v) = 0;
04408             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) dest(x,y,z,v) = (T)linear_pix2d(X,Y,z,v);
04409           }
04410         } <span class="keywordflow">break</span>; 
04411         }
04412       }
04413       <span class="keywordflow">return</span> dest;
04414     }
04415   
04417 
<a name="l04425"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_21">04425</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; rotate(<span class="keyword">const</span> <span class="keywordtype">float</span> angle,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=2) { <span class="keywordflow">return</span> get_rotate(angle,cond).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
04426   
04428 
<a name="l04439"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_22">04439</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_rotate(<span class="keyword">const</span> <span class="keywordtype">float</span> angle,<span class="keyword">const</span> <span class="keywordtype">float</span> cx,<span class="keyword">const</span> <span class="keywordtype">float</span> cy,<span class="keyword">const</span> <span class="keywordtype">float</span> zoom=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=2)<span class="keyword"> const </span>{
04440       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_rotate"</span>);
04441       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(*<span class="keyword">this</span>,<span class="keyword">false</span>);
04442       <span class="keyword">const</span> <span class="keywordtype">float</span> nangle = cimg::mod(angle,360.0f), rad = (float)((nangle*cimg::PI)/180.0),
04443         ca=(float)std::cos(rad)/zoom, sa=(float)std::sin(rad)/zoom;
04444     
04445       <span class="keywordflow">if</span> (cond!=1 &amp;&amp; zoom==1 &amp;&amp; cimg::mod(nangle,90.0f)==0) { <span class="comment">// optimized version for orthogonal angles</span>
04446         <span class="keyword">const</span> <span class="keywordtype">int</span> iangle = (int)nangle/90;
04447         <span class="keywordflow">switch</span> (iangle) {
04448         <span class="keywordflow">case</span> 1: {
04449           dest.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(0);
04450           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
04451             xmin = cimg::max(0,(dimx()-dimy())/2), xmax = cimg::min(width,xmin+height),
04452             ymin = cimg::max(0,(dimy()-dimx())/2), ymax = cimg::min(height,ymin+width),
04453             xoff = xmin + cimg::min(0,(dimx()-dimy())/2),
04454             yoff = ymin + cimg::min(0,(dimy()-dimx())/2);
04455           cimg_mapZV(dest,z,v) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=ymin; y&lt;ymax; y++) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=xmin; x&lt;xmax; x++)
04456             dest(x,y,z,v) = (*this)(y-yoff,height-1-x+xoff,z,v);
04457         } <span class="keywordflow">break</span>;
04458         <span class="keywordflow">case</span> 2: {
04459           cimg_mapXYZV(dest,x,y,z,v) dest(x,y,z,v) = (*this)(width-1-x,height-1-y,z,v); 
04460         } <span class="keywordflow">break</span>;
04461         <span class="keywordflow">case</span> 3: {
04462           dest.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(0);
04463           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
04464             xmin = cimg::max(0,(dimx()-dimy())/2), xmax = cimg::min(width,xmin+height),
04465             ymin = cimg::max(0,(dimy()-dimx())/2), ymax = cimg::min(height,ymin+width),
04466             xoff = xmin + cimg::min(0,(dimx()-dimy())/2),
04467             yoff = ymin + cimg::min(0,(dimy()-dimx())/2);
04468           cimg_mapZV(dest,z,v) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=ymin; y&lt;ymax; y++) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=xmin; x&lt;xmax; x++)
04469             dest(x,y,z,v) = (*this)(width-1-y+yoff,x-xoff,z,v);
04470         } <span class="keywordflow">break</span>;
04471         <span class="keywordflow">default</span>: 
04472           <span class="keywordflow">return</span> *<span class="keyword">this</span>;        
04473         }
04474       } <span class="keywordflow">else</span> 
04475         <span class="keywordflow">switch</span> (cond) { <span class="comment">// generic version</span>
04476         <span class="keywordflow">case</span> 0: { 
04477           cimg_mapXY(dest,x,y)
04478             cimg_mapZV(*<span class="keyword">this</span>,z,v) 
04479             dest(x,y,z,v) = dirichlet_pix2d((<span class="keywordtype">int</span>)(cx + (x-cx)*ca + (y-cy)*sa),(<span class="keywordtype">int</span>)(cy - (x-cx)*sa + (y-cy)*ca),z,v);
04480         } <span class="keywordflow">break</span>;
04481         <span class="keywordflow">case</span> 1: {
04482           cimg_mapXY(dest,x,y)
04483             cimg_mapZV(*<span class="keyword">this</span>,z,v) 
04484             dest(x,y,z,v) = (*this)(cimg::mod((<span class="keywordtype">int</span>)(cx + (x-cx)*ca + (y-cy)*sa),width),
04485                                     cimg::mod((<span class="keywordtype">int</span>)(cy - (x-cx)*sa + (y-cy)*ca),height),z,v);
04486         } <span class="keywordflow">break</span>;
04487         <span class="keywordflow">default</span>: {
04488           cimg_mapXY(dest,x,y) {
04489             <span class="keyword">const</span> <span class="keywordtype">float</span> X = cx + (x-cx)*ca + (y-cy)*sa, Y = cy - (x-cx)*sa + (y-cy)*ca;
04490             <span class="keyword">const</span> <span class="keywordtype">int</span> ix = (int)X, iy = (int)Y;
04491             <span class="keywordflow">if</span> (ix&lt;0 || ix&gt;=dimx() || iy&lt;0 || iy&gt;=dimy()) cimg_mapZV(*<span class="keyword">this</span>,z,v) dest(x,y,z,v) = 0;
04492             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) dest(x,y,z,v) = (T)linear_pix2d(X,Y,z,v);
04493           }
04494         } <span class="keywordflow">break</span>; 
04495         }
04496       <span class="keywordflow">return</span> dest;
04497     }
04498   
04500 
<a name="l04512"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_23">04512</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; rotate(<span class="keyword">const</span> <span class="keywordtype">float</span> angle,<span class="keyword">const</span> <span class="keywordtype">float</span> cx,<span class="keyword">const</span> <span class="keywordtype">float</span> cy,<span class="keyword">const</span> <span class="keywordtype">float</span> zoom=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=2) {
04513       <span class="keywordflow">return</span> get_rotate(angle,cx,cy,zoom,cond).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>);
04514     }
04515  
04517 
<a name="l04531"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_24">04531</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_resize(<span class="keyword">const</span> <span class="keywordtype">int</span> pdx=-100,<span class="keyword">const</span> <span class="keywordtype">int</span> pdy=-100,<span class="keyword">const</span> <span class="keywordtype">int</span> pdz=-100,<span class="keyword">const</span> <span class="keywordtype">int</span> pdv=-100,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interp=1)<span class="keyword"> const </span>{
04532       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_resize"</span>);
04533       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
04534         dx = pdx&lt;0?-pdx*width/100:pdx,
04535         dy = pdy&lt;0?-pdy*height/100:pdy,
04536         dz = pdz&lt;0?-pdz*depth/100:pdz, 
04537         dv = pdv&lt;0?-pdv*dim/100:pdv;
04538       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res(dx?dx:1,dy?dy:1,dz?dz:1,dv?dv:1);
04539       <span class="keywordflow">if</span> (width==res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> &amp;&amp; height==res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> &amp;&amp; depth==res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a> &amp;&amp; dim==res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04540       <span class="keywordflow">switch</span> (interp) {
04541       <span class="keywordflow">case</span> 0: { <span class="comment">// Zero filling</span>
04542         res.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(0).<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>(*<span class="keyword">this</span>,0,0,0,0);
04543       } <span class="keywordflow">break</span>;
04544       <span class="keywordflow">case</span> 1: { <span class="comment">// Bloc interpolation</span>
04545         <span class="keyword">const</span> <span class="keywordtype">float</span> sx = (float)width/res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>, sy = (float)height/res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>, sz = (float)depth/res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>, sk = (float)dim/res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>;
04546         <span class="keywordtype">float</span> cx,cy,cz,ck=0;
04547         cimg_mapV(res,k) { cz = 0; 
04548         cimg_mapZ(res,z) { cy = 0; 
04549         cimg_mapY(res,y) { cx = 0; 
04550         cimg_mapX(res,x) { res(x,y,z,k) = (*this)((<span class="keywordtype">unsigned</span> int)cx,(<span class="keywordtype">unsigned</span> int)cy,(<span class="keywordtype">unsigned</span> int)cz,(<span class="keywordtype">unsigned</span> int)ck); cx+=sx;
04551         } cy+=sy;
04552         } cz+=sz;
04553         } ck+=sk;
04554         }
04555       } <span class="keywordflow">break</span>;
04556       <span class="keywordflow">case</span> 2: { <span class="comment">// Mosaic filling</span>
04557         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>; k+=dim)
04558           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0; z&lt;res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>; z+=depth)
04559             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; y+=height)
04560               <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; x+=width) res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>(*<span class="keyword">this</span>,x,y,z,k);
04561       } <span class="keywordflow">break</span>;
04562       <span class="keywordflow">case</span> 3: { <span class="comment">// Linear interpolation</span>
04563         <span class="keyword">const</span> <span class="keywordtype">float</span>
04564           sx = res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&gt;1?(float)(width-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>-1):0,
04565           sy = res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>&gt;1?(float)(height-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1):0,
04566           sz = res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>&gt;1?(float)(depth-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>-1):0,
04567           sk = res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>&gt;1?(float)(dim-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>-1):0;
04568         <span class="keywordtype">float</span> cx,cy,cz,ck = 0;
04569         cimg_mapV(res,k) { cz = 0; 
04570         cimg_mapZ(res,z) { cy = 0;
04571         cimg_mapY(res,y) { cx = 0; 
04572         cimg_mapX(res,x) { res(x,y,z,k) = (T)linear_pix4d(cx,cy,cz,ck); cx+=sx;
04573         } cy+=sy;
04574         } cz+=sz;
04575         } ck+=sk;
04576         }
04577       } <span class="keywordflow">break</span>;
04578       <span class="keywordflow">case</span> 4: { <span class="comment">// Grid filling</span>
04579         <span class="keyword">const</span> <span class="keywordtype">float</span> sx = (float)width/res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>, sy = (float)height/res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>, sz = (float)depth/res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>, sk = (float)dim/res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>;
04580         res.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(0);
04581         cimg_mapXYZV(*<span class="keyword">this</span>,x,y,z,k) res((<span class="keywordtype">int</span>)(x/sx),(<span class="keywordtype">int</span>)(y/sy),(<span class="keywordtype">int</span>)(z/sz),(<span class="keywordtype">int</span>)(k/sk)) = (*this)(x,y,z,k);
04582       } <span class="keywordflow">break</span>;
04583       <span class="keywordflow">case</span> 5: { <span class="comment">// Cubic interpolation</span>
04584         <span class="keyword">const</span> <span class="keywordtype">float</span>
04585           sx = res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&gt;1?(float)(width-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>-1):0,
04586           sy = res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>&gt;1?(float)(height-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1):0,
04587           sz = res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>&gt;1?(float)(depth-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>-1):0,
04588           sk = res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>&gt;1?(float)(dim-1)/(res.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>-1):0;
04589         <span class="keywordtype">float</span> cx,cy,cz,ck = 0;
04590         cimg_mapV(res,k) { cz = 0;
04591         cimg_mapZ(res,z) { cy = 0;
04592         cimg_mapY(res,y) { cx = 0;
04593         cimg_mapX(res,x) { res(x,y,z,k) = (T)cubic_pix2d(cx,cy,(<span class="keywordtype">int</span>)cz,(<span class="keywordtype">int</span>)ck); cx+=sx;
04594         } cy+=sy;
04595         } cz+=sz;
04596         } ck+=sk;
04597         }
04598       } <span class="keywordflow">break</span>;      
04599       }
04600       <span class="keywordflow">return</span> res;
04601     }
04602 
04604 
<a name="l04615"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_25">04615</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_resize(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; src,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interp=1)<span class="keyword"> const </span>{
04616       <span class="keywordflow">return</span> get_resize(src.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,src.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,src.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,src.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,interp); 
04617     }  
04618 
04620 
<a name="l04631"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_26">04631</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_resize(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; disp,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interp=1)<span class="keyword"> const </span>{
04632       <span class="keywordflow">return</span> get_resize(disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>,disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>,depth,dim,interp);
04633     }
04634 
04636 
<a name="l04650"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_27">04650</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; resize(<span class="keyword">const</span> <span class="keywordtype">int</span> pdx=-100,<span class="keyword">const</span> <span class="keywordtype">int</span> pdy=-100,<span class="keyword">const</span> <span class="keywordtype">int</span> pdz=-100,<span class="keyword">const</span> <span class="keywordtype">int</span> pdv=-100,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interp=1) {
04651       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
04652         dx = pdx&lt;0?-pdx*width/100 :(pdx==0?1:pdx),
04653         dy = pdy&lt;0?-pdy*height/100:(pdy==0?1:pdy),
04654         dz = pdz&lt;0?-pdz*depth/100 :(pdz==0?1:pdz),
04655         dv = pdv&lt;0?-pdv*dim/100   :(pdv==0?1:pdv);
04656       <span class="keywordflow">if</span> (width==dx &amp;&amp; height==dy &amp;&amp; depth==dz &amp;&amp; dim==dv) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
04657       <span class="keywordflow">else</span> <span class="keywordflow">return</span> get_resize(dx,dy,dz,dv,interp).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>);
04658     }
04659 
04661 
<a name="l04672"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_28">04672</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; resize(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; src,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interp=1) { 
04673       <span class="keywordflow">return</span> resize(src.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,src.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,src.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,src.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,interp); 
04674     }
04675 
04677 
<a name="l04688"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_29">04688</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; resize(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; disp,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> interp=1) {
04689       <span class="keywordflow">return</span> resize(disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>,disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>,depth,dim,interp);
04690     }
04691 
04693 
<a name="l04696"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_30">04696</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_resize_halfXY()<span class="keyword"> const </span>{
04697       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_resize_halfXY"</span>);
04698       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> mask = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;::matrix</a>(0.07842776544f, 0.1231940459f, 0.07842776544f,
04699                                              0.1231940459f,  0.1935127547f, 0.1231940459f,
04700                                              0.07842776544f, 0.1231940459f, 0.07842776544f);
04701       CImg_3x3(I,<span class="keywordtype">float</span>);
04702       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(width/2,height/2,depth,dim);
04703       cimg_mapZV(*<span class="keyword">this</span>,z,k) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,k,I) dest(x/2,y/2,z,k) = (T)cimg_conv3x3(I,mask);
04704       <span class="keywordflow">return</span> dest;
04705     }
04706 
04708 
<a name="l04711"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_31">04711</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; resize_halfXY() {     <span class="keywordflow">return</span> get_resize_halfXY().<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
04712 
04714 
<a name="l04726"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_32">04726</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0,
04727                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v1,
04728                   <span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition = <span class="keyword">false</span>)<span class="keyword"> const </span>{
04729       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_crop"</span>);
04730       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx=x1-x0+1, dy=y1-y0+1, dz=z1-z0+1, dv=v1-v0+1;
04731       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(dx,dy,dz,dv);
04732       <span class="keywordflow">if</span> (x0&gt;=width || x1&gt;=width || y0&gt;=height || y1&gt;=height || z0&gt;=depth || z1&gt;=depth ||
04733           v0&gt;=dim || v1&gt;=dim || x1&lt;x0 || y1&lt;y0 || z1&lt;z0 || v1&lt;v0)
04734         <span class="keywordflow">switch</span> (border_condition) {
04735         <span class="keywordflow">case</span> <span class="keyword">false</span>: { cimg_mapXYZV(dest,x,y,z,v) dest(x,y,z,v) = dirichlet_pix4d(x0+x,y0+y,z0+z,v0+v,0); } <span class="keywordflow">break</span>;
04736         <span class="keywordflow">default</span>: { cimg_mapXYZV(dest,x,y,z,v) dest(x,y,z,v) = neumann_pix4d(x0+x,y0+y,z0+z,v0+v); } <span class="keywordflow">break</span>;
04737         } <span class="keywordflow">else</span> {
04738           T *psrc = ptr(x0,y0,z0,v0), *pdest = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0);
04739           <span class="keywordflow">if</span> (dx!=width)
04740             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;dv; k++) {
04741               <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0; z&lt;dz; z++) {
04742                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;dy; y++) {
04743                   std::memcpy(pdest,psrc,dx*<span class="keyword">sizeof</span>(T));
04744                   pdest+=dx;
04745                   psrc+=width;
04746                 }
04747                 psrc+=width*(height-dy);
04748               }
04749               psrc+=width*height*(depth-dz);
04750             }
04751           <span class="keywordflow">else</span> {
04752             <span class="keywordflow">if</span> (dy!=height)         
04753               <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;dv; k++) {
04754                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0; z&lt;dz; z++) {
04755                   std::memcpy(pdest,psrc,dx*dy*<span class="keyword">sizeof</span>(T));
04756                   pdest+=dx*dy;
04757                   psrc+=width*height;
04758                 }
04759                 psrc+=width*height*(depth-dz);
04760               }
04761             <span class="keywordflow">else</span> {
04762               <span class="keywordflow">if</span> (dz!=depth)
04763                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;dv; k++) {
04764                   std::memcpy(pdest,psrc,dx*dy*dz*<span class="keyword">sizeof</span>(T));
04765                   pdest+=dx*dy*dz;
04766                   psrc+=width*height*depth;
04767                 }
04768               <span class="keywordflow">else</span> std::memcpy(pdest,psrc,dx*dy*dz*dv*<span class="keyword">sizeof</span>(T));
04769             }
04770           }
04771         }
04772       <span class="keywordflow">return</span> dest;
04773     }
04774     
04776 
<a name="l04785"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_33">04785</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0,
04786                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z1,
04787                   <span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>)<span class="keyword"> const </span>{
04788       <span class="keywordflow">return</span> get_crop(x0,y0,z0,0,x1,y1,z1,dim-1,border_condition);
04789     }
04790 
04792 
<a name="l04799"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_34">04799</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,
04800                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1,
04801                   <span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>)<span class="keyword"> const </span>{
04802       <span class="keywordflow">return</span> get_crop(x0,y0,0,0,x1,y1,depth-1,dim-1,border_condition);
04803     }
04804 
04806 
<a name="l04811"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_35">04811</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>)<span class="keyword"> const </span>{
04812       <span class="keywordflow">return</span> get_crop(x0,0,0,0,x1,height-1,depth-1,dim-1,border_condition); 
04813     }
04814 
04816 
<a name="l04827"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_36">04827</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0,
04828                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v1,
04829                <span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>) {
04830       <span class="keywordflow">return</span> get_crop(x0,y0,z0,v0,x1,y1,z1,v1,border_condition).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>);
04831     }
04832 
04834 
<a name="l04843"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_37">04843</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0,
04844                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z1,
04845                <span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>) {
04846       <span class="keywordflow">return</span> crop(x0,y0,z0,0,x1,y1,z1,dim-1,border_condition);
04847     }
04848 
04850 
<a name="l04857"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_38">04857</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,
04858                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1,
04859                <span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>) { 
04860       <span class="keywordflow">return</span> crop(x0,y0,0,0,x1,y1,depth-1,dim-1,border_condition); 
04861     }
04862 
04864 
<a name="l04869"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_39">04869</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; crop(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">bool</span> border_condition=<span class="keyword">false</span>) { 
04870       <span class="keywordflow">return</span> crop(x0,0,0,0,x1,height-1,depth-1,dim-1,border_condition);
04871     }
04872 
04874 
<a name="l04878"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_40">04878</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_channel(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> get_crop(0,0,0,v0,width-1,height-1,depth-1,v0); }
04879 
04881 
<a name="l04885"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_41">04885</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_slice(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> get_crop(0,0,z0,0,width-1,height-1,z0,dim-1); }
04886 
04888 
<a name="l04893"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_42">04893</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_plane(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> get_crop(0,0,z0,v0,width-1,height-1,z0,v0); }
04894 
<a name="l04896"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_43">04896</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_pointset(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xmin,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xmax,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{
04897       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::ref_pointset"</span>);
04898       <span class="keywordflow">if</span> (xmax&lt;xmin || xmax&gt;=width || y0&gt;=height || z0&gt;=depth || v0&gt;=dim)
04899         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::ref_pointset() : Cannot return a reference (%u-&gt;%u,%u,%u,%u) from a (%u,%u,%u,%u) image"</span>,
04900                                     pixel_type(),xmin,xmax,y0,z0,v0,width,height,depth,dim);
04901       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a>(1+xmax-xmin,1,1,1,ptr(xmin,y0,z0,v0));
04902     }
04903 
<a name="l04905"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_44">04905</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_lineset(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymin,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymax,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{
04906       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::ref_lineset"</span>);
04907       <span class="keywordflow">if</span> (ymax&lt;ymin || ymax&gt;=height || z0&gt;=depth || v0&gt;=dim)
04908         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::ref_lineset() : Cannot return a reference (0-&gt;%u,%u-&gt;%u,%u,%u) from a (%u,%u,%u,%u) image"</span>,
04909                                     pixel_type(),width-1,ymin,ymax,z0,v0,width,height,depth,dim);
04910       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a>(width,1+ymax-ymin,1,1,ptr(0,ymin,z0,v0));
04911     }
04912   
<a name="l04914"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_45">04914</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_planeset(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> zmin,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> zmax,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{
04915       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::ref_planeset"</span>);
04916       <span class="keywordflow">if</span>(zmax&lt;zmin || zmax&gt;=depth || v0&gt;=dim)
04917         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::ref_planeset() : Cannot return a reference (0-&gt;%u,0-&gt;%u,%u-&gt;%u,%u) from a (%u,%u,%u,%u) image"</span>,
04918                                     pixel_type(),width-1,height-1,zmin,zmax,v0,width,height,depth,dim);
04919       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a>(width,height,1+zmax-zmin,1,ptr(0,0,zmin,v0));
04920     }
04921 
<a name="l04923"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_46">04923</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_channelset(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vmin,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vmax)<span class="keyword"> const </span>{
04924       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::ref_channelset"</span>);
04925       <span class="keywordflow">if</span> (vmax&lt;vmin || vmax&gt;=dim)
04926         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::ref_channelset() : Cannot return a reference (0-&gt;%u,0-&gt;%u,0-&gt;%u,%u-&gt;%u) from a (%u,%u,%u,%u) image"</span>,
04927                                     pixel_type(),width-1,height-1,depth-1,vmin,vmax,width,height,depth,dim);
04928       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a>(width,height,depth,1+vmax-vmin,ptr(0,0,0,vmin));
04929     }
04930   
<a name="l04932"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_47">04932</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_line(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ref_pointset(0,width-1,y0,z0,v0); }
04933 
<a name="l04935"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_48">04935</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_plane(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ref_lineset(0,height-1,z0,v0); }
04936 
<a name="l04938"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_49">04938</a>     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a> ref_channel(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ref_planeset(0,depth-1,v0); }
04939 
<a name="l04941"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_50">04941</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; channel(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0) { <span class="keywordflow">return</span> get_channel(v0).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
04942 
<a name="l04944"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_51">04944</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; slice(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0) { <span class="keywordflow">return</span> get_slice(z0).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
04945 
<a name="l04947"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_52">04947</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; plane(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z0=0, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v0=0) { <span class="keywordflow">return</span> get_plane(z0,v0).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
04948   
<a name="l04950"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_53">04950</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; flip(<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>) {
04951       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::flip"</span>);
04952       T *pf,*pb,*buf=NULL;
04953       <span class="keywordflow">switch</span> (cimg::uncase(axe)) {
04954       <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: {
04955         pf = ptr(); pb = ptr(width-1);
04956         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> yzv=0; yzv&lt;height*depth*dim; yzv++) { 
04957           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;width/2; x++) { <span class="keyword">const</span> T val = *pf; *(pf++)=*pb; *(pb--)=val; }
04958           pf+=width-width/2;
04959           pb+=width+width/2;
04960         }
04961       } <span class="keywordflow">break</span>;
04962       <span class="keywordflow">case</span> <span class="charliteral">'y'</span>: {
04963         buf = <span class="keyword">new</span> T[width];
04964         pf = ptr(); pb = ptr(0,height-1);
04965         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> zv=0; zv&lt;depth*dim; zv++) {
04966           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;height/2; y++) {
04967             std::memcpy(buf,pf,width*<span class="keyword">sizeof</span>(T));
04968             std::memcpy(pf,pb,width*<span class="keyword">sizeof</span>(T));
04969             std::memcpy(pb,buf,width*<span class="keyword">sizeof</span>(T));
04970             pf+=width;
04971             pb-=width;
04972           }
04973           pf+=width*(height-height/2);
04974           pb+=width*(height+height/2);
04975         }
04976       } <span class="keywordflow">break</span>;
04977       <span class="keywordflow">case</span> <span class="charliteral">'z'</span>: {
04978         buf = <span class="keyword">new</span> T[width*height];
04979         pf = ptr(); pb = ptr(0,0,depth-1);
04980         cimg_mapV(*<span class="keyword">this</span>,v) {
04981           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0; z&lt;depth/2; z++) {
04982             std::memcpy(buf,pf,width*height*<span class="keyword">sizeof</span>(T));
04983             std::memcpy(pf,pb,width*height*<span class="keyword">sizeof</span>(T));
04984             std::memcpy(pb,buf,width*height*<span class="keyword">sizeof</span>(T));
04985             pf+=width*height;
04986             pb-=width*height;
04987           }
04988           pf+=width*height*(depth-depth/2);
04989           pb+=width*height*(depth+depth/2);
04990         }
04991       } <span class="keywordflow">break</span>;
04992       <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: {
04993         buf = <span class="keyword">new</span> T[width*height*depth];
04994         pf = ptr(); pb = ptr(0,0,0,dim-1);
04995         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v=0; v&lt;dim/2; v++) {
04996           std::memcpy(buf,pf,width*height*depth*<span class="keyword">sizeof</span>(T));
04997           std::memcpy(pf,pb,width*height*depth*<span class="keyword">sizeof</span>(T));
04998           std::memcpy(pb,buf,width*height*depth*<span class="keyword">sizeof</span>(T));
04999           pf+=width*height*depth;
05000           pb-=width*height*depth;
05001         }
05002       } <span class="keywordflow">break</span>;
05003       <span class="keywordflow">default</span>:
05004         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::flip() : unknow axe '%c', must be 'x','y','z' or 'v'"</span>,pixel_type(),axe);
05005       }
05006       <span class="keywordflow">if</span> (buf) <span class="keyword">delete</span>[] buf;
05007       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05008     }
05009 
<a name="l05011"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_54">05011</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_flip(<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z9_53">flip</a>(axe); }
05012     
<a name="l05014"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_55">05014</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; scroll(<span class="keyword">const</span> <span class="keywordtype">int</span> scrollx,<span class="keyword">const</span> <span class="keywordtype">int</span> scrolly=0,<span class="keyword">const</span> <span class="keywordtype">int</span> scrollz=0,<span class="keyword">const</span> <span class="keywordtype">int</span> scrollv=0,<span class="keyword">const</span> <span class="keywordtype">int</span> border_condition=0) {
05015       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::scroll"</span>);
05016       
05017       <span class="keywordflow">if</span> (scrollx) <span class="comment">// Scroll along X-axis</span>
05018         <span class="keywordflow">switch</span> (border_condition) {
05019         <span class="keywordflow">case</span> 0:
05020           <span class="keywordflow">if</span> (cimg::abs(scrollx)&gt;=(int)width) <span class="keywordflow">return</span> fill(0);
05021           <span class="keywordflow">if</span> (scrollx&gt;0) cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) {
05022             std::memmove(ptr(0,y,z,k),ptr(scrollx,y,z,k),(width-scrollx)*<span class="keyword">sizeof</span>(T));
05023             std::memset(ptr(width-scrollx,y,z,k),0,scrollx*<span class="keyword">sizeof</span>(T));
05024           } <span class="keywordflow">else</span> cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) {
05025             std::memmove(ptr(-scrollx,y,z,k),ptr(0,y,z,k),(width+scrollx)*<span class="keyword">sizeof</span>(T));
05026             std::memset(ptr(0,y,z,k),0,-scrollx*<span class="keyword">sizeof</span>(T));
05027           }
05028           <span class="keywordflow">break</span>;   
05029         <span class="keywordflow">case</span> 1:
05030           <span class="keywordflow">if</span> (scrollx&gt;0) {
05031             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrollx = (scrollx&gt;=(int)width)?width-1:scrollx;
05032             <span class="keywordflow">if</span> (!nscrollx) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05033             cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) {
05034               std::memmove(ptr(0,y,z,k),ptr(nscrollx,y,z,k),(width-nscrollx)*<span class="keyword">sizeof</span>(T));
05035               T *ptrd = ptr(width-1,y,z,k);
05036               <span class="keyword">const</span> T &amp;val = *ptrd;
05037               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrollx-1; l++) *(--ptrd) = val;
05038             }
05039           } <span class="keywordflow">else</span> {
05040             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrollx = (-scrollx&gt;=(int)width)?width-1:-scrollx;
05041             <span class="keywordflow">if</span> (!nscrollx) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05042             cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) {
05043               std::memmove(ptr(nscrollx,y,z,k),ptr(0,y,z,k),(width-nscrollx)*<span class="keyword">sizeof</span>(T));
05044               T *ptrd = ptr(0,y,z,k);
05045               <span class="keyword">const</span> T &amp;val = *ptrd;
05046               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrollx-1; l++) *(++ptrd) = val;
05047             }
05048           }    
05049           <span class="keywordflow">break</span>; 
05050         <span class="keywordflow">case</span> 2: {
05051           <span class="keyword">const</span> <span class="keywordtype">int</span> ml = cimg::mod(scrollx,width), nscrollx = (ml&lt;=(int)width/2)?ml:(ml-(int)width);
05052           <span class="keywordflow">if</span> (!nscrollx) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05053           T* buf = <span class="keyword">new</span> T[cimg::abs(nscrollx)];
05054           <span class="keywordflow">if</span> (nscrollx&gt;0) cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) {
05055             std::memcpy(buf,ptr(0,y,z,k),nscrollx*<span class="keyword">sizeof</span>(T));
05056             std::memmove(ptr(0,y,z,k),ptr(nscrollx,y,z,k),(width-nscrollx)*<span class="keyword">sizeof</span>(T));
05057             std::memcpy(ptr(width-nscrollx,y,z,k),buf,nscrollx*<span class="keyword">sizeof</span>(T));
05058           } <span class="keywordflow">else</span> cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) {
05059             std::memcpy(buf,ptr(width+nscrollx,y,z,k),-nscrollx*<span class="keyword">sizeof</span>(T));
05060             std::memmove(ptr(-nscrollx,y,z,k),ptr(0,y,z,k),(width+nscrollx)*<span class="keyword">sizeof</span>(T));
05061             std::memcpy(ptr(0,y,z,k),buf,-nscrollx*<span class="keyword">sizeof</span>(T));
05062           }
05063           <span class="keyword">delete</span>[] buf;
05064         } <span class="keywordflow">break</span>;
05065         }
05066 
05067       <span class="keywordflow">if</span> (scrolly) <span class="comment">// Scroll along Y-axis</span>
05068         <span class="keywordflow">switch</span> (border_condition) {
05069         <span class="keywordflow">case</span> 0:
05070           <span class="keywordflow">if</span> (cimg::abs(scrolly)&gt;=(int)height) <span class="keywordflow">return</span> fill(0);
05071           <span class="keywordflow">if</span> (scrolly&gt;0) cimg_mapZV(*<span class="keyword">this</span>,z,k) {
05072             std::memmove(ptr(0,0,z,k),ptr(0,scrolly,z,k),width*(height-scrolly)*<span class="keyword">sizeof</span>(T));
05073             std::memset(ptr(0,height-scrolly,z,k),0,width*scrolly*<span class="keyword">sizeof</span>(T));
05074           } <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,k) {
05075             std::memmove(ptr(0,-scrolly,z,k),ptr(0,0,z,k),width*(height+scrolly)*<span class="keyword">sizeof</span>(T));
05076             std::memset(ptr(0,0,z,k),0,-scrolly*width*<span class="keyword">sizeof</span>(T));
05077           }
05078           <span class="keywordflow">break</span>;      
05079         <span class="keywordflow">case</span> 1:
05080           <span class="keywordflow">if</span> (scrolly&gt;0) {
05081             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrolly = (scrolly&gt;=(int)height)?height-1:scrolly;
05082             <span class="keywordflow">if</span> (!nscrolly) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05083             cimg_mapZV(*<span class="keyword">this</span>,z,k) {
05084               std::memmove(ptr(0,0,z,k),ptr(0,nscrolly,z,k),width*(height-nscrolly)*<span class="keyword">sizeof</span>(T));
05085               T *ptrd = ptr(0,height-nscrolly,z,k), *ptrs = ptr(0,height-1,z,k);
05086               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrolly-1; l++) { std::memcpy(ptrd,ptrs,width*<span class="keyword">sizeof</span>(T)); ptrd+=width; }
05087             }
05088           } <span class="keywordflow">else</span> {
05089             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrolly = (-scrolly&gt;=(int)height)?height-1:-scrolly;
05090             <span class="keywordflow">if</span> (!nscrolly) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05091             cimg_mapZV(*<span class="keyword">this</span>,z,k) {
05092               std::memmove(ptr(0,nscrolly,z,k),ptr(0,0,z,k),width*(height-nscrolly)*<span class="keyword">sizeof</span>(T));
05093               T *ptrd = ptr(0,1,z,k), *ptrs = ptr(0,0,z,k);
05094               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrolly-1; l++) { std::memcpy(ptrd,ptrs,width*<span class="keyword">sizeof</span>(T)); ptrd+=width; }
05095             }
05096           }    
05097           <span class="keywordflow">break</span>;  
05098         <span class="keywordflow">case</span> 2: {
05099           <span class="keyword">const</span> <span class="keywordtype">int</span> ml = cimg::mod(scrolly,height), nscrolly = (ml&lt;=(int)height/2)?ml:(ml-(int)height);
05100           <span class="keywordflow">if</span> (!nscrolly) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05101           T* buf = <span class="keyword">new</span> T[width*cimg::abs(nscrolly)];
05102           <span class="keywordflow">if</span> (nscrolly&gt;0) cimg_mapZV(*<span class="keyword">this</span>,z,k) {
05103             std::memcpy(buf,ptr(0,0,z,k),width*nscrolly*<span class="keyword">sizeof</span>(T));
05104             std::memmove(ptr(0,0,z,k),ptr(0,nscrolly,z,k),width*(height-nscrolly)*<span class="keyword">sizeof</span>(T));
05105             std::memcpy(ptr(0,height-nscrolly,z,k),buf,width*nscrolly*<span class="keyword">sizeof</span>(T));
05106           } <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,k) {
05107             std::memcpy(buf,ptr(0,height+nscrolly,z,k),-nscrolly*width*<span class="keyword">sizeof</span>(T));
05108             std::memmove(ptr(0,-nscrolly,z,k),ptr(0,0,z,k),width*(height+nscrolly)*<span class="keyword">sizeof</span>(T));
05109             std::memcpy(ptr(0,0,z,k),buf,-nscrolly*width*<span class="keyword">sizeof</span>(T));
05110           }
05111           <span class="keyword">delete</span>[] buf;
05112         } <span class="keywordflow">break</span>;    
05113         }
05114 
05115       <span class="keywordflow">if</span> (scrollz) <span class="comment">// Scroll along Z-axis</span>
05116         <span class="keywordflow">switch</span> (border_condition) {
05117         <span class="keywordflow">case</span> 0:
05118           <span class="keywordflow">if</span> (cimg::abs(scrollz)&gt;=(int)depth) <span class="keywordflow">return</span> fill(0);
05119           <span class="keywordflow">if</span> (scrollz&gt;0) cimg_mapV(*<span class="keyword">this</span>,k) {
05120             std::memmove(ptr(0,0,0,k),ptr(0,0,scrollz,k),width*height*(depth-scrollz)*<span class="keyword">sizeof</span>(T));
05121             std::memset(ptr(0,0,depth-scrollz,k),0,width*height*scrollz*<span class="keyword">sizeof</span>(T));
05122           } <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) {
05123             std::memmove(ptr(0,0,-scrollz,k),ptr(0,0,0,k),width*height*(depth+scrollz)*<span class="keyword">sizeof</span>(T));
05124             std::memset(ptr(0,0,0,k),0,-scrollz*width*height*<span class="keyword">sizeof</span>(T));
05125           }
05126           <span class="keywordflow">break</span>;      
05127         <span class="keywordflow">case</span> 1:
05128           <span class="keywordflow">if</span> (scrollz&gt;0) {
05129             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrollz = (scrollz&gt;=(int)depth)?depth-1:scrollz;
05130             <span class="keywordflow">if</span> (!nscrollz) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05131             cimg_mapV(*<span class="keyword">this</span>,k) {
05132               std::memmove(ptr(0,0,0,k),ptr(0,0,nscrollz,k),width*height*(depth-nscrollz)*<span class="keyword">sizeof</span>(T));
05133               T *ptrd = ptr(0,0,depth-nscrollz,k), *ptrs = ptr(0,0,depth-1,k);
05134               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrollz-1; l++) { std::memcpy(ptrd,ptrs,width*height*<span class="keyword">sizeof</span>(T)); ptrd+=width*height; }
05135             }
05136           } <span class="keywordflow">else</span> {
05137             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrollz = (-scrollz&gt;=(int)depth)?depth-1:-scrollz;
05138             <span class="keywordflow">if</span> (!nscrollz) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05139             cimg_mapV(*<span class="keyword">this</span>,k) {
05140               std::memmove(ptr(0,0,nscrollz,k),ptr(0,0,0,k),width*height*(depth-nscrollz)*<span class="keyword">sizeof</span>(T));
05141               T *ptrd = ptr(0,0,1,k), *ptrs = ptr(0,0,0,k);
05142               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrollz-1; l++) { std::memcpy(ptrd,ptrs,width*height*<span class="keyword">sizeof</span>(T)); ptrd+=width*height; }
05143             }
05144           }    
05145           <span class="keywordflow">break</span>;      
05146         <span class="keywordflow">case</span> 2: {
05147           <span class="keyword">const</span> <span class="keywordtype">int</span> ml = cimg::mod(scrollz,depth), nscrollz = (ml&lt;=(int)depth/2)?ml:(ml-(int)depth);
05148           <span class="keywordflow">if</span> (!nscrollz) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05149           T* buf = <span class="keyword">new</span> T[width*height*cimg::abs(nscrollz)];
05150           <span class="keywordflow">if</span> (nscrollz&gt;0) cimg_mapV(*<span class="keyword">this</span>,k) {
05151             std::memcpy(buf,ptr(0,0,0,k),width*height*nscrollz*<span class="keyword">sizeof</span>(T));
05152             std::memmove(ptr(0,0,0,k),ptr(0,0,nscrollz,k),width*height*(depth-nscrollz)*<span class="keyword">sizeof</span>(T));
05153             std::memcpy(ptr(0,0,depth-nscrollz,k),buf,width*height*nscrollz*<span class="keyword">sizeof</span>(T));
05154           } <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) {
05155             std::memcpy(buf,ptr(0,0,depth+nscrollz,k),-nscrollz*width*height*<span class="keyword">sizeof</span>(T));
05156             std::memmove(ptr(0,0,-nscrollz,k),ptr(0,0,0,k),width*height*(depth+nscrollz)*<span class="keyword">sizeof</span>(T));
05157             std::memcpy(ptr(0,0,0,k),buf,-nscrollz*width*height*<span class="keyword">sizeof</span>(T));
05158           }
05159           <span class="keyword">delete</span>[] buf;
05160         } <span class="keywordflow">break</span>;    
05161         }
05162 
05163       <span class="keywordflow">if</span> (scrollv) <span class="comment">// Scroll along V-axis</span>
05164         <span class="keywordflow">switch</span> (border_condition) {
05165         <span class="keywordflow">case</span> 0:
05166           <span class="keywordflow">if</span> (cimg::abs(scrollv)&gt;=(int)dim) <span class="keywordflow">return</span> fill(0);
05167           <span class="keywordflow">if</span> (scrollv&gt;0) {
05168             std::memmove(data,ptr(0,0,0,scrollv),width*height*depth*(dim-scrollv)*<span class="keyword">sizeof</span>(T));
05169             std::memset(ptr(0,0,0,dim-scrollv),0,width*height*depth*scrollv*<span class="keyword">sizeof</span>(T));
05170           } <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) {
05171             std::memmove(ptr(0,0,0,-scrollv),data,width*height*depth*(dim+scrollv)*<span class="keyword">sizeof</span>(T));
05172             std::memset(data,0,-scrollv*width*height*depth*<span class="keyword">sizeof</span>(T));
05173           }
05174           <span class="keywordflow">break</span>;      
05175         <span class="keywordflow">case</span> 1:
05176           <span class="keywordflow">if</span> (scrollv&gt;0) {
05177             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrollv = (scrollv&gt;=(int)dim)?dim-1:scrollv;
05178             <span class="keywordflow">if</span> (!nscrollv) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05179             std::memmove(data,ptr(0,0,0,nscrollv),width*height*depth*(dim-nscrollv)*<span class="keyword">sizeof</span>(T));
05180             T *ptrd = ptr(0,0,0,dim-nscrollv), *ptrs = ptr(0,0,0,dim-1);
05181             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrollv-1; l++) { std::memcpy(ptrd,ptrs,width*height*depth*<span class="keyword">sizeof</span>(T)); ptrd+=width*height*depth; }      
05182           } <span class="keywordflow">else</span> {
05183             <span class="keyword">const</span> <span class="keywordtype">int</span> nscrollv = (-scrollv&gt;=(int)dim)?dim-1:-scrollv;
05184             <span class="keywordflow">if</span> (!nscrollv) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05185             std::memmove(ptr(0,0,0,nscrollv),data,width*height*depth*(dim-nscrollv)*<span class="keyword">sizeof</span>(T));
05186             T *ptrd = ptr(0,0,0,1);
05187             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;nscrollv-1; l++) { std::memcpy(ptrd,data,width*height*depth*<span class="keyword">sizeof</span>(T)); ptrd+=width*height*depth; }      
05188           }    
05189           <span class="keywordflow">break</span>;      
05190         <span class="keywordflow">case</span> 2: {
05191           <span class="keyword">const</span> <span class="keywordtype">int</span> ml = cimg::mod(scrollv,dim), nscrollv = (ml&lt;=(int)dim/2)?ml:(ml-(int)dim);
05192           <span class="keywordflow">if</span> (!nscrollv) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05193           T* buf = <span class="keyword">new</span> T[width*height*depth*cimg::abs(nscrollv)];
05194           <span class="keywordflow">if</span> (nscrollv&gt;0) {
05195             std::memcpy(buf,data,width*height*depth*nscrollv*<span class="keyword">sizeof</span>(T));
05196             std::memmove(data,ptr(0,0,0,nscrollv),width*height*depth*(dim-nscrollv)*<span class="keyword">sizeof</span>(T));
05197             std::memcpy(ptr(0,0,0,dim-nscrollv),buf,width*height*depth*nscrollv*<span class="keyword">sizeof</span>(T));
05198           } <span class="keywordflow">else</span> {
05199             std::memcpy(buf,ptr(0,0,0,dim+nscrollv),-nscrollv*width*height*depth*<span class="keyword">sizeof</span>(T));
05200             std::memmove(ptr(0,0,0,-nscrollv),data,width*height*depth*(dim+nscrollv)*<span class="keyword">sizeof</span>(T));
05201             std::memcpy(data,buf,-nscrollv*width*height*depth*<span class="keyword">sizeof</span>(T));
05202           }
05203           <span class="keyword">delete</span>[] buf;
05204         } <span class="keywordflow">break</span>;    
05205         }
05206 
05207       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05208     }
05209 
<a name="l05211"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_56">05211</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_scroll(<span class="keyword">const</span> <span class="keywordtype">int</span> scrollx,<span class="keyword">const</span> <span class="keywordtype">int</span> scrolly=0,<span class="keyword">const</span> <span class="keywordtype">int</span> scrollz=0,<span class="keyword">const</span> <span class="keywordtype">int</span> scrollv=0,
05212                     <span class="keyword">const</span> <span class="keywordtype">int</span> border_condition=0)<span class="keyword"> const </span>{
05213       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z9_55">scroll</a>(scrollx,scrolly,scrollz,scrollv,border_condition);
05214     }
05215     
<a name="l05217"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_57">05217</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_3dplanes(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> px0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> py0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pz0)<span class="keyword"> const </span>{
05218       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_3dplanes"</span>);
05219       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
05220         x0=(px0&gt;=width)?width-1:px0,
05221         y0=(py0&gt;=height)?height-1:py0,
05222         z0=(pz0&gt;=depth)?depth-1:pz0;
05223       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res(width+depth,height+depth,1,dim);
05224       res.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>((*<span class="keyword">this</span>)[0]);
05225       { cimg_mapXYV(*<span class="keyword">this</span>,x,y,k) res(x,y,0,k)        = (*this)(x,y,z0,k); }
05226       { cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) res(width+z,y,0,k)  = (*this)(x0,y,z,k); }
05227       { cimg_mapXZV(*<span class="keyword">this</span>,x,z,k) res(x,height+z,0,k) = (*this)(x,y0,z,k); }
05228       <span class="keywordflow">return</span> res;
05229     }
05230 
<a name="l05232"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_58">05232</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> get_histogram(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nblevels=256,<span class="keyword">const</span> T val_min=(T)0,<span class="keyword">const</span> T val_max=(T)0)<span class="keyword"> const </span>{
05233       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_histogram"</span>);
05234       <span class="keywordflow">if</span> (nblevels&lt;1) {
05235         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::get_histogram() : Can't compute an histogram with %u levels"</span>,
05236                                     pixel_type(),nblevels);
05237       }
05238       T vmin=val_min,vmax=val_max;
05239       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> res(nblevels,1,1,1,0);
05240       <span class="keywordflow">if</span> (vmin==vmax &amp;&amp; vmin==0) { <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(*<span class="keyword">this</span>,<span class="keyword">false</span>); vmin = (T)st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>; vmax = (T)st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>; }
05241       cimg_map(*<span class="keyword">this</span>,ptr,T) { <span class="keyword">const</span> <span class="keywordtype">int</span> pos = (int)((*ptr-vmin)*(nblevels-1)/(vmax-vmin)); <span class="keywordflow">if</span> (pos&gt;=0 &amp;&amp; pos&lt;(int)nblevels) res[pos]++; }
05242       <span class="keywordflow">return</span> res;
05243     }
05244 
<a name="l05246"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_59">05246</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; equalize_histogram(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nblevels=256) {
05247       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::equalize_histogram"</span>);
05248       <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(*<span class="keyword">this</span>,<span class="keyword">false</span>);
05249       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> hist = get_histogram(nblevels,(T)st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>,(T)st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>);
05250       <span class="keywordtype">float</span> cumul=0;
05251       cimg_mapX(hist,pos) { cumul+=hist[pos]; hist[pos]=cumul; }
05252       cimg_map(*<span class="keyword">this</span>,ptr,T) {
05253         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos = (<span class="keywordtype">unsigned</span> int)((*ptr-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)*nblevels/(1+st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>));
05254         *ptr = (T)(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a> + (st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)*hist[pos]/size());
05255       }
05256       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05257     }
<a name="l05259"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_60">05259</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_equalize_histogram(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nblevels=256)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z9_59">equalize_histogram</a>(nblevels); }
05260 
<a name="l05262"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_61">05262</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> get_norm_pointwise(<span class="keywordtype">int</span> ntype=2)<span class="keyword"> const </span>{
05263       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_norm_pointwise"</span>);
05264       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> res(width,height,depth);
05265       <span class="keywordflow">switch</span>(ntype) {
05266       <span class="keywordflow">case</span> -1:                <span class="comment">// Linf norm</span>
05267         {
05268           cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05269             <span class="keywordtype">float</span> n=0; cimg_mapV(*<span class="keyword">this</span>,v) {
05270               <span class="keyword">const</span> <span class="keywordtype">double</span> tmp = cimg::abs((<span class="keywordtype">double</span>)(*<span class="keyword">this</span>)(x,y,z,v));
05271               <span class="keywordflow">if</span> (tmp&gt;n) n=(float)tmp; res(x,y,z) = n;
05272             }
05273           }
05274         } <span class="keywordflow">break</span>;
05275       <span class="keywordflow">case</span> 1:               <span class="comment">// L1 norm</span>
05276         {
05277           cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05278             <span class="keywordtype">float</span> n=0; cimg_mapV(*<span class="keyword">this</span>,v) n+=cimg::abs((<span class="keywordtype">float</span>)((*<span class="keyword">this</span>)(x,y,z,v))); res(x,y,z) = n;
05279           }
05280         } <span class="keywordflow">break</span>;
05281       <span class="keywordflow">default</span>:              <span class="comment">// L2 norm</span>
05282         {
05283           cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05284             <span class="keywordtype">float</span> n=0; cimg_mapV(*<span class="keyword">this</span>,v) n+=(float)((*this)(x,y,z,v)*(*this)(x,y,z,v)); res(x,y,z) = (float)std::sqrt((<span class="keywordtype">double</span>)n);
05285           }
05286         } <span class="keywordflow">break</span>;
05287       }
05288       <span class="keywordflow">return</span> res;
05289     }
05290 
<a name="l05292"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_62">05292</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; norm_pointwise() { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(get_norm_pointwise()).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
05293 
<a name="l05295"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_63">05295</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_orientation_pointwise()<span class="keyword"> const </span>{
05296       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_orientation_pointwise"</span>);
05297       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(width,height,depth,dim);
05298       cimg_mapXYZ(dest,x,y,z) {
05299         <span class="keywordtype">float</span> n = 0;
05300         cimg_mapV(*<span class="keyword">this</span>,v) n+=(float)((*this)(x,y,z,v)*(*this)(x,y,z,v));
05301         n = (float)std::sqrt((<span class="keywordtype">double</span>)n);
05302         <span class="keywordflow">if</span> (n&gt;0) cimg_mapV(dest,v) dest(x,y,z,v)=(T)((*this)(x,y,z,v)/n); <span class="keywordflow">else</span> cimg_mapV(dest,v) dest(x,y,z,v)=0;
05303       }
05304       <span class="keywordflow">return</span> dest;
05305     }
05306 
<a name="l05308"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_64">05308</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; orientation_pointwise() { <span class="keywordflow">return</span> get_orientation_pointwise().<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
05309 
05311 
<a name="l05314"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_65">05314</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_split(<span class="keyword">const</span> <span class="keywordtype">char</span> axe,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb=0)<span class="keyword"> const </span>{
05315       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_split"</span>);
05316       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res;
05317       <span class="keywordflow">switch</span> (cimg::uncase(axe)) {
05318       <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: {
05319         res = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(nb?nb:width);
05320         cimgl_map(res,l) res[l] = get_crop(l*width/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>,0,0,0,(l+1)*width/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>-1,height-1,depth-1,dim-1);
05321         } <span class="keywordflow">break</span>;
05322       <span class="keywordflow">case</span> <span class="charliteral">'y'</span>: {
05323         res = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(nb?nb:height);
05324         cimgl_map(res,l) res[l] = get_crop(0,l*height/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>,0,0,width-1,(l+1)*height/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>-1,depth-1,dim-1);
05325         } <span class="keywordflow">break</span>;
05326       <span class="keywordflow">case</span> <span class="charliteral">'z'</span>: {
05327         res = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(nb?nb:depth);
05328         cimgl_map(res,l) res[l] = get_crop(0,0,l*depth/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>,0,width-1,height-1,(l+1)*depth/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>-1,dim-1);
05329         } <span class="keywordflow">break</span>;
05330       <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: {
05331         res = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(nb?nb:dim);
05332         cimgl_map(res,l) res[l] = get_crop(0,0,0,l*dim/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>,width-1,height-1,depth-1,(l+1)*dim/res.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>-1);
05333         } <span class="keywordflow">break</span>;
05334       <span class="keywordflow">default</span>:
05335         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::get_split() : Unknow axe '%c', must be 'x','y','z' or 'v'"</span>,pixel_type(),axe);
05336         <span class="keywordflow">break</span>;
05337       }
05338       <span class="keywordflow">return</span> res;
05339     }
05340 
05342 
<a name="l05352"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_66">05352</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_gradientXY(<span class="keyword">const</span> <span class="keywordtype">int</span> scheme=0,<span class="keyword">const</span> <span class="keywordtype">float</span> alpha=0)<span class="keyword"> const </span>{
05353       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_gradientXY"</span>);
05354       <span class="keywordflow">if</span> (alpha&lt;0) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::get_gradientXYZ() : Given blur parameter %g is negative"</span>,pixel_type(),alpha);
05355       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res(2,width,height,depth,dim);
05356       CImg_3x3(I,T);
05357       <span class="keywordflow">switch</span>(scheme) {
05358       <span class="keywordflow">case</span> -1: { <span class="comment">// backward finite differences</span>
05359         cimg_mapZV(*<span class="keyword">this</span>,z,k) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,k,I) { res[0](x,y,z,k) = Icc-Ipc; res[1](x,y,z,k) = Icc-Icp; } 
05360       } <span class="keywordflow">break</span>;
05361       <span class="keywordflow">case</span> 1: { <span class="comment">// forward finite differences</span>
05362         cimg_mapZV(*<span class="keyword">this</span>,z,k) cimg_map2x2(*<span class="keyword">this</span>,x,y,z,k,I) { res[0](x,y,0,k) = Inc-Icc; res[1](x,y,z,k) = Icn-Icc; }
05363       } <span class="keywordflow">break</span>;
05364       <span class="keywordflow">case</span> 2: { <span class="comment">// using Sobel mask</span>
05365         <span class="keyword">const</span> <span class="keywordtype">float</span> a = 1, b = 2;
05366         cimg_mapZV(*<span class="keyword">this</span>,z,k) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,k,I) {
05367           res[0](x,y,z,k) = (T)(-a*Ipp-b*Ipc-a*Ipn+a*Inp+b*Inc+a*Inn);
05368           res[1](x,y,z,k) = (T)(-a*Ipp-b*Icp-a*Inp+a*Ipn+b*Icn+a*Inn);
05369         }
05370       } <span class="keywordflow">break</span>;
05371       <span class="keywordflow">case</span> 3: { <span class="comment">// using rotation invariant mask</span>
05372         <span class="keyword">const</span> <span class="keywordtype">float</span> a = (float)(0.25*(2-std::sqrt(2.0))), b = (float)(0.5f*(std::sqrt(2.0)-1));
05373         cimg_mapZV(*<span class="keyword">this</span>,z,k) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,k,I) {
05374           res[0](x,y,z,k) = (T)(-a*Ipp-b*Ipc-a*Ipn+a*Inp+b*Inc+a*Inn);
05375           res[1](x,y,z,k) = (T)(-a*Ipp-b*Icp-a*Inp+a*Ipn+b*Icn+a*Inn);
05376         }
05377       } <span class="keywordflow">break</span>;
05378       <span class="keywordflow">case</span> 4: { <span class="comment">// using Deriche filter with low standart variation</span>
05379         res[0] = get_deriche(alpha,1,<span class="charliteral">'x'</span>);
05380         res[1] = get_deriche(alpha,1,<span class="charliteral">'y'</span>);
05381       } <span class="keywordflow">break</span>;
05382       <span class="keywordflow">default</span>: { <span class="comment">// central finite differences</span>
05383         cimg_mapZV(*<span class="keyword">this</span>,z,k) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,k,I) { 
05384           res[0](x,y,z,k) = (T)(0.5*(Inc-Ipc));
05385           res[1](x,y,z,k) = (T)(0.5*(Icn-Icp)); 
05386         } 
05387       } <span class="keywordflow">break</span>;
05388       }
05389       <span class="keywordflow">if</span> (scheme!=4 &amp;&amp; alpha&gt;0) cimgl_map(res,l) res[l].blur(alpha);
05390       <span class="keywordflow">return</span> res;
05391     }
05392 
05394 
<a name="l05397"></a><a class="code" href="structcimg__library_1_1CImg.html#z9_67">05397</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_gradientXYZ(<span class="keyword">const</span> <span class="keywordtype">int</span> scheme=0,<span class="keyword">const</span> <span class="keywordtype">float</span> alpha=0)<span class="keyword"> const </span>{
05398       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_gradientXYZ"</span>);
05399       <span class="keywordflow">if</span> (alpha&lt;0) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::get_gradientXYZ() : Given blur parameter %g is negative"</span>,pixel_type(),alpha);
05400       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res(3,width,height,depth,dim);
05401       CImg_3x3x3(I,T);
05402       <span class="keywordflow">switch</span>(scheme) {
05403       <span class="keywordflow">case</span> -1: { <span class="comment">// backward finite differences</span>
05404         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,k,I) { 
05405           res[0](x,y,z,k) = Iccc-Ipcc;
05406           res[1](x,y,z,k) = Iccc-Icpc;
05407           res[2](x,y,z,k) = Iccc-Iccp; 
05408         }
05409       } <span class="keywordflow">break</span>;
05410       <span class="keywordflow">case</span> 1: { <span class="comment">// forward finite differences</span>
05411         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,k,I) {
05412           res[0](x,y,z,k) = Incc-Iccc; 
05413           res[1](x,y,z,k) = Icnc-Iccc;
05414           res[2](x,y,z,k) = Iccn-Iccc; 
05415         } 
05416       } <span class="keywordflow">break</span>;
05417       <span class="keywordflow">case</span> 4: { <span class="comment">// using Deriche filter with low standart variation</span>
05418         res[0] = get_deriche(alpha,1,<span class="charliteral">'x'</span>);
05419         res[1] = get_deriche(alpha,1,<span class="charliteral">'y'</span>);
05420         res[2] = get_deriche(alpha,1,<span class="charliteral">'z'</span>);
05421       } <span class="keywordflow">break</span>;
05422       <span class="keywordflow">default</span>: { <span class="comment">// central finite differences</span>
05423         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,k,I) {
05424           res[0](x,y,z,k) = (T)(0.5*(Incc-Ipcc));
05425           res[1](x,y,z,k) = (T)(0.5*(Icnc-Icpc)); 
05426           res[2](x,y,z,k) = (T)(0.5*(Iccn-Iccp)); 
05427         } 
05428       } <span class="keywordflow">break</span>;
05429       }
05430       <span class="keywordflow">if</span> (scheme!=4 &amp;&amp; alpha&gt;0) cimgl_map(res,l) res[l].blur(alpha);
05431       <span class="keywordflow">return</span> res;
05432     }
05433 
05435     <span class="comment">//--------------------------------------</span>
05436     <span class="comment">//--------------------------------------</span>
05437     <span class="comment">//</span>
05439 <span class="comment"></span>
05440     <span class="comment">//--------------------------------------</span>
05441     <span class="comment">//--------------------------------------</span>
05442   
<a name="l05444"></a><a class="code" href="structcimg__library_1_1CImg.html#z11_0">05444</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; RGBtoXYZ() {
05445       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::RGBtoXYZ"</span>);
05446       <span class="keywordflow">if</span> (dim!=3) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::RGBtoXYZ() : Input image dimension is dim=%u, "</span>
05447                                               <span class="stringliteral">"should be a (R,G,B) image (dim=3)"</span>,pixel_type(),dim);
05448       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05449         <span class="keyword">const</span> T R = (*this)(x,y,z,0), G = (*this)(x,y,z,1), B = (*this)(x,y,z,2);
05450         (*this)(x,y,z,0) = (T)(0.412453*R + 0.357580*G + 0.180423*B);
05451         (*this)(x,y,z,1) = (T)(0.212671*R + 0.715160*G + 0.072169*B);
05452         (*this)(x,y,z,2) = (T)(0.019334*R + 0.119193*G + 0.950227*B);
05453       }
05454       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05455     }
05456 
<a name="l05458"></a><a class="code" href="structcimg__library_1_1CImg.html#z11_1">05458</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; XYZtoRGB() {
05459       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::XYZtoRGB"</span>);
05460       <span class="keywordflow">if</span> (dim!=3) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::XYZtoRGB() : Input image dimension is dim=%u, "</span>
05461                                               <span class="stringliteral">"should be a (X,Y,Z) image (dim=3)"</span>,pixel_type(),dim);
05462       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05463         <span class="keyword">const</span> T X = (*this)(x,y,z,0), Y = (*this)(x,y,z,1), Z = (*this)(x,y,z,2);
05464         (*this)(x,y,z,0) = (T)(3.240479*X  - 1.537150*Y - 0.498535*Z);
05465         (*this)(x,y,z,1) = (T)(-0.969256*X + 1.875992*Y + 0.041556*Z);
05466         (*this)(x,y,z,2) = (T)(0.055648*X  - 0.204043*Y + 1.057311*Z);
05467       }
05468       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05469     }
05470 
05472 <span class="preprocessor">#define cimg_Labf(x)  ((x)&gt;=0.008856?(std::pow(x,1/3.0)):(7.787*(x)+16.0/116.0))</span>
05473 <span class="preprocessor"></span><span class="preprocessor">#define cimg_Labfi(x) ((x)&gt;=0.206893?((x)*(x)*(x)):(((x)-16.0/116.0)/7.787))</span>
05474 <span class="preprocessor"></span>
05475     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; XYZtoLab() {
05476       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::XYZtoLab"</span>);
05477       <span class="keywordflow">if</span> (dim!=3) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::XYZtoLab() : Input image dimension is dim=%u, "</span>
05478                                               <span class="stringliteral">"should be a (X,Y,Z) image (dim=3)"</span>,pixel_type(),dim);
05479       <span class="keyword">const</span> <span class="keywordtype">double</span>
05480         Xn = 0.412453 + 0.357580 + 0.180423,
05481         Yn = 0.212671 + 0.715160 + 0.072169,
05482         Zn = 0.019334 + 0.119193 + 0.950227;
05483       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05484         <span class="keyword">const</span> T X = (*this)(x,y,z,0), Y = (*this)(x,y,z,1), Z = (*this)(x,y,z,2);
05485         <span class="keyword">const</span> <span class="keywordtype">double</span>
05486           XXn = X/Xn, YYn = Y/Yn, ZZn = Z/Zn,
05487           fX = cimg_Labf(XXn), fY = cimg_Labf(YYn), fZ = cimg_Labf(ZZn);
05488         (*this)(x,y,z,0) = (T)(116*fY-16);
05489         (*this)(x,y,z,1) = (T)(500*(fX-fY));
05490         (*this)(x,y,z,2) = (T)(200*(fY-fZ));
05491       }
05492       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05493     }
05494 
<a name="l05496"></a><a class="code" href="structcimg__library_1_1CImg.html#z11_3">05496</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; LabtoXYZ() {
05497       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::LabtoXYZ"</span>);
05498       <span class="keywordflow">if</span> (dim!=3) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::LabtoXYZ() : Input image dimension is dim=%u, "</span>
05499                                               <span class="stringliteral">"should be a (X,Y,Z) image (dim=3)"</span>,pixel_type(),dim);
05500       <span class="keyword">const</span> <span class="keywordtype">double</span>
05501         Xn = 0.412453 + 0.357580 + 0.180423,
05502         Yn = 0.212671 + 0.715160 + 0.072169,
05503         Zn = 0.019334 + 0.119193 + 0.950227;
05504       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05505         <span class="keyword">const</span> T L = (*this)(x,y,z,0), a = (*this)(x,y,z,1), b = (*this)(x,y,z,2);
05506         <span class="keyword">const</span> <span class="keywordtype">double</span>
05507           cY = (L+16)/116.0,
05508           Y = Yn*cimg_Labfi(cY),
05509           pY = std::pow(Y/Yn,1.0/3),
05510           cX = a/500+pY,
05511           X = Xn*cX*cX*cX,
05512           cZ = pY-b/200,
05513           Z = Zn*cZ*cZ*cZ;
05514         (*this)(x,y,z,0) = (T)(X);
05515         (*this)(x,y,z,1) = (T)(Y);
05516         (*this)(x,y,z,2) = (T)(Z);
05517       }
05518       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05519     }
05520 
<a name="l05522"></a><a class="code" href="structcimg__library_1_1CImg.html#z11_4">05522</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; XYZtoxyY() {
05523       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::XYZtoxyY()"</span>);
05524       <span class="keywordflow">if</span> (dim!=3) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::XYZtoxyY() : Input image dimension is dim=%u, "</span>
05525                                               <span class="stringliteral">"should be a (X,Y,Z) image (dim=3)"</span>,pixel_type(),dim);
05526       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05527         <span class="keyword">const</span> T X = (*this)(x,y,z,0), Y = (*this)(x,y,z,1), Z = (*this)(x,y,z,2), sum = (X+Y+Z), nsum = sum&gt;0?sum:1;
05528         (*this)(x,y,z,0) = X/nsum;
05529         (*this)(x,y,z,1) = Y/nsum;
05530         (*this)(x,y,z,2) = Y;
05531       }
05532       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05533     }
05534 
<a name="l05536"></a><a class="code" href="structcimg__library_1_1CImg.html#z11_5">05536</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; xyYtoXYZ() {
05537       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::xyYtoXYZ()"</span>);
05538       <span class="keywordflow">if</span> (dim!=3) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::xyYtoXYZ() : Input image dimension is dim=%u, "</span>
05539                                               <span class="stringliteral">"should be a (x,y,Y) image (dim=3)"</span>,pixel_type(),dim);
05540       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
05541         <span class="keyword">const</span> T px = (*this)(x,y,z,0), py = (*this)(x,y,z,1), Y = (*this)(x,y,z,2), ny = py&gt;0?py:1;
05542         (*this)(x,y,z,0) = (T)(px*Y/ny);
05543         (*this)(x,y,z,1) = Y;
05544         (*this)(x,y,z,2) = (T)((1-px-py)*Y/ny);
05545       }
05546       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05547     }
05548     
05549     <span class="comment">// Other conversions functions</span>
05550     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; RGBtoLab() { <span class="keywordflow">return</span> RGBtoXYZ().XYZtoLab(); }
05551     CImg&amp; LabtoRGB() { <span class="keywordflow">return</span> LabtoXYZ().XYZtoRGB(); }
05552     CImg&amp; RGBtoxyY() { <span class="keywordflow">return</span> RGBtoXYZ().XYZtoxyY(); }
05553     CImg&amp; xyYtoRGB() { <span class="keywordflow">return</span> xyYtoXYZ().XYZtoRGB(); }
05554 
05555     <span class="comment">// equivalent with get_*()</span>
05556     CImg get_RGBtoXYZ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).RGBtoXYZ(); }
05557     CImg get_XYZtoRGB()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).XYZtoRGB(); }
05558     CImg get_XYZtoLab()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).XYZtoLab(); }
05559     CImg get_LabtoXYZ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).LabtoXYZ(); }
05560     CImg get_XYZtoxyY()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).XYZtoxyY(); }
05561     CImg get_xyYtoXYZ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).xyYtoXYZ(); }
05562     CImg get_RGBtoLab()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).RGBtoLab(); }
05563     CImg get_LabtoRGB()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).LabtoRGB(); }
05564     CImg get_RGBtoxyY()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).RGBtoxyY(); }
05565     CImg get_xyYtoRGB()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> CImg&lt;T&gt;(*this).xyYtoRGB(); }
05566 
05568     <span class="comment">//--------------------------------------</span>
05569     <span class="comment">//--------------------------------------</span>
05570     <span class="comment">//</span>
05572 <span class="comment"></span>
05573     <span class="comment">//--------------------------------------</span>
05574     <span class="comment">//--------------------------------------</span>
05575 
05576     <span class="comment">// Should be used only by member functions. Not an user-friendly function.</span>
05577     <span class="comment">// Pre-requisites : x0&lt;x1, y-coordinate is valid, col is valid.</span>
05578     CImg&amp; draw_scanline(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1,
05579                        <span class="keyword">const</span> <span class="keywordtype">bool</span> init=<span class="keyword">false</span>) {
05580       <span class="keyword">static</span> <span class="keywordtype">float</span> nopacity=0, copacity=0;
05581       <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> whz=0;
05582       <span class="keyword">static</span> <span class="keyword">const</span> T* col = NULL;
05583       <span class="keywordflow">if</span> (init) {
05584         cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_scanline"</span>);
05585         <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> CImgArgumentException(<span class="stringliteral">"CImg&lt;%s&gt;::draw_scanline() : specified color is (null)"</span>,pixel_type());
05586         nopacity = cimg::abs(opacity);
05587         copacity = 1-cimg::max(opacity,0.0f); 
05588         whz = width*height*depth;
05589         col = color;
05590       } <span class="keywordflow">else</span> {
05591         <span class="keyword">const</span> <span class="keywordtype">int</span> nx0 = cimg::max(x0,0), nx1 = cimg::min(x1,(<span class="keywordtype">int</span>)width-1), dx = nx1-nx0;
05592         T *ptrd = ptr(nx0,y,0,0);
05593         <span class="keywordflow">if</span> (dx&gt;=0) {
05594           <span class="keywordflow">if</span> (opacity&gt;=1) {
05595             <span class="keywordtype">int</span> off = whz-dx-1;
05596             <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(T)!=1) cimg_mapV(*<span class="keyword">this</span>,k) {
05597               <span class="keyword">const</span> T&amp; val = *(col++);
05598               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=dx; x&gt;=0; x--) *(ptrd++)=val;
05599               ptrd+=off;
05600             } <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) { std::memset(ptrd,(<span class="keywordtype">int</span>)*(col++),dx+1); ptrd+=whz; }
05601             col-=dim;
05602           } <span class="keywordflow">else</span> {
05603             <span class="keywordtype">int</span> off = whz-dx-1;
05604             cimg_mapV(*<span class="keyword">this</span>,k) {
05605               <span class="keyword">const</span> T&amp; val = *(col++);
05606               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=dx; x&gt;=0; x--) { *ptrd = (T)(val*nopacity + *ptrd*copacity); ptrd++; }
05607               ptrd+=off;
05608             }
05609             col-=dim;
05610           }
05611         }
05612       }
05613       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05614     }
05615     
05616     CImg&amp; draw_scanline(<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) { <span class="keywordflow">return</span> draw_scanline(0,0,0,color,opacity,<span class="keyword">true</span>); }
05617 
05619 
<a name="l05627"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_2">05627</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_point(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0,
05628                      <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05629       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_point"</span>);
05630       <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_point() : specified color is (null)"</span>,pixel_type());
05631       <span class="keywordflow">if</span> (x0&gt;=0 &amp;&amp; y0&gt;=0 &amp;&amp; z0&gt;=0 &amp;&amp; x0&lt;dimx() &amp;&amp; y0&lt;dimy() &amp;&amp; z0&lt;dimz()) {
05632         <span class="keyword">const</span> T *col=color;
05633         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> whz = width*height*depth;
05634         <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
05635         T *ptrd = ptr(x0,y0,z0,0);
05636         <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = *(col++); ptrd+=whz; }
05637         <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd=(T)(*(col++)*nopacity + *ptrd*copacity); ptrd+=whz; }
05638       }
05639       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05640     }
05641 
05643 
<a name="l05650"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_3">05650</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_point(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) { 
05651       <span class="keywordflow">return</span> draw_point(x0,y0,0,color,opacity); 
05652     }
05653 
05655 
<a name="l05665"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_4">05665</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_line(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
05666                     <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern=~0L,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05667       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_line"</span>); 
05668       <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_line() : specified color is (null)"</span>,pixel_type());
05669       <span class="keyword">const</span> T* col=color;
05670       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hatch=1;     
05671       <span class="keywordtype">int</span> nx0=x0, nx1=x1, ny0=y0, ny1=y1;
05672       <span class="keywordflow">if</span> (nx0&gt;nx1) cimg::swap(nx0,nx1,ny0,ny1);
05673       <span class="keywordflow">if</span> (nx1&lt;0 || nx0&gt;=dimx()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05674       <span class="keywordflow">if</span> (nx0&lt;0) { ny0-=nx0*(ny1-ny0)/(nx1-nx0); nx0=0; }
05675       <span class="keywordflow">if</span> (nx1&gt;=dimx()) { ny1+=(nx1-dimx())*(ny0-ny1)/(nx1-nx0); nx1=dimx()-1;}
05676       <span class="keywordflow">if</span> (ny0&gt;ny1) cimg::swap(nx0,nx1,ny0,ny1);
05677       <span class="keywordflow">if</span> (ny1&lt;0 || ny0&gt;=dimy()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05678       <span class="keywordflow">if</span> (ny0&lt;0) { nx0-=ny0*(nx1-nx0)/(ny1-ny0); ny0=0; }
05679       <span class="keywordflow">if</span> (ny1&gt;=dimy()) { nx1+=(ny1-dimy())*(nx0-nx1)/(ny1-ny0); ny1=dimy()-1;}
05680       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmax = (<span class="keywordtype">unsigned</span> int)cimg::max(cimg::abs(nx1-nx0),ny1-ny0), whz = width*height*depth;
05681       <span class="keyword">const</span> <span class="keywordtype">float</span> px = dmax?(nx1-nx0)/(float)dmax:0, py = dmax?(ny1-ny0)/(float)dmax:0;
05682       <span class="keywordtype">float</span> x = (float)nx0, y = (float)ny0;
05683       <span class="keywordflow">if</span> (opacity&gt;=1) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt;=dmax; t++) {
05684         <span class="keywordflow">if</span> (!(~pattern) || (~pattern &amp;&amp; pattern&amp;hatch)) {
05685           T* ptrd = ptr((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)x,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)y,0,0);      
05686           cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd=*(col++); ptrd+=whz; }
05687           col-=dim;
05688         }
05689         x+=px; y+=py; <span class="keywordflow">if</span> (pattern) hatch=(hatch&lt;&lt;1)+(hatch&gt;&gt;(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int)*8-1));
05690       } <span class="keywordflow">else</span> {
05691         <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity=1-cimg::max(opacity,0.0f);
05692         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt;=dmax; t++) {
05693           <span class="keywordflow">if</span> (!(~pattern) || (~pattern &amp;&amp; pattern&amp;hatch)) {
05694             T* ptrd = ptr((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)x,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)y,0,0);
05695             cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(*(col++)*nopacity + copacity*(*ptrd)); ptrd+=whz; }
05696             col-=dim;
05697           }
05698           x+=px; y+=py; <span class="keywordflow">if</span> (pattern) hatch=(hatch&lt;&lt;1)+(hatch&gt;&gt;(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int)*8-1));
05699         }
05700       }
05701       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05702     }
05703   
05705 
<a name="l05717"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_5">05717</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_line(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">int</span> z1,
05718                     <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern=~0L,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05719       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_line"</span>); 
05720       <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_line() : specified color is (null)"</span>,pixel_type());
05721       <span class="keyword">const</span> T* col=color;
05722       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hatch=1;
05723       <span class="keywordtype">int</span> nx0=x0, ny0=y0, nz0=z0, nx1=x1, ny1=y1, nz1=z1;
05724       <span class="keywordflow">if</span> (nx0&gt;nx1) cimg::swap(nx0,nx1,ny0,ny1,nz0,nz1);
05725       <span class="keywordflow">if</span> (nx1&lt;0 || nx0&gt;=dimx()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05726       <span class="keywordflow">if</span> (nx0&lt;0) { <span class="keyword">const</span> <span class="keywordtype">int</span> D=nx1-nx0; ny0-=nx0*(ny1-ny0)/D; nz0-=nx0*(nz1-nz0)/D; nx0=0; }
05727       <span class="keywordflow">if</span> (nx1&gt;=dimx()) { <span class="keyword">const</span> <span class="keywordtype">int</span> d=nx1-dimx(), D=nx1-nx0; ny1+=d*(ny0-ny1)/D; nz1+=d*(nz0-nz1)/D; nx1=dimx()-1;}
05728       <span class="keywordflow">if</span> (ny0&gt;ny1) cimg::swap(nx0,nx1,ny0,ny1,nz0,nz1);
05729       <span class="keywordflow">if</span> (ny1&lt;0 || ny0&gt;=dimy()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05730       <span class="keywordflow">if</span> (ny0&lt;0) { <span class="keyword">const</span> <span class="keywordtype">int</span> D=ny1-ny0; nx0-=ny0*(nx1-nx0)/D; nz0-=ny0*(nz1-nz0)/D; ny0=0; }
05731       <span class="keywordflow">if</span> (ny1&gt;=dimy()) { <span class="keyword">const</span> <span class="keywordtype">int</span> d=ny1-dimy(), D=ny1-ny0; nx1+=d*(nx0-nx1)/D; nz1+=d*(nz0-nz1)/D; ny1=dimy()-1;}
05732       <span class="keywordflow">if</span> (nz0&gt;nz1) cimg::swap(nx0,nx1,ny0,ny1,nz0,nz1);
05733       <span class="keywordflow">if</span> (nz1&lt;0 || nz0&gt;=dimz()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05734       <span class="keywordflow">if</span> (nz0&lt;0) { <span class="keyword">const</span> <span class="keywordtype">int</span> D=nz1-nz0; nx0-=nz0*(nx1-nx0)/D; ny0-=nz0*(ny1-ny0)/D; nz0=0; }
05735       <span class="keywordflow">if</span> (nz1&gt;=dimz()) { <span class="keyword">const</span> <span class="keywordtype">int</span> d=nz1-dimz(), D=nz1-nz0; nx1+=d*(nx0-nx1)/D; ny1+=d*(ny0-ny1)/D; nz1=dimz()-1;}
05736       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmax = (<span class="keywordtype">unsigned</span> int)cimg::max(cimg::abs(nx1-nx0),cimg::abs(ny1-ny0),nz1-nz0), whz = width*height*depth;
05737       <span class="keyword">const</span> <span class="keywordtype">float</span> px = dmax?(nx1-nx0)/(float)dmax:0, py = dmax?(ny1-ny0)/(float)dmax:0, pz = dmax?(nz1-nz0)/(float)dmax:0;
05738       <span class="keywordtype">float</span> x = (float)nx0, y = (float)ny0, z = (float)nz0;
05739       <span class="keywordflow">if</span> (opacity&gt;=1) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt;=dmax; t++) { 
05740         <span class="keywordflow">if</span> (!(~pattern) || (~pattern &amp;&amp; pattern&amp;hatch)) {
05741           T* ptrd = ptr((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)x,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)y,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)z,0);
05742           cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd=*(col++); ptrd+=whz; }        
05743           col-=dim; 
05744         }
05745         x+=px; y+=py; z+=pz; <span class="keywordflow">if</span> (pattern) hatch=(hatch&lt;&lt;1)+(hatch&gt;&gt;(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int)*8-1));
05746       } <span class="keywordflow">else</span> {
05747         <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
05748         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t=0; t&lt;=dmax; t++) { 
05749           <span class="keywordflow">if</span> (!(~pattern) || (~pattern &amp;&amp; pattern&amp;hatch)) {
05750             T* ptrd = ptr((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)x,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)y,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)z,0);
05751             cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(*(col++)*nopacity + copacity*(*ptrd)); ptrd+=whz; }
05752             col-=dim; 
05753           }
05754           x+=px; y+=py; z+=pz; <span class="keywordflow">if</span> (pattern) hatch=(hatch&lt;&lt;1)+(hatch&gt;&gt;(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int)*8-1));        
05755         }
05756       }
05757       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05758     }
05759 
05761 
<a name="l05774"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_6">05774</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_line(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
05775                                          <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; texture,
05776                                          <span class="keyword">const</span> <span class="keywordtype">int</span> tx0,<span class="keyword">const</span> <span class="keywordtype">int</span> ty0,<span class="keyword">const</span> <span class="keywordtype">int</span> tx1,<span class="keyword">const</span> <span class="keywordtype">int</span> ty1,
05777                                          <span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05778       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_line"</span>); 
05779       cimg_test(texture,<span class="stringliteral">"CImg&lt;T&gt;::draw_line"</span>);
05780       <span class="keywordflow">if</span> (texture.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>&lt;dim)
05781         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_line() : texture has %u channel while image has %u channels"</span>,texture.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,dim);
05782       <span class="keywordtype">int</span> nx0=x0, ny0=y0, nx1=x1, ny1=y1, ntx0=tx0, nty0=ty0, ntx1=tx1, nty1=ty1;
05783       <span class="keywordflow">if</span> (nx0&gt;nx1) cimg::swap(nx0,nx1,ny0,ny1,ntx0,ntx1,nty0,nty1);
05784       <span class="keywordflow">if</span> (nx1&lt;0 || nx0&gt;=dimx()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05785       <span class="keywordflow">if</span> (nx0&lt;0) { <span class="keyword">const</span> <span class="keywordtype">int</span> D=nx1-nx0; ny0-=nx0*(ny1-ny0)/D; ntx0-=nx0*(ntx1-ntx0)/D; nty0-=nx0*(nty1-nty0)/D; nx0=0; }
05786       <span class="keywordflow">if</span> (nx1&gt;=dimx()) { <span class="keyword">const</span> <span class="keywordtype">int</span> d=nx1-dimx(),D=nx1-nx0; ny1+=d*(ny0-ny1)/D; ntx1+=d*(ntx0-ntx1)/D; nty1+=d*(nty0-nty1)/D; nx1=dimx()-1; }
05787       <span class="keywordflow">if</span> (ny0&gt;ny1) cimg::swap(nx0,nx1,ny0,ny1,ntx0,ntx1,nty0,nty1);
05788       <span class="keywordflow">if</span> (ny1&lt;0 || ny0&gt;=dimy()) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05789       <span class="keywordflow">if</span> (ny0&lt;0) { <span class="keyword">const</span> <span class="keywordtype">int</span> D=ny1-ny0; nx0-=ny0*(nx1-nx0)/D; ntx0-=ny0*(ntx1-ntx0)/D; nty0-=ny0*(nty1-nty0)/D; ny0=0; }
05790       <span class="keywordflow">if</span> (ny1&gt;=dimy()) { <span class="keyword">const</span> <span class="keywordtype">int</span> d=ny1-dimy(),D=ny1-ny0; nx1+=d*(nx0-nx1)/D; ntx1+=d*(ntx0-ntx1)/D; nty1+=d*(nty0-nty1)/D; ny1=dimy()-1; }
05791       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmax = (<span class="keywordtype">unsigned</span> int)cimg::max(cimg::abs(nx1-nx0),ny1-ny0), 
05792         whz = width*height*depth, twhz = texture.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*texture.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*texture.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>;
05793       <span class="keyword">const</span> <span class="keywordtype">float</span> px = dmax?(nx1-nx0)/(float)dmax:0, py = dmax?(ny1-ny0)/(float)dmax:0,
05794         tpx = dmax?(ntx1-ntx0)/(float)dmax:0, tpy = dmax?(nty1-nty0)/(float)dmax:0;
05795       <span class="keywordtype">float</span> x = (float)nx0, y = (float)ny0, tx = (float)ntx0, ty = (float)nty0;
05796       <span class="keywordflow">if</span> (opacity&gt;=1) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tt=0; tt&lt;=dmax; tt++) { 
05797         T *ptrd = ptr((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)x,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)y,0,0);
05798         t *ptrs = texture.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tx,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ty,0,0);
05799         cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(*ptrs); ptrd+=whz; ptrs+=twhz; }
05800         x+=px; y+=py; tx+=tpx; ty+=tpy;
05801       } <span class="keywordflow">else</span> {
05802         <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
05803         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tt=0; tt&lt;=dmax; tt++) { 
05804           T *ptrd = ptr((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)x,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)y,0,0);
05805           t *ptrs = texture.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tx,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ty,0,0);
05806           cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(nopacity*(*ptrs) + copacity*(*ptrd)); ptrd+=whz; ptrs+=twhz; }
05807           x+=px; y+=py; tx+=tpx; ty+=tpy;
05808         }
05809       }
05810       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05811     }
05812 
05814 
<a name="l05826"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_7">05826</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_arrow(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
05827                      <span class="keyword">const</span> T *<span class="keyword">const</span> color,
05828                      <span class="keyword">const</span> <span class="keywordtype">float</span> angle=30,<span class="keyword">const</span> <span class="keywordtype">float</span> length=-10,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern=~0L,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05829       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_arrow"</span>);
05830       <span class="keyword">const</span> <span class="keywordtype">float</span> u = (float)(x0-x1), v = (float)(y0-y1), sq = u*u+v*v,
05831         deg = (float)(angle*cimg::PI/180), ang = (sq&gt;0)?(float)std::atan2(v,u):0.0f,
05832         l = (length&gt;=0)?length:-length*(float)std::sqrt(sq)/100;
05833       <span class="keywordflow">if</span> (sq&gt;0) {
05834         <span class="keyword">const</span> <span class="keywordtype">double</span> cl = std::cos(ang-deg), sl = std::sin(ang-deg), cr = std::cos(ang+deg), sr = std::sin(ang+deg);        
05835         <span class="keyword">const</span> <span class="keywordtype">int</span> 
05836           xl = x1+(int)(l*cl), yl = y1+(int)(l*sl),
05837           xr = x1+(int)(l*cr), yr = y1+(int)(l*sr),
05838           xc = x1+(int)((l+1)*(cl+cr))/2, yc = y1+(int)((l+1)*(sl+sr))/2;
05839         draw_line(x0,y0,xc,yc,color,pattern,opacity).<a class="code" href="structcimg__library_1_1CImg.html#z13_14">draw_triangle</a>(x1,y1,xl,yl,xr,yr,color,opacity);
05840       } <span class="keywordflow">else</span> draw_point(x0,y0,color,opacity);
05841       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05842     }
05843 
05845 
<a name="l05854"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_8">05854</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_image(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; sprite,
05855                                           <span class="keyword">const</span> <span class="keywordtype">int</span> x0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v0=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05856       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05857       cimg_test(sprite,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05858       <span class="keyword">const</span> <span class="keywordtype">bool</span> bx=(x0&lt;0), by=(y0&lt;0), bz=(z0&lt;0), bv=(v0&lt;0);
05859       <span class="keyword">const</span> <span class="keywordtype">int</span> 
05860         lX = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>() - (x0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()&gt;dimx()?x0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()-dimx():0) + (bx?x0:0),
05861         lY = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>() - (y0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()&gt;dimy()?y0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()-dimy():0) + (by?y0:0),
05862         lZ = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>() - (z0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>()&gt;dimz()?z0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>()-dimz():0) + (bz?z0:0),
05863         lV = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_4">dimv</a>() - (v0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_4">dimv</a>()&gt;dimv()?v0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_4">dimv</a>()-dimv():0) + (bv?v0:0);
05864       <span class="keyword">const</span> t *ptrs = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>()-(bx?x0:0)-(by?y0*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>():0)+(bz?z0*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>():0)+
05865         (bv?v0*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>():0);
05866       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
05867         offX = width-lX, soffX = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>-lX,
05868         offY = width*(height-lY), soffY = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*(sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-lY),
05869         offZ = width*height*(depth-lZ), soffZ = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*(sprite.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>-lZ);
05870       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
05871       T *ptrd = ptr(x0&lt;0?0:x0,y0&lt;0?0:y0,z0&lt;0?0:z0,v0&lt;0?0:v0);
05872       <span class="keywordflow">if</span> (lX&gt;0 &amp;&amp; lY&gt;0 &amp;&amp; lZ&gt;0 &amp;&amp; lV&gt;0)
05873         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;lV; v++) {
05874           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=0; z&lt;lZ; z++) {
05875             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;lY; y++) {
05876               <span class="keywordflow">if</span> (opacity&gt;=1) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;lX; x++) *(ptrd++) = (T)(*(ptrs++));
05877               <span class="keywordflow">else</span> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;lX; x++) { *ptrd = (T)(nopacity*(*(ptrs++)) + copacity*(*ptrd)); ptrd++; }
05878               ptrd+=offX; ptrs+=soffX;
05879             }
05880             ptrd+=offY; ptrs+=soffY;
05881           }
05882           ptrd+=offZ; ptrs+=soffZ;
05883         }
05884       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05885     }
05886 
05887     <span class="comment">// Add template overloading for VC++&gt;=7.1</span>
05888 <span class="preprocessor">#if ( !defined(_MSC_VER) || _MSC_VER&gt;1300 )</span>
05889 <span class="preprocessor"></span>    <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_image(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; sprite,<span class="keyword">const</span> <span class="keywordtype">int</span> x0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v0=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05890       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05891       cimg_test(sprite,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05892       <span class="keywordflow">if</span> (<span class="keyword">this</span>==&amp;sprite) <span class="keywordflow">return</span> draw_image(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(sprite),x0,y0,z0,v0,opacity);
05893       <span class="keyword">const</span> <span class="keywordtype">bool</span> bx=(x0&lt;0), by=(y0&lt;0), bz=(z0&lt;0), bv=(v0&lt;0);
05894       <span class="keyword">const</span> <span class="keywordtype">int</span> 
05895         lX = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>() - (x0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()&gt;dimx()?x0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()-dimx():0) + (bx?x0:0),
05896         lY = sprite.dimy() - (y0+sprite.dimy()&gt;dimy()?y0+sprite.dimy()-dimy():0) + (by?y0:0),
05897         lZ = sprite.dimz() - (z0+sprite.dimz()&gt;dimz()?z0+sprite.dimz()-dimz():0) + (bz?z0:0),
05898         lV = sprite.dimv() - (v0+sprite.dimv()&gt;dimv()?v0+sprite.dimv()-dimv():0) + (bv?v0:0);
05899       <span class="keyword">const</span> T *ptrs = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>()-(bx?x0:0)-(by?y0*sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>():0)+(bz?z0*sprite.dimx()*sprite.dimy():0)+
05900         (bv?v0*sprite.dimx()*sprite.dimy()*sprite.dimz():0);
05901       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
05902         offX = width-lX, soffX = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>-lX,
05903         offY = width*(height-lY), soffY = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*(sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-lY),
05904         offZ = width*height*(depth-lZ), soffZ = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*(sprite.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>-lZ),
05905         slX = lX*<span class="keyword">sizeof</span>(T);    
05906       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
05907       T *ptrd = ptr(x0&lt;0?0:x0,y0&lt;0?0:y0,z0&lt;0?0:z0,v0&lt;0?0:v0);
05908       <span class="keywordflow">if</span> (lX&gt;0 &amp;&amp; lY&gt;0 &amp;&amp; lZ&gt;0 &amp;&amp; lV&gt;0)
05909         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;lV; v++) {
05910           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=0; z&lt;lZ; z++) {
05911             <span class="keywordflow">if</span> (opacity&gt;=1) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;lY; y++) { std::memcpy(ptrd,ptrs,slX); ptrd+=width; ptrs+=sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; }
05912             <span class="keywordflow">else</span> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;lY; y++) {
05913               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;lX; x++) { *ptrd = (T)(nopacity*(*(ptrs++)) + copacity*(*ptrd)); ptrd++; }
05914               ptrd+=offX; ptrs+=soffX;
05915             }
05916             ptrd+=offY; ptrs+=soffY;
05917           }
05918           ptrd+=offZ; ptrs+=soffZ;
05919         }
05920       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05921     }
05922 <span class="preprocessor">#endif</span>
05923 <span class="preprocessor"></span>
05925 
<a name="l05938"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_10">05938</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> ti,<span class="keyword">typename</span> tm&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_image(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;ti&gt;</a>&amp; sprite,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;tm&gt;</a>&amp; mask,
05939                                                        <span class="keyword">const</span> <span class="keywordtype">int</span> x0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0=0,<span class="keyword">const</span> <span class="keywordtype">int</span> v0=0,
05940                                                        <span class="keyword">const</span> tm mask_valmax=1,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
05941       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05942       cimg_test(sprite,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05943       cimg_test(mask,<span class="stringliteral">"CImg&lt;T&gt;::draw_image"</span>);
05944       <span class="keywordflow">if</span> ((<span class="keywordtype">void</span>*)<span class="keyword">this</span>==(<span class="keywordtype">void</span>*)&amp;sprite) <span class="keywordflow">return</span> draw_image(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(sprite),mask,x0,y0,z0,v0);
05945       <span class="keywordflow">if</span>(mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> || mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> || mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=sprite.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>)
05946         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_image() : mask dimension is (%u,%u,%u,%u), while sprite is (%u,%u,%u,%u)"</span>,
05947                                     pixel_type(),mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,mask.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,sprite.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,sprite.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
05948       <span class="keyword">const</span> <span class="keywordtype">bool</span> bx=(x0&lt;0), by=(y0&lt;0), bz=(z0&lt;0), bv=(v0&lt;0);
05949       <span class="keyword">const</span> <span class="keywordtype">int</span>
05950         lX = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>() - (x0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()&gt;dimx()?x0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()-dimx():0) + (bx?x0:0),
05951         lY = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>() - (y0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()&gt;dimy()?y0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()-dimy():0) + (by?y0:0),
05952         lZ = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>() - (z0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>()&gt;dimz()?z0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>()-dimz():0) + (bz?z0:0),      
05953         lV = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_4">dimv</a>() - (v0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_4">dimv</a>()&gt;dimv()?v0+sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_4">dimv</a>()-dimv():0) + (bv?v0:0);    
05954       <span class="keyword">const</span> <span class="keywordtype">int</span> coff = -(bx?x0:0)-(by?y0*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>():0)-(bz?z0*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>():0)-
05955         (bv?v0*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>():0),
05956         ssize = mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_1">dimx</a>()*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()*mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_3">dimz</a>();
05957       <span class="keyword">const</span> ti *ptrs = sprite.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>() + coff;
05958       <span class="keyword">const</span> tm *ptrm = mask.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>() + coff;
05959       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
05960         offX = width-lX, soffX = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>-lX,
05961         offY = width*(height-lY), soffY = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*(sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-lY),
05962         offZ = width*height*(depth-lZ), soffZ = sprite.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*sprite.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*(sprite.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>-lZ);
05963       T *ptrd = ptr(x0&lt;0?0:x0,y0&lt;0?0:y0,z0&lt;0?0:z0,v0&lt;0?0:v0);
05964       <span class="keywordflow">if</span> (lX&gt;0 &amp;&amp; lY&gt;0 &amp;&amp; lZ&gt;0 &amp;&amp; lV&gt;0)
05965         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;lV; v++) {
05966           ptrm = mask.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> + (ptrm - mask.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>)%ssize;
05967           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=0; z&lt;lZ; z++) {
05968             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;lY; y++) {
05969               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;lX; x++) {
05970                 <span class="keyword">const</span> <span class="keywordtype">float</span> mopacity = *(ptrm++)*opacity,
05971                   nopacity = cimg::abs(mopacity), copacity = mask_valmax-cimg::max(mopacity,0.0f);
05972                 *ptrd = (T)((nopacity*(*(ptrs++))+copacity*(*ptrd))/mask_valmax);
05973                 ptrd++;
05974               }
05975               ptrd+=offX; ptrs+=soffX; ptrm+=soffX;
05976             }
05977             ptrd+=offY; ptrs+=soffY; ptrm+=soffY;
05978           }
05979           ptrd+=offZ; ptrs+=soffZ; ptrm+=soffZ;
05980         }
05981       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
05982     }
05983 
05985 
<a name="l05998"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_11">05998</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_rectangle(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0,<span class="keyword">const</span> <span class="keywordtype">int</span> v0,
05999                          <span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">int</span> z1,<span class="keyword">const</span> <span class="keywordtype">int</span> v1,
06000                          <span class="keyword">const</span> T&amp; val,<span class="keywordtype">float</span> opacity=1) {
06001       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_rectangle"</span>);
06002       <span class="keyword">const</span> <span class="keywordtype">bool</span> bx=(x0&lt;x1), by=(y0&lt;y1), bz=(z0&lt;z1), bv=(v0&lt;v1);
06003       <span class="keyword">const</span> <span class="keywordtype">int</span> nx0=bx?x0:x1, nx1=bx?x1:x0, ny0=by?y0:y1, ny1=by?y1:y0, nz0=bz?z0:z1, nz1=bz?z1:z0, nv0=bv?v0:v1, nv1=bv?v1:v0;
06004       <span class="keyword">const</span> <span class="keywordtype">int</span> 
06005         lX = (1+nx1-nx0) + (nx1&gt;=dimx()?dimx()-1-nx1:0) + (nx0&lt;0?nx0:0),
06006         lY = (1+ny1-ny0) + (ny1&gt;=dimy()?dimy()-1-ny1:0) + (ny0&lt;0?ny0:0),
06007         lZ = (1+nz1-nz0) + (nz1&gt;=dimz()?dimz()-1-nz1:0) + (nz0&lt;0?nz0:0),
06008         lV = (1+nv1-nv0) + (nv1&gt;=dimv()?dimv()-1-nv1:0) + (nv0&lt;0?nv0:0);
06009       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offX = width-lX, offY = width*(height-lY), offZ = width*height*(depth-lZ);
06010       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06011       T *ptrd = ptr(nx0&lt;0?0:nx0,ny0&lt;0?0:ny0,nz0&lt;0?0:nz0,nv0&lt;0?0:nv0);
06012       <span class="keywordflow">if</span> (lX&gt;0 &amp;&amp; lY&gt;0 &amp;&amp; lZ&gt;0 &amp;&amp; lV&gt;0)
06013         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;lV; v++) {
06014           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=0; z&lt;lZ; z++) {
06015             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;lY; y++) {
06016               <span class="keywordflow">if</span> (opacity&gt;=1) {
06017                 <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(T)!=1) { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;lX; x++) *(ptrd++) = val; ptrd+=offX; }
06018                 <span class="keywordflow">else</span> { std::memset(ptrd,(<span class="keywordtype">int</span>)val,lX); ptrd+=width; }
06019               } <span class="keywordflow">else</span> { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;lX; x++) { *ptrd = (T)(nopacity*val+copacity*(*ptrd)); ptrd++; } ptrd+=offX; }
06020             }
06021             ptrd+=offY;
06022           }
06023           ptrd+=offZ;
06024         }  
06025       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06026     }
06027 
06029 
<a name="l06040"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_12">06040</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_rectangle(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> z0,
06041                          <span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,<span class="keyword">const</span> <span class="keywordtype">int</span> z1,
06042                          <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06043       <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_rectangle : specified color is (null)"</span>,pixel_type());
06044       cimg_mapV(*<span class="keyword">this</span>,k) draw_rectangle(x0,y0,z0,k,x1,y1,z1,k,color[k],opacity);
06045       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06046     }
06047 
06049 
<a name="l06058"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_13">06058</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_rectangle(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
06059                          <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06060       draw_rectangle(x0,y0,0,x1,y1,depth-1,color,opacity);
06061       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06062     }
06063   
06065 
<a name="l06076"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_14">06076</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_triangle(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,
06077                         <span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
06078                         <span class="keyword">const</span> <span class="keywordtype">int</span> x2,<span class="keyword">const</span> <span class="keywordtype">int</span> y2,
06079                         <span class="keyword">const</span> T *<span class="keyword">const</span> color, <span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06080       draw_scanline(color,opacity);
06081       <span class="keywordtype">int</span> nx0=x0,ny0=y0,nx1=x1,ny1=y1,nx2=x2,ny2=y2;
06082       <span class="keywordflow">if</span> (ny0&gt;ny1) cimg::swap(nx0,nx1,ny0,ny1);
06083       <span class="keywordflow">if</span> (ny0&gt;ny2) cimg::swap(nx0,nx2,ny0,ny2);
06084       <span class="keywordflow">if</span> (ny1&gt;ny2) cimg::swap(nx1,nx2,ny1,ny2);
06085       <span class="keywordflow">if</span> (ny0&gt;=dimy() || ny2&lt;0) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06086       <span class="keyword">const</span> <span class="keywordtype">float</span> 
06087         p1 = (ny1-ny0)?(nx1-nx0)/(float)(ny1-ny0):(nx1-nx0),
06088         p2 = (ny2-ny0)?(nx2-nx0)/(float)(ny2-ny0):(nx2-nx0),
06089         p3 = (ny2-ny1)?(nx2-nx1)/(float)(ny2-ny1):(nx2-nx1);
06090       <span class="keywordtype">float</span> xleft = (float)nx0, xright = xleft, pleft = (p1&lt;p2)?p1:p2, pright = (p1&lt;p2)?p2:p1;
06091       <span class="keywordflow">if</span> (ny0&lt;0) { xleft-=ny0*pleft; xright-=ny0*pright; }
06092       <span class="keyword">const</span> <span class="keywordtype">int</span> ya = ny1&gt;dimy()?height:ny1;
06093       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=ny0&lt;0?0:ny0; y&lt;ya; y++) { draw_scanline((<span class="keywordtype">int</span>)xleft,(<span class="keywordtype">int</span>)xright,y,color,opacity); xleft+=pleft; xright+=pright; }
06094       <span class="keywordflow">if</span> (p1&lt;p2) { xleft=(float)nx1;  pleft=p3;  <span class="keywordflow">if</span> (ny1&lt;0) xleft-=ny1*pleft; } 
06095       <span class="keywordflow">else</span>       { xright=(float)nx1; pright=p3; <span class="keywordflow">if</span> (ny1&lt;0) xright-=ny1*pright; }
06096       <span class="keyword">const</span> <span class="keywordtype">int</span> yb = ny2&gt;=dimy()?height-1:ny2;
06097       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> yy=ny1&lt;0?0:ny1; yy&lt;=yb; yy++) { draw_scanline((<span class="keywordtype">int</span>)xleft,(<span class="keywordtype">int</span>)xright,yy,color,opacity); xleft+=pleft; xright+=pright; }
06098       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06099     }
06100   
06102 
<a name="l06119"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_15">06119</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_triangle(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,
06120                                              <span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
06121                                              <span class="keyword">const</span> <span class="keywordtype">int</span> x2,<span class="keyword">const</span> <span class="keywordtype">int</span> y2,
06122                                              <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; texture,
06123                                              <span class="keyword">const</span> <span class="keywordtype">int</span> tx0,<span class="keyword">const</span> <span class="keywordtype">int</span> ty0,
06124                                              <span class="keyword">const</span> <span class="keywordtype">int</span> tx1,<span class="keyword">const</span> <span class="keywordtype">int</span> ty1,
06125                                              <span class="keyword">const</span> <span class="keywordtype">int</span> tx2,<span class="keyword">const</span> <span class="keywordtype">int</span> ty2,
06126                                              <span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06127       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_triangle"</span>); 
06128       cimg_test(texture,<span class="stringliteral">"CImg&lt;T&gt;::draw_triangle"</span>);
06129       <span class="keywordtype">int</span> nx0=x0,ny0=y0,nx1=x1,ny1=y1,nx2=x2,ny2=y2,ntx0=tx0,nty0=ty0,ntx1=tx1,nty1=ty1,ntx2=tx2,nty2=ty2,whz=width*height*depth;
06130       <span class="keywordflow">if</span> (ny0&gt;ny1) cimg::swap(nx0,nx1,ny0,ny1,ntx0,ntx1,nty0,nty1);
06131       <span class="keywordflow">if</span> (ny0&gt;ny2) cimg::swap(nx0,nx2,ny0,ny2,ntx0,ntx2,nty0,nty2);
06132       <span class="keywordflow">if</span> (ny1&gt;ny2) cimg::swap(nx1,nx2,ny1,ny2,ntx1,ntx2,nty1,nty2);
06133       <span class="keywordflow">if</span> (ny0&gt;=dimy() || ny2&lt;0) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06134       <span class="keyword">const</span> <span class="keywordtype">float</span> 
06135         p1 = (ny1-ny0)?(nx1-nx0)/(float)(ny1-ny0):(nx1-nx0),
06136         p2 = (ny2-ny0)?(nx2-nx0)/(float)(ny2-ny0):(nx2-nx0),
06137         p3 = (ny2-ny1)?(nx2-nx1)/(float)(ny2-ny1):(nx2-nx1),
06138         tpx1 = (ny1-ny0)?(ntx1-ntx0)/(float)(ny1-ny0):0,
06139         tpy1 = (ny1-ny0)?(nty1-nty0)/(float)(ny1-ny0):0,
06140         tpx2 = (ny2-ny0)?(ntx2-ntx0)/(float)(ny2-ny0):0,
06141         tpy2 = (ny2-ny0)?(nty2-nty0)/(float)(ny2-ny0):0,
06142         tpx3 = (ny2-ny1)?(ntx2-ntx1)/(float)(ny2-ny1):0,
06143         tpy3 = (ny2-ny1)?(nty2-nty1)/(float)(ny2-ny1):0;
06144       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06145       <span class="keywordtype">float</span> pleft,pright,tpxleft,tpyleft,tpxright,tpyright,
06146         xleft=(float)nx0,xright=xleft,txleft=(float)ntx0,tyleft=(float)nty0,txright=txleft,tyright=tyleft;
06147       <span class="keywordflow">if</span> (p1&lt;p2) { pleft=p1; pright=p2; tpxleft=tpx1; tpyleft=tpy1; tpxright=tpx2; tpyright=tpy2; } 
06148       <span class="keywordflow">else</span>       { pleft=p2; pright=p1; tpxleft=tpx2; tpyleft=tpy2; tpxright=tpx1; tpyright=tpy1; }
06149       <span class="keywordflow">if</span> (ny0&lt;0) { xleft-=ny0*pleft; xright-=ny0*pright; txleft-=ny0*tpxleft; tyleft-=ny0*tpyleft;
06150         txright-=ny0*tpxright; tyright-=ny0*tpyright; }
06151       <span class="keyword">const</span> <span class="keywordtype">int</span> ya = ny1&lt;dimy()?ny1:height;
06152       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=(ny0&lt;0?0:ny0); y&lt;ya; y++) {
06153         <span class="keyword">const</span> <span class="keywordtype">int</span> dx = (int)xright-(int)xleft;
06154         <span class="keyword">const</span> <span class="keywordtype">float</span>
06155           tpx = dx?((int)txright-(int)txleft)/(float)dx:0,
06156           tpy = dx?((int)tyright-(int)tyleft)/(float)dx:0,        
06157           txi = (float)((xleft&gt;=0)?(int)txleft:(int)(txleft-(int)xleft*tpx)),
06158           tyi = (float)((xleft&gt;=0)?(int)tyleft:(int)(tyleft-(int)xleft*tpy));
06159         <span class="keyword">const</span> <span class="keywordtype">int</span> xmin=(xleft&gt;=0)?(int)xleft:0, xmax=(xright&lt;dimx())?(int)xright:(width-1);
06160         <span class="keywordflow">if</span> (xmin&lt;=xmax) {
06161           <span class="keyword">const</span> <span class="keywordtype">int</span> offx=whz-xmax+xmin-1;
06162           T* ptrd = ptr(xmin,y,0,0);
06163           <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(*<span class="keyword">this</span>,k) {
06164             <span class="keywordtype">float</span> tx=txi, ty=tyi;
06165             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=xmin; x&lt;=xmax; x++) { *(ptrd++)=(T)texture((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tx,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ty,0,k); tx+=tpx; ty+=tpy; }
06166             ptrd+=offx;
06167           } <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) {
06168             <span class="keywordtype">float</span> tx=txi, ty=tyi;
06169             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=xmin; x&lt;=xmax; x++) { *ptrd=(T)(nopacity*texture((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tx,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ty,0,k)+copacity*(*ptrd)); ptrd++; tx+=tpx; ty+=tpy; }
06170             ptrd+=offx;
06171           }
06172         }
06173         xleft+=pleft; xright+=pright; txleft+=tpxleft; tyleft+=tpyleft; txright+=tpxright; tyright+=tpyright;
06174       }
06175 
06176       <span class="keywordflow">if</span> (p1&lt;p2) {
06177         xleft=(float)nx1; pleft=p3; txleft=(float)ntx1; tyleft=(float)nty1; tpxleft=tpx3; tpyleft=tpy3;
06178         <span class="keywordflow">if</span> (ny1&lt;0) { xleft-=ny1*pleft; txleft-=ny1*tpxleft; tyleft-=ny1*tpyleft; }
06179       } <span class="keywordflow">else</span> { 
06180         xright=(float)nx1; pright=p3; txright=(float)ntx1; tyright=(float)nty1; tpxright=tpx3; tpyright=tpy3;
06181         <span class="keywordflow">if</span> (ny1&lt;0) { xright-=ny1*pright; txright-=ny1*tpxright; tyright-=ny1*tpyright; }
06182       }    
06183       <span class="keyword">const</span> <span class="keywordtype">int</span> yb = ny2&gt;=dimy()?(height-1):ny2;
06184       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> yy=(ny1&lt;0?0:ny1); yy&lt;=yb; yy++) {
06185         <span class="keyword">const</span> <span class="keywordtype">int</span> dx = (int)xright-(int)xleft;
06186         <span class="keyword">const</span> <span class="keywordtype">float</span>
06187           tpx = dx?((int)txright-(int)txleft)/(float)dx:0,
06188           tpy = dx?((int)tyright-(int)tyleft)/(float)dx:0,        
06189           txi = (float)((xleft&gt;=0)?(int)txleft:(int)(txleft-(int)xleft*tpx)),
06190           tyi = (float)((xleft&gt;=0)?(int)tyleft:(int)(tyleft-(int)xleft*tpy));
06191         <span class="keyword">const</span> <span class="keywordtype">int</span> xmin=(xleft&gt;=0)?(int)xleft:0, xmax=(xright&lt;dimx())?(int)xright:(width-1);
06192         <span class="keywordflow">if</span> (xmin&lt;=xmax) {
06193           <span class="keyword">const</span> <span class="keywordtype">int</span> offx=whz-xmax+xmin-1;
06194           T* ptrd = ptr(xmin,yy,0,0);
06195           <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(*<span class="keyword">this</span>,k) { 
06196             <span class="keywordtype">float</span> tx=txi, ty=tyi;
06197             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=xmin; x&lt;=xmax; x++) { *(ptrd++)=(T)texture((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tx,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ty,0,k); tx+=tpx; ty+=tpy; }
06198             ptrd+=offx;
06199           } <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) { 
06200             <span class="keywordtype">float</span> tx=txi, ty=tyi;
06201             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=xmin; x&lt;=xmax; x++) { *ptrd=(T)(nopacity*texture((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)tx,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)ty,0,k)+copacity*(*ptrd)); ptrd++; tx+=tpx; ty+=tpy; }
06202             ptrd+=offx;
06203           }
06204         }
06205         xleft+=pleft; xright+=pright; txleft+=tpxleft; tyleft+=tpyleft; txright+=tpxright; tyright+=tpyright;
06206       }
06207       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06208     }
06209 
06211 
<a name="l06222"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_16">06222</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_ellipse(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">float</span> r1,<span class="keyword">const</span> <span class="keywordtype">float</span> r2,<span class="keyword">const</span> <span class="keywordtype">float</span> ru,<span class="keyword">const</span> <span class="keywordtype">float</span> rv,
06223                        <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern=0L, <span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06224       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_ellipse"</span>);
06225       draw_scanline(color,opacity);
06226       <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_ellipse : specified color is (null)."</span>,pixel_type());
06227       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hatch=1;
06228       <span class="keyword">const</span> <span class="keywordtype">float</span>
06229         nr1 = cimg::abs(r1), nr2 = cimg::abs(r2),
06230         norm = (float)std::sqrt(ru*ru+rv*rv),
06231         u = norm&gt;0?ru/norm:1,
06232         v = norm&gt;0?rv/norm:0,
06233         rmax = cimg::max(nr1,nr2),
06234         l1 = (float)std::pow(rmax/(nr1&gt;0?nr1:1e-6),2),
06235         l2 = (float)std::pow(rmax/(nr2&gt;0?nr2:1e-6),2),
06236         a = l1*u*u + l2*v*v,
06237         b = u*v*(l1-l2),
06238         c = l1*v*v + l2*u*u;
06239       <span class="keyword">const</span> <span class="keywordtype">int</span>
06240         yb = (int)std::sqrt(a*rmax*rmax/(a*c-b*b)),
06241         ymin = (y0-yb&lt;0)?0:(y0-yb),
06242         ymax = (1+y0+yb&gt;=dimy())?height-1:(1+y0+yb);
06243       <span class="keywordtype">int</span> oxmin=0, oxmax=0;
06244       <span class="keywordtype">bool</span> first_line = <span class="keyword">true</span>;
06245       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=ymin; y&lt;=ymax; y++) {
06246         <span class="keyword">const</span> <span class="keywordtype">float</span> Y = (float)(y-y0), delta = b*b*Y*Y-a*(c*Y*Y-rmax*rmax), sdelta = (float)((delta&gt;0?std::sqrt(delta):0));
06247         <span class="keywordtype">int</span> xmin = (int)(x0-(b*Y+sdelta)/a), xmax = (int)(x0-(b*Y-sdelta)/a);
06248         <span class="keywordflow">if</span> (!pattern) draw_scanline(xmin,xmax,y,color,opacity);
06249         <span class="keywordflow">else</span> {
06250           <span class="keywordflow">if</span> (!(~pattern) || (~pattern &amp;&amp; pattern&amp;hatch)) {
06251             <span class="keywordflow">if</span> (first_line) { draw_scanline(xmin,xmax,y,color,opacity); first_line = <span class="keyword">false</span>; }
06252             <span class="keywordflow">else</span> {
06253               <span class="keywordflow">if</span> (xmin&lt;oxmin) draw_scanline(xmin,oxmin-1,y,color,opacity); 
06254               <span class="keywordflow">else</span> draw_scanline(oxmin+(oxmin==xmin?0:1),xmin,y,color,opacity);
06255               <span class="keywordflow">if</span> (xmax&lt;oxmax) draw_scanline(xmax,oxmax-1,y,color,opacity); 
06256               <span class="keywordflow">else</span> draw_scanline(oxmax+(oxmax==xmax?0:1),xmax,y,color,opacity); 
06257             }
06258           }
06259         }
06260         oxmin = xmin; oxmax = xmax;
06261         <span class="keywordflow">if</span> (pattern) hatch=(hatch&lt;&lt;1)+(hatch&gt;&gt;(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> int)*8-1));
06262       }
06263       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06264     }
06265     
06267 
<a name="l06275"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_17">06275</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_ellipse(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> &amp;tensor,
06276                                             <span class="keyword">const</span> T *color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern=0L,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06277       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a> eig = tensor.<a class="code" href="structcimg__library_1_1CImg.html#z17_29">get_symeigen</a>();
06278       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> &amp;val = eig[0], &amp;vec = eig[1];
06279       <span class="keywordflow">return</span> draw_ellipse(x0,y0,val(0),val(1),vec(0),vec(1),color,pattern,opacity);
06280     }
06281     
06283 
<a name="l06291"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_18">06291</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_circle(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keywordtype">float</span> r,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern=0L,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06292       <span class="keywordflow">return</span> draw_ellipse(x0,y0,r,r,1,0,color,pattern,opacity);
06293     }
06294   
06296 
<a name="l06307"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_19">06307</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_text(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> text,
06308                                          <span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,
06309                                          <span class="keyword">const</span> T *<span class="keyword">const</span> fgcolor,<span class="keyword">const</span> T *<span class="keyword">const</span> bgcolor,
06310                                          <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; font,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06311 
06312       cimgl_test(font,<span class="stringliteral">"CImg&lt;%s&gt;::draw_text"</span>);
06313       <span class="keywordflow">if</span> (!text) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_text() : NULL string specified as input"</span>,pixel_type());
06314       <span class="keywordflow">if</span> (!width || !height || !depth || !dim || !data) {
06315         <span class="comment">// If needed, pre-compute needed size of the image</span>
06316         <span class="keywordtype">int</span> x=0, y=0, w=0;
06317         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cimg::strlen(text); i++) {
06318           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = text[i];
06319           <span class="keywordflow">switch</span> (c) {
06320           <span class="keywordflow">case</span> <span class="charliteral">'\n'</span>: y+=font[<span class="charliteral">' '</span>].height; <span class="keywordflow">if</span> (x&gt;w) w=x; x=0; <span class="keywordflow">break</span>;
06321           <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>: x+=4*font[<span class="charliteral">' '</span>].width; <span class="keywordflow">break</span>;
06322           <span class="keywordflow">default</span>: <span class="keywordflow">if</span> (c&lt;font.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>) x+=font[c].width;
06323           }
06324         }       
06325         <span class="keywordflow">if</span> (x!=0) {
06326           <span class="keywordflow">if</span> (x&gt;w) w=x;
06327           y+=font[<span class="charliteral">' '</span>].height;
06328         }
06329         (*this) = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(x0+w,y0+y,1,font[<span class="charliteral">' '</span>].dim,0);
06330         <span class="keywordflow">if</span> (bgcolor) cimg_mapV(*<span class="keyword">this</span>,k) ref_channel(k).fill(bgcolor[k]);
06331       }
06332 
06333       <span class="keywordtype">int</span> x=x0, y=y0;
06334       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> letter;
06335       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cimg::strlen(text); i++) {
06336         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = text[i];
06337         <span class="keywordflow">switch</span> (c) {
06338         <span class="keywordflow">case</span> <span class="charliteral">'\n'</span>: y+=font[<span class="charliteral">' '</span>].height; x=x0; <span class="keywordflow">break</span>;
06339         <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>: x+=4*font[<span class="charliteral">' '</span>].width; <span class="keywordflow">break</span>;
06340         <span class="keywordflow">default</span>: <span class="keywordflow">if</span> (c&lt;font.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>) {
06341             letter = font[c];
06342             <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; mask = (c+256)&lt;(int)font.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>?font[c+256]:font[c];
06343             <span class="keywordflow">if</span> (fgcolor) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;letter.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*letter.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; p++) 
06344               <span class="keywordflow">if</span> (mask(p)) cimg_mapV(*<span class="keyword">this</span>,k) letter(p,0,0,k)=(T)(letter(p,0,0,k)*fgcolor[k]);
06345             <span class="keywordflow">if</span> (bgcolor) <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p=0; p&lt;letter.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*letter.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; p++)
06346               <span class="keywordflow">if</span> (!mask(p)) cimg_mapV(*<span class="keyword">this</span>,k) letter(p,0,0,k)=bgcolor[k];
06347             <span class="keywordflow">if</span> (!bgcolor &amp;&amp; font.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>&gt;=512) draw_image(letter,mask,x,y,0,0,(T)1,opacity); <span class="keywordflow">else</span> draw_image(letter,x,y,0,0,opacity);
06348             x+=letter.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
06349           }
06350           <span class="keywordflow">break</span>;
06351         }
06352       }
06353       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06354     }
06355 
06356 
06358 
<a name="l06368"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_20">06368</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_text(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> text,
06369                     <span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,
06370                     <span class="keyword">const</span> T *<span class="keyword">const</span> fgcolor=NULL,<span class="keyword">const</span> T *<span class="keyword">const</span> bgcolor=NULL,
06371                     <span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06372       <span class="keyword">static</span> <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
06373       <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> default_font;
06374       <span class="keywordflow">if</span> (first) { default_font = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;::get_font7x11</a>(); first = <span class="keyword">false</span>; }
06375       <span class="keywordflow">return</span> draw_text(text,x0,y0,fgcolor,bgcolor,default_font,opacity);
06376     }
06377   
06379 
<a name="l06389"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_21">06389</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_text(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,
06390                     <span class="keyword">const</span> T *<span class="keyword">const</span> fgcolor,<span class="keyword">const</span> T *<span class="keyword">const</span> bgcolor,
06391                     <span class="keyword">const</span> <span class="keywordtype">float</span> opacity,<span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
06392       <span class="keywordtype">char</span> tmp[2048]; 
06393       std::va_list ap;
06394       va_start(ap,format);
06395       std::vsprintf(tmp,format,ap);
06396       va_end(ap);
06397       <span class="keywordflow">return</span> draw_text(tmp,x0,y0,fgcolor,bgcolor,opacity);
06398     }
06399     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_text(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,
06400                                          <span class="keyword">const</span> T *<span class="keyword">const</span> fgcolor,<span class="keyword">const</span> T *<span class="keyword">const</span> bgcolor,
06401                                          <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; font, <span class="keyword">const</span> <span class="keywordtype">float</span> opacity, <span class="keyword">const</span> <span class="keywordtype">char</span> *format,...) {
06402       <span class="keywordtype">char</span> tmp[2048]; std::va_list ap; va_start(ap,format); std::vsprintf(tmp,format,ap); va_end(ap);
06403       <span class="keywordflow">return</span> draw_text(tmp,x0,y0,fgcolor,bgcolor,font);
06404     }
06405   
06407 
06416     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; 
<a name="l06417"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_23">06417</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_quiver(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; flow,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sampling=25,<span class="keyword">const</span> <span class="keywordtype">float</span> factor=-20,
06418                       <span class="keyword">const</span> <span class="keywordtype">int</span> quiver_type=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06419       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_quiver"</span>);
06420       cimg_test(flow,<span class="stringliteral">"CImg&lt;T&gt;::draw_quiver"</span>);
06421       <span class="keywordflow">if</span> (!color) 
06422         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_quiver() : specified color is (null)"</span>,pixel_type());
06423       <span class="keywordflow">if</span> (sampling&lt;=0)
06424         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_quiver() : incorrect sampling value = %g"</span>,pixel_type(),sampling);
06425       <span class="keywordflow">if</span> (flow.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=2)
06426         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_quiver() : specified flow has invalid dimensions (%u,%u,%u,%u)"</span>,
06427                                     pixel_type(),flow.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
06428       <span class="keywordtype">float</span> vmax,fact;
06429       <span class="keywordflow">if</span> (factor&lt;=0) {
06430         <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(flow.<a class="code" href="structcimg__library_1_1CImg.html#z9_61">get_norm_pointwise</a>(2),<span class="keyword">false</span>);
06431         vmax = (float)cimg::max(cimg::abs(st.min),cimg::abs(st.max));
06432         fact = -factor;
06433       } <span class="keywordflow">else</span> { fact = factor; vmax = 1; }
06434 
06435       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=sampling/2; y&lt;height; y+=sampling)
06436         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=sampling/2; x&lt;width; x+=sampling) {
06437           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> X = x*flow.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>/width, Y = y*flow.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>/height;
06438           <span class="keywordtype">float</span> u = (float)flow(X,Y,0,0)*fact/vmax, v = (float)flow(X,Y,0,1)*fact/vmax;
06439           <span class="keywordflow">if</span> (!quiver_type) {
06440             <span class="keyword">const</span> <span class="keywordtype">int</span> xx = x+(int)u, yy = y+(int)v;
06441             draw_arrow(x,y,xx,yy,color,45.0f,sampling/5.0f,~0L,opacity);
06442           } <span class="keywordflow">else</span> draw_line((<span class="keywordtype">int</span>)(x-0.5*u),(<span class="keywordtype">int</span>)(y-0.5*v),(<span class="keywordtype">int</span>)(x+0.5*u),(<span class="keywordtype">int</span>)(y+0.5*v),color,~0L,opacity);
06443         }
06444       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
06445     }
06446 
06448 
06457     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t1,<span class="keyword">typename</span> t2&gt;
<a name="l06458"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_24">06458</a>       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_quiver(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t1&gt;</a>&amp; flow,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t2&gt;</a>&amp; color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sampling=25,<span class="keyword">const</span> <span class="keywordtype">float</span> factor=-20,
06459                         <span class="keyword">const</span> <span class="keywordtype">int</span> quiver_type=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06460       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_quiver"</span>); 
06461       cimg_test(flow,<span class="stringliteral">"CImg&lt;T&gt;::draw_quiver"</span>);
06462       cimg_test(color,<span class="stringliteral">"CImg&lt;T&gt;::draw_quiver"</span>);
06463       <span class="keywordflow">if</span> (sampling&lt;=0)
06464         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_quiver() : incorrect sampling value = %g"</span>,pixel_type(),sampling);
06465       <span class="keywordflow">if</span> (flow.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=2)
06466         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_quiver() : specified flow has invalid dimensions (%u,%u,%u,%u)"</span>,
06467                                     pixel_type(),flow.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
06468       <span class="keywordflow">if</span> (color.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=flow.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> || color.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=flow.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>)
06469         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_quiver() : input color data map=(%u,%u,%u,%u)\</span>
06470 <span class="stringliteral"> and data flow=(%u,%u,%u,%u) must have same dimension."</span>,
06471                                     color.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,color.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,color.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,color.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,
06472                                     flow.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,flow.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>);
06473       <span class="keywordtype">float</span> vmax,fact;
06474       <span class="keywordflow">if</span> (factor&lt;=0) {
06475         <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(flow.<a class="code" href="structcimg__library_1_1CImg.html#z9_61">get_norm_pointwise</a>(2),<span class="keyword">false</span>);
06476         vmax = (float)cimg::max(cimg::abs(st.min),cimg::abs(st.max));
06477         fact = -factor;
06478       } <span class="keywordflow">else</span> { fact = factor; vmax = 1; }
06479 
06480       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=sampling/2; y&lt;height; y+=sampling)
06481         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=sampling/2; x&lt;width; x+=sampling) {
06482           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> X = x*flow.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>/width, Y = y*flow.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>/height;
06483           <span class="keywordtype">float</span> u = (float)flow(X,Y,0,0)*fact/vmax, v = (float)flow(X,Y,0,1)*fact/vmax;
06484           <span class="keywordflow">if</span> (!quiver_type) {
06485             <span class="keyword">const</span> <span class="keywordtype">int</span> xx = x+(int)u, yy = y+(int)v;
06486             draw_arrow(x,y,xx,yy,color.<a class="code" href="structcimg__library_1_1CImg.html#z17_2">get_vector</a>(X,Y).<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,45,sampling/5,~0L,opacity);
06487           } <span class="keywordflow">else</span> draw_line((<span class="keywordtype">int</span>)(x-0.5*u),(<span class="keywordtype">int</span>)(y-0.5*v),(<span class="keywordtype">int</span>)(x+0.5*u),(<span class="keywordtype">int</span>)(y+0.5*v),color(X,Y),~0L,opacity);
06488         }
06489       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
06490     }
06491 
06493 
06507     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt;
<a name="l06508"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_25">06508</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_graph(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; data,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gtype=0,
06509                      <span class="keyword">const</span> <span class="keywordtype">double</span> ymin=0,<span class="keyword">const</span> <span class="keywordtype">double</span> ymax=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06510       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_graph"</span>);
06511       <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_graph() : specified color is (null)"</span>,pixel_type());
06512       T *color1 = <span class="keyword">new</span> T[dim], *color2 = <span class="keyword">new</span> T[dim];
06513       cimg_mapV(*<span class="keyword">this</span>,k) { color1[k]=(T)(color[k]*0.6f); color2[k]=(T)(color[k]*0.3f); }
06514       <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st;
06515       <span class="keywordflow">if</span> (ymin==ymax) { st = <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>(data,<span class="keyword">false</span>); cimg::swap(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>,st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>); } <span class="keywordflow">else</span> { st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a> = ymin; st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a> = ymax; }
06516       <span class="keywordflow">if</span> (st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>==st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>) { st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>--; st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>++; }
06517       <span class="keyword">const</span> <span class="keywordtype">float</span> ca = height&gt;1?(float)(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)/(height-1):0, cb = (float)st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>;
06518       <span class="keyword">const</span> <span class="keywordtype">int</span> Y0 = (int)(-cb/ca);
06519       <span class="keywordtype">int</span> pY=0;
06520       cimg_mapoff(data,off) {     
06521         <span class="keyword">const</span> <span class="keywordtype">int</span> Y = (int)((data[off]-cb)/ca);
06522         <span class="keywordflow">switch</span> (gtype) {
06523         <span class="keywordflow">case</span> 0: <span class="comment">// plot with segments</span>
06524           <span class="keywordflow">if</span> (off&gt;0) draw_line((<span class="keywordtype">int</span>)((off-1)*width/data.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()),pY,(int)(off*width/data.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()),Y,color,~0L,opacity);
06525           <span class="keywordflow">break</span>;
06526         <span class="keywordflow">case</span> 1: { <span class="comment">// plot with bars</span>
06527           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> X = off*width/data.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>(), nX = (off+1)*width/data.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()-1;
06528           draw_rectangle(X,(<span class="keywordtype">int</span>)Y0,nX,Y,color1,opacity);
06529           draw_line(X,Y,X,(<span class="keywordtype">int</span>)Y0,color2,~0L,opacity);
06530           draw_line(X,(<span class="keywordtype">int</span>)Y0,nX,(<span class="keywordtype">int</span>)Y0,Y&lt;=Y0?color2:color,~0L,opacity);
06531           draw_line(nX,Y,nX,(<span class="keywordtype">int</span>)Y0,color,~0L,opacity);
06532           draw_line(X,Y,nX,Y,Y&lt;=Y0?color:color2,~0L,opacity);
06533         } <span class="keywordflow">break</span>;
06534         }        
06535         pY=Y;
06536       }
06537       <span class="keywordflow">if</span> (gtype==2) { <span class="comment">// plot with cubic interpolation</span>
06538         <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;t&gt;</a> ndata(data.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>(),1,1,1,data.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>());
06539         cimg_mapX(*<span class="keyword">this</span>,x) {
06540           <span class="keyword">const</span> <span class="keywordtype">int</span> Y = (int)((ndata.cubic_pix1d((<span class="keywordtype">float</span>)x*ndata.width/width)-cb)/ca);
06541           <span class="keywordflow">if</span> (x&gt;0) draw_line(x,pY,x+1,Y,color,~0L,opacity);
06542           pY=Y;
06543         }
06544       }
06545       <span class="keyword">delete</span>[] color1; <span class="keyword">delete</span>[] color2;
06546       <span class="keywordflow">return</span> *<span class="keyword">this</span>;     
06547     }
06548 
06550 
<a name="l06560"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_26">06560</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_axeX(<span class="keyword">const</span> <span class="keywordtype">double</span> x0,<span class="keyword">const</span> <span class="keywordtype">double</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> T *<span class="keyword">const</span> color,
06561                     <span class="keyword">const</span> <span class="keywordtype">double</span> precision=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06562       <span class="keywordflow">if</span> (x0==x1) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06563       <span class="keywordflow">if</span> (x0&lt;x1) draw_arrow(0,y,width-1,y,color,30,5,~0L,opacity);
06564       <span class="keywordflow">else</span> draw_arrow(width-1,y,0,y,color,30,5,~0L,opacity);
06565       <span class="keyword">const</span> <span class="keywordtype">int</span> yt = (y+14)&lt;dimy()?(y+3):(y-14);
06566       <span class="keywordtype">double</span> nprecision=precision;
06567       <span class="keywordflow">if</span> (precision&lt;=0) { 
06568         <span class="keyword">const</span> <span class="keywordtype">double</span> nb_pow = std::floor(std::log10(cimg::abs(x1-x0)))-1;
06569         nprecision = std::pow(10.0,nb_pow);
06570         <span class="keywordflow">while</span> ((cimg::abs(x1-x0)/nprecision)&gt;(dimx()/40)) nprecision*=2;
06571       }
06572       <span class="keyword">const</span> <span class="keywordtype">double</span> xmin=x0&lt;x1?x0:x1, xmax=x0&lt;x1?x1:x0,
06573         tx0 = cimg::mod(xmin,nprecision)==0?xmin:((xmin+nprecision)-cimg::mod(xmin+nprecision,nprecision)),
06574         tx1 = cimg::mod(xmax,nprecision)==0?xmax:((xmax+nprecision)-cimg::mod(xmax+nprecision,nprecision));
06575       <span class="keywordtype">char</span> txt[32];
06576       <span class="keywordflow">for</span> (<span class="keywordtype">double</span> x=tx0; x&lt;=tx1; x+=nprecision) {
06577         std::sprintf(txt,<span class="stringliteral">"%g"</span>,x);               
06578         <span class="keyword">const</span> <span class="keywordtype">int</span> xi=(int)((x-x0)*(width-1)/(x1-x0)), xt = xi-(int)std::strlen(txt)*3;
06579         draw_point(xi,y-1,color,opacity).<a class="code" href="structcimg__library_1_1CImg.html#z13_2">draw_point</a>(xi,y+1,color,opacity).
06580           draw_text(txt,xt&lt;0?0:xt,yt,color,NULL,opacity);
06581       }
06582       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06583     }
06584 
06586 
<a name="l06596"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_27">06596</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_axeY(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">double</span> y0,<span class="keyword">const</span> <span class="keywordtype">double</span> y1,<span class="keyword">const</span> T *<span class="keyword">const</span> color,
06597                     <span class="keyword">const</span> <span class="keywordtype">double</span> precision=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06598       <span class="keywordflow">if</span> (y0==y1) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06599       <span class="keywordflow">if</span> (y0&lt;y1) draw_arrow(x,0,x,height-1,color,30,5,~0L,opacity);
06600       <span class="keywordflow">else</span> draw_arrow(x,height-1,x,0,color,30,5,~0L,opacity);
06601       <span class="keywordtype">double</span> nprecision=precision;
06602       <span class="keywordflow">if</span> (precision&lt;=0) {
06603         <span class="keyword">const</span> <span class="keywordtype">double</span> nb_pow = std::floor(std::log10(cimg::abs(y1-y0)))-1;
06604         nprecision = std::pow(10.0,nb_pow);
06605         <span class="keywordflow">while</span> ((cimg::abs(y1-y0)/nprecision)&gt;(dimy()/40)) nprecision*=2;
06606       }
06607       <span class="keyword">const</span> <span class="keywordtype">double</span> ymin=y0&lt;y1?y0:y1, ymax=y0&lt;y1?y1:y0,
06608         ty0 = cimg::mod(ymin,nprecision)==0?ymin:((ymin+nprecision)-cimg::mod(ymin+nprecision,nprecision)),
06609         ty1 = cimg::mod(ymax,nprecision)==0?ymax:((ymax+nprecision)-cimg::mod(ymax+nprecision,nprecision));
06610       <span class="keywordtype">char</span> txt[32];
06611       <span class="keywordflow">for</span> (<span class="keywordtype">double</span> y=ty0; y&lt;=ty1; y+=nprecision) {
06612         std::sprintf(txt,<span class="stringliteral">"%g"</span>,y);
06613         <span class="keyword">const</span> <span class="keywordtype">int</span> yi = (int)((y-y0)*(height-1)/(y1-y0)), xt = x-(int)std::strlen(txt)*7;
06614         draw_point(x-1,yi,color,opacity).<a class="code" href="structcimg__library_1_1CImg.html#z13_2">draw_point</a>(x+1,yi,color,opacity);
06615         <span class="keywordflow">if</span> (xt&gt;0) draw_text(txt,xt,yi-5,color,NULL,opacity);
06616         <span class="keywordflow">else</span> draw_text(txt,x+3,yi-5,color,NULL,opacity);
06617       }
06618       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06619     }
06620 
06622 
<a name="l06634"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_28">06634</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_axeXY(<span class="keyword">const</span> <span class="keywordtype">double</span> x0,<span class="keyword">const</span> <span class="keywordtype">double</span> x1,<span class="keyword">const</span> <span class="keywordtype">double</span> y0,<span class="keyword">const</span> <span class="keywordtype">double</span> y1,<span class="keyword">const</span> T *<span class="keyword">const</span> color,
06635                      <span class="keyword">const</span> <span class="keywordtype">double</span> precisionx=0,<span class="keyword">const</span> <span class="keywordtype">double</span> precisiony=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06636       <span class="keywordflow">if</span> (x0*x1&lt;=0) {
06637         <span class="keyword">const</span> <span class="keywordtype">int</span> xz = (int)(-x0*(width-1)/(x1-x0));
06638         <span class="keywordflow">if</span> (xz&gt;=0 &amp;&amp; xz&lt;dimx()) draw_axeY(xz,y0,y1,color,precisiony,opacity);
06639       }
06640       <span class="keywordflow">if</span> (y0*y1&lt;=0) {
06641         <span class="keyword">const</span> <span class="keywordtype">int</span> yz = (int)(-y0*(height-1)/(y1-y0));
06642         <span class="keywordflow">if</span> (yz&gt;=0 &amp;&amp; yz&lt;dimy()) draw_axeX(x0,x1,yz,color,precisionx,opacity);
06643       }
06644       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06645     }
06646   
06647     <span class="comment">// Local class used by function CImg&lt;&gt;::draw_fill()</span>
06648     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1,<span class="keyword">typename</span> T2&gt; <span class="keyword">struct </span>_draw_fill {
06649       <span class="keyword">const</span> T1 *<span class="keyword">const</span> color;
06650       <span class="keyword">const</span> <span class="keywordtype">float</span> sigma,opacity;
06651       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T1&gt;</a> value;
06652       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T2&gt;</a> region;
06653 
06654       _draw_fill(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T1&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> <span class="keywordtype">int</span> z,
06655                  <span class="keyword">const</span> T *<span class="keyword">const</span> pcolor,<span class="keyword">const</span> <span class="keywordtype">float</span> psigma,<span class="keyword">const</span> <span class="keywordtype">float</span> popacity):
06656         color(pcolor),sigma(psigma),opacity(popacity),
06657         value(img.get_vector(x,y,z)), region(<a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&lt;T2&gt;(img.width,img.height,img.depth,1,(T2)false)) {
06658         cimg_test(img,<span class="stringliteral">"CImg&lt;T&gt;::draw_fill"</span>);
06659         <span class="keywordflow">if</span> (!color) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_fill() : specified color is (null)"</span>,img.<a class="code" href="structcimg__library_1_1CImg.html#z3_25">pixel_type</a>());
06660       }
06661 
06662            _draw_fill&amp; operator=(<span class="keyword">const</span> _draw_fill&amp; d) {
06663                         color = d.color;
06664                         sigma = d.sigma;
06665                         opacity = d.opacity;
06666                         value = d.value;
06667                         region = d.region;
06668                 }
06669 
06670       <span class="keywordtype">bool</span> comp(<span class="keyword">const</span> CImg&lt;T1&gt;&amp; A,<span class="keyword">const</span> CImg&lt;T1&gt;&amp; B)<span class="keyword"> const </span>{
06671         <span class="keywordtype">bool</span> res=<span class="keyword">true</span>;
06672         <span class="keyword">const</span> T *pA=A.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+A.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
06673         <span class="keywordflow">for</span> (<span class="keyword">const</span> T *pB=B.data+B.size(); res &amp;&amp; pA&gt;A.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>; res=(cimg::abs(*(--pA)-(*(--pB)))&lt;=sigma) );
06674         <span class="keywordflow">return</span> res;
06675       }
06676 
06677       <span class="keywordtype">void</span> fill(CImg&lt;T1&gt;&amp; img,<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> <span class="keywordtype">int</span> z) {
06678         <span class="keywordflow">if</span> (x&lt;0 || x&gt;=img.dimx() || y&lt;0 || y&gt;=img.dimy() || z&lt;0 || z&gt;=img.dimz()) <span class="keywordflow">return</span>;
06679         <span class="keywordflow">if</span> (!region(x,y,z) &amp;&amp; comp(value,img.<a class="code" href="structcimg__library_1_1CImg.html#z17_2">get_vector</a>(x,y,z))) {
06680           <span class="keyword">const</span> T *col=color;
06681           <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06682           <span class="keywordtype">int</span> xmin,xmax;
06683           <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(img,k) img(x,y,z,k)=*(col++);
06684           else cimg_mapV(img,k) img(x,y,z,k)=(T1)(*(col++)*opacity+copacity*img(x,y,z,k));
06685           col-=img.dim;
06686           region(x,y,z) = (T2)true;
06687           for (xmin=x-1; xmin&gt;=0 &amp;&amp; comp(value,img.get_vector(xmin,y,z)); xmin--) {
06688             <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(img,k) img(xmin,y,z,k) = *(col++);
06689             else cimg_mapV(img,k) img(xmin,y,z,k)=(T1)(*(col++)*nopacity+copacity*img(xmin,y,z,k)); 
06690             col-=img.dim;
06691             region(xmin,y,z)=(T2)true;
06692           }
06693           for (xmax=x+1; xmax&lt;img.dimx() &amp;&amp; comp(value,img.get_vector(xmax,y,z)); xmax++) {
06694             <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(img,k) img(xmax,y,z,k) = *(col++);
06695             else cimg_mapV(img,k) img(xmax,y,z,k)=(T1)(*(col++)*nopacity+copacity*img(xmax,y,z,k));
06696             col-=img.dim;
06697             region(xmax,y,z)=(T2)true; 
06698           }
06699           xmin++; xmax--;
06700           for (; xmin&lt;=xmax; xmin++) { 
06701             fill(img,xmin,y-1,z); 
06702             fill(img,xmin,y+1,z);
06703             fill(img,xmin,y,z-1); 
06704             fill(img,xmin,y,z+1);
06705           }
06706         }
06707       }        
06708     };
06709 
06711 
<a name="l06722"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_29">06722</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_fill(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> <span class="keywordtype">int</span> z,
06723                                          <span class="keyword">const</span> T *<span class="keyword">const</span> color, <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; region,<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=0,
06724                                          <span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06725       _draw_fill&lt;T,t&gt; F(*<span class="keyword">this</span>,x,y,z,color,sigma,opacity);
06726       F.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(*<span class="keyword">this</span>,x,y,z);
06727       region = F.region;
06728       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06729     }
06730 
06732 
<a name="l06740"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_30">06740</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_fill(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> <span class="keywordtype">int</span> z,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06741       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;bool&gt;</a> tmp;
06742       <span class="keywordflow">return</span> draw_fill(x,y,z,color,tmp,sigma,opacity);
06743     }
06744 
06746 
<a name="l06753"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_31">06753</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_fill(<span class="keyword">const</span> <span class="keywordtype">int</span> x,<span class="keyword">const</span> <span class="keywordtype">int</span> y,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {      
06754       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;bool&gt;</a> tmp;
06755       <span class="keywordflow">return</span> draw_fill(x,y,0,color,tmp,sigma,opacity);
06756     }
06757 
06759 
<a name="l06768"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_32">06768</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_plasma(<span class="keyword">const</span> <span class="keywordtype">int</span> x0,<span class="keyword">const</span> <span class="keywordtype">int</span> y0,<span class="keyword">const</span> <span class="keywordtype">int</span> x1,<span class="keyword">const</span> <span class="keywordtype">int</span> y1,
06769                       <span class="keyword">const</span> <span class="keywordtype">double</span> alpha=1.0,<span class="keyword">const</span> <span class="keywordtype">double</span> beta=1.0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06770       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_plasma"</span>);
06771       <span class="keywordtype">int</span> nx0=x0,nx1=x1,ny0=y0,ny1=y1;
06772       <span class="keywordflow">if</span> (nx1&lt;nx0) cimg::swap(nx0,nx1);
06773       <span class="keywordflow">if</span> (ny1&lt;ny0) cimg::swap(ny0,ny1);
06774       <span class="keywordflow">if</span> (nx0&lt;0) nx0=0;
06775       <span class="keywordflow">if</span> (nx1&gt;=dimx()) nx1=width-1;
06776       <span class="keywordflow">if</span> (ny0&lt;0) ny0=0;
06777       <span class="keywordflow">if</span> (ny1&gt;=dimy()) ny1=height-1;
06778       <span class="keyword">const</span> <span class="keywordtype">int</span> xc = (nx0+nx1)/2, yc = (ny0+ny1)/2, dx=(xc-nx0), dy=(yc-ny0);
06779       <span class="keyword">const</span> <span class="keywordtype">double</span> dc = std::sqrt((<span class="keywordtype">double</span>)(dx*dx+dy*dy))*alpha + beta;
06780       cimg_mapV(*<span class="keyword">this</span>,k) {
06781         <span class="keywordflow">if</span> (opacity&gt;=1) {
06782           (*this)(xc,ny0,0,k) = (T)(0.5*((*this)(nx0,ny0,0,k)+(*this)(nx1,ny0,0,k)));
06783           (*this)(xc,ny1,0,k) = (T)(0.5*((*this)(nx0,ny1,0,k)+(*this)(nx1,ny1,0,k)));
06784           (*this)(nx0,yc,0,k) = (T)(0.5*((*this)(nx0,ny0,0,k)+(*this)(nx0,ny1,0,k)));
06785           (*this)(nx1,yc,0,k) = (T)(0.5*((*this)(nx1,ny0,0,k)+(*this)(nx1,ny1,0,k)));
06786           (*this)(xc,yc,0,k)  = (T)(0.25*((*this)(nx0,ny0,0,k)+(*this)(nx1,ny0,0,k) +
06787                                           (*this)(nx1,ny1,0,k)+(*this)(nx0,ny1,0,k)) + dc*cimg::grand());
06788         } <span class="keywordflow">else</span> {
06789           <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06790           (*this)(xc,ny0,0,k) = (T)(0.5*((*this)(nx0,ny0,0,k)+(*this)(nx1,ny0,0,k))*nopacity + copacity*(*this)(xc,ny0,0,k));
06791           (*this)(xc,ny1,0,k) = (T)(0.5*((*this)(nx0,ny1,0,k)+(*this)(nx1,ny1,0,k))*nopacity + copacity*(*this)(xc,ny1,0,k));
06792           (*this)(nx0,yc,0,k) = (T)(0.5*((*this)(nx0,ny0,0,k)+(*this)(nx0,ny1,0,k))*nopacity + copacity*(*this)(nx0,yc,0,k));
06793           (*this)(nx1,yc,0,k) = (T)(0.5*((*this)(nx1,ny0,0,k)+(*this)(nx1,ny1,0,k))*nopacity + copacity*(*this)(nx1,yc,0,k));
06794           (*this)(xc,yc,0,k)  = (T)(0.25*(((*this)(nx0,ny0,0,k)+(*this)(nx1,ny0,0,k) +
06795                                            (*this)(nx1,ny1,0,k)+(*this)(nx0,ny1,0,k)) + dc*cimg::grand())*nopacity
06796                                     + copacity*(*this)(xc,yc,0,k));
06797         }
06798       }
06799       <span class="keywordflow">if</span> (xc!=nx0 || yc!=ny0) { 
06800         draw_plasma(nx0,ny0,xc,yc,alpha,beta,opacity);
06801         draw_plasma(xc,ny0,nx1,yc,alpha,beta,opacity);
06802         draw_plasma(nx0,yc,xc,ny1,alpha,beta,opacity);
06803         draw_plasma(xc,yc,nx1,ny1,alpha,beta,opacity); 
06804       }
06805       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06806     }
06807 
06809 
<a name="l06814"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_33">06814</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_plasma(<span class="keyword">const</span> <span class="keywordtype">double</span> alpha=1.0,<span class="keyword">const</span> <span class="keywordtype">double</span> beta=1.0,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06815       <span class="keywordflow">return</span> draw_plasma(0,0,width-1,height-1,alpha,beta,opacity);
06816     }
06817   
06819 
<a name="l06825"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_34">06825</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_gaussian(<span class="keyword">const</span> <span class="keywordtype">float</span> xc,<span class="keyword">const</span> <span class="keywordtype">double</span> sigma,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06826       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_gaussian"</span>);
06827       <span class="keyword">const</span> <span class="keywordtype">double</span> sigma2 = 2*sigma*sigma;
06828       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06829       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> whz = width*height*depth;
06830       <span class="keyword">const</span> T *col = color;
06831       cimg_mapX(*<span class="keyword">this</span>,x) {
06832         <span class="keyword">const</span> <span class="keywordtype">float</span> dx = (x-xc);
06833         <span class="keyword">const</span> <span class="keywordtype">double</span> val = std::exp( -dx*dx/sigma2 );
06834         T *ptrd = ptr(x,0,0,0);
06835         <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(val*(*col++)); ptrd+=whz; }
06836         <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(nopacity*val*(*col++) + copacity*(*ptrd)); ptrd+=whz; } 
06837         col-=dim;
06838       }
06839       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06840     }
06841 
06843 
<a name="l06850"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_35">06850</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_gaussian(<span class="keyword">const</span> <span class="keywordtype">float</span> xc,<span class="keyword">const</span> <span class="keywordtype">float</span> yc,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; tensor,
06851                                              <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06852       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_gaussian"</span>); 
06853       <span class="keywordflow">if</span> (tensor.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=2 || tensor.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=2 || tensor.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=1 || tensor.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=1) 
06854         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_gaussian() : Tensor parameter must be a 2x2 matrix,"</span>
06855                                     <span class="stringliteral">"given is (%u,%u,%u,%u)"</span>,
06856                                     pixel_type(),tensor.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,tensor.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,tensor.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,tensor.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
06857       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> invT = tensor.<a class="code" href="structcimg__library_1_1CImg.html#z17_14">get_inverse</a>(), invT2 = (invT*invT)/(-2.0);
06858       <span class="keyword">const</span> t &amp;a=invT2(0,0), &amp;b=2*invT2(1,0), &amp;c=invT2(1,1);
06859       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06860       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> whz = width*height*depth;
06861       <span class="keyword">const</span> T *col = color;
06862       cimg_mapXY(*<span class="keyword">this</span>,x,y) {
06863         <span class="keyword">const</span> <span class="keywordtype">float</span> dx = (x-xc), dy = (y-yc);
06864         <span class="keyword">const</span> <span class="keywordtype">double</span> val = std::exp(a*dx*dx + b*dx*dy + c*dy*dy);
06865         T *ptrd = ptr(x,y,0,0);
06866         <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(val*(*col++)); ptrd+=whz; }
06867         <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(nopacity*val*(*col++) + copacity*(*ptrd)); ptrd+=whz; }
06868         col-=dim;
06869       }
06870       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06871     }
06872 
06874 
<a name="l06881"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_36">06881</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_gaussian(<span class="keyword">const</span> <span class="keywordtype">float</span> xc,<span class="keyword">const</span> <span class="keywordtype">float</span> yc,<span class="keyword">const</span> <span class="keywordtype">float</span> sigma,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06882       <span class="keywordflow">return</span> draw_gaussian(xc,yc,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a>::diagonal(sigma,sigma),color,opacity);
06883     }
06884     
06886 
<a name="l06894"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_37">06894</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_gaussian(<span class="keyword">const</span> <span class="keywordtype">float</span> xc,<span class="keyword">const</span> <span class="keywordtype">float</span> yc,<span class="keyword">const</span> <span class="keywordtype">float</span> zc,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; tensor,
06895                                              <span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06896       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::draw_gaussian"</span>);
06897       <span class="keywordflow">if</span> (tensor.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=3 || tensor.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=3 || tensor.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=1 || tensor.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=1)
06898         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::draw_gaussian() : Tensor parameter must be a 3x3 matrix,"</span>
06899                                     <span class="stringliteral">"given is (%u,%u,%u,%u)"</span>,
06900                                     pixel_type(),tensor.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,tensor.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,tensor.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,tensor.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
06901       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> invT = tensor.<a class="code" href="structcimg__library_1_1CImg.html#z17_14">get_inverse</a>(), invT2 = (invT*invT)/(-2.0);
06902       <span class="keyword">const</span> t a=invT(0,0), b=2*invT(1,0), c=2*invT(2,0), d=invT(1,1), e=2*invT(2,1), f=invT(2,2);
06903       <span class="keyword">const</span> <span class="keywordtype">float</span> nopacity = cimg::abs(opacity), copacity = 1-cimg::max(opacity,0.0f);
06904       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> whz = width*height*depth; 
06905       <span class="keyword">const</span> T *col = color;
06906       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
06907         <span class="keyword">const</span> <span class="keywordtype">float</span> dx = (x-xc), dy = (y-yc), dz = (z-zc);
06908         <span class="keyword">const</span> <span class="keywordtype">double</span> val = std::exp(a*dx*dx + b*dx*dy + c*dx*dz + d*dy*dy + e*dy*dz + f*dz*dz);
06909         T *ptrd = ptr(x,y,z,0);
06910         <span class="keywordflow">if</span> (opacity&gt;=1) cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(val*(*col++)); ptrd+=whz; }
06911         <span class="keywordflow">else</span> cimg_mapV(*<span class="keyword">this</span>,k) { *ptrd = (T)(nopacity*val*(*col++) + copacity*(*ptrd)); ptrd+=whz; }
06912         col-=dim;
06913       }
06914       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
06915     }
06916     
06918 
<a name="l06926"></a><a class="code" href="structcimg__library_1_1CImg.html#z13_38">06926</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; draw_gaussian(<span class="keyword">const</span> <span class="keywordtype">float</span> xc,<span class="keyword">const</span> <span class="keywordtype">float</span> yc,<span class="keyword">const</span> <span class="keywordtype">float</span> zc,
06927                         <span class="keyword">const</span> <span class="keywordtype">double</span> sigma,<span class="keyword">const</span> T *<span class="keyword">const</span> color,<span class="keyword">const</span> <span class="keywordtype">float</span> opacity=1) {
06928       <span class="keywordflow">return</span> draw_gaussian(xc,yc,zc,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a>::diagonal(sigma,sigma,sigma),color,opacity);
06929     }
06930     
06932     <span class="comment">//---------------------------------------</span>
06933     <span class="comment">//---------------------------------------</span>
06934     <span class="comment">//</span>
06936 <span class="comment"></span>
06937     <span class="comment">//---------------------------------------</span>
06938     <span class="comment">//---------------------------------------</span>
06939   
06941 
<a name="l06950"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_0">06950</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_correlate(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; mask,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1,<span class="keyword">const</span> <span class="keywordtype">bool</span> weighted_correl=<span class="keyword">false</span>)<span class="keyword"> const </span>{
06951       cimg_test_scalar(mask,<span class="stringliteral">"CImg&lt;T&gt;::get_correlate"</span>);
06952       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(*<span class="keyword">this</span>,<span class="keyword">false</span>);
06953       <span class="keywordflow">if</span> (cond &amp;&amp; mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>==mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> &amp;&amp; ((mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>==1 &amp;&amp; mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&lt;=5) || (mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>==mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> &amp;&amp; mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&lt;=3))) {
06954         <span class="comment">// A special optimization is done for 2x2,3x3,4x4,5x5,2x2x2 and 3x3x3 mask (with cond=1)</span>
06955         <span class="keywordflow">switch</span> (mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>) {
06956         <span class="keywordflow">case</span> 3: {
06957           CImg_3x3x3(I,T);
06958           <span class="keywordflow">if</span> (!weighted_correl) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_corr3x3x3(I,mask);
06959           <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,v,I) {
06960             <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum3x3x3(I);
06961             dest(x,y,z,v) = (norm!=0)?(T)(cimg_corr3x3x3(I,mask)/std::sqrt(norm)):0;
06962           }
06963         } <span class="keywordflow">break</span>;
06964         <span class="keywordflow">case</span> 2: {
06965           CImg_2x2x2(I,T);
06966           <span class="keywordflow">if</span> (!weighted_correl) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2x2(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_corr2x2x2(I,mask);
06967           <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2x2(*<span class="keyword">this</span>,x,y,z,v,I) {
06968             <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum2x2x2(I);
06969             dest(x,y,z,v) = (norm!=0)?(T)(cimg_corr2x2x2(I,mask)/std::sqrt(norm)):0;
06970           }
06971         } <span class="keywordflow">break</span>;
06972         <span class="keywordflow">default</span>:
06973         <span class="keywordflow">case</span> 1:
06974           <span class="keywordflow">switch</span> (mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>) {
06975           <span class="keywordflow">case</span> 5: {
06976             CImg_5x5(I,T);
06977             <span class="keywordflow">if</span> (!weighted_correl) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map5x5(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_corr5x5(I,mask);
06978             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map5x5(*<span class="keyword">this</span>,x,y,z,v,I) {
06979               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum5x5(I);
06980               dest(x,y,z,v) = (norm!=0)?(T)(cimg_corr5x5(I,mask)/std::sqrt(norm)):0;
06981             }            
06982           } <span class="keywordflow">break</span>;          
06983           <span class="keywordflow">case</span> 4: {
06984             CImg_4x4(I,T);
06985             <span class="keywordflow">if</span> (!weighted_correl) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map4x4(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_corr4x4(I,mask);
06986             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map4x4(*<span class="keyword">this</span>,x,y,z,v,I) {
06987               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum4x4(I);
06988               dest(x,y,z,v) = (norm!=0)?(T)(cimg_corr4x4(I,mask)/std::sqrt(norm)):0;
06989             }            
06990           } <span class="keywordflow">break</span>;              
06991           <span class="keywordflow">case</span> 3: {
06992             CImg_3x3(I,T);
06993             <span class="keywordflow">if</span> (!weighted_correl) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_corr3x3(I,mask);
06994             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,v,I) {
06995               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum3x3(I);
06996               dest(x,y,z,v) = (norm!=0)?(T)(cimg_corr3x3(I,mask)/std::sqrt(norm)):0;
06997             }            
06998           } <span class="keywordflow">break</span>;   
06999           <span class="keywordflow">case</span> 2: {
07000             CImg_2x2(I,T);
07001             <span class="keywordflow">if</span> (!weighted_correl) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_corr2x2(I,mask);
07002             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2(*<span class="keyword">this</span>,x,y,z,v,I) {
07003               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum2x2(I);
07004               dest(x,y,z,v) = (norm!=0)?(T)(cimg_corr2x2(I,mask)/std::sqrt(norm)):0;
07005             }            
07006           } <span class="keywordflow">break</span>;  
07007           <span class="keywordflow">case</span> 1: dest = mask(0)*(*this); <span class="keywordflow">break</span>;
07008           }
07009         }
07010       } <span class="keywordflow">else</span> { 
07011         <span class="comment">// Generic version for other masks      </span>
07012         <span class="keyword">const</span> <span class="keywordtype">int</span> cxm=mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>/2, cym=mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>/2, czm=mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>/2, fxm=cxm-1+(mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>%2), fym=cym-1+(mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>%2), fzm=czm-1+(mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>%2);
07013         cimg_mapV(*<span class="keyword">this</span>,v) 
07014           <span class="keywordflow">if</span> (!weighted_correl) {       <span class="comment">// Classical correlation</span>
07015             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=czm; z&lt;dimz()-czm; z++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=cym; y&lt;dimy()-cym; y++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=cxm; x&lt;dimx()-cxm; x++) {
07016               <span class="keywordtype">double</span> val = 0;
07017               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++)
07018                 val+= (*this)(x+xm,y+ym,z+zm,v)*mask(cxm+xm,cym+ym,czm+zm,0);
07019               dest(x,y,z,v)=(T)val;
07020             }
07021             <span class="keywordflow">if</span> (cond) cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07022               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07023                 <span class="keywordtype">double</span> val = 0;
07024                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++)
07025                   val+= neumann_pix3d(x+xm,y+ym,z+zm,v)*mask(cxm+xm,cym+ym,czm+zm,0);
07026                 dest(x,y,z,v)=(T)val;
07027               }
07028             <span class="keywordflow">else</span> cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07029               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07030                 <span class="keywordtype">double</span> val = 0;
07031                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++)  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++)
07032                   val+= dirichlet_pix3d(x+xm,y+ym,z+zm,v,0)*mask(cxm+xm,cym+ym,czm+zm,0);
07033                 dest(x,y,z,v)=(T)val;
07034               }
07035           } <span class="keywordflow">else</span> {      <span class="comment">// Weighted correlation</span>
07036             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=czm; z&lt;dimz()-czm; z++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=cym; y&lt;dimy()-cym; y++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=cxm; x&lt;dimx()-cxm; x++) {
07037               <span class="keywordtype">double</span> val = 0, norm = 0;
07038               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++) {
07039                 <span class="keyword">const</span> T cval = (*this)(x+xm,y+ym,z+zm,v);
07040                 val+= cval*mask(cxm+xm,cym+ym,czm+zm,0);
07041                 norm+= cval*cval;
07042               }
07043               dest(x,y,z,v)=(norm!=0)?(T)(val/std::sqrt(norm)):0;
07044             }
07045             <span class="keywordflow">if</span> (cond) cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07046               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07047                 <span class="keywordtype">double</span> val = 0, norm = 0;
07048                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++) {
07049                   <span class="keyword">const</span> T cval = neumann_pix3d(x+xm,y+ym,z+zm,v);
07050                   val+= cval*mask(cxm+xm,cym+ym,czm+zm,0);
07051                   norm+=cval*cval;
07052                 }
07053                 dest(x,y,z,v)=(norm!=0)?(T)(val/std::sqrt(norm)):0;
07054               }
07055             <span class="keywordflow">else</span> cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07056               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07057                 <span class="keywordtype">double</span> val = 0, norm = 0;
07058                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++) {
07059                   <span class="keyword">const</span> T cval = dirichlet_pix3d(x+xm,y+ym,z+zm,v,0);
07060                   val+= cval*mask(cxm+xm,cym+ym,czm+zm,0);
07061                   norm+= cval*cval;
07062                 }
07063                 dest(x,y,z,v)=(norm!=0)?(T)(val/std::sqrt(norm)):0;
07064               }
07065           }
07066       }
07067       <span class="keywordflow">return</span> dest;
07068     }
07070 
<a name="l07074"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_1">07074</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; correlate(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; mask,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1,<span class="keyword">const</span> <span class="keywordtype">bool</span> weighted_correl=<span class="keyword">false</span>) { 
07075       <span class="keywordflow">return</span> get_correlate(mask,cond,weighted_correl).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); 
07076     }
07077   
07079 
<a name="l07088"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_2">07088</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_convolve(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; mask,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1,<span class="keyword">const</span> <span class="keywordtype">bool</span> weighted_convol=<span class="keyword">false</span>)<span class="keyword"> const </span>{
07089       cimg_test_scalar(mask,<span class="stringliteral">"CImg&lt;T&gt;::get_convolve"</span>);
07090       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(*<span class="keyword">this</span>,<span class="keyword">false</span>);
07091       <span class="keywordflow">if</span> (cond &amp;&amp; mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>==mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> &amp;&amp; ((mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>==1 &amp;&amp; mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&lt;=5) || (mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>==mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> &amp;&amp; mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&lt;=3))) { <span class="comment">// optimized version</span>
07092         <span class="keywordflow">switch</span> (mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>) {
07093         <span class="keywordflow">case</span> 3: {
07094           CImg_3x3x3(I,T);
07095           <span class="keywordflow">if</span> (!weighted_convol) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_conv3x3x3(I,mask);
07096           <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,v,I) {
07097             <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum3x3x3(I);
07098             dest(x,y,z,v) = (norm!=0)?(T)(cimg_conv3x3x3(I,mask)/std::sqrt(norm)):(T)0;
07099           }
07100         } <span class="keywordflow">break</span>;
07101         <span class="keywordflow">case</span> 2: {
07102           CImg_2x2x2(I,T);
07103           <span class="keywordflow">if</span> (!weighted_convol) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2x2(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_conv2x2x2(I,mask);
07104           <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2x2(*<span class="keyword">this</span>,x,y,z,v,I) {
07105             <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum2x2x2(I);
07106             dest(x,y,z,v) = (norm!=0)?(T)(cimg_conv2x2x2(I,mask)/std::sqrt(norm)):(T)0;
07107           }
07108         } <span class="keywordflow">break</span>;
07109         <span class="keywordflow">default</span>:
07110         <span class="keywordflow">case</span> 1:
07111           <span class="keywordflow">switch</span> (mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>) {
07112           <span class="keywordflow">case</span> 5: {
07113             CImg_5x5(I,T);
07114             <span class="keywordflow">if</span> (!weighted_convol) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map5x5(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_conv5x5(I,mask);
07115             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map5x5(*<span class="keyword">this</span>,x,y,z,v,I) {
07116               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum5x5(I);
07117               dest(x,y,z,v) = (norm!=0)?(T)(cimg_conv5x5(I,mask)/std::sqrt(norm)):(T)0;
07118             }            
07119           } <span class="keywordflow">break</span>;          
07120           <span class="keywordflow">case</span> 4: {
07121             CImg_4x4(I,T);
07122             <span class="keywordflow">if</span> (!weighted_convol) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map4x4(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_conv4x4(I,mask);
07123             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map4x4(*<span class="keyword">this</span>,x,y,z,v,I) {
07124               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum4x4(I);
07125               dest(x,y,z,v) = (norm!=0)?(T)(cimg_conv4x4(I,mask)/std::sqrt(norm)):(T)0;
07126             }
07127           } <span class="keywordflow">break</span>;              
07128           <span class="keywordflow">case</span> 3: {
07129             CImg_3x3(I,T);
07130             <span class="keywordflow">if</span> (!weighted_convol) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_conv3x3(I,mask);
07131             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map3x3(*<span class="keyword">this</span>,x,y,z,v,I) {
07132               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum3x3(I);
07133               dest(x,y,z,v) = (norm!=0)?(T)(cimg_conv3x3(I,mask)/std::sqrt(norm)):(T)0;
07134             }            
07135           } <span class="keywordflow">break</span>;   
07136           <span class="keywordflow">case</span> 2: {
07137             CImg_2x2(I,T);
07138             <span class="keywordflow">if</span> (!weighted_convol) cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2(*<span class="keyword">this</span>,x,y,z,v,I) dest(x,y,z,v) = (T)cimg_conv2x2(I,mask);
07139             <span class="keywordflow">else</span> cimg_mapZV(*<span class="keyword">this</span>,z,v) cimg_map2x2(*<span class="keyword">this</span>,x,y,z,v,I) {
07140               <span class="keyword">const</span> <span class="keywordtype">double</span> norm = (double)cimg_squaresum2x2(I);
07141               dest(x,y,z,v) = (norm!=0)?(T)(cimg_conv2x2(I,mask)/std::sqrt(norm)):(T)0;
07142             } 
07143           } <span class="keywordflow">break</span>;  
07144           <span class="keywordflow">case</span> 1: dest = mask(0)*(*this); <span class="keywordflow">break</span>;
07145           }
07146         }
07147       } <span class="keywordflow">else</span> { <span class="comment">// generic version</span>
07148           
07149         <span class="keyword">const</span> <span class="keywordtype">int</span> cxm=mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>/2, cym=mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>/2, czm=mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>/2, fxm=cxm-1+(mask.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>%2), fym=cym-1+(mask.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>%2), fzm=czm-1+(mask.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>%2);
07150         cimg_mapV(*<span class="keyword">this</span>,v) 
07151           <span class="keywordflow">if</span> (!weighted_convol) {       <span class="comment">// Classical convolution</span>
07152             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=czm; z&lt;dimz()-czm; z++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=cym; y&lt;dimy()-cym; y++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=cxm; x&lt;dimx()-cxm; x++) {
07153               <span class="keywordtype">double</span> val = 0;
07154               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++)
07155                 val+= (*this)(x-xm,y-ym,z-zm,v)*mask(cxm+xm,cym+ym,czm+zm,0);
07156               dest(x,y,z,v)=(T)val;
07157             }
07158             <span class="keywordflow">if</span> (cond) cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07159               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07160                 <span class="keywordtype">double</span> val = 0;
07161                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++)
07162                   val+= neumann_pix3d(x-xm,y-ym,z-zm,v)*mask(cxm+xm,cym+ym,czm+zm,0);
07163                 dest(x,y,z,v)=(T)val;
07164               }
07165             <span class="keywordflow">else</span> cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07166               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07167                 <span class="keywordtype">double</span> val = 0;
07168                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++)  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++)
07169                   val+= dirichlet_pix3d(x-xm,y-ym,z-zm,v,0)*mask(cxm+xm,cym+ym,czm+zm,0);
07170                 dest(x,y,z,v)=(T)val;
07171               }
07172           } <span class="keywordflow">else</span> {      <span class="comment">// Weighted convolution</span>
07173             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> z=czm; z&lt;dimz()-czm; z++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=cym; y&lt;dimy()-cym; y++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=cxm; x&lt;dimx()-cxm; x++) {
07174               <span class="keywordtype">double</span> val = 0, norm = 0;
07175               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++) {
07176                 <span class="keyword">const</span> T cval = (*this)(x-xm,y-ym,z-zm,v);
07177                 val+= cval*mask(cxm+xm,cym+ym,czm+zm,0);
07178                 norm+= cval*cval;
07179               }
07180               dest(x,y,z,v)=(norm!=0)?(T)(val/std::sqrt(norm)):(T)0;
07181             }
07182             <span class="keywordflow">if</span> (cond) cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07183               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07184                 <span class="keywordtype">double</span> val = 0, norm = 0;
07185                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++) {
07186                   <span class="keyword">const</span> T cval = neumann_pix3d(x-xm,y-ym,z-zm,v);
07187                   val+= cval*mask(cxm+xm,cym+ym,czm+zm,0);
07188                   norm+=cval*cval;
07189                 }
07190                 dest(x,y,z,v)=(norm!=0)?(T)(val/std::sqrt(norm)):(T)0;
07191               }
07192             <span class="keywordflow">else</span> cimg_mapYZV(*<span class="keyword">this</span>,y,z,v)
07193               <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0; x&lt;dimx(); (y&lt;cym || y&gt;=dimy()-cym || z&lt;czm || z&gt;=dimz()-czm)?x++:((x&lt;cxm-1 || x&gt;=dimx()-cxm)?x++:(x=dimx()-cxm))) {
07194                 <span class="keywordtype">double</span> val = 0, norm = 0;
07195                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> zm=-czm; zm&lt;=fzm; zm++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ym=-cym; ym&lt;=fym; ym++)  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xm=-cxm; xm&lt;=fxm; xm++) {
07196                   <span class="keyword">const</span> T cval = dirichlet_pix3d(x-xm,y-ym,z-zm,v,0);
07197                   val+= cval*mask(cxm+xm,cym+ym,czm+zm,0);
07198                   norm+= cval*cval;
07199                 }
07200                 dest(x,y,z,v)=(norm!=0)?(T)(val/std::sqrt(norm)):(T)0;
07201               }
07202           }
07203       }
07204       <span class="keywordflow">return</span> dest;
07205     }
07206   
07208 
<a name="l07212"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_3">07212</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; convolve(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; mask,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1,<span class="keyword">const</span> <span class="keywordtype">bool</span> weighted_convol=<span class="keyword">false</span>) {
07213       <span class="keywordflow">return</span> get_convolve(mask,cond,weighted_convol).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); 
07214     }
07215 
07217 
<a name="l07221"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_4">07221</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; noise(<span class="keyword">const</span> <span class="keywordtype">double</span> sigma=-20,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ntype=0) {
07222       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::noise"</span>);
07223       T tmp;
07224       <span class="keywordtype">double</span> nsigma = sigma, max = (double)cimg::get_type_max(tmp), min = (double)cimg::get_type_min(tmp);
07225       <span class="keyword">static</span> <span class="keywordtype">bool</span> first_time = <span class="keyword">true</span>;
07226       <span class="keywordflow">if</span> (first_time) { std::srand((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)::time(NULL)); first_time = <span class="keyword">false</span>; }
07227       <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st;
07228       <span class="keywordflow">if</span> (nsigma==0) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07229       <span class="keywordflow">if</span> (nsigma&lt;0 || ntype==2) st = <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a>(*<span class="keyword">this</span>,<span class="keyword">false</span>);
07230       <span class="keywordflow">if</span> (nsigma&lt;0) nsigma = -nsigma*(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>-st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>)/100.0;
07231       <span class="keywordflow">switch</span> (ntype) {
07232       <span class="keywordflow">case</span> 0: { <span class="comment">// Gaussian noise</span>
07233         cimg_map(*<span class="keyword">this</span>,ptr,T) {
07234           <span class="keywordtype">double</span> val = *ptr+nsigma*cimg::grand(); 
07235           <span class="keywordflow">if</span> (val&gt;max) val = max;
07236           <span class="keywordflow">if</span> (val&lt;min) val = min;
07237           *ptr = (T)val;
07238         }
07239       } <span class="keywordflow">break</span>;
07240       <span class="keywordflow">case</span> 1: { <span class="comment">// Uniform noise</span>
07241         cimg_map(*<span class="keyword">this</span>,ptr,T) {
07242           <span class="keywordtype">double</span> val = *ptr+nsigma*cimg::crand();
07243           <span class="keywordflow">if</span> (val&gt;max) val = max;
07244           <span class="keywordflow">if</span> (val&lt;min) val = min;
07245           *ptr = (T)val;
07246         }
07247       } <span class="keywordflow">break</span>;
07248       <span class="keywordflow">case</span> 2: { <span class="comment">// Salt &amp; Pepper noise</span>
07249         <span class="keywordflow">if</span> (st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>==st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>) { st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>=0; st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>=255; }
07250         cimg_map(*<span class="keyword">this</span>,ptr,T) <span class="keywordflow">if</span> (cimg::rand()*100&lt;nsigma) *ptr=(T)(cimg::rand()&lt;0.5?st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>:st.<a class="code" href="structcimg__library_1_1CImgStats.html#o0">min</a>);
07251       } <span class="keywordflow">break</span>;
07252       }
07253       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07254     }
07255     
07257 
<a name="l07262"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_5">07262</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_noise(<span class="keyword">const</span> <span class="keywordtype">double</span> sigma=-20,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ntype=0)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).noise(sigma,ntype); }
07263 
07264 
07265 <span class="preprocessor">#define cimg_deriche_map(x0,y0,z0,k0,nb,offset,T) {                           \</span>
07266 <span class="preprocessor">    ima = ptr(x0,y0,z0,k0);                                                   \</span>
07267 <span class="preprocessor">    I2 = *ima; ima+=offset; I1 = *ima; ima+=offset;                           \</span>
07268 <span class="preprocessor">    Y2 = *(Y++) = sumg0*I2; Y1 = *(Y++) = g0*I1 + sumg1*I2;                   \</span>
07269 <span class="preprocessor">    for (i=2; i&lt;(nb); i++) { I1 = *ima; ima+=offset;                          \</span>
07270 <span class="preprocessor">        Y0 = *(Y++) = a1*I1 + a2*I2 + b1*Y1 + b2*Y2;                          \</span>
07271 <span class="preprocessor">        I2=I1; Y2=Y1; Y1=Y0; }                                                \</span>
07272 <span class="preprocessor">    ima-=offset; I2 = *ima; Y2 = Y1 = parity*sumg1*I2; *ima = (T)(*(--Y)+Y2); \</span>
07273 <span class="preprocessor">    ima-=offset; I1 = *ima; *ima = (T)(*(--Y)+Y1);                            \</span>
07274 <span class="preprocessor">    for (i=(nb)-3; i&gt;=0; i--) { Y0=a3*I1+a4*I2+b1*Y1+b2*Y2; ima-=offset;      \</span>
07275 <span class="preprocessor">      I2=I1; I1=*ima; *ima=(T)(*(--Y)+Y0); Y2=Y1; Y1=Y0; }                    \</span>
07276 <span class="preprocessor">  }</span>
07277 <span class="preprocessor"></span>
07279 
<a name="l07283"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_6">07283</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; deriche(<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=1,<span class="keyword">const</span> <span class="keywordtype">int</span> order=0,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1) {
07284       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::deriche"</span>);
07285       <span class="keywordflow">if</span> (sigma&lt;0 || order&lt;0 || order&gt;2)
07286         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::deriche() : Bad arguments (sigma=%g, order=%d)"</span>,pixel_type(),sigma,order);
07287       <span class="keyword">const</span> <span class="keywordtype">float</span> alpha=sigma&gt;0?(1.695f/sigma):20,ea=(float)std::exp(alpha),ema=(float)std::exp(-alpha),em2a=ema*ema,b1=2*ema,b2=-em2a;
07288       <span class="keywordtype">float</span> ek,ekn,parity,a1,a2,a3,a4,g0,sumg1,sumg0;
07289       <span class="keywordtype">double</span> *Y,Y0,Y1,Y2;
07290       <span class="keywordtype">int</span> i,offset,nb;
07291       T *ima,I1,I2;
07292       <span class="keywordflow">switch</span>(order) {
07293       <span class="keywordflow">case</span> 1:                 <span class="comment">// first derivative</span>
07294         ek = -(1-ema)*(1-ema)*(1-ema)/(2*(ema+1)*ema); a1 = a4 = 0;  a2 = ek*ema; a3 = -ek*ema; parity =-1;\
07295         <span class="keywordflow">if</span> (cond) { sumg1 = (ek*ea) / ((ea-1)*(ea-1)); g0 = 0; sumg0 = g0+sumg1; } \
07296         <span class="keywordflow">else</span> g0 = sumg0 = sumg1 = 0;
07297         <span class="keywordflow">break</span>;
07298       <span class="keywordflow">case</span> 2:               <span class="comment">// second derivative</span>
07299         ekn = ( -2*(-1+3*ea-3*ea*ea+ea*ea*ea)/(3*ea+1+3*ea*ea+ea*ea*ea) );
07300         ek = -(em2a-1)/(2*alpha*ema); a1 = ekn;  a2 = -ekn*(1+ek*alpha)*ema; a3 = ekn*(1-ek*alpha)*ema; a4 = -ekn*em2a; parity =1;
07301         <span class="keywordflow">if</span> (cond) { sumg1 = ekn/2; g0 = ekn; sumg0 = g0+sumg1; }
07302         <span class="keywordflow">else</span> g0=sumg0=sumg1=0;
07303         <span class="keywordflow">break</span>;
07304       <span class="keywordflow">default</span>:              <span class="comment">// smoothing</span>
07305         ek = (1-ema)*(1-ema) / (1+2*alpha*ema - em2a); a1 = ek;  a2 = ek*ema*(alpha-1); a3 = ek*ema*(alpha+1); a4 = -ek*em2a; parity = 1;
07306         <span class="keywordflow">if</span> (cond) { sumg1 = ek*(alpha*ea+ea-1) / ((ea-1)*(ea-1)); g0 = ek; sumg0 = g0+sumg1; }
07307         <span class="keywordflow">else</span>  g0=sumg0=sumg1=0;
07308         <span class="keywordflow">break</span>;
07309       }
07310       <span class="comment">// filter init</span>
07311       Y = <span class="keyword">new</span> <span class="keywordtype">double</span>[cimg::max(width,height,depth)];
07312       <span class="keywordflow">switch</span>(cimg::uncase(axe)) {
07313       <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: <span class="keywordflow">if</span> (width&gt;1)  { offset = 1;            nb = width;  cimg_mapYZV(*<span class="keyword">this</span>,y,z,k) cimg_deriche_map(0,y,z,k,nb,offset,T); }   <span class="keywordflow">break</span>;
07314       <span class="keywordflow">case</span> <span class="charliteral">'y'</span>: <span class="keywordflow">if</span> (height&gt;1) { offset = width;        nb = height; cimg_mapXZV(*<span class="keyword">this</span>,x,z,k) cimg_deriche_map(x,0,z,k,nb,offset,T); }   <span class="keywordflow">break</span>;
07315       <span class="keywordflow">case</span> <span class="charliteral">'z'</span>: <span class="keywordflow">if</span> (depth&gt;1)  { offset = width*height; nb = depth;  cimg_mapXYV(*<span class="keyword">this</span>,x,y,k) cimg_deriche_map(x,y,0,k,nb,offset,T); }   <span class="keywordflow">break</span>;
07316       <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::deriche() : unknow axe '%c', must be 'x','y' or 'z'"</span>,pixel_type(),axe);
07317       }
07318       <span class="keyword">delete</span>[] Y;
07319       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07320     }
07322 
<a name="l07327"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_7">07327</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_deriche(<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=1,<span class="keyword">const</span> <span class="keywordtype">int</span> order=0,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1)<span class="keyword"> const </span>{
07328       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).deriche(sigma,order,axe,cond);
07329     }
07330 
07332 
<a name="l07336"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_8">07336</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; blur(<span class="keyword">const</span> <span class="keywordtype">float</span> sigmax,<span class="keyword">const</span> <span class="keywordtype">float</span> sigmay,<span class="keyword">const</span> <span class="keywordtype">float</span> sigmaz,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1) {
07337       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::blur"</span>);
07338       <span class="keywordflow">if</span> (width&gt;1  &amp;&amp; sigmax&gt;0) deriche(sigmax,0,<span class="charliteral">'x'</span>,cond);
07339       <span class="keywordflow">if</span> (height&gt;1 &amp;&amp; sigmay&gt;0) deriche(sigmay,0,<span class="charliteral">'y'</span>,cond);
07340       <span class="keywordflow">if</span> (depth&gt;1  &amp;&amp; sigmaz&gt;0) deriche(sigmaz,0,<span class="charliteral">'z'</span>,cond);
07341       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07342     }
07343 
<a name="l07345"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_9">07345</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; blur(<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1) { <span class="keywordflow">return</span> blur(sigma,sigma,sigma,cond); }
07346 
07348 
<a name="l07351"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_10">07351</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_blur(<span class="keyword">const</span> <span class="keywordtype">float</span> sigmax,<span class="keyword">const</span> <span class="keywordtype">float</span> sigmay,<span class="keyword">const</span> <span class="keywordtype">float</span> sigmaz,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1)<span class="keyword"> const </span>{
07352       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).blur(sigmax,sigmay,sigmaz,cond); 
07353     }
07354     
<a name="l07356"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_11">07356</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_blur(<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=1,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cond=1)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).blur(sigma,cond); }
07357 
07359     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; 
<a name="l07360"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_12">07360</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; blur_anisotropic(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; G, <span class="keyword">const</span> <span class="keywordtype">float</span> amplitude=10.0f, <span class="keyword">const</span> <span class="keywordtype">float</span> dl=0.8f,<span class="keyword">const</span> <span class="keywordtype">float</span> da=45.0f,
07361                            <span class="keyword">const</span> <span class="keywordtype">float</span> gauss_prec=2.0f, <span class="keyword">const</span> <span class="keywordtype">bool</span> linear=<span class="keyword">false</span>) {
07362       
07363       <span class="comment">// Check arguments and init variables</span>
07364       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"blur_anisotropic"</span>);
07365       cimg_test(G,<span class="stringliteral">"blur_anisotropic"</span>);
07366       <span class="keywordflow">if</span> ((G.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=3 &amp;&amp; G.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=6) || G.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=width || G.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=height || G.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=depth)
07367         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::blur_anisotropic() : Input tensor field G has wrong dimensions (%u,%u,%u,%u)."</span>,
07368                                 pixel_type(),G.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,G.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,G.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,G.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
07369       
07370       <span class="keyword">const</span> <span class="keywordtype">int</span> dx1 = dimx()-1, dy1 = dimy()-1, dz1 = dimz()-1;
07371       <span class="keyword">const</span> <span class="keywordtype">bool</span> threed = (G.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>&gt;=6);
07372       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> dest(width,height,depth,dim,0), tmp(dim), W(width,height,depth,threed?3:2);
07373       <span class="keywordtype">int</span> N = 0;
07374       
07375       <span class="keywordflow">if</span> (threed)
07376         <span class="comment">// 3D version of the algorithm</span>
07377         <span class="comment">//-----------------------------</span>
07378         <span class="keywordflow">for</span> (<span class="keywordtype">float</span> phi=(180%(int)da)/2.0f; phi&lt;=180; phi+=da) {
07379           <span class="keyword">const</span> <span class="keywordtype">float</span> phir = phi*cimg::PI/180, datmp = da/std::cos(phir), da2 = datmp&lt;1?360:datmp;
07380           <span class="keywordflow">for</span> (<span class="keywordtype">float</span> theta=0; theta&lt;360; (theta+=da2),N++) {
07381             <span class="keyword">const</span> <span class="keywordtype">float</span> thetar = theta*cimg::PI/180,
07382               vx = (float)std::cos(thetar)*std::cos(phir),
07383               vy = (float)std::sin(thetar)*std::cos(phir),
07384               vz = (float)std::sin(phir);
07385             <span class="keyword">const</span> t 
07386               *pa = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0), *pb = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1), *pc = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,2),
07387               *pd = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,3), *pe = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,4), *pf = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,5);
07388             t *pd0 = W.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0), *pd1 = W.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1), *pd2 = W.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,2);
07389             cimg_mapXYZ(G,xg,yg,zg) {
07390               <span class="keyword">const</span> t
07391                 a = *(pa++), b = *(pb++), c = *(pc++),
07392                 d = *(pd++), e = *(pe++), f = *(pf++),
07393                 u = a*vx + b*vy + c*vz,
07394                 v = b*vx + d*vy + e*vz,
07395                 w = c*vx + e*vy + f*vz,
07396                 n = dl/std::sqrt(1e-5+u*u+v*v+w*w);
07397               *(pd0++) = u*n;
07398               *(pd1++) = v*n;
07399               *(pd2++) = w*n;
07400             }
07401 
07402             cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
07403               tmp.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(0);
07404               <span class="keyword">const</span> t cu = W(x,y,z,0), cv = W(x,y,z,1), cw = W(x,y,z,2);
07405               <span class="keyword">const</span> <span class="keywordtype">float</span>
07406                 fsigma = (float)(2*std::sqrt((cu*cu+cv*cv+cw*cw)*amplitude)),
07407                 length = gauss_prec*fsigma,
07408                 fsigma2 = 2*fsigma*fsigma;
07409               <span class="keywordtype">float</span> l, S=0, pu=cu, pv=cv, pw=cw, X=(float)x, Y=(float)y, Z=z+cw;
07410               <span class="keywordflow">if</span> (linear) <span class="keywordflow">for</span> (l=0; l&lt;length; l+=dl) {
07411                 <span class="keyword">const</span> <span class="keywordtype">float</span> coef = (float)std::exp(-l*l/fsigma2);
07412                 t u = (t)(W.<a class="code" href="structcimg__library_1_1CImg.html#z3_18">linear_pix3d</a>(X,Y,Z,0)), v = (t)(W.<a class="code" href="structcimg__library_1_1CImg.html#z3_18">linear_pix3d</a>(X,Y,Z,1)), w = (t)(W.<a class="code" href="structcimg__library_1_1CImg.html#z3_18">linear_pix3d</a>(X,Y,Z,2));
07413                 <span class="keywordflow">if</span> ((pu*u+pv*v+pw*w)&lt;0) { u=-u; v=-v; w=-w; }
07414                 cimg_mapV(*<span class="keyword">this</span>,k) tmp[k]+=(t)(coef*linear_pix3d(X,Y,Z,k));
07415                 X+=(pu=u); Y+=(pv=v); Z+=(pw=w); S+=coef;
07416               } <span class="keywordflow">else</span> <span class="keywordflow">for</span> (l=0; l&lt;length; l+=dl) {
07417                 <span class="keyword">const</span> <span class="keywordtype">float</span> 
07418                   coef = (float)std::exp(-l*l/fsigma2),
07419                   Xn = X&lt;0?0:(X&gt;=dx1?dx1:X),
07420                   Yn = Y&lt;0?0:(Y&gt;=dy1?dy1:Y),
07421                   Zn = Z&lt;0?0:(Z&gt;=dz1?dz1:Z);
07422                 <span class="keyword">const</span> <span class="keywordtype">int</span> xi = (int)(Xn+0.5f), yi = (int)(Yn+0.5f), zi = (int)(Zn+0.5f);
07423                 t u = W(xi,yi,zi,0), v = W(xi,yi,zi,1), w = W(xi,yi,zi,2);
07424                 <span class="keywordflow">if</span> ((pu*u+pv*v+pw*w)&lt;0) { u=-u; v=-v; w=-w; }
07425                 cimg_mapV(*<span class="keyword">this</span>,k) tmp[k]+=(t)(coef*(*this)(xi,yi,zi,k));
07426                 X+=(pu=u); Y+=(pv=v); Z+=(pw=w); S+=coef;
07427               }
07428               <span class="keywordflow">if</span> (S&gt;0) cimg_mapV(dest,k) dest(x,y,z,k)+=tmp[k]/S;
07429               <span class="keywordflow">else</span> cimg_mapV(dest,k) dest(x,y,z,k)+=(t)((*this)(x,y,z,k));
07430             }
07431           }
07432         } <span class="keywordflow">else</span>
07433           <span class="comment">// 2D version of the algorithm</span>
07434           <span class="comment">//-----------------------------</span>
07435           <span class="keywordflow">for</span> (<span class="keywordtype">float</span> theta=(360%(int)da)/2.0f; theta&lt;360; (theta+=da),N++) {
07436             <span class="keyword">const</span> <span class="keywordtype">float</span> thetar = theta*cimg::PI/180, vx = std::cos(thetar), vy = std::sin(thetar);
07437 
07438             <span class="keyword">const</span> t *pa = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0), *pb = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1), *pc = G.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,2);
07439             t *pd0 = W.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0), *pd1 = W.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1);
07440             cimg_mapXY(G,xg,yg) {
07441               <span class="keyword">const</span> t
07442                 a = *(pa++), b = *(pb++), c = *(pc++), 
07443                 u = a*vx + b*vy, v = b*vx + c*vy,
07444                 n = dl/std::sqrt(1e-5+u*u+v*v);
07445               *(pd0++) = u*n;
07446               *(pd1++) = v*n;
07447             }
07448         
07449             cimg_mapXY(*<span class="keyword">this</span>,x,y) {
07450               tmp.<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(0);
07451               <span class="keyword">const</span> t cu = W(x,y,0,0), cv = W(x,y,0,1);
07452               <span class="keyword">const</span> <span class="keywordtype">float</span>
07453                 fsigma = (float)(2*std::sqrt((cu*cu+cv*cv)*amplitude)),
07454                 length = gauss_prec*fsigma,
07455                 fsigma2 = 2*fsigma*fsigma;
07456               <span class="keywordtype">float</span> l, S=0, pu=cu, pv=cv, X=(float)x, Y=(float)y;
07457               <span class="keywordflow">if</span> (linear) <span class="keywordflow">for</span> (l=0; l&lt;length; l+=dl) {
07458                 <span class="keyword">const</span> <span class="keywordtype">float</span> coef = (float)std::exp(-l*l/fsigma2);
07459                 t u = (t)(W.<a class="code" href="structcimg__library_1_1CImg.html#z3_19">linear_pix2d</a>(X,Y,0,0)), v = (t)(W.<a class="code" href="structcimg__library_1_1CImg.html#z3_19">linear_pix2d</a>(X,Y,0,1));
07460                 <span class="keywordflow">if</span> ((pu*u+pv*v)&lt;0) { u=-u; v=-v; }
07461                 cimg_mapV(*<span class="keyword">this</span>,k) tmp[k]+=(t)(coef*linear_pix2d(X,Y,0,k));
07462                 X+=(pu=u); Y+=(pv=v); S+=coef;
07463               } <span class="keywordflow">else</span> <span class="keywordflow">for</span> (l=0; l&lt;length; l+=dl) {
07464                 <span class="keyword">const</span> <span class="keywordtype">float</span> 
07465                   coef = (float)std::exp(-l*l/fsigma2),
07466                   Xn = X&lt;0?0:(X&gt;=dx1?dx1:X),
07467                   Yn = Y&lt;0?0:(Y&gt;=dy1?dy1:Y);
07468                 <span class="keyword">const</span> <span class="keywordtype">int</span> xi = (int)(Xn+0.5f), yi = (int)(Yn+0.5f);
07469                 t u = W(xi,yi,0,0), v = W(xi,yi,0,1);
07470                 <span class="keywordflow">if</span> ((pu*u+pv*v)&lt;0) { u=-u; v=-v; }
07471                 cimg_mapV(*<span class="keyword">this</span>,k) tmp[k]+=(t)(coef*(*this)(xi,yi,0,k));
07472                 X+=(pu=u); Y+=(pv=v); S+=coef;
07473               }
07474               <span class="keywordflow">if</span> (S&gt;0) cimg_mapV(dest,k) dest(x,y,0,k)+=tmp[k]/S;
07475               <span class="keywordflow">else</span> cimg_mapV(dest,k) dest(x,y,0,k)+=(t)((*this)(x,y,0,k));
07476             }
07477           }
07478       <span class="keyword">const</span> <span class="keywordtype">float</span> *ptrs = dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>+dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>(); cimg_map(*<span class="keyword">this</span>,ptrd,T) *ptrd = (T)(*(--ptrs)/N);
07479       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07480     }
07481 
07483 
07491     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt;
<a name="l07492"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_13">07492</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_blur_anisotropic(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; G, <span class="keyword">const</span> <span class="keywordtype">float</span> amplitude=10.0f, <span class="keyword">const</span> <span class="keywordtype">float</span> dl=0.8f,<span class="keyword">const</span> <span class="keywordtype">float</span> da=45.0f,
07493                               <span class="keyword">const</span> <span class="keywordtype">float</span> gauss_prec=2.0f, <span class="keyword">const</span> <span class="keywordtype">bool</span> linear=<span class="keyword">false</span>)<span class="keyword"> const </span>{
07494       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z15_12">blur_anisotropic</a>(G,amplitude,dl,da,gauss_prec,linear);
07495     }
07496 
<a name="l07498"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_14">07498</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; blur_anisotropic(<span class="keyword">const</span> <span class="keywordtype">float</span> amplitude, <span class="keyword">const</span> <span class="keywordtype">float</span> sharpness=1.5f, <span class="keyword">const</span> <span class="keywordtype">float</span> anisotropy=0.7f,
07499                            <span class="keyword">const</span> <span class="keywordtype">float</span> alpha=0.2f,<span class="keyword">const</span> <span class="keywordtype">float</span> sigma=0.8f, <span class="keyword">const</span> <span class="keywordtype">float</span> dl=0.8f,<span class="keyword">const</span> <span class="keywordtype">float</span> da=45.0f,
07500                            <span class="keyword">const</span> <span class="keywordtype">float</span> gauss_prec=2.0f, <span class="keyword">const</span> <span class="keywordtype">bool</span> linear=<span class="keyword">false</span>) {
07501   
07502       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"blur_anisotropic"</span>);
07503       <span class="keyword">const</span> <span class="keywordtype">bool</span> threed = (depth&gt;1);
07504       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> G(width,height,depth,(threed?6:3),0);
07505       <span class="keyword">const</span> <span class="keywordtype">float</span> power1 = 0.5f*sharpness, power2 = (1+anisotropy)/(1e-10+1-anisotropy)*power1;
07506       <span class="keywordtype">float</span> nmax = 0;
07507 
07508       <span class="keywordflow">if</span> (threed) { <span class="comment">// Field for 3D volumes    </span>
07509         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> val(3),vec(3,3);
07510         CImg_3x3x3(I,<span class="keywordtype">float</span>);
07511         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> blurred = get_blur(alpha);
07512         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3x3(blurred,x,y,z,k,I) {
07513           <span class="keyword">const</span> <span class="keywordtype">float</span> 
07514             ixf = Incc-Iccc, iyf = Icnc-Iccc, izf = Iccn-Iccc,
07515             ixb = Iccc-Ipcc, iyb = Iccc-Icpc, izb = Iccc-Iccp;
07516           G(x,y,z,0) += 0.5f*(ixf*ixf + ixb*ixb);
07517           G(x,y,z,1) += 0.25f*(ixf*iyf + ixf*iyb + ixb*iyf + ixb*iyb);
07518           G(x,y,z,2) += 0.25f*(ixf*izf + ixf*izb + ixb*izf + ixb*izb);
07519           G(x,y,z,3) += 0.5f*(iyf*iyf + iyb*iyb);
07520           G(x,y,z,4) += 0.25f*(iyf*izf + iyf*izb + iyb*izf + iyb*izb);
07521           G(x,y,z,5) += 0.5f*(izf*izf + izb*izb);
07522         }
07523         G.<a class="code" href="structcimg__library_1_1CImg.html#z15_8">blur</a>(sigma);
07524         cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) {
07525           G.<a class="code" href="structcimg__library_1_1CImg.html#z17_4">get_tensor</a>(x,y,z).<a class="code" href="structcimg__library_1_1CImg.html#z17_28">symeigen</a>(val,vec);
07526           <span class="keyword">const</span> <span class="keywordtype">float</span> l1 = val[2], l2 = val[1], l3 = val[0],
07527             ux = vec(2,0), uy = vec(2,1), uz = vec(2,2),
07528             vx = vec(1,0), vy = vec(1,1), vz = vec(1,2),
07529             wx = vec(0,0), wy = vec(0,1), wz = vec(0,2),
07530             n1 = (float)(1.0/std::pow(1.0f+l1+l2+l3,power1)),
07531             n2 = (float)(1.0/std::pow(1.0f+l1+l2+l3,power2)),
07532             nm = cimg::max(n1,n2);
07533           G(x,y,z,0) = n1*(ux*ux + vx*vx) + n2*wx*wx;
07534           G(x,y,z,1) = n1*(ux*uy + vx*vy) + n2*wx*wy;
07535           G(x,y,z,2) = n1*(ux*uz + vx*vz) + n2*wx*wz;
07536           G(x,y,z,3) = n1*(uy*uy + vy*vy) + n2*wy*wy;
07537           G(x,y,z,4) = n1*(uy*uz + vy*vz) + n2*wy*wz;
07538           G(x,y,z,5) = n1*(uz*uz + vz*vz) + n2*wz*wz;
07539           <span class="keywordflow">if</span> (nm&gt;nmax) nmax = nm;
07540         }
07541       } <span class="keywordflow">else</span> { <span class="comment">// Field for 2D images</span>
07542         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;float&gt;</a> val(2),vec(2,2);
07543         CImg_3x3(I,<span class="keywordtype">float</span>);
07544         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> blurred = get_blur(alpha);
07545         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3(blurred,x,y,0,k,I) {
07546           <span class="keyword">const</span> <span class="keywordtype">float</span>
07547             ixf = Inc-Icc, iyf = Icn-Icc,
07548             ixb = Icc-Ipc, iyb = Icc-Icp;
07549           G(x,y,0,0) += 0.5f*(ixf*ixf+ixb*ixb);
07550           G(x,y,0,1) += 0.25f*(ixf*iyf+ixf*iyb+ixb*iyf+ixb*iyb);
07551           G(x,y,0,2) += 0.5f*(iyf*iyf+iyb*iyb);
07552         }
07553         G.<a class="code" href="structcimg__library_1_1CImg.html#z15_8">blur</a>(sigma);
07554         cimg_mapXY(*<span class="keyword">this</span>,x,y) {
07555           G.<a class="code" href="structcimg__library_1_1CImg.html#z17_4">get_tensor</a>(x,y).<a class="code" href="structcimg__library_1_1CImg.html#z17_28">symeigen</a>(val,vec);
07556           <span class="keyword">const</span> <span class="keywordtype">float</span> l1 = val[0], l2 = val[1],
07557             ux = vec[0], uy = vec[1],
07558             vx = vec[2], vy = vec[3],
07559             n1 = (float)(1.0/std::pow(1.0f+l1+l2,power1)),
07560             n2 = (float)(1.0/std::pow(1.0f+l1+l2,power2)),
07561             nm = cimg::max(n1,n2);
07562           G(x,y,0,0) = n1*ux*ux + n2*vx*vx;
07563           G(x,y,0,1) = n1*ux*uy + n2*vx*vy;
07564           G(x,y,0,2) = n1*uy*uy + n2*vy*vy;
07565           <span class="keywordflow">if</span> (nm&gt;nmax) nmax = nm;
07566         }
07567       }
07568       G/=nmax;
07569       <span class="keywordflow">return</span> blur_anisotropic(G,amplitude,dl,da,gauss_prec,linear);
07570     }
07571 
07573 
<a name="l07583"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_15">07583</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_blur_anisotropic(<span class="keyword">const</span> <span class="keywordtype">float</span> amplitude, <span class="keyword">const</span> <span class="keywordtype">float</span> sharpness=1.5f, <span class="keyword">const</span> <span class="keywordtype">float</span> anisotropy=0.7f,
07584                               <span class="keyword">const</span> <span class="keywordtype">float</span> alpha=0.2f, <span class="keyword">const</span> <span class="keywordtype">float</span> sigma=0.8f, <span class="keyword">const</span> <span class="keywordtype">float</span> dl=0.8f,
07585                               <span class="keyword">const</span> <span class="keywordtype">float</span> da=45.0f, <span class="keyword">const</span> <span class="keywordtype">float</span> gauss_prec=2.0f, <span class="keyword">const</span> <span class="keywordtype">bool</span> linear=<span class="keyword">false</span>)<span class="keyword"> const </span>{
07586   
07587       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z15_12">blur_anisotropic</a>(amplitude,sharpness,anisotropy,alpha,sigma,dl,da,gauss_prec,linear);
07588     }
07589 
<a name="l07591"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_16">07591</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_erode(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=1) {
07592       CImg_3x3x3(I,T);
07593       <span class="keywordflow">if</span> (n==1) {
07594         <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(*<span class="keyword">this</span>);
07595         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,k,I) 
07596           <span class="keywordflow">if</span> (Iccc &amp;&amp; (!Incc || !Ipcc || !Icnc || !Icpc || !Iccn || !Iccp)) dest(x,y,z,k) = 0;
07597         <span class="keywordflow">return</span> dest;
07598       }
07599       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> img1(*<span class="keyword">this</span>),img2(*<span class="keyword">this</span>,<span class="keyword">false</span>);
07600       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> *src = &amp;img1, *dest = &amp;img2, *tmp = NULL;
07601       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter=0; iter&lt;n; iter++) {
07602         *dest = *src;
07603         cimg_mapV(*src,k) cimg_map3x3x3(*src,x,y,z,k,I) 
07604           <span class="keywordflow">if</span> (Iccc &amp;&amp; (!Incc || !Ipcc || !Icnc || !Icpc || !Iccn || !Iccp)) (*dest)(x,y,z,k) = 0;
07605         tmp = src;
07606         src = dest;
07607         dest = tmp;
07608       }
07609       <span class="keywordflow">return</span> *src;      
07610     }
07611     
<a name="l07613"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_17">07613</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_FFT(<span class="keyword">const</span> <span class="keywordtype">char</span> axe,<span class="keyword">const</span> <span class="keywordtype">bool</span> inverse=<span class="keyword">false</span>)<span class="keyword"> const </span>{
07614       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*<span class="keyword">this</span>,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,depth,dim,0)).FFT(axe,inverse);      
07615     }
07616 
<a name="l07618"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_18">07618</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_FFT(<span class="keyword">const</span> <span class="keywordtype">bool</span> inverse=<span class="keyword">false</span>)<span class="keyword"> const </span>{
07619       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*<span class="keyword">this</span>,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,depth,dim,0)).FFT(inverse);      
07620     }
07621 
<a name="l07623"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_19">07623</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; erode(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=1) { <span class="keywordflow">return</span> get_erode(n).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
07624 
<a name="l07626"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_20">07626</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_dilate(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=1) {
07627       <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> stats(*<span class="keyword">this</span>);
07628       <span class="keyword">const</span> T tmax = stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>!=0?(T)stats.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>:(T)1;
07629       CImg_3x3x3(I,T);
07630       <span class="keywordflow">if</span> (n==1) {
07631         <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(*<span class="keyword">this</span>);
07632         cimg_mapV(*<span class="keyword">this</span>,k) cimg_map3x3x3(*<span class="keyword">this</span>,x,y,z,k,I) 
07633           <span class="keywordflow">if</span> (!Iccc &amp;&amp; (Incc || Ipcc || Icnc || Icpc || Iccn || Iccp)) dest(x,y,z,k) = tmax;
07634         <span class="keywordflow">return</span> dest;
07635       }
07636       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> img1(*<span class="keyword">this</span>),img2(*<span class="keyword">this</span>,<span class="keyword">false</span>);
07637       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> *src = &amp;img1, *dest = &amp;img2, *tmp = NULL;
07638       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter=0; iter&lt;n; iter++) {
07639         *dest = *src;
07640         cimg_mapV(*src,k) cimg_map3x3x3(*src,x,y,z,k,I) 
07641           <span class="keywordflow">if</span> (!Iccc &amp;&amp; (Incc || Ipcc || Icnc || Icpc || Iccn || Iccp)) (*dest)(x,y,z,k) = tmax;
07642         tmp = src;
07643         src = dest;
07644         dest = tmp;
07645       }
07646       <span class="keywordflow">return</span> *src;      
07647     }
<a name="l07649"></a><a class="code" href="structcimg__library_1_1CImg.html#z15_21">07649</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; dilate(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=1) { <span class="keywordflow">return</span> get_dilate(n).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
07650 
07652     <span class="comment">//------------------------------------------</span>
07653     <span class="comment">//------------------------------------------</span>
07654     <span class="comment">//</span>
07656 <span class="comment"></span>
07657     <span class="comment">//------------------------------------------</span>
07658     <span class="comment">//------------------------------------------</span>
07659 
<a name="l07661"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_36">07661</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> vector(<span class="keyword">const</span> T&amp; a1) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(1,1).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1); }
07662     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(1,2).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2); }
07663     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,3).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3); }
07664     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,4).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4); }
07665     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,<span class="keyword">const</span> T&amp; a5) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,5).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5); }
07666     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,<span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,6).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5,a6); }
07667     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,
07668                        <span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6,<span class="keyword">const</span> T&amp; a7) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,7).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5,a6,a7); }
07669     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,
07670                        <span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6,<span class="keyword">const</span> T&amp; a7,<span class="keyword">const</span> T&amp; a8) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,8).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5,a6,a7,a8); }
07671     <span class="keyword">static</span> CImg vector(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,
07672                        <span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6,<span class="keyword">const</span> T&amp; a7,<span class="keyword">const</span> T&amp; a8,<span class="keyword">const</span> T&amp; a9) { <span class="keywordflow">return</span> CImg&lt;T&gt;(1,9).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5,a6,a7,a8,a9); }
07673 
<a name="l07675"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_45">07675</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> matrix(<span class="keyword">const</span> T&amp; a1) { <span class="keywordflow">return</span> vector(a1); }
07676     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> matrix(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,
07677                        <span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(2,2).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4); }
07678     <span class="keyword">static</span> CImg matrix(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,
07679                        <span class="keyword">const</span> T&amp; a4,<span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6,
07680                        <span class="keyword">const</span> T&amp; a7,<span class="keyword">const</span> T&amp; a8,<span class="keyword">const</span> T&amp; a9) { <span class="keywordflow">return</span> CImg&lt;T&gt;(3,3).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5,a6,a7,a8,a9); }
07681     <span class="keyword">static</span> CImg matrix(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,
07682                        <span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6,<span class="keyword">const</span> T&amp; a7,<span class="keyword">const</span> T&amp; a8,
07683                        <span class="keyword">const</span> T&amp; a9,<span class="keyword">const</span> T&amp; a10,<span class="keyword">const</span> T&amp; a11,<span class="keyword">const</span> T&amp; a12,
07684                        <span class="keyword">const</span> T&amp; a13,<span class="keyword">const</span> T&amp; a14,<span class="keyword">const</span> T&amp; a15,<span class="keyword">const</span> T&amp; a16) {
07685       <span class="keywordflow">return</span> CImg&lt;T&gt;(4,4).<a class="code" href="structcimg__library_1_1CImg.html#z9_0">fill</a>(a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12,a13,a14,a15,a16);
07686     }
07687 
<a name="l07689"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_49">07689</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> tensor(<span class="keyword">const</span> T&amp; a1) { <span class="keywordflow">return</span> matrix(a1); }
07690     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> tensor(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3) { <span class="keywordflow">return</span> matrix(a1,a2,a2,a3); }
07691     <span class="keyword">static</span> CImg tensor(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4,<span class="keyword">const</span> T&amp; a5,<span class="keyword">const</span> T&amp; a6) {
07692       <span class="keywordflow">return</span> matrix(a1,a2,a3,a2,a4,a5,a3,a5,a6);
07693     }
07694 
<a name="l07696"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_52">07696</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> diagonal(<span class="keyword">const</span> T&amp; a1) { <span class="keywordflow">return</span> matrix(a1); }
07697     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> diagonal(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2) { <span class="keywordflow">return</span> matrix(a1,0,0,a2); }
07698     <span class="keyword">static</span> CImg diagonal(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3) { <span class="keywordflow">return</span> matrix(a1,0,0,0,a2,0,0,0,a3); }
07699     <span class="keyword">static</span> CImg diagonal(<span class="keyword">const</span> T&amp; a1,<span class="keyword">const</span> T&amp; a2,<span class="keyword">const</span> T&amp; a3,<span class="keyword">const</span> T&amp; a4) { <span class="keywordflow">return</span> matrix(a1,0,0,0,0,a2,0,0,0,0,a3,0,0,0,0,a4); }
<a name="l07701"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_0">07701</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> operator*(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img)<span class="keyword"> const </span>{
07702       cimg_test_matrix(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::operator*"</span>);
07703       cimg_test_matrix(img,<span class="stringliteral">"CImg&lt;T&gt;::operator*"</span>);
07704       <span class="keywordflow">if</span> (width!=img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>) 
07705         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::operator*() : can't multiply a matrix *this = (%ux%u) by a matrix (%ux%u)"</span>,
07706                                     pixel_type(),width,height,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>);
07707       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res(img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,height);
07708       <span class="keywordtype">double</span> val;
07709       cimg_mapXY(res,i,j) { val=0; cimg_mapX(*<span class="keyword">this</span>,k) val+=(*this)(k,j)*img(i,k); res(i,j) = (T)val; }
07710       <span class="keywordflow">return</span> res;
07711     }
<a name="l07713"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_1">07713</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; operator*=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) { <span class="keywordflow">return</span> ((*this)*img).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
07714   
<a name="l07716"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_2">07716</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_vector(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0)<span class="keyword"> const </span>{
07717       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(dim);
07718       cimg_mapV(*<span class="keyword">this</span>,k) dest[k]=(*this)(x,y,z,k);
07719       <span class="keywordflow">return</span> dest;
07720     }
07721   
<a name="l07723"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_3">07723</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_matrix(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0)<span class="keyword"> const </span>{
07724       <span class="keyword">const</span> <span class="keywordtype">int</span> n = (int)std::sqrt((<span class="keywordtype">double</span>)dim);
07725       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(n,n);
07726       cimg_mapV(*<span class="keyword">this</span>,k) dest[k]=(*this)(x,y,z,k);
07727       <span class="keywordflow">return</span> dest;
07728     }
07729   
<a name="l07731"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_4">07731</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_tensor(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0)<span class="keyword"> const </span>{      
07732       <span class="keywordflow">if</span> (dim==6) <span class="keywordflow">return</span> tensor((*<span class="keyword">this</span>)(x,y,z,0),(*<span class="keyword">this</span>)(x,y,z,1),(*<span class="keyword">this</span>)(x,y,z,2),
07733                                 (*<span class="keyword">this</span>)(x,y,z,3),(*<span class="keyword">this</span>)(x,y,z,4),(*<span class="keyword">this</span>)(x,y,z,5));
07734       <span class="keywordflow">if</span> (dim==3) <span class="keywordflow">return</span> tensor((*<span class="keyword">this</span>)(x,y,z,0),(*<span class="keyword">this</span>)(x,y,z,1),(*<span class="keyword">this</span>)(x,y,z,2));
07735       <span class="keywordflow">return</span> tensor((*<span class="keyword">this</span>)(x,y,z,0));
07736     }
07737 
<a name="l07739"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_5">07739</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; set_vector(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; vec,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0) {
07740       <span class="keywordflow">return</span> draw_point(x,y,z,vec.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,1);
07741     }
<a name="l07743"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_6">07743</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; set_matrix(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; mat,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0) {
07744       <span class="keywordflow">return</span> set_vector(mat,x,y,z);
07745     }
<a name="l07747"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_7">07747</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; set_tensor(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; ten,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> z=0) {
07748       <span class="keywordflow">if</span> (ten.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>==2) {
07749         (*this)(x,y,z,0)=ten[0];
07750         (*this)(x,y,z,1)=ten[1];
07751         (*this)(x,y,z,2)=ten[3];
07752       }
07753       <span class="keywordflow">else</span> {
07754         (*this)(x,y,z,0)=ten[0];
07755         (*this)(x,y,z,1)=ten[1];
07756         (*this)(x,y,z,2)=ten[2];
07757         (*this)(x,y,z,3)=ten[4];
07758         (*this)(x,y,z,4)=ten[5];
07759         (*this)(x,y,z,5)=ten[8];
07760       }
07761       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07762     }
<a name="l07764"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_8">07764</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; identity_matrix(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N) { <span class="keywordflow">return</span> get_identity_matrix(N).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
07765       
<a name="l07767"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_56">07767</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_identity_matrix(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N) {
07768       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> res(N,N,1,1,0);
07769       cimg_mapX(res,x) res(x,x)=1;
07770       <span class="keywordflow">return</span> res;
07771     }
07772   
<a name="l07774"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_9">07774</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_transpose()<span class="keyword"> const </span>{
07775       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> res(height,width,depth,dim);
07776       cimg_mapXYZV(*<span class="keyword">this</span>,x,y,z,v) res(y,x,z,v) = (*this)(x,y,z,v);      
07777       <span class="keywordflow">return</span> res;
07778     }
07779     
<a name="l07781"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_10">07781</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; transpose() {
07782       <span class="keywordflow">if</span> (width==1) { width=height; height=1; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
07783       <span class="keywordflow">if</span> (height==1) { height=width; width=1; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
07784       <span class="keywordflow">if</span> (width==height) {
07785         cimg_mapYZV(*<span class="keyword">this</span>,y,z,v) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=y; x&lt;(int)width; x++) cimg::swap((*<span class="keyword">this</span>)(x,y,z,v),(*<span class="keyword">this</span>)(y,x,z,v));
07786         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07787       }
07788       <span class="keywordflow">return</span> (*this)=get_transpose();
07789     }
07790 
<a name="l07792"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_11">07792</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_diagonal()<span class="keyword"> const </span>{
07793       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::get_diagonal"</span>);
07794       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res(size(),size(),1,1,0);
07795       cimg_mapoff(*<span class="keyword">this</span>,off) res(off,off)=(*this)(off);
07796       <span class="keywordflow">return</span> res;
07797     }
<a name="l07799"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_12">07799</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; diagonal() { <span class="keywordflow">return</span> get_diagonal().<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
07800 
<a name="l07802"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_13">07802</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; inverse() {
07803       cimg_test_square(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::inverse"</span>);
07804       <span class="keywordflow">switch</span> (width) {
07805       <span class="keywordflow">case</span> 2: {
07806         <span class="keyword">const</span> <span class="keywordtype">double</span> 
07807           a = data[0], c = data[1],
07808           b = data[2], d = data[3],
07809           dete = det();
07810         <span class="keywordflow">if</span> (dete) { 
07811           data[0] = (T)(d/dete);  data[1] = (T)(-c/dete);
07812           data[2] = (T)(-b/dete), data[3] = (T)(a/dete); 
07813         } <span class="keywordflow">else</span> {
07814           cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImg&lt;%s&gt;::inverse() : Matrix determinant is 0, can't invert matrix"</span>,pixel_type());
07815           fill(0);
07816         }
07817       } <span class="keywordflow">break</span>;
07818       <span class="keywordflow">case</span> 3: {
07819         <span class="keyword">const</span> <span class="keywordtype">double</span>
07820           a = data[0], d = data[1], g = data[2],
07821           b = data[3], e = data[4], h = data[5],
07822           c = data[6], f = data[7], i = data[8],
07823           dete = det();
07824         <span class="keywordflow">if</span> (dete) {
07825           data[0] = (T)((i*e-f*h)/dete), data[1] = (T)((g*f-i*d)/dete), data[2] = (T)((d*h-g*e)/dete);
07826           data[3] = (T)((h*c-i*b)/dete), data[4] = (T)((i*a-c*g)/dete), data[5] = (T)((g*b-a*h)/dete);
07827           data[6] = (T)((b*f-e*c)/dete), data[7] = (T)((d*c-a*f)/dete), data[8] = (T)((a*e-d*b)/dete);
07828         } <span class="keywordflow">else</span> {
07829           cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImg&lt;%s&gt;::inverse() : Matrix determinant is 0, can't invert matrix"</span>,pixel_type());
07830           fill(0);
07831         }
07832       } <span class="keywordflow">break</span>;
07833       <span class="keywordflow">default</span>: {
07834         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> U(width,width),S(1,width),V(width,width);
07835         SVD(U,S,V,<span class="keyword">false</span>);
07836         U.<a class="code" href="structcimg__library_1_1CImg.html#z17_10">transpose</a>();
07837         cimg_mapY(S,k) <span class="keywordflow">if</span> (S[k]!=0) S[k]=1/S[k];
07838         <span class="keywordflow">else</span> cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImg&lt;%s&gt;::inverse() : Matrix determinant is 0, can't invert matrix"</span>,pixel_type());
07839         S.<a class="code" href="structcimg__library_1_1CImg.html#z17_52">diagonal</a>();
07840         *<span class="keyword">this</span> = V*S*U;
07841       } <span class="keywordflow">break</span>;
07842       }
07843       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07844     }
07845 
<a name="l07847"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_14">07847</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_inverse()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z17_13">inverse</a>(); }
07848 
<a name="l07850"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_15">07850</a>     <span class="keywordtype">double</span> trace()<span class="keyword"> const </span>{
07851       cimg_test_square(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::trace"</span>);
07852       <span class="keywordtype">double</span> res=0;
07853       cimg_mapX(*<span class="keyword">this</span>,k) res+=(*this)(k,k);
07854       <span class="keywordflow">return</span> res;
07855     }
<a name="l07857"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_16">07857</a>     <span class="keywordtype">double</span> dot(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img)<span class="keyword"> const </span>{
07858       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::dot"</span>); cimg_test(img,<span class="stringliteral">"CImg&lt;T&gt;::dot"</span>);
07859       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nb = cimg::min(size(),img.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
07860       <span class="keywordtype">double</span> res=0;
07861       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> off=0; off&lt;nb; off++) res+=data[off]*img[off];
07862       <span class="keywordflow">return</span> res;
07863     }
07864         
<a name="l07866"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_17">07866</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; cross(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
07867       <span class="keywordflow">if</span> (width!=1 || height&lt;3 || img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=1 || img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>&lt;3)
07868         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::cross() : cannot get cross product between two matrices (%u,%u) and (%u,%u)"</span>,
07869                                     pixel_type(),width,height,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>);
07870       <span class="keyword">const</span> T x = (*this)[0], y = (*this)[1], z = (*this)[2];
07871       (*this)[0] = y*img[2]-z*img[1];
07872       (*this)[1] = z*img[0]-x*img[2];
07873       (*this)[2] = x*img[1]-y*img[0];
07874       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
07875     }
<a name="l07877"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_18">07877</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_cross(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z17_17">cross</a>(img); }
07878 
<a name="l07880"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_19">07880</a>     <span class="keywordtype">double</span> det()<span class="keyword"> const </span>{
07881       cimg_test_square(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::det"</span>);
07882       <span class="keywordflow">switch</span> (width) {
07883       <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> (*this)(0,0);
07884       <span class="keywordflow">case</span> 2: <span class="keywordflow">return</span> (*this)(0,0)*(*this)(1,1)-(*this)(0,1)*(*this)(1,0);
07885       <span class="keywordflow">case</span> 3: 
07886         {
07887           <span class="keyword">const</span> <span class="keywordtype">double</span>
07888             a = data[0], d = data[1], g = data[2],
07889             b = data[3], e = data[4], h = data[5],
07890             c = data[6], f = data[7], i = data[8];
07891           <span class="keywordflow">return</span> i*a*e-a*h*f-i*b*d+b*g*f+c*d*h-c*g*e;
07892         }
07893       }
07894       <span class="keywordflow">return</span> 0;
07895     }
<a name="l07897"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_20">07897</a>     <span class="keywordtype">double</span> norm(<span class="keyword">const</span> <span class="keywordtype">int</span> ntype=2)<span class="keyword"> const </span>{
07898       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::norm"</span>);
07899       <span class="keywordtype">double</span> res = 0;
07900       <span class="keywordflow">switch</span> (ntype) {
07901       <span class="keywordflow">case</span> -1: {
07902         cimg_mapoff(*<span class="keyword">this</span>,off) {
07903           <span class="keyword">const</span> <span class="keywordtype">double</span> tmp = cimg::abs((<span class="keywordtype">double</span>)data[off]);
07904           <span class="keywordflow">if</span> (tmp&gt;res) res = tmp;
07905         }
07906         <span class="keywordflow">return</span> res; 
07907       } <span class="keywordflow">break</span>;
07908       <span class="keywordflow">case</span> 1 : { 
07909         cimg_mapoff(*<span class="keyword">this</span>,off) res+=cimg::abs((<span class="keywordtype">double</span>)data[off]); 
07910         <span class="keywordflow">return</span> res;
07911       } <span class="keywordflow">break</span>;
07912       <span class="keywordflow">default</span>: { <span class="keywordflow">return</span> std::sqrt(dot(*<span class="keyword">this</span>)); }
07913       }
07914       <span class="keywordflow">return</span> 0;
07915     }
<a name="l07917"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_21">07917</a>     <span class="keywordtype">double</span> sum()<span class="keyword"> const </span>{
07918       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::sum"</span>);          
07919       <span class="keywordtype">double</span> res=0;
07920       cimg_map(*<span class="keyword">this</span>,ptr,T) res+=*ptr;
07921       <span class="keywordflow">return</span> res;
07922     }
07923 
<a name="l07925"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_22">07925</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; SVD(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; U, <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; S, <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; V,<span class="keyword">const</span> <span class="keywordtype">bool</span> sorting=<span class="keyword">true</span>)<span class="keyword"> const </span>{
07926       cimg_test_matrix(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::SVD"</span>);
07927       U = *<span class="keyword">this</span>;
07928       <span class="keywordflow">if</span> (S.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()&lt;width) S = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(1,width);
07929       <span class="keywordflow">if</span> (V.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&lt;width || V.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>&lt;height) V = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(width,width);
07930       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> rv1(width);  
07931       t anorm=0,c,f,g=0,h,s,scale=0;
07932       <span class="keywordtype">int</span> l=0,nm=0;
07933      
07934       cimg_mapX(U,i) {
07935         l = i+1; rv1[i] = scale*g; g = s = scale = 0;
07936         <span class="keywordflow">if</span> (i&lt;dimy()) {
07937           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i; k&lt;dimy(); k++) scale+= cimg::abs(U(i,k));
07938           <span class="keywordflow">if</span> (scale) {
07939             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i; k&lt;dimy(); k++) { U(i,k)/=scale; s+= U(i,k)*U(i,k); }
07940             f = U(i,i); g = (t)((f&gt;=0?-1:1)*std::sqrt(s)); h=f*g-s; U(i,i)=f-g;
07941             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimx(); j++) {
07942               s = 0; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i; k&lt;dimy(); k++) s+= U(i,k)*U(j,k);
07943               f = s/h;
07944               { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i; k&lt;dimy(); k++) U(j,k)+= f*U(i,k); }
07945             }
07946             { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i; k&lt;dimy(); k++) U(i,k)*= scale; }
07947           }
07948         }
07949         S[i]=scale*g;
07950         
07951         g = s = scale = 0;
07952         <span class="keywordflow">if</span> (i&lt;dimy() &amp;&amp; i!=dimx()-1) {
07953           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) scale += cimg::abs(U(k,i));
07954           <span class="keywordflow">if</span> (scale) {
07955             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) { U(k,i)/= scale; s+= U(k,i)*U(k,i); }
07956             f = U(l,i); g = (t)((f&gt;=0?-1:1)*std::sqrt(s)); h = f*g-s; U(l,i) = f-g;
07957             { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) rv1[k]=U(k,i)/h; }
07958             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimy(); j++) {
07959               s=0; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) s+= U(k,j)*U(k,i);
07960               { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) U(k,j)+= s*rv1[k]; }
07961             }
07962             { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) U(k,i)*= scale; }
07963           }
07964         }
07965         anorm=cimg::max((t)anorm,(cimg::abs(S[i])+cimg::abs(rv1[i])));
07966       }
07967       
07968       { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=dimx()-1; i&gt;=0; i--) {
07969         <span class="keywordflow">if</span> (i&lt;dimx()-1) {
07970           <span class="keywordflow">if</span> (g) {
07971             { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimx(); j++) V(i,j) =(U(j,i)/U(l,i))/g; }
07972             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimx(); j++) {
07973               s=0; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) s+= U(k,i)*V(j,k);
07974               { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimx(); k++) V(j,k)+= s*V(i,k); }
07975             }
07976           }
07977           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimx(); j++) V(j,i)=V(i,j)=0.0;
07978         }
07979         V(i,i) = 1.0; g = rv1[i]; l = i;
07980       }
07981       }
07982       
07983       { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=cimg::min(dimx(),dimy())-1; i&gt;=0; i--) {
07984         l = i+1; g = S[i];
07985         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimx(); j++) U(j,i) = 0;
07986         <span class="keywordflow">if</span> (g) {
07987           g = 1/g;
07988           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;dimx(); j++) {
07989             s=0; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=l; k&lt;dimy(); k++) s+= U(i,k)*U(j,k);
07990             f = (s/U(i,i))*g;
07991             { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i; k&lt;dimy(); k++) U(j,k)+= f*U(i,k); }
07992           }
07993           { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=i; j&lt;dimy(); j++) U(i,j)*= g; }
07994         } <span class="keywordflow">else</span> <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=i; j&lt;dimy(); j++) U(i,j)=0;
07995         U(i,i)++;
07996       }
07997       }
07998       
07999       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=dimx()-1; k&gt;=0; k--) {
08000         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> its=0; its&lt;40; its++) {
08001           <span class="keywordtype">bool</span> flag = <span class="keyword">true</span>;
08002           <span class="keywordflow">for</span> (l=k; l&gt;=0; l--) {
08003             nm = l-1;
08004             <span class="keywordflow">if</span> ((cimg::abs(rv1[l])+anorm)==anorm) { flag = <span class="keyword">false</span>; <span class="keywordflow">break</span>; }
08005             <span class="keywordflow">if</span> ((cimg::abs(S[nm])+anorm)==anorm) <span class="keywordflow">break</span>;
08006           }
08007           <span class="keywordflow">if</span> (flag) {
08008             c = 0; s = 1;
08009             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=l; i&lt;=k; i++) {
08010               f = s*rv1[i]; rv1[i] = c*rv1[i];
08011               <span class="keywordflow">if</span> ((cimg::abs(f)+anorm)==anorm) <span class="keywordflow">break</span>;
08012               g = S[i]; h = (t)cimg::pythagore(f,g); S[i] = h; h = 1/h; c = g*h; s = -f*h;
08013               cimg_mapY(U,j) { <span class="keyword">const</span> t y = U(nm,j), z = U(i,j); U(nm,j) = y*c+z*s; U(i,j) = z*c-y*s; }
08014             }
08015           }
08016           <span class="keyword">const</span> t&amp; z = S[k];
08017           <span class="keywordflow">if</span> (l==k) { <span class="keywordflow">if</span> (z&lt;0) { S[k] = -z; cimg_mapX(U,j) V(k,j) = -V(k,j); } <span class="keywordflow">break</span>; }
08018           cimg::warn(its&gt;=39,<span class="stringliteral">"CImg&lt;%s&gt;::SVD() : SVD failed to converge"</span>,pixel_type());
08019           nm = k-1; 
08020           t x = S[l], y = S[nm]; 
08021           g = rv1[nm]; h = rv1[k];
08022           f = ((y-z)*(y+z)+(g-h)*(g+h))/(2*h*y);
08023           g = (t)cimg::pythagore(f,1.0);
08024           f = ((x-z)*(x+z)+h*((y/(f+ (f&gt;=0?g:-g)))-h))/x;
08025           c = s = 1;
08026           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=l; j&lt;=nm; j++) {
08027             <span class="keyword">const</span> <span class="keywordtype">int</span> i = j+1;
08028             g = rv1[i]; h = s*g; g = c*g;
08029             t y = S[i];
08030             t z = (t)cimg::pythagore(f,h); 
08031             rv1[j] = z; c = f/z; s = h/z;
08032             f = x*c+g*s; g = g*c-x*s; h = y*s; y*=c;
08033             cimg_mapX(U,jj) { <span class="keyword">const</span> t x = V(j,jj), z = V(i,jj); V(j,jj) = x*c+z*s; V(i,jj) = z*c-x*s; }
08034             z = (t)cimg::pythagore(f,h); S[j] = z;
08035             <span class="keywordflow">if</span> (z) { z = 1/z; c = f*z; s = h*z; }
08036             f = c*g+s*y; x = c*y-s*g;
08037             { cimg_mapY(U,jj) { <span class="keyword">const</span> t y = U(j,jj); z = U(i,jj); U(j,jj) = y*c+z*s; U(i,jj) = z*c-y*s; }}
08038           }
08039           rv1[l] = 0; rv1[k]=f; S[k]=x;
08040         }
08041       }
08042       
08043       <span class="keywordflow">if</span> (sorting) {
08044         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;int&gt;</a> permutations(width);
08045         S.<a class="code" href="structcimg__library_1_1CImg.html#z17_32">quicksort</a>(permutations,<span class="keyword">false</span>);
08046         cimg_mapX(permutations,x) {
08047           <span class="keyword">const</span> <span class="keywordtype">int</span> n = permutations(x);
08048           <span class="keywordflow">if</span> (x&lt;n) {
08049             cimg_mapY(U,k) cimg::swap(U(x,k),U(n,k));
08050             cimg_mapY(V,l) cimg::swap(V(x,l),V(n,l));
08051           }
08052         }
08053       }
08054       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
08055     }
08056 
<a name="l08058"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_23">08058</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; SVD(<a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; USV)<span class="keyword"> const </span>{
08059       <span class="keywordflow">if</span> (USV.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>&lt;3) USV = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>(3);
08060       <span class="keywordflow">return</span> SVD(USV[0],USV[1],USV[2]);      
08061     }
08062     
<a name="l08064"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_24">08064</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_SVD(<span class="keyword">const</span> <span class="keywordtype">bool</span> sorting=<span class="keyword">true</span>)<span class="keyword"> const </span>{
08065       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res(3);
08066       SVD(res[0],res[1],res[2],sorting);
08067       <span class="keywordflow">return</span> res;
08068     }
08069         
<a name="l08071"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_25">08071</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; eigen(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; val, <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> &amp;vec)<span class="keyword"> const </span>{
08072       cimg_test_square(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::eigen"</span>);
08073       <span class="keywordflow">if</span> (val.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()&lt;width) val = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(1,width);
08074       <span class="keywordflow">if</span> (vec.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()&lt;width*width) vec = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(width,width);
08075       <span class="keywordflow">switch</span>(width) {
08076       <span class="keywordflow">case</span> 1: { val[0]=(t)(*this)[0]; vec[0]=(t)1; } <span class="keywordflow">break</span>;
08077       <span class="keywordflow">case</span> 2: {
08078         <span class="keyword">const</span> <span class="keywordtype">double</span> a = (*this)[0], b = (*this)[1], c = (*this)[2], d = (*this)[3], e = a+d;
08079         <span class="keywordtype">double</span> f = e*e-4*(a*d-b*c);
08080         cimg::warn(f&lt;0,<span class="stringliteral">"CImg&lt;%s&gt;::eigen() : Complex eigenvalues"</span>,pixel_type());
08081         f = std::sqrt(f);
08082         <span class="keyword">const</span> <span class="keywordtype">double</span> l1 = 0.5*(e-f), l2 = 0.5*(e+f);
08083         <span class="keywordtype">double</span> u, v, n;
08084         val[0]=(t)l2; val[1]=(t)l1;
08085         <span class="keywordflow">if</span> (cimg::abs(b)&gt;cimg::abs(a-l2)) { u = 1; v = (l2-a)/b; }
08086         <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (a-l2!=0) { u = -b/(a-l2); v = 1; } <span class="keywordflow">else</span> { u = 0; v = 1; } }
08087         n = std::sqrt(u*u+v*v); u/=n; v/=n; vec(0,0) = (t)u; vec(0,1) = (t)v;
08088         <span class="keywordflow">if</span> (cimg::abs(b)&gt;cimg::abs(a-l1)) { u = 1; v = (l1-a)/b; }
08089         <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (a-l1!=0) { u = -b/(a-l1); v = 1; } <span class="keywordflow">else</span> { u = 1; v = 0; } }
08090         n = std::sqrt(u*u+v*v); u/=n; v/=n; vec(1,0) = (t)u; vec(1,1) = (t)v;
08091       } <span class="keywordflow">break</span>;
08092       <span class="keywordflow">default</span>: 
08093         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::eigen() : Eigenvalues computation of general matrices is limited to 2x2 matrices "</span>
08094                                     <span class="stringliteral">"(given is %ux%u)"</span>, pixel_type(),width,height);
08095       }
08096       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
08097     }
08098 
<a name="l08100"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_26">08100</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_eigen()<span class="keyword"> const </span>{ <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res(2); eigen(res[0],res[1]); <span class="keywordflow">return</span> res; }
08101     
<a name="l08103"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_27">08103</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; eigen(<a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; eig)<span class="keyword"> const </span>{
08104       <span class="keywordflow">if</span> (eig.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>&lt;2) eig = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>(2);
08105       eigen(eig[0],eig[1]);
08106       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
08107     }
08108     
<a name="l08110"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_28">08110</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; symeigen(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; val, <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; vec)<span class="keyword"> const </span>{
08111       cimg_test_square(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::symeigen"</span>);
08112       <span class="keywordflow">if</span> (val.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()&lt;width) val = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(width);
08113       <span class="keywordflow">if</span> (vec.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> &amp;&amp; vec.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()&lt;width*width) vec = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(width,width);
08114       <span class="keywordflow">if</span> (width&lt;3) <span class="keywordflow">return</span> eigen(val,vec);     
08115       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a> V(width,width);
08116       <span class="keywordflow">return</span> SVD(vec,val,V,<span class="keyword">true</span>);
08117     }
08118 
<a name="l08120"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_29">08120</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_symeigen()<span class="keyword"> const </span>{ <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res(2); symeigen(res[0],res[1]); <span class="keywordflow">return</span> res; }
08121 
<a name="l08123"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_30">08123</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; symeigen(<a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; eig)<span class="keyword"> const </span>{
08124       <span class="keywordflow">if</span> (eig.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>&lt;2) eig = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>(2);
08125       symeigen(eig[0],eig[1]);
08126       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
08127     }
08128 
08129     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; _quicksort(<span class="keyword">const</span> <span class="keywordtype">int</span> min,<span class="keyword">const</span> <span class="keywordtype">int</span> max,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; permutations,<span class="keyword">const</span> <span class="keywordtype">bool</span> increasing) {
08130       <span class="keywordflow">if</span> (min&lt;max) {      
08131         <span class="keyword">const</span> <span class="keywordtype">int</span> mid = (min+max)/2;
08132         <span class="keywordflow">if</span> (increasing) {
08133           <span class="keywordflow">if</span> ((*this)[min]&gt;(*this)[mid]) {
08134             cimg::swap((*<span class="keyword">this</span>)[min],(*<span class="keyword">this</span>)[mid]); cimg::swap(permutations[min],permutations[mid]); }
08135           <span class="keywordflow">if</span> ((*this)[mid]&gt;(*this)[max]) {
08136             cimg::swap((*<span class="keyword">this</span>)[max],(*<span class="keyword">this</span>)[mid]); cimg::swap(permutations[max],permutations[mid]); }
08137           <span class="keywordflow">if</span> ((*this)[min]&gt;(*this)[mid]) {
08138             cimg::swap((*<span class="keyword">this</span>)[min],(*<span class="keyword">this</span>)[mid]); cimg::swap(permutations[min],permutations[mid]); }
08139         } <span class="keywordflow">else</span> {
08140           <span class="keywordflow">if</span> ((*this)[min]&lt;(*this)[mid]) {
08141             cimg::swap((*<span class="keyword">this</span>)[min],(*<span class="keyword">this</span>)[mid]); cimg::swap(permutations[min],permutations[mid]); }
08142           <span class="keywordflow">if</span> ((*this)[mid]&lt;(*this)[max]) {
08143             cimg::swap((*<span class="keyword">this</span>)[max],(*<span class="keyword">this</span>)[mid]); cimg::swap(permutations[max],permutations[mid]); }
08144           <span class="keywordflow">if</span> ((*this)[min]&lt;(*this)[mid]) {
08145             cimg::swap((*<span class="keyword">this</span>)[min],(*<span class="keyword">this</span>)[mid]); cimg::swap(permutations[min],permutations[mid]); }
08146         }
08147         <span class="keywordflow">if</span> (<a class="code" href="namespacecimg__library_1_1cimg.html#a87">max</a>-<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>&gt;=3) {
08148           <span class="keyword">const</span> T pivot = (*this)[mid];
08149           <span class="keywordtype">int</span> i = min, j = max;
08150           <span class="keywordflow">if</span> (increasing) {
08151             <span class="keywordflow">do</span> {
08152               <span class="keywordflow">while</span> ((*this)[i]&lt;pivot) i++; <span class="keywordflow">while</span> ((*this)[j]&gt;pivot) j--;
08153               <span class="keywordflow">if</span> (i&lt;=j) {
08154                 cimg::swap((*<span class="keyword">this</span>)[i],(*<span class="keyword">this</span>)[j]);
08155                 cimg::swap(permutations[i],permutations[j]);
08156                 i++; j--; }
08157             } <span class="keywordflow">while</span> (i&lt;=j);
08158           } <span class="keywordflow">else</span> {
08159             <span class="keywordflow">do</span> {
08160               <span class="keywordflow">while</span> ((*this)[i]&gt;pivot) i++; <span class="keywordflow">while</span> ((*this)[j]&lt;pivot) j--;
08161               <span class="keywordflow">if</span> (i&lt;=j) {
08162                 cimg::swap((*<span class="keyword">this</span>)[i],(*<span class="keyword">this</span>)[j]);
08163                 cimg::swap(permutations[i],permutations[j]);
08164                 i++; j--; }
08165             } <span class="keywordflow">while</span> (i&lt;=j);
08166           }
08167           <span class="keywordflow">if</span> (<a class="code" href="namespacecimg__library_1_1cimg.html#a84">min</a>&lt;j) _quicksort(min,j,permutations,increasing);
08168           <span class="keywordflow">if</span> (i&lt;max) _quicksort(i,max,permutations,increasing);
08169         }
08170       }
08171       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
08172     }
08173 
08175     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt;
<a name="l08176"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_32">08176</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; quicksort(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; permutations,<span class="keyword">const</span> <span class="keywordtype">bool</span> increasing=<span class="keyword">true</span>) {
08177       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::quicksort"</span>);
08178       <span class="keywordflow">if</span> (permutations.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>()!=size()) permutations = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>(size());
08179       cimg_mapoff(permutations,off) permutations[off] = off;
08180       <span class="keywordflow">return</span> _quicksort(0,size()-1,permutations,increasing); 
08181     }
08182 
<a name="l08184"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_33">08184</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; quicksort(<span class="keyword">const</span> <span class="keywordtype">bool</span> increasing=<span class="keyword">true</span>) { <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> foo; <span class="keywordflow">return</span> quicksort(foo,increasing); }
08185 
<a name="l08187"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_34">08187</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; get_quicksort(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; permutations,<span class="keyword">const</span> <span class="keywordtype">bool</span> increasing=<span class="keyword">true</span>) {
08188       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z17_32">quicksort</a>(permutations,increasing);
08189     }
08190 
<a name="l08192"></a><a class="code" href="structcimg__library_1_1CImg.html#z17_35">08192</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; get_quicksort(<span class="keyword">const</span> <span class="keywordtype">bool</span> increasing=<span class="keyword">true</span>) { 
08193       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(*this).<a class="code" href="structcimg__library_1_1CImg.html#z17_32">quicksort</a>(increasing); 
08194     }
08195     
08197     <span class="comment">//------------------------------------------</span>
08198     <span class="comment">//------------------------------------------</span>
08199     <span class="comment">//</span>
08201 <span class="comment"></span>
08202     <span class="comment">//------------------------------------------</span>
08203     <span class="comment">//------------------------------------------</span>
08204   
<a name="l08206"></a><a class="code" href="structcimg__library_1_1CImg.html#z19_0">08206</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; display(<a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; disp,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymin=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ymax=~0)<span class="keyword"> const </span>{ disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#a6">display</a>(*<span class="keyword">this</span>,ymin,ymax); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
08207 
<a name="l08209"></a><a class="code" href="structcimg__library_1_1CImg.html#z19_1">08209</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; wait(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> milliseconds)<span class="keyword"> const </span>{ cimg::wait(milliseconds); <span class="keywordflow">return</span> *<span class="keyword">this</span>;  }
08210   
<a name="l08214"></a><a class="code" href="structcimg__library_1_1CImg.html#z19_2">08214</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; display(<span class="keyword">const</span> <span class="keywordtype">char</span>* title,<span class="keyword">const</span> <span class="keywordtype">int</span> min_size=128,<span class="keyword">const</span> <span class="keywordtype">int</span> max_size=1024)<span class="keyword"> const </span>{
08215       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::display"</span>);
08216       <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a> *disp;
08217       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w = width+(depth&gt;1?depth:0), h = height+(depth&gt;1?depth:0), XYZ[3];
08218       print(title);
08219       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmin = cimg::min(w,h), minsiz = min_size&gt;=0?min_size:(-min_size)*dmin/100;
08220       <span class="keywordflow">if</span> (dmin&lt;minsiz) { w=w*minsiz/dmin; w+=(w==0); h=h*minsiz/dmin; h+=(h==0); }
08221       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmax = cimg::max(w,h), maxsiz = max_size&gt;=0?max_size:(-max_size)*dmax/100;
08222       <span class="keywordflow">if</span> (dmax&gt;maxsiz) { w=w*maxsiz/dmax; w+=(w==0); h=h*maxsiz/dmax; h+=(h==0); }
08223       disp = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(w,h,1,1,0),title,0,3);
08224       XYZ[0] = width/2; XYZ[1] = height/2; XYZ[2] = depth/2;
08225       <span class="keywordflow">while</span> (!disp-&gt;<a class="code" href="structcimg__library_1_1CImgDisplay.html#o13">closed</a> &amp;&amp; !disp-&gt;<a class="code" href="structcimg__library_1_1CImgDisplay.html#o12">key</a>) feature_selection(NULL,1,*disp,XYZ);
08226       <span class="keyword">delete</span> disp;
08227       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
08228     }
08229 
<a name="l08231"></a><a class="code" href="structcimg__library_1_1CImg.html#z19_3">08231</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; display(<span class="keyword">const</span> <span class="keywordtype">int</span> min_size=128,<span class="keyword">const</span> <span class="keywordtype">int</span> max_size=1024)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> display(<span class="stringliteral">""</span>,min_size,max_size); }
08232   
<a name="l08234"></a><a class="code" href="structcimg__library_1_1CImg.html#z19_4">08234</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; feature_selection(<span class="keywordtype">int</span> *<span class="keyword">const</span> selection, <span class="keyword">const</span> <span class="keywordtype">int</span> feature_type,<a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a> &amp;disp,
08235                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<span class="keyword">const</span> XYZ=NULL,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> color=NULL)<span class="keyword"> const </span>{
08236       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::feature_selection"</span>);
08237       <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o7">events</a>&lt;3) 
08238         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::feature_selection() : Input display must be able to catch keyboard"</span>
08239                                     <span class="stringliteral">"and mouse events (events&gt;=3). Given display has 'events = %s'."</span>,
08240                                     pixel_type(),disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o7">events</a>);
08241       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> fgcolor[3]={255,255,105}, bgcolor[3]={0,0,0};
08242       <span class="keywordflow">if</span> (color) std::memcpy(fgcolor,color,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*cimg::min(3,dimv()));
08243       <span class="keywordtype">int</span> carea=0,area=0,phase=0,
08244         X0=(XYZ?XYZ[0]:width/2)%width, Y0=(XYZ?XYZ[1]:height/2)%height, Z0=(XYZ?XYZ[2]:depth/2)%depth, 
08245         X=-1,Y=-1,Z=-1,oX=-1,oY=-1,oZ=-1,X1=-1,Y1=-1,Z1=-1;
08246       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hatch=feature_type?0xF0F0F0F0:~0L;
08247       <span class="keywordtype">bool</span> feature_selected = <span class="keyword">false</span>, ytext = <span class="keyword">false</span>;
08248       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> visu, visu0;
08249       <span class="keywordtype">char</span> text[1024];
08250     
08251       <span class="keywordflow">while</span> (!disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o12">key</a> &amp;&amp; !disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o13">closed</a> &amp;&amp; !feature_selected) {
08252 
08253         <span class="comment">// Init visu0 if necessary</span>
08254         <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o14">resized</a> || !visu0.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>) { 
08255           <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o14">resized</a>) disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#a7">resize</a>();
08256           <span class="keywordflow">if</span> (depth==1) visu0=get_normalize(0,(T)255); <span class="keywordflow">else</span> visu0=get_3dplanes(X0,Y0,Z0).<a class="code" href="structcimg__library_1_1CImg.html#z9_13">get_normalize</a>(0,(T)255);
08257           visu0.<a class="code" href="structcimg__library_1_1CImg.html#z9_27">resize</a>(disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>,disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>,1,cimg::min(3,dimv()));
08258         }
08259         visu = visu0;      
08260         
08261         <span class="comment">// Handle motion and selection</span>
08262         <span class="keyword">const</span> <span class="keywordtype">int</span> mx = disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o9">mouse_x</a>, my = disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o10">mouse_y</a>, b = disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o11">button</a>;
08263         <span class="keywordflow">if</span> (mx&gt;=0 &amp;&amp; my&gt;=0) {
08264           <span class="keyword">const</span> <span class="keywordtype">int</span> mX = mx*(width+(depth&gt;1?depth:0))/disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>, mY = my*(height+(depth&gt;1?depth:0))/disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>;
08265           <span class="keywordflow">if</span> (mX&lt;dimx() &amp;&amp; mY&lt;dimy())   { area=1; X=mX; Y=mY; Z=phase?Z1:Z0; }
08266           <span class="keywordflow">if</span> (mX&lt;dimx() &amp;&amp; mY&gt;=dimy())  { area=2; X=mX; Y=phase?Y1:Y0; Z=mY-height; }
08267           <span class="keywordflow">if</span> (mX&gt;=dimx() &amp;&amp; mY&lt;dimy())  { area=3; X=phase?X1:X0; Y=mY; Z=mX-width;  }
08268           <span class="keywordflow">if</span> (mX&gt;=dimx() &amp;&amp; mY&gt;=dimy()) { X=X0; Y=Y0; Z=Z0; }
08269           <span class="keywordflow">if</span> ((!(phase%2) &amp;&amp; (b&amp;1)) || (phase%2 &amp;&amp; !(b&amp;1))) { 
08270             <span class="keywordflow">if</span> (!carea) carea=area;
08271             <span class="keywordflow">if</span> (!(phase++)) { X0=X; Y0=Y; Z0=Z; }
08272           }
08273           <span class="keywordflow">if</span> (b&amp;2) { <span class="keywordflow">if</span> (!phase) { X0=X; Y0=Y; Z0=Z; } <span class="keywordflow">else</span> { X1=Y1=Z1=-1; phase=carea=0; }}
08274           <span class="keywordflow">if</span> ((b&amp;2 || phase) &amp;&amp; depth&gt;1) 
08275             visu0 = get_3dplanes(X,Y,Z).<a class="code" href="structcimg__library_1_1CImg.html#z9_12">normalize</a>(0,(T)255).<a class="code" href="structcimg__library_1_1CImg.html#z9_27">resize</a>(disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>,disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>,1,cimg::min(3,dimv()));
08276           <span class="keywordflow">if</span> (phase) {
08277             <span class="keywordflow">if</span> (!feature_type) feature_selected = phase?<span class="keyword">true</span>:<span class="keyword">false</span>;
08278             <span class="keywordflow">else</span> {
08279               <span class="keywordflow">if</span> (depth&gt;1) feature_selected = (phase==3)?<span class="keyword">true</span>:<span class="keyword">false</span>;
08280               <span class="keywordflow">else</span> feature_selected = (phase==2)?<span class="keyword">true</span>:<span class="keyword">false</span>;
08281             }   
08282             <span class="keywordflow">if</span> (!feature_selected) {
08283               <span class="keywordflow">if</span> (phase&lt;2) { X1=X; Y1=Y; Z1=Z; }
08284               <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(carea) {
08285               <span class="keywordflow">case</span> 1: Z1=Z; <span class="keywordflow">break</span>;
08286               <span class="keywordflow">case</span> 2: Y1=Y; <span class="keywordflow">break</span>;
08287               <span class="keywordflow">case</span> 3: X1=X; <span class="keywordflow">break</span>;
08288               }
08289             }
08290           }
08291           <span class="keywordflow">if</span> (!phase || !feature_type) {
08292             <span class="keywordflow">if</span> (depth&gt;1) std::sprintf(text,<span class="stringliteral">"Coords (%d,%d,%d)={ "</span>,X,Y,Z); <span class="keywordflow">else</span> std::sprintf(text,<span class="stringliteral">"Coords (%d,%d)={ "</span>,X,Y);
08293             cimg_mapV(*<span class="keyword">this</span>,k) std::sprintf(text+cimg::strlen(text),<span class="stringliteral">"%g "</span>,(<span class="keywordtype">double</span>)(*<span class="keyword">this</span>)(X,Y,Z,k));
08294             std::sprintf(text+cimg::strlen(text),<span class="stringliteral">"}"</span>);
08295             <span class="keywordflow">if</span> (!feature_type) { X1=X0; Y1=Y0; Z1=Z0; }
08296           } <span class="keywordflow">else</span>
08297             <span class="keywordflow">switch</span> (feature_type) {
08298             <span class="keywordflow">case</span> 1: {
08299                 <span class="keyword">const</span> <span class="keywordtype">double</span> dX=(double)(X0-X1), dY=(double)(Y0-Y1), dZ=(double)(Z0-Z1), norm = std::sqrt(dX*dX+dY*dY+dZ*dZ);
08300                 <span class="keywordflow">if</span> (depth&gt;1) std::sprintf(text,<span class="stringliteral">"Vect (%d,%d,%d)-(%d,%d,%d), norm=%g"</span>,X0,Y0,Z0,X1,Y1,Z1,norm);
08301                 <span class="keywordflow">else</span> std::sprintf(text,<span class="stringliteral">"Vect (%d,%d)-(%d,%d), norm=%g"</span>,X0,Y0,X1,Y1,norm);
08302             } <span class="keywordflow">break</span>;
08303             <span class="keywordflow">case</span> 2:
08304               <span class="keywordflow">if</span> (depth&gt;1) std::sprintf(text,<span class="stringliteral">"Box (%d,%d,%d)-(%d,%d,%d), Size=(%d,%d,%d)"</span>,
08305                                         X0&lt;X1?X0:X1,Y0&lt;Y1?Y0:Y1,Z0&lt;Z1?Z0:Z1,
08306                                         X0&lt;X1?X1:X0,Y0&lt;Y1?Y1:Y0,Z0&lt;Z1?Z1:Z0,
08307                                         1+cimg::abs(X0-X1),1+cimg::abs(Y0-Y1),1+cimg::abs(Z0-Z1));
08308               <span class="keywordflow">else</span>  std::sprintf(text,<span class="stringliteral">"Box (%d,%d)-(%d,%d), Size=(%d,%d)"</span>,
08309                                  X0&lt;X1?X0:X1,Y0&lt;Y1?Y0:Y1,X0&lt;X1?X1:X0,Y0&lt;Y1?Y1:Y0,1+cimg::abs(X0-X1),1+cimg::abs(Y0-Y1));
08310               <span class="keywordflow">break</span>;
08311             <span class="keywordflow">case</span> 3:
08312               <span class="keywordflow">if</span> (depth&gt;1) std::sprintf(text,<span class="stringliteral">"Ellipse (%d,%d,%d)-(%d,%d,%d), Radii=(%d,%d,%d)"</span>,
08313                                         X0,Y0,Z0,X1,Y1,Z1,1+cimg::abs(X0-X1),1+cimg::abs(Y0-Y1),1+cimg::abs(Z0-Z1));
08314               <span class="keywordflow">else</span>  std::sprintf(text,<span class="stringliteral">"Ellipse (%d,%d)-(%d,%d), Radii=(%d,%d)"</span>,
08315                                  X0,Y0,X1,Y1,1+cimg::abs(X0-X1),1+cimg::abs(Y0-Y1));
08316 
08317               <span class="keywordflow">break</span>;
08318             }
08319           <span class="keywordflow">if</span> (my&lt;12) ytext=<span class="keyword">true</span>;
08320           <span class="keywordflow">if</span> (my&gt;=visu.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()-11) ytext=<span class="keyword">false</span>;
08321           visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_19">draw_text</a>(text,0,ytext?visu.<a class="code" href="structcimg__library_1_1CImg.html#z3_2">dimy</a>()-11:0,fgcolor,bgcolor,0.7f);
08322         } <span class="keywordflow">else</span> { X=Y=Z=-1; <span class="keywordflow">if</span> (phase) disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o11">button</a>=phase%2; }
08323         
08324         <span class="comment">// Draw image + selection on display window</span>
08325         <span class="keywordflow">if</span> (X&gt;=0 &amp;&amp; Y&gt;=0 &amp;&amp; Z&gt;=0) {
08326           hatch=cimg::ror(hatch);
08327           <span class="keywordflow">if</span> (feature_type==1 &amp;&amp; phase) {
08328             <span class="keyword">const</span> <span class="keywordtype">int</span> d=(depth&gt;1)?depth:0,
08329               x0=(int)((X0+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)), y0=(int)((Y0+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d)),
08330               x1=(int)((X1+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)), y1=(int)((Y1+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d));
08331             visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_7">draw_arrow</a>(x0,y0,x1,y1,fgcolor,30.0f,5.0f,hatch);
08332             <span class="keywordflow">if</span> (d) {
08333               <span class="keyword">const</span> <span class="keywordtype">int</span> zx0=(int)((width+Z0+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)), zx1=(int)((width+Z1+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)),
08334                 zy0=(int)((height+Z0+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d)), zy1=(int)((height+Z1+0.5f)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d));
08335               visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_7">draw_arrow</a>(zx0,y0,zx1,y1,fgcolor,30.0f,5.0f,hatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_7">draw_arrow</a>(x0,zy0,x1,zy1,fgcolor,30.0f,5.0f,hatch);
08336             }
08337           } <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(feature_type) {
08338           <span class="keywordflow">case</span> 2: {
08339             <span class="keyword">const</span> <span class="keywordtype">bool</span> cond=(phase&amp;&amp;feature_type);
08340             <span class="keyword">const</span> <span class="keywordtype">int</span> d=(depth&gt;1)?depth:0,
08341               nX0=cond?X0:X, nY0=cond?Y0:Y, nZ0=cond?Z0:Z,
08342               nX1=cond?X1:X, nY1=cond?Y1:Y, nZ1=cond?Z1:Z,
08343               x0=(nX0&lt;nX1?nX0:nX1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d),
08344               y0=(nY0&lt;nY1?nY0:nY1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d),
08345               x1=((nX0&lt;nX1?nX1:nX0)+1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)-1,
08346               y1=((nY0&lt;nY1?nY1:nY0)+1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d)-1;
08347             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nhatch=phase?hatch:~0L;
08348             visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_11">draw_rectangle</a>(x0,y0,x1,y1,fgcolor,0.2f).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(x0,y0,x1,y0,fgcolor,nhatch).
08349               draw_line(x1,y0,x1,y1,fgcolor,nhatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(x1,y1,x0,y1,fgcolor,nhatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(x0,y1,x0,y0,fgcolor,nhatch);
08350             <span class="keywordflow">if</span> (d) {
08351               <span class="keyword">const</span> <span class="keywordtype">int</span>
08352                 zx0=(int)((width+(nZ0&lt;nZ1?nZ0:nZ1))*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)),
08353                 zy0=(int)((height+(nZ0&lt;nZ1?nZ0:nZ1))*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d)),
08354                 zx1=(int)((width+(nZ0&lt;nZ1?nZ1:nZ0)+1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d))-1,
08355                 zy1=(int)((height+(nZ0&lt;nZ1?nZ1:nZ0)+1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d))-1;
08356               visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_11">draw_rectangle</a>(zx0,y0,zx1,y1,fgcolor,0.2f).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(zx0,y0,zx1,y0,fgcolor,nhatch).
08357                 draw_line(zx1,y0,zx1,y1,fgcolor,nhatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(zx1,y1,zx0,y1,fgcolor,nhatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(zx0,y1,zx0,y0,fgcolor,nhatch);
08358               visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_11">draw_rectangle</a>(x0,zy0,x1,zy1,fgcolor,0.2f).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(x0,zy0,x1,zy0,fgcolor,nhatch).
08359                 draw_line(x1,zy0,x1,zy1,fgcolor,nhatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(x1,zy1,x0,zy1,fgcolor,nhatch).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(x0,zy1,x0,zy0,fgcolor,nhatch);
08360             }
08361           } <span class="keywordflow">break</span>;
08362           <span class="keywordflow">case</span> 3: {
08363             <span class="keyword">const</span> <span class="keywordtype">bool</span> cond=(phase&amp;&amp;feature_type);
08364             <span class="keyword">const</span> <span class="keywordtype">int</span> d=(depth&gt;1)?depth:0,
08365               x0=(cond?X0:X)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d),
08366               y0=(cond?Y0:Y)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d),
08367               x1=(cond?X1:X)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)-1,
08368               y1=(cond?Y1:Y)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d)-1;
08369             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nhatch=phase?hatch:~0L;
08370             visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_16">draw_ellipse</a>(x0,y0,(<span class="keywordtype">float</span>)(x1-x0),(<span class="keywordtype">float</span>)(y1-y0),1.0f,0.0f,fgcolor,0L,0.2f).
08371                          draw_ellipse(x0,y0,(<span class="keywordtype">float</span>)(x1-x0),(<span class="keywordtype">float</span>)(y1-y0),1.0f,0.0f,fgcolor,nhatch);
08372             <span class="keywordflow">if</span> (d) {
08373               <span class="keyword">const</span> <span class="keywordtype">int</span>
08374                 zx0=(int)((width+(cond?Z0:Z))*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d)),
08375                 zy0=(int)((height+(cond?Z0:Z))*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d)),
08376                 zx1=(int)((width+(cond?Z1:Z)+1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o0">width</a>/(width+d))-1,
08377                 zy1=(int)((height+(cond?Z1:Z)+1)*disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o1">height</a>/(height+d))-1;
08378               visu.<a class="code" href="structcimg__library_1_1CImg.html#z13_16">draw_ellipse</a>(zx0,y0,(<span class="keywordtype">float</span>)(zx1-zx0),(<span class="keywordtype">float</span>)(y1-y0),1.0f,0.0f,fgcolor,0L,0.2f).
08379                                    draw_ellipse(zx0,y0,(<span class="keywordtype">float</span>)(zx1-zx0),(<span class="keywordtype">float</span>)(y1-y0),1.0f,0.0f,fgcolor,nhatch).
08380                                    draw_ellipse(x0,zy0,(<span class="keywordtype">float</span>)(x1-x0),(<span class="keywordtype">float</span>)(zy1-zy0),1.0f,0.0f,fgcolor,0L,0.2f).
08381                                    draw_ellipse(x0,zy0,(<span class="keywordtype">float</span>)(x1-x0),(<span class="keywordtype">float</span>)(zy1-zy0),1.0f,0.0f,fgcolor,nhatch);
08382             }
08383           } <span class="keywordflow">break</span>;
08384           }
08385         }
08386         visu.<a class="code" href="structcimg__library_1_1CImg.html#z19_0">display</a>(disp).<a class="code" href="structcimg__library_1_1CImg.html#z19_1">wait</a>(32);
08387         <span class="keywordflow">if</span> ((!feature_selected &amp;&amp; !phase &amp;&amp; oX==X &amp;&amp; oY==Y &amp;&amp; oZ==Z) || (X&lt;0 || Y&lt;0 || Z&lt;0)) disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#a5">wait</a>();
08388         oX=X; oY=Y; oZ=Z;
08389       }
08390 
08391       <span class="comment">// Return result</span>
08392       <span class="keywordflow">if</span> (XYZ) { XYZ[0] = X; XYZ[1] = Y; XYZ[2] = Z; }
08393       <span class="keywordflow">if</span> (feature_selected) {
08394         <span class="keywordflow">if</span> (feature_type==2) {
08395           <span class="keywordflow">if</span> (X0&gt;X1) cimg::swap(X0,X1);
08396           <span class="keywordflow">if</span> (Y0&gt;Y1) cimg::swap(Y0,Y1);
08397           <span class="keywordflow">if</span> (Z0&gt;Z1) cimg::swap(Z0,Z1);
08398         }
08399         <span class="keywordflow">if</span> (selection) {
08400           <span class="keywordflow">if</span> (X1&lt;0 || Y1&lt;0 || Z1&lt;0) X0=Y0=Z0=X1=Y1=Z1=-1;
08401           <span class="keywordflow">switch</span>(feature_type) {
08402           <span class="keywordflow">case</span> 1:
08403           <span class="keywordflow">case</span> 2:  selection[3] = X1; selection[4] = Y1; selection[5] = Z1;
08404           <span class="keywordflow">default</span>: selection[0] = X0; selection[1] = Y0; selection[2] = Z0;
08405           }
08406         }
08407       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selection) selection[0]=selection[1]=selection[2]=selection[3]=selection[4]=selection[5]=-1;
08408       disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o11">button</a>=0;
08409       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
08410     }
08411 
<a name="l08413"></a><a class="code" href="structcimg__library_1_1CImg.html#z19_5">08413</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; feature_selection(<span class="keywordtype">int</span> *<span class="keyword">const</span> selection, <span class="keyword">const</span> <span class="keywordtype">int</span> feature_type,
08414                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<span class="keyword">const</span> XYZ=NULL,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> color=NULL)<span class="keyword"> const </span>{
08415       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w = width + (depth&gt;1?depth:0), h = height + (depth&gt;1?depth:0);
08416       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmin = cimg::min(w,h), minsiz = 256;
08417       <span class="keywordflow">if</span> (dmin&lt;minsiz) { w=w*minsiz/dmin; h=h*minsiz/dmin; }
08418       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dmax = cimg::max(w,h), maxsiz = 1024;
08419       <span class="keywordflow">if</span> (dmax&gt;maxsiz) { w=w*maxsiz/dmax; h=h*maxsiz/dmax; }
08420       <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a> disp(w,h,<span class="stringliteral">""</span>,0,3);
08421       <span class="keywordflow">return</span> feature_selection(selection,feature_type,disp,XYZ,color);
08422     }
08423   
08425     <span class="comment">//------------------------------------------</span>
08426     <span class="comment">//------------------------------------------</span>
08427     <span class="comment">//</span>
08429 <span class="comment"></span>
08430     <span class="comment">//------------------------------------------</span>
08431     <span class="comment">//------------------------------------------</span>
08432 
08434 
<a name="l08440"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_15">08440</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08441       <span class="keywordflow">if</span> (!filename) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load() : Can't load (null) filename"</span>,pixel_type());
08442       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename);
08443       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"asc"</span>)) <span class="keywordflow">return</span> load_ascii(filename);
08444       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"dlm"</span>)) <span class="keywordflow">return</span> load_dlm(filename);
08445       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"inr"</span>)) <span class="keywordflow">return</span> load_inr(filename);
08446       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"hdr"</span>)) <span class="keywordflow">return</span> load_analyze(filename);
08447       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"pan"</span>)) <span class="keywordflow">return</span> load_pandore(filename);
08448       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"bmp"</span>)) <span class="keywordflow">return</span> load_bmp(filename);
08449       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"png"</span>)) <span class="keywordflow">return</span> load_png(filename);
08450       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"jpg"</span>) ||
08451           !cimg::strcasecmp(ext,<span class="stringliteral">"jpeg"</span>)) <span class="keywordflow">return</span> load_jpeg(filename);
08452       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"ppm"</span>) || 
08453           !cimg::strcasecmp(ext,<span class="stringliteral">"pgm"</span>) ||
08454           !cimg::strcasecmp(ext,<span class="stringliteral">"pnm"</span>)) <span class="keywordflow">return</span> load_pnm(filename);
08455       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"raw"</span>) || ext[0]==<span class="charliteral">'\0'</span>) <span class="keywordflow">return</span> load_raw(filename);      
08456       <span class="keywordflow">return</span> load_convert(filename);
08457     }
08458 
<a name="l08460"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_16">08460</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_ascii(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08461       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08462       <span class="keywordtype">char</span> line[256] = {0};
08463       std::fscanf(file,<span class="stringliteral">"%255[^\n]"</span>,line);
08464       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> off;
08465           <span class="keywordtype">int</span> err=1, dx=0, dy=1, dz=1, dv=1;
08466       std::sscanf(line,<span class="stringliteral">"%d %d %d %d"</span>,&amp;dx,&amp;dy,&amp;dz,&amp;dv);
08467       <span class="keywordflow">if</span> (!dx || !dy || !dz || !dv)
08468         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_ascii() : File '%s' does not appear to be a valid ASC file.\n"</span>
08469                               <span class="stringliteral">"Specified image dimensions are (%d,%d,%d,%d)"</span>,pixel_type(),filename,dx,dy,dz,dv);
08470       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(dx,dy,dz,dv);
08471       <span class="keywordtype">double</span> val;
08472       T *ptr = dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>;
08473       <span class="keywordflow">for</span> (off=0; off&lt;dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>() &amp;&amp; err==1; off++) {
08474         err = std::fscanf(file,<span class="stringliteral">"%lf%*[^0-9.eE+-]"</span>,&amp;val); 
08475         *(ptr++)=(T)val; 
08476       }
08477       cimg::warn(off&lt;dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>(),<span class="stringliteral">"CImg&lt;%s&gt;::load_ascii() : File '%s', only %u values read, instead of %u"</span>,
08478                  pixel_type(),filename,off,dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
08479       cimg::fclose(file);
08480       <span class="keywordflow">return</span> dest;
08481     }
08482 
<a name="l08484"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_17">08484</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_dlm(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08485       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"r"</span>);
08486       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cdx=0,dx=0,dy=0;
08487       <span class="keywordtype">double</span> val;
08488       <span class="keywordtype">char</span> c, delimiter[256]={0}, tmp[256];
08489       <span class="keywordtype">int</span> err;
08490       <span class="keywordflow">while</span> ((err = std::fscanf(file,<span class="stringliteral">"%lf%255[^0-9.eE+-]"</span>,&amp;val,delimiter))!=EOF) {
08491         c=0;
08492         <span class="keywordflow">if</span> (err&gt;0) cdx++;
08493         <span class="keywordflow">if</span> (!std::sscanf(delimiter,<span class="stringliteral">"%255[^\n]%c"</span>,tmp,&amp;c) || c==<span class="charliteral">'\n'</span>) { dx = cimg::max(cdx,dx); dy++; cdx=0; }
08494       }
08495       <span class="keywordflow">if</span> (!dx || !dy) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_dlm() : File '%s' does not appear to be a "</span>
08496                                             <span class="stringliteral">"valid DLM file (width = %d, height = %d)\n"</span>,pixel_type(),filename,dx,dy);
08497       std::rewind(file);
08498       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> dest(dx,dy,1,1,0);
08499       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = 0, y = 0;
08500       <span class="keywordflow">while</span> ((err = std::fscanf(file,<span class="stringliteral">"%lf%255[^0-9.eE+-]"</span>,&amp;val,delimiter))!=EOF) {
08501         c=0;
08502         <span class="keywordflow">if</span> (err&gt;0) dest(x++,y) = (T)val;
08503         <span class="keywordflow">if</span> (!std::sscanf(delimiter,<span class="stringliteral">"%255[^\n]%c"</span>,tmp,&amp;c) || c==<span class="charliteral">'\n'</span>) { x=0; y++; }
08504       }
08505       cimg::fclose(file);
08506       <span class="keywordflow">return</span> dest;
08507     }
08508 
<a name="l08510"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_18">08510</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_pnm(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08511       std::FILE *file=cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08512       <span class="keywordtype">char</span> item[1024]={0};
08513       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ppm_type,width,height,colormax=255;
08514       <span class="keywordtype">int</span> err;
08515       
08516       <span class="keywordflow">while</span> ((err=std::fscanf(file,<span class="stringliteral">"%1023[^\n]"</span>,item))!=EOF &amp;&amp; (item[0]==<span class="charliteral">'#'</span> || !err)) std::fgetc(file);
08517       <span class="keywordflow">if</span>(std::sscanf(item,<span class="stringliteral">" P%u"</span>,&amp;ppm_type)!=1) 
08518         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_pnm() : file '%s',PPM header 'P?' not found"</span>,pixel_type(),filename);
08519       <span class="keywordflow">while</span> ((err=std::fscanf(file,<span class="stringliteral">" %1023[^\n]"</span>,item))!=EOF &amp;&amp; (item[0]==<span class="charliteral">'#'</span> || !err)) std::fgetc(file);
08520       <span class="keywordflow">if</span> (std::sscanf(item,<span class="stringliteral">" %u %u"</span>,&amp;width,&amp;height)!=2)
08521         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_pnm() : file '%s',WIDTH and HEIGHT not defined"</span>,pixel_type(),filename);
08522       <span class="keywordflow">while</span> ((err=std::fscanf(file,<span class="stringliteral">" %1023[^\n]"</span>,item))!=EOF &amp;&amp; (item[0]==<span class="charliteral">'#'</span> || !err)) std::fgetc(file);
08523       std::fgetc(file);
08524       cimg::warn(std::sscanf(item,<span class="stringliteral">"%u"</span>,&amp;colormax)!=1,
08525                  <span class="stringliteral">"CImg&lt;%s&gt;::load_pnm() : file '%s',COLORMAX not defined"</span>,pixel_type(),filename);
08526       
08527       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest;
08528       <span class="keywordtype">int</span> rval,gval,bval;
08529 
08530       <span class="keywordflow">switch</span> (ppm_type) {
08531       <span class="keywordflow">case</span> 2: { <span class="comment">// Grey Ascii</span>
08532         dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,1,1);
08533         T* rdata = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
08534         cimg_mapoff(dest,off) { std::fscanf(file,<span class="stringliteral">"%d"</span>,&amp;rval); *(rdata++)=(T)rval; }
08535       } <span class="keywordflow">break</span>;
08536       <span class="keywordflow">case</span> 3: { <span class="comment">// Color Ascii</span>
08537         dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,1,3);
08538         T *rdata = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0), *gdata = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1), *bdata = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,2);
08539         cimg_mapXY(dest,x,y) { 
08540           std::fscanf(file,<span class="stringliteral">"%d %d %d"</span>,&amp;rval,&amp;gval,&amp;bval);
08541           *(rdata++)=(T)rval; 
08542           *(gdata++)=(T)gval; 
08543           *(bdata++)=(T)bval; }
08544       } <span class="keywordflow">break</span>;
08545       <span class="keywordflow">case</span> 5: { <span class="comment">// Grey Binary</span>
08546         <span class="keywordflow">if</span> (colormax&lt;256) { <span class="comment">// 8 bits</span>
08547           <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> raw(width,height,1,1);
08548           cimg::fread(raw.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),width*height,file);
08549           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(raw);
08550         } <span class="keywordflow">else</span> { <span class="comment">// 16 bits</span>
08551           <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned short&gt;</a> raw(width,height,1,1);
08552           cimg::fread(raw.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),width*height,file);
08553           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(raw);
08554         }
08555       } <span class="keywordflow">break</span>;
08556       <span class="keywordflow">case</span> 6: { <span class="comment">// Color Binary</span>
08557         <span class="keywordflow">if</span> (colormax&lt;256) { <span class="comment">// 8 bits</span>
08558           <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> raw(width,height,1,3);
08559           cimg::fread(raw.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),width*height*3,file);
08560           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(raw.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,width,height,1,3,<span class="keyword">true</span>);
08561         } <span class="keywordflow">else</span> { <span class="comment">// 16 bits</span>
08562           <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned short&gt;</a> raw(width,height,1,3);
08563           cimg::fread(raw.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),width*height*3,file);
08564           dest = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(raw.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,width,height,1,3,<span class="keyword">true</span>);
08565         }
08566       } <span class="keywordflow">break</span>;
08567       <span class="keywordflow">default</span>:
08568         cimg::fclose(file);
08569         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_pnm() : file '%s', PPM type 'P%d' not supported"</span>,pixel_type(),filename,ppm_type);
08570       }
08571       cimg::fclose(file);
08572       <span class="keywordflow">return</span> dest;
08573     }
08574 
<a name="l08576"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_19">08576</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_bmp(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08577       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> header[64];
08578       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08579       cimg::fread(header,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),54,file);
08580       <span class="keywordflow">if</span> (header[0]!=<span class="charliteral">'B'</span> || header[1]!=<span class="charliteral">'M'</span>)
08581         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_bmp() : filename '%s' does not appear to be a valid BMP file"</span>,
08582                               pixel_type(),filename);
08583       
08584       <span class="comment">// Read header and pixel buffer</span>
08585       <span class="keywordtype">int</span>
08586         file_size   = header[0x02] + (header[0x03]&lt;&lt;8) + (header[0x04]&lt;&lt;16) + (header[0x05]&lt;&lt;24),
08587         offset      = header[0x0A] + (header[0x0B]&lt;&lt;8) + (header[0x0C]&lt;&lt;16) + (header[0x0D]&lt;&lt;24),
08588         dx          = header[0x12] + (header[0x13]&lt;&lt;8) + (header[0x14]&lt;&lt;16) + (header[0x15]&lt;&lt;24),
08589         dy          = header[0x16] + (header[0x17]&lt;&lt;8) + (header[0x18]&lt;&lt;16) + (header[0x19]&lt;&lt;24),
08590         compression = header[0x1E] + (header[0x1F]&lt;&lt;8) + (header[0x20]&lt;&lt;16) + (header[0x21]&lt;&lt;24),
08591         nb_colors   = header[0x2E] + (header[0x2F]&lt;&lt;8) + (header[0x30]&lt;&lt;16) + (header[0x31]&lt;&lt;24),
08592         bpp         = header[0x1C] + (header[0x1D]&lt;&lt;8),
08593         *palette    = NULL;
08594       <span class="keyword">const</span> <span class="keywordtype">int</span> 
08595         dx_bytes   = (bpp==1)?(dx/8+(dx%8?1:0)):((bpp==4)?(dx/2+(dx%2?1:0)):(dx*bpp/8)),
08596         align      = (4-dx_bytes%4)%4,
08597         buf_size   = cimg::min(cimg::abs(dy)*(dx_bytes+align),file_size-offset);
08598 
08599       <span class="keywordflow">if</span> (bpp&lt;16) { <span class="keywordflow">if</span> (!nb_colors) nb_colors=1&lt;&lt;bpp; } <span class="keywordflow">else</span> nb_colors=0;
08600       <span class="keywordflow">if</span> (nb_colors) { palette = <span class="keyword">new</span> <span class="keywordtype">int</span>[nb_colors]; cimg::fread(palette,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),nb_colors,file); }
08601       <span class="keyword">const</span> <span class="keywordtype">int</span> xoffset = offset-54-4*nb_colors;      
08602       <span class="keywordflow">if</span> (xoffset&gt;0) std::fseek(file,xoffset,SEEK_CUR);
08603       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer  = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[buf_size], *ptrs = buffer;
08604       cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),buf_size,file);
08605       cimg::fclose(file);
08606 
08607       <span class="comment">// Decompress buffer (if necessary)</span>
08608       <span class="keywordflow">if</span> (compression) <span class="keywordflow">return</span> load_convert(filename);
08609       
08610       <span class="comment">// Read pixel data</span>
08611       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res(dx,cimg::abs(dy),1,3);
08612       <span class="keywordflow">switch</span> (bpp) {
08613       <span class="keywordflow">case</span> 1: { <span class="comment">// Monochrome</span>
08614         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1; y&gt;=0; y--) { 
08615           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mask = 0x80, val = 0;
08616           cimg_mapX(res,x) {
08617             <span class="keywordflow">if</span> (mask==0x80) val = *(ptrs++);
08618             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(palette+(val&amp;mask?1:0));
08619             res(x,y,2) = (T)*(col++);
08620             res(x,y,1) = (T)*(col++);
08621             res(x,y,0) = (T)*(col++);
08622             mask = cimg::ror(mask);
08623           } ptrs+=align; }
08624       } <span class="keywordflow">break</span>;
08625       <span class="keywordflow">case</span> 4: { <span class="comment">// 16 colors</span>
08626         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1; y&gt;=0; y--) { 
08627           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mask = 0xF0, val = 0;
08628           cimg_mapX(res,x) {
08629             <span class="keywordflow">if</span> (mask==0xF0) val = *(ptrs++);
08630             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> color = (mask&lt;16)?(val&amp;mask):((val&amp;mask)&gt;&gt;4);
08631             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(palette+color);
08632             res(x,y,2) = (T)*(col++);
08633             res(x,y,1) = (T)*(col++);
08634             res(x,y,0) = (T)*(col++);
08635             mask = cimg::ror(mask,4);
08636           } ptrs+=align; }
08637       } <span class="keywordflow">break</span>;
08638       <span class="keywordflow">case</span> 8: { <span class="comment">//  256 colors</span>
08639         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1; y&gt;=0; y--) { cimg_mapX(res,x) {
08640           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(palette+*(ptrs++));
08641           res(x,y,2) = (T)*(col++);
08642           res(x,y,1) = (T)*(col++);
08643           res(x,y,0) = (T)*(col++);
08644         } ptrs+=align; }
08645       } <span class="keywordflow">break</span>;
08646       <span class="keywordflow">case</span> 16: { <span class="comment">// 16 bits colors</span>
08647         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1; y&gt;=0; y--) { cimg_mapX(res,x) {
08648           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c1 = *(ptrs++), c2 = *(ptrs++);
08649           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> col = c1+(c2&lt;&lt;8);
08650           res(x,y,2) = (T)(col&amp;0x1F);
08651           res(x,y,1) = (T)((col&gt;&gt;5)&amp;0x1F);
08652           res(x,y,0) = (T)((col&gt;&gt;10)&amp;0x1F);
08653         } ptrs+=align; }
08654       } <span class="keywordflow">break</span>;  
08655       <span class="keywordflow">case</span> 24: { <span class="comment">// 24 bits colors</span>
08656         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1; y&gt;=0; y--) { cimg_mapX(res,x) {
08657           res(x,y,2) = (T)*(ptrs++);
08658           res(x,y,1) = (T)*(ptrs++);
08659           res(x,y,0) = (T)*(ptrs++);
08660         } ptrs+=align; }
08661       } <span class="keywordflow">break</span>;
08662       <span class="keywordflow">case</span> 32: { <span class="comment">// 32 bits colors</span>
08663         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>-1; y&gt;=0; y--) { cimg_mapX(res,x) {
08664           res(x,y,2) = (T)*(ptrs++);
08665           res(x,y,1) = (T)*(ptrs++);
08666           res(x,y,0) = (T)*(ptrs++);
08667           ptrs++;
08668         } ptrs+=align; }
08669       } <span class="keywordflow">break</span>;
08670       }
08671 
08672       <span class="keywordflow">if</span> (palette) <span class="keyword">delete</span>[] palette;
08673       <span class="keyword">delete</span>[] buffer;
08674       <span class="keywordflow">if</span> (dy&lt;0) res.<a class="code" href="structcimg__library_1_1CImg.html#z9_53">flip</a>(<span class="charliteral">'y'</span>);
08675       <span class="keywordflow">return</span> res;
08676     }
08677     
08679     <span class="comment">// Note : Most of this function has been written by Eric Fausett</span>
<a name="l08680"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_20">08680</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_png(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08681 <span class="preprocessor">#ifndef cimg_use_png</span>
08682 <span class="preprocessor"></span>      <span class="keywordflow">return</span> load_convert(filename);
08683 <span class="preprocessor">#else</span>
08684 <span class="preprocessor"></span>      <span class="comment">// Open file and check for PNG validity</span>
08685       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pngCheck[8];
08686       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08687       cimg::fread(pngCheck,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),8,file);
08688       <span class="keywordflow">if</span>(png_sig_cmp(pngCheck,0,8)){
08689         cimg::fclose(file);
08690         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : filename '%s' does not appear to be a valid PNG file"</span>,pixel_type(),filename);
08691       }
08692       
08693       <span class="comment">// Setup PNG structures for read</span>
08694       png_voidp user_error_ptr=0;
08695       png_error_ptr user_error_fn=0, user_warning_fn=0;
08696       png_structp png_ptr = png_create_read_struct(PNG_LIBPNG_VER_STRING,       <span class="comment">// Verifies libpng version correct</span>
08697                                                    user_error_ptr, user_error_fn, user_warning_fn);
08698       <span class="keywordflow">if</span>(!png_ptr){
08699         cimg::fclose(file);
08700         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : trouble initializing 'png_ptr' data structure"</span>,pixel_type());
08701       }
08702       png_infop info_ptr = png_create_info_struct(png_ptr);
08703       <span class="keywordflow">if</span>(!info_ptr){
08704         cimg::fclose(file);
08705         png_destroy_read_struct(&amp;png_ptr, (png_infopp)NULL, (png_infopp)NULL);                  
08706         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : trouble initializing 'info_ptr' data structure"</span>,pixel_type());
08707       }
08708       png_infop end_info = png_create_info_struct(png_ptr);
08709       <span class="keywordflow">if</span>(!end_info){
08710         cimg::fclose(file);
08711         png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, (png_infopp)NULL);                 
08712         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : trouble initializing 'end_info' data structure"</span>,pixel_type());
08713       }
08714       
08715       <span class="comment">// Error handling callback for png file reading</span>
08716       <span class="keywordflow">if</span> (setjmp(png_jmpbuf(png_ptr))){
08717         png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, &amp;end_info);
08718         cimg::fclose(file);
08719         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : unspecified error reading PNG file '%s'"</span>,pixel_type(),filename);
08720       }      
08721       png_init_io(png_ptr, file);      
08722       png_set_sig_bytes(png_ptr, 8);
08723       
08724       <span class="comment">// Get PNG Header Info up to data block</span>
08725       png_read_info(png_ptr, info_ptr);      
08726       png_uint_32 width, height;
08727       <span class="keywordtype">int</span> bit_depth, color_type, interlace_type;
08728       png_get_IHDR(png_ptr, info_ptr, &amp;width, &amp;height, &amp;bit_depth, &amp;color_type, &amp;interlace_type,
08729                    int_p_NULL, int_p_NULL);
08730       <span class="keywordtype">int</span> new_bit_depth = bit_depth;
08731       <span class="keywordtype">int</span> new_color_type = color_type;
08732       
08733       <span class="comment">// Transforms to unify image data         </span>
08734       <span class="keywordflow">if</span> (new_color_type == PNG_COLOR_TYPE_PALETTE){
08735         png_set_palette_to_rgb(png_ptr);
08736         new_color_type -= PNG_COLOR_MASK_PALETTE;
08737         new_bit_depth = 8;
08738       }
08739       <span class="keywordflow">if</span> (new_color_type == PNG_COLOR_TYPE_GRAY &amp;&amp; bit_depth &lt; 8){
08740         png_set_gray_1_2_4_to_8(png_ptr);
08741         new_bit_depth = 8;
08742       }
08743       <span class="keywordflow">if</span> (png_get_valid(png_ptr, info_ptr, PNG_INFO_tRNS))
08744         png_set_tRNS_to_alpha(png_ptr);
08745       <span class="keywordflow">if</span> (new_color_type == PNG_COLOR_TYPE_GRAY || new_color_type == PNG_COLOR_TYPE_GRAY_ALPHA){
08746         png_set_gray_to_rgb(png_ptr);
08747         new_color_type |= PNG_COLOR_MASK_COLOR;
08748       }
08749       <span class="keywordflow">if</span> (new_color_type == PNG_COLOR_TYPE_RGB) png_set_filler(png_ptr, 0xffffU, PNG_FILLER_AFTER);      
08750       png_read_update_info(png_ptr, info_ptr);      
08751       <span class="keywordflow">if</span> (!(new_bit_depth==8 || new_bit_depth==16))
08752         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : Wrong bit coding 'bit_depth=%u'"</span>,pixel_type(),new_bit_depth);
08753       <span class="keyword">const</span> <span class="keywordtype">int</span> byte_depth = new_bit_depth&gt;&gt;3;
08754       
08755       <span class="comment">// Allocate Memory for Image Read</span>
08756       png_bytep *imgData = <span class="keyword">new</span> png_bytep[height];
08757       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row=0; row &lt; height; row++) imgData[row] = <span class="keyword">new</span> png_byte[byte_depth * 4 * width];
08758       png_read_image(png_ptr, imgData);
08759       png_read_end(png_ptr, end_info);
08760       
08761       <span class="comment">// Read pixel data</span>
08762       <span class="keywordflow">if</span> (!(new_color_type==PNG_COLOR_TYPE_RGB || new_color_type==PNG_COLOR_TYPE_RGB_ALPHA))
08763         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_png() : Wrong color coding new_color_type=%u"</span>,pixel_type(),new_color_type);
08764       <span class="keyword">const</span> <span class="keywordtype">bool</span> no_alpha_channel = (new_color_type==PNG_COLOR_TYPE_RGB);
08765       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res(width,height,1,no_alpha_channel?3:4);
08766       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> off = width*height;
08767       T *ptr1 = res.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>, *ptr2 = ptr1+off, *ptr3 = ptr2+off, *ptr4 = ptr3+off;
08768       <span class="keywordflow">switch</span>(new_bit_depth){
08769       <span class="keywordflow">case</span> 8: {
08770         cimg_mapY(res,y){
08771           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrs = imgData[y];
08772           cimg_mapX(res,x){
08773             *(ptr1++) = (T)*(ptrs++);
08774             *(ptr2++) = (T)*(ptrs++);
08775             *(ptr3++) = (T)*(ptrs++);
08776             <span class="keywordflow">if</span> (no_alpha_channel) ptrs++; <span class="keywordflow">else</span> *(ptr4++) = (T)*(ptrs++);
08777           }
08778         }
08779       } <span class="keywordflow">break</span>;
08780       <span class="keywordflow">case</span> 16: {
08781         cimg_mapY(res,y){
08782           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrs = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)(imgData[y]);
08783           cimg_mapX(res,x){
08784             *(ptr1++) = (T)*(ptrs++);
08785             *(ptr2++) = (T)*(ptrs++);
08786             *(ptr3++) = (T)*(ptrs++);
08787             <span class="keywordflow">if</span> (no_alpha_channel) ptrs++; <span class="keywordflow">else</span> *(ptr4++) = (T)*(ptrs++);
08788           }
08789         }
08790       } <span class="keywordflow">break</span>;
08791       }
08792       png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, &amp;end_info);
08793       
08794       <span class="comment">// Deallocate Image Read Memory</span>
08795       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=0; n&lt;height; n++) <span class="keyword">delete</span>[] imgData[n];
08796       <span class="keyword">delete</span>[] imgData;      
08797       cimg::fclose(file);
08798       <span class="keywordflow">return</span> res;      
08799 <span class="preprocessor">#endif      </span>
08800 <span class="preprocessor"></span>    }
08801 
08802 
<a name="l08804"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_21">08804</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_jpeg(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08805 <span class="preprocessor">#ifndef cimg_use_jpeg</span>
08806 <span class="preprocessor"></span>      <span class="keywordflow">return</span> load_convert(filename);
08807 <span class="preprocessor">#else</span>
08808 <span class="preprocessor"></span>      <span class="keyword">struct </span>jpeg_decompress_struct cinfo;
08809       <span class="keyword">struct </span>jpeg_error_mgr jerr;
08810       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08811       cinfo.err = jpeg_std_error(&amp;jerr);
08812       jpeg_create_decompress(&amp;cinfo);
08813       jpeg_stdio_src(&amp;cinfo,file);
08814       jpeg_read_header(&amp;cinfo,TRUE);
08815       jpeg_start_decompress(&amp;cinfo);
08816       
08817       <span class="keywordflow">if</span> (cinfo.output_components!=3) {
08818         cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImg&lt;%s&gt;::load_jpeg() : Don't know how to read image '%s' with libpeg, trying ImageMagick's convert"</span>,
08819                    pixel_type(),filename);
08820         <span class="keywordflow">return</span> load_convert(filename);
08821       }
08822       
08823       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row_stride = cinfo.output_width * cinfo.output_components;
08824       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[cinfo.output_width*cinfo.output_height*3], *buf2 = buf;
08825       JSAMPROW row_pointer[1];
08826       <span class="keywordflow">while</span> (cinfo.output_scanline &lt; cinfo.output_height) {
08827         row_pointer[0] = &amp;buf[cinfo.output_scanline*row_stride];
08828         jpeg_read_scanlines(&amp;cinfo,row_pointer,1);
08829       }
08830       jpeg_finish_decompress(&amp;cinfo);
08831       jpeg_destroy_decompress(&amp;cinfo);
08832       cimg::fclose(file);
08833       
08834       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> dest(cinfo.output_width,cinfo.output_height,1,3);
08835       T *ptr_r = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0),
08836         *ptr_g = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1),
08837         *ptr_b = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,2);
08838       cimg_mapXY(dest,x,y) {
08839         *(ptr_r++) = *(buf2++);
08840         *(ptr_g++) = *(buf2++);
08841         *(ptr_b++) = *(buf2++);
08842       }
08843       <span class="keyword">delete</span>[] buf;
08844       <span class="keywordflow">return</span> dest;
08845 <span class="preprocessor">#endif</span>
08846 <span class="preprocessor"></span>    }
08847     
<a name="l08849"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_22">08849</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_rgba(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimw,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimh) {
08850       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08851       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[dimw*dimh*4];
08852       cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),dimw*dimh*4,file);
08853       cimg::fclose(file);
08854       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(buffer,dimw,dimh,1,4,<span class="keyword">true</span>);
08855       <span class="keyword">delete</span>[] buffer;
08856       <span class="keywordflow">return</span> res;      
08857     }
08858 
<a name="l08860"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_23">08860</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_rgb(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimw,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dimh) {
08861       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08862       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[dimw*dimh*3];
08863       cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),dimw*dimh*3,file);
08864       cimg::fclose(file);
08865       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> res = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(buffer,dimw,dimh,1,3,<span class="keyword">true</span>);
08866       <span class="keyword">delete</span>[] buffer;
08867       <span class="keywordflow">return</span> res;
08868     }
08869     
08871 <span class="preprocessor">#define cimg_load_inr_case(Tf,sign,pixsize,Ts)                            \</span>
08872 <span class="preprocessor">  if (!loaded &amp;&amp; fopt[6]==pixsize &amp;&amp; fopt[4]==Tf &amp;&amp; fopt[5]==sign) {      \</span>
08873 <span class="preprocessor">      Ts *xval, *val = new Ts[fopt[0]*fopt[3]];                           \</span>
08874 <span class="preprocessor">      cimg_mapYZ(dest,y,z) {                                              \</span>
08875 <span class="preprocessor">          cimg::fread(val,pixsize/8,fopt[0]*fopt[3],file);                \</span>
08876 <span class="preprocessor">          if (fopt[7]!=endian) cimg::endian_swap(val,fopt[0]*fopt[3]);    \</span>
08877 <span class="preprocessor">          xval = val; cimg_mapX(dest,x) cimg_mapV(dest,k)                 \</span>
08878 <span class="preprocessor">                          dest(x,y,z,k) = (T)*(xval++);                   \</span>
08879 <span class="preprocessor">        }                                                                 \</span>
08880 <span class="preprocessor">      delete[] val;                                                       \</span>
08881 <span class="preprocessor">      loaded = true;                                                      \</span>
08882 <span class="preprocessor">    }</span>
08883 <span class="preprocessor"></span>    
08884     <span class="keyword">static</span> <span class="keywordtype">void</span> _load_inr(std::FILE *file,<span class="keywordtype">int</span> out[8],<span class="keywordtype">float</span> *voxsize=NULL) {
08885       <span class="keywordtype">char</span> item[1024],tmp1[64],tmp2[64];
08886       out[0]=out[1]=out[2]=out[3]=out[5]=1; out[4]=out[6]=out[7]=-1;
08887       std::fscanf(file,<span class="stringliteral">"%63s"</span>,item);
08888       <span class="keywordflow">if</span>(cimg::strncasecmp(item,<span class="stringliteral">"#INRIMAGE-4#{"</span>,13)!=0) 
08889         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_inr() : File does not appear to be a valid INR file.\n"</span>
08890                               <span class="stringliteral">"(INRIMAGE-4 identifier not found)"</span>,pixel_type());
08891       <span class="keywordflow">while</span> (std::fscanf(file,<span class="stringliteral">" %63[^\n]%*c"</span>,item)!=EOF &amp;&amp; cimg::strncmp(item,<span class="stringliteral">"##}"</span>,3)) {
08892         std::sscanf(item,<span class="stringliteral">" XDIM%*[^0-9]%d"</span>,out);
08893         std::sscanf(item,<span class="stringliteral">" YDIM%*[^0-9]%d"</span>,out+1);
08894         std::sscanf(item,<span class="stringliteral">" ZDIM%*[^0-9]%d"</span>,out+2);
08895         std::sscanf(item,<span class="stringliteral">" VDIM%*[^0-9]%d"</span>,out+3);
08896         std::sscanf(item,<span class="stringliteral">" PIXSIZE%*[^0-9]%d"</span>,out+6);
08897         <span class="keywordflow">if</span> (voxsize) {
08898           std::sscanf(item,<span class="stringliteral">" VX%*[^0-9.eE+-]%f"</span>,voxsize);
08899           std::sscanf(item,<span class="stringliteral">" VY%*[^0-9.eE+-]%f"</span>,voxsize+1);
08900           std::sscanf(item,<span class="stringliteral">" VZ%*[^0-9.eE+-]%f"</span>,voxsize+2);
08901         }
08902         <span class="keywordflow">if</span> (std::sscanf(item,<span class="stringliteral">" CPU%*[ =]%s"</span>,tmp1)) out[7]=cimg::strncasecmp(tmp1,<span class="stringliteral">"sun"</span>,3)?0:1;
08903         <span class="keywordflow">switch</span>(std::sscanf(item,<span class="stringliteral">" TYPE%*[ =]%s %s"</span>,tmp1,tmp2)) {
08904         <span class="keywordflow">case</span> 0: <span class="keywordflow">break</span>;
08905         <span class="keywordflow">case</span> 2: out[5] = cimg::strncasecmp(tmp1,<span class="stringliteral">"unsigned"</span>,8)?1:0; std::strcpy(tmp1,tmp2);
08906         <span class="keywordflow">case</span> 1:
08907           <span class="keywordflow">if</span> (!cimg::strncasecmp(tmp1,<span class="stringliteral">"int"</span>,3)   || !cimg::strncasecmp(tmp1,<span class="stringliteral">"fixed"</span>,5))  out[4]=0;
08908           <span class="keywordflow">if</span> (!cimg::strncasecmp(tmp1,<span class="stringliteral">"float"</span>,5) || !cimg::strncasecmp(tmp1,<span class="stringliteral">"double"</span>,6)) out[4]=1;
08909           <span class="keywordflow">if</span> (!cimg::strncasecmp(tmp1,<span class="stringliteral">"packed"</span>,6))                                       out[4]=2;
08910           <span class="keywordflow">if</span> (out[4]&gt;=0) <span class="keywordflow">break</span>;
08911         <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"cimg::inr_header_read() : Invalid TYPE '%s'"</span>,tmp2);
08912         }
08913       }
08914       <span class="keywordflow">if</span>(out[0]&lt;0 || out[1]&lt;0 || out[2]&lt;0 || out[3]&lt;0)
08915         <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_inr() : Bad dimensions in .inr file = ( %d , %d , %d , %d )"</span>,
08916                               pixel_type(),out[0],out[1],out[2],out[3]);
08917       <span class="keywordflow">if</span>(out[4]&lt;0 || out[5]&lt;0) <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_inr() : TYPE is not fully defined"</span>,pixel_type());
08918       <span class="keywordflow">if</span>(out[6]&lt;0) <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_inr() : PIXSIZE is not fully defined"</span>,pixel_type());
08919       <span class="keywordflow">if</span>(out[7]&lt;0) <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_inr() : Big/Little Endian coding type is not defined"</span>,pixel_type());
08920     }
08921     
08922     <span class="keyword">static</span> CImg load_inr(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">float</span> *voxsize = NULL) {
08923       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08924           <span class="keywordtype">int</span> fopt[8], <a class="code" href="namespacecimg__library_1_1cimg.html#a73">endian</a>=cimg::endian()?1:0;
08925       <span class="keywordtype">bool</span> loaded = <span class="keyword">false</span>;
08926       <span class="keywordflow">if</span> (voxsize) voxsize[0]=voxsize[1]=voxsize[2]=1;
08927       _load_inr(file,fopt,voxsize);
08928       CImg&lt;T&gt; dest = CImg&lt;T&gt;(fopt[0],fopt[1],fopt[2],fopt[3]);
08929       cimg_load_inr_case(0,0,8, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>);
08930       cimg_load_inr_case(0,1,8, <span class="keywordtype">char</span>);
08931       cimg_load_inr_case(0,0,16,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
08932       cimg_load_inr_case(0,1,16,<span class="keywordtype">short</span>);
08933       cimg_load_inr_case(0,0,32,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
08934       cimg_load_inr_case(0,1,32,<span class="keywordtype">int</span>);
08935       cimg_load_inr_case(1,0,32,<span class="keywordtype">float</span>);
08936       cimg_load_inr_case(1,1,32,<span class="keywordtype">float</span>);
08937       cimg_load_inr_case(1,0,64,<span class="keywordtype">double</span>);
08938       cimg_load_inr_case(1,1,64,<span class="keywordtype">double</span>);
08939       <span class="keywordflow">if</span> (!loaded) <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_inr() : File '%s', can't read images of the type specified in the file"</span>,
08940                                          pixel_type(),filename);
08941       cimg::fclose(file);
08942       <span class="keywordflow">return</span> dest;
08943     }
08944    
08945 <span class="preprocessor">#define cimg_load_pandore_case(nid,nbdim,nwidth,nheight,ndepth,ndim,stype)  \</span>
08946 <span class="preprocessor">  case nid: {                                                         \</span>
08947 <span class="preprocessor">    cimg::fread(dims,sizeof(unsigned int),nbdim,file);                \</span>
08948 <span class="preprocessor">    if (endian) cimg::endian_swap(dims,nbdim);                        \</span>
08949 <span class="preprocessor">    dest = CImg&lt;T&gt;(nwidth,nheight,ndepth,ndim);                       \</span>
08950 <span class="preprocessor">    stype *buffer = new stype[dest.size()];                           \</span>
08951 <span class="preprocessor">    cimg::fread(buffer,sizeof(stype),dest.size(),file);               \</span>
08952 <span class="preprocessor">    if (endian) cimg::endian_swap(buffer,dest.size());                \</span>
08953 <span class="preprocessor">    T *ptrd = dest.ptr();                                             \</span>
08954 <span class="preprocessor">    cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));               \</span>
08955 <span class="preprocessor">    buffer-=dest.size();                                              \</span>
08956 <span class="preprocessor">    delete[] buffer;                                                  \</span>
08957 <span class="preprocessor">   }                                                                  \</span>
08958 <span class="preprocessor">   break;</span>
08959 <span class="preprocessor"></span>    
08960     <span class="keyword">static</span> CImg load_pandore(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
08961       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
08962       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> uchar;
08963       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ushort;
08964       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uint;  
08965       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulong; 
08966       CImg dest;
08967       <span class="keywordtype">char</span> tmp[16];
08968       cimg::fread(tmp,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),12,file);
08969       <span class="keywordflow">if</span> (cimg::strncasecmp(<span class="stringliteral">"PANDORE"</span>,tmp,7)) 
08970         <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_pandore() : File '%s' does not appear to be a valid PANDORE file.\n"</span>
08971                               <span class="stringliteral">"(PANDORE identifier not found)"</span>,pixel_type(),filename);
08972       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> id,dims[8];
08973       <span class="keywordtype">long</span> ptbuf[4];
08974       cimg::fread(&amp;<span class="keywordtype">id</span>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),1,file);
08975       <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="namespacecimg__library_1_1cimg.html#a73">endian</a> = (<span class="keywordtype">id</span>&gt;255);
08976       <span class="keywordflow">if</span> (endian) cimg::endian_swap(<span class="keywordtype">id</span>);
08977       cimg::fread(tmp,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),20,file);
08978       <span class="keywordflow">switch</span> (id) {
08979         cimg_load_pandore_case(2,2,dims[1],1,1,1,uchar);
08980         cimg_load_pandore_case(3,2,dims[1],1,1,1,<span class="keywordtype">long</span>);
08981         cimg_load_pandore_case(4,2,dims[1],1,1,1,<span class="keywordtype">float</span>);
08982         cimg_load_pandore_case(5,3,dims[2],dims[1],1,1,uchar);
08983         cimg_load_pandore_case(6,3,dims[2],dims[1],1,1,<span class="keywordtype">long</span>);
08984         cimg_load_pandore_case(7,3,dims[2],dims[1],1,1,<span class="keywordtype">float</span>);
08985         cimg_load_pandore_case(8,4,dims[3],dims[2],dims[1],1,uchar);
08986         cimg_load_pandore_case(9,4,dims[3],dims[2],dims[1],1,<span class="keywordtype">long</span>);
08987         cimg_load_pandore_case(10,4,dims[3],dims[2],dims[1],1,<span class="keywordtype">float</span>);
08988       <span class="keywordflow">case</span> 11: { <span class="comment">// Region 1D</span>
08989         cimg::fread(dims,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>),3,file);
08990         <span class="keywordflow">if</span> (endian) cimg::endian_swap(dims,3);
08991         dest = CImg&lt;T&gt;(dims[1],1,1,1);
08992         <span class="keywordflow">if</span> (dims[2]&lt;256) {
08993           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[dest.size()];
08994           cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),dest.size(),file);
08995           T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
08996           cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
08997           buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
08998           <span class="keyword">delete</span>[] buffer;
08999         } <span class="keywordflow">else</span> {
09000           <span class="keywordflow">if</span> (dims[2]&lt;65536) {
09001             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[dest.size()];
09002             cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),dest.size(),file);
09003             <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dest.size());
09004             T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09005             cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09006             buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09007             <span class="keyword">delete</span>[] buffer;
09008           } <span class="keywordflow">else</span> {
09009             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[dest.size()];
09010             cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>),dest.size(),file);
09011             <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dest.size());
09012             T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09013             cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09014             buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09015             <span class="keyword">delete</span>[] buffer;
09016           }
09017         }       
09018       }
09019         <span class="keywordflow">break</span>;
09020       <span class="keywordflow">case</span> 12: { <span class="comment">// Region 2D</span>
09021         cimg::fread(dims,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>),4,file);
09022         <span class="keywordflow">if</span> (endian) cimg::endian_swap(dims,4);
09023         dest = CImg&lt;T&gt;(dims[2],dims[1],1,1);
09024         <span class="keywordflow">if</span> (dims[3]&lt;256) {
09025           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[dest.size()];
09026           cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),dest.size(),file);
09027           T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09028           cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09029           buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09030           <span class="keyword">delete</span>[] buffer;
09031         } <span class="keywordflow">else</span> {
09032           <span class="keywordflow">if</span> (dims[3]&lt;65536) {
09033             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[dest.size()];
09034             cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),dest.size(),file);
09035             <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dest.size());
09036             T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09037             cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09038             buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09039             <span class="keyword">delete</span>[] buffer;
09040           } <span class="keywordflow">else</span> {
09041             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[dest.size()];
09042             cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>),dest.size(),file);
09043             <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dest.size());
09044             T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09045             cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09046             buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09047             <span class="keyword">delete</span>[] buffer;
09048           }
09049         }       
09050       }
09051         <span class="keywordflow">break</span>;
09052       <span class="keywordflow">case</span> 13: { <span class="comment">// Region 3D</span>
09053         cimg::fread(dims,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>),5,file);
09054         <span class="keywordflow">if</span> (endian) cimg::endian_swap(dims,5);
09055         dest = CImg&lt;T&gt;(dims[3],dims[2],dims[1],1);
09056         <span class="keywordflow">if</span> (dims[4]&lt;256) {
09057           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[dest.size()];
09058           cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),dest.size(),file);
09059           T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09060           cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09061           buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09062           <span class="keyword">delete</span>[] buffer;
09063         } <span class="keywordflow">else</span> {
09064           <span class="keywordflow">if</span> (dims[4]&lt;65536) {
09065             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[dest.size()];
09066             cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),dest.size(),file);
09067             <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dest.size());
09068             T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09069             cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09070             buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09071             <span class="keyword">delete</span>[] buffer;
09072           } <span class="keywordflow">else</span> {
09073             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[dest.size()];
09074             cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>),dest.size(),file);
09075             <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dest.size());
09076             T *ptrd = dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>();
09077             cimg_mapoff(dest,off) *(ptrd++) = (T)(*(buffer++));
09078             buffer-=dest.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>();
09079             <span class="keyword">delete</span>[] buffer;
09080           }
09081         }       
09082       }
09083         <span class="keywordflow">break</span>;
09084         cimg_load_pandore_case(16,4,dims[2],dims[1],1,3,uchar);
09085         cimg_load_pandore_case(17,4,dims[2],dims[1],1,3,<span class="keywordtype">long</span>);
09086         cimg_load_pandore_case(18,4,dims[2],dims[1],1,3,<span class="keywordtype">float</span>);
09087         cimg_load_pandore_case(19,5,dims[3],dims[2],dims[1],3,uchar);
09088         cimg_load_pandore_case(20,5,dims[3],dims[2],dims[1],3,<span class="keywordtype">long</span>);
09089         cimg_load_pandore_case(21,5,dims[3],dims[2],dims[1],3,<span class="keywordtype">float</span>);
09090         cimg_load_pandore_case(22,2,dims[1],1,1,dims[0],uchar);
09091         cimg_load_pandore_case(23,2,dims[1],1,1,dims[0],<span class="keywordtype">long</span>);
09092         cimg_load_pandore_case(24,2,dims[1],1,1,dims[0],ulong);
09093         cimg_load_pandore_case(25,2,dims[1],1,1,dims[0],<span class="keywordtype">float</span>);
09094         cimg_load_pandore_case(26,3,dims[2],dims[1],1,dims[0],uchar);
09095         cimg_load_pandore_case(27,3,dims[2],dims[1],1,dims[0],<span class="keywordtype">long</span>);
09096         cimg_load_pandore_case(28,3,dims[2],dims[1],1,dims[0],ulong);
09097         cimg_load_pandore_case(29,3,dims[2],dims[1],1,dims[0],<span class="keywordtype">float</span>);
09098         cimg_load_pandore_case(30,4,dims[3],dims[2],dims[1],dims[0],uchar);
09099         cimg_load_pandore_case(31,4,dims[3],dims[2],dims[1],dims[0],<span class="keywordtype">long</span>);
09100         cimg_load_pandore_case(32,4,dims[3],dims[2],dims[1],dims[0],ulong);
09101         cimg_load_pandore_case(33,4,dims[3],dims[2],dims[1],dims[0],<span class="keywordtype">float</span>);     
09102       <span class="keywordflow">case</span> 34: <span class="comment">// Points 1D     </span>
09103         cimg::fread(ptbuf,<span class="keyword">sizeof</span>(<span class="keywordtype">long</span>),1,file);
09104         <span class="keywordflow">if</span> (endian) cimg::endian_swap(ptbuf,1);
09105         dest = CImg&lt;T&gt;(1); dest[0]=(T)ptbuf[0];
09106         <span class="keywordflow">break</span>;
09107       <span class="keywordflow">case</span> 35: <span class="comment">// Points 2D</span>
09108         cimg::fread(ptbuf,<span class="keyword">sizeof</span>(<span class="keywordtype">long</span>),2,file);
09109         <span class="keywordflow">if</span> (endian) cimg::endian_swap(ptbuf,2);
09110         dest = CImg&lt;T&gt;(2); dest[0]=(T)ptbuf[1]; dest[1]=(T)ptbuf[0];
09111         <span class="keywordflow">break</span>;
09112       <span class="keywordflow">case</span> 36: <span class="comment">// Points 3D</span>
09113         cimg::fread(ptbuf,<span class="keyword">sizeof</span>(<span class="keywordtype">long</span>),3,file);
09114         <span class="keywordflow">if</span> (endian) cimg::endian_swap(ptbuf,3);
09115         dest = CImg&lt;T&gt;(3); dest[0]=(T)ptbuf[2]; dest[1]=(T)ptbuf[1]; dest[2]=(T)ptbuf[0];
09116         <span class="keywordflow">break</span>;
09117       <span class="keywordflow">default</span>:
09118         <span class="keywordflow">throw</span> CImgIOException(<span class="stringliteral">"CImg&lt;%s&gt;::load_pandore() : File '%s', can't read images with ID_type=%d"</span>,pixel_type(),filename,<span class="keywordtype">id</span>);
09119       }
09120       <span class="keywordflow">return</span> dest;
09121     }
09122 
09123 
<a name="l09125"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_27">09125</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_analyze(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">float</span> *voxsize = NULL) {
09126       
09127       <span class="comment">// Open header and data files</span>
09128       std::FILE *file_header=NULL, *file=NULL;
09129       <span class="keywordtype">char</span> body[1024];
09130       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename,body);
09131       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"hdr"</span>) || !cimg::strcasecmp(ext,<span class="stringliteral">"img"</span>)) {
09132         std::sprintf(body+cimg::strlen(body),<span class="stringliteral">".hdr"</span>);
09133         file_header = cimg::fopen(body,<span class="stringliteral">"rb"</span>);
09134         std::sprintf(body+cimg::strlen(body)-3,<span class="stringliteral">"img"</span>);
09135         file = cimg::fopen(body,<span class="stringliteral">"rb"</span>);
09136       } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_analyze() : Cannot load filename '%s' as an analyze format"</span>,pixel_type(),filename);
09137 
09138       <span class="comment">// Read header</span>
09139       <span class="keywordtype">bool</span> endian = <span class="keyword">false</span>;
09140       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> header_size;
09141       cimg::fread(&amp;header_size,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),1,file_header);
09142       <span class="keywordflow">if</span> (header_size&gt;=4096) { endian = <span class="keyword">true</span>; cimg::endian_swap(header_size); }
09143       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *header = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[header_size];
09144       cimg::fread(header+<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),header_size-<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),file_header);
09145       cimg::fclose(file_header);
09146       <span class="keywordflow">if</span> (endian) {
09147         cimg::endian_swap((<span class="keywordtype">short</span>*)(header+40),5);
09148         cimg::endian_swap((<span class="keywordtype">short</span>*)(header+70),1);
09149         cimg::endian_swap((<span class="keywordtype">short</span>*)(header+72),1);
09150         cimg::endian_swap((<span class="keywordtype">float</span>*)(header+76),4);
09151         cimg::endian_swap((<span class="keywordtype">float</span>*)(header+112),1);
09152       }
09153       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *dim = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)(header+40), dimx=1, dimy=1, dimz=1, dimv=1;
09154       cimg::warn(!dim[0],<span class="stringliteral">"CImg&lt;%s&gt;::load_analyze() : Specified image has zero dimensions."</span>,pixel_type());
09155       cimg::warn(dim[0]&gt;4,<span class="stringliteral">"CImg&lt;%s&gt;::load_analyze() : Number of image dimension is %d, reading only the 4 first dimensions"</span>,
09156                  pixel_type(),dim[0]);
09157       <span class="keywordflow">if</span> (dim[0]&gt;=1) dimx = dim[1];
09158       <span class="keywordflow">if</span> (dim[0]&gt;=2) dimy = dim[2];
09159       <span class="keywordflow">if</span> (dim[0]&gt;=3) dimz = dim[3];
09160       <span class="keywordflow">if</span> (dim[0]&gt;=4) dimv = dim[4];
09161       
09162       <span class="keywordtype">float</span> scalefactor = *(<span class="keywordtype">float</span>*)(header+112); <span class="keywordflow">if</span> (scalefactor==0) scalefactor=1;
09163       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> datatype = *(<span class="keywordtype">short</span>*)(header+70);
09164       <span class="keywordflow">if</span> (voxsize) { <span class="keyword">const</span> <span class="keywordtype">float</span> *vsize = (<span class="keywordtype">float</span>*)(header+76); voxsize[0] = vsize[1]; voxsize[1] = vsize[2]; voxsize[2] = vsize[3]; }
09165       <span class="keyword">delete</span>[] header;
09166 
09167       <span class="comment">// Read pixel data</span>
09168       <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(dimx,dimy,dimz,dimv);
09169       <span class="keywordflow">switch</span> (datatype) {
09170       <span class="keywordflow">case</span> 2: {
09171         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[dimx*dimy*dimz*dimv];
09172         cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),dimx*dimy*dimz*dimv,file);
09173         cimg_mapoff(dest,off) dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>[off] = (T)(buffer[off]*scalefactor);
09174         <span class="keyword">delete</span>[] buffer;
09175       } <span class="keywordflow">break</span>;
09176       <span class="keywordflow">case</span> 4: {
09177         <span class="keywordtype">short</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">short</span>[dimx*dimy*dimz*dimv];
09178         cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>),dimx*dimy*dimz*dimv,file);
09179         <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dimx*dimy*dimz*dimv);
09180         cimg_mapoff(dest,off) dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>[off] = (T)(buffer[off]*scalefactor);
09181         <span class="keyword">delete</span>[] buffer;
09182       } <span class="keywordflow">break</span>;
09183       <span class="keywordflow">case</span> 8: {
09184         <span class="keywordtype">int</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">int</span>[dimx*dimy*dimz*dimv];
09185         cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),dimx*dimy*dimz*dimv,file);
09186         <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dimx*dimy*dimz*dimv);
09187         cimg_mapoff(dest,off) dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>[off] = (T)(buffer[off]*scalefactor);
09188         <span class="keyword">delete</span>[] buffer;
09189       } <span class="keywordflow">break</span>;
09190       <span class="keywordflow">case</span> 16: {
09191         <span class="keywordtype">float</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">float</span>[dimx*dimy*dimz*dimv];
09192         cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),dimx*dimy*dimz*dimv,file);
09193         <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dimx*dimy*dimz*dimv);
09194         cimg_mapoff(dest,off) dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>[off] = (T)(buffer[off]*scalefactor);
09195         <span class="keyword">delete</span>[] buffer;
09196       } <span class="keywordflow">break</span>;
09197       <span class="keywordflow">case</span> 64: {
09198         <span class="keywordtype">double</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">double</span>[dimx*dimy*dimz*dimv];
09199         cimg::fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),dimx*dimy*dimz*dimv,file);
09200         <span class="keywordflow">if</span> (endian) cimg::endian_swap(buffer,dimx*dimy*dimz*dimv);
09201         cimg_mapoff(dest,off) dest.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>[off] = (T)(buffer[off]*scalefactor);
09202         <span class="keyword">delete</span>[] buffer;
09203       } <span class="keywordflow">break</span>;
09204       <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_analyze() : Cannot read images width 'datatype = %d'"</span>,pixel_type(),datatype);
09205       }
09206       cimg::fclose(file);
09207       <span class="keywordflow">return</span> dest;
09208     }
09209 
<a name="l09211"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_28">09211</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_raw(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'v'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'p'</span>) { 
09212       <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(filename).get_append(axe,align); 
09213     }
09214 
<a name="l09218"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_29">09218</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> load_convert(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
09219       <span class="keyword">static</span> <span class="keywordtype">bool</span> first_time = <span class="keyword">true</span>;
09220       <span class="keywordtype">char</span> command[512], filetmp[512];     
09221       <span class="keywordflow">if</span> (first_time) { std::srand((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)::time(NULL)); first_time = <span class="keyword">false</span>; }
09222       std::FILE *file = NULL;
09223       <span class="keywordflow">do</span> { 
09224         <span class="keywordflow">if</span> (file) std::fclose(file);
09225         std::sprintf(filetmp,<span class="stringliteral">"%s/CImg%.4d.ppm"</span>,cimg::temporary_path(),std::rand()%10000);
09226         file = std::fopen(filetmp,<span class="stringliteral">"rb"</span>);
09227       } <span class="keywordflow">while</span> (file);
09228       std::sprintf(command,<span class="stringliteral">"\"%s\" \"%s\" %s"</span>,cimg::convert_path(),filename,filetmp);
09229       cimg::system(command);
09230       file = std::fopen(filetmp,<span class="stringliteral">"rb"</span>);
09231       <span class="keywordflow">if</span> (!file) {
09232         std::fclose(cimg::fopen(filename,<span class="stringliteral">"r"</span>));
09233         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::load_convert() : Failed to open image '%s' with 'convert'.\n"</span>
09234                               <span class="stringliteral">"Check that you have installed the ImageMagick package in a standart directory."</span>,
09235                               pixel_type(),filename);
09236       } <span class="keywordflow">else</span> cimg::fclose(file);
09237       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> dest(filetmp);
09238       std::remove(filetmp);
09239       <span class="keywordflow">return</span> dest;
09240     }
09241 
09243 
<a name="l09248"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_0">09248</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">int</span> number=-1)<span class="keyword"> const </span>{
09249       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save"</span>);
09250       <span class="keywordflow">if</span> (!filename) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save() : Can't save with (null) filename"</span>,pixel_type());
09251       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename);
09252       <span class="keywordtype">char</span> nfilename[1024];
09253       <span class="keywordflow">if</span> (number&gt;=0) filename = cimg::filename_number(filename,number,6,nfilename);
09254       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"asc"</span>)) <span class="keywordflow">return</span> save_ascii(filename);
09255       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"dlm"</span>)) <span class="keywordflow">return</span> save_dlm(filename);
09256       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"inr"</span>)) <span class="keywordflow">return</span> save_inr(filename);
09257       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"hdr"</span>)) <span class="keywordflow">return</span> save_analyze(filename);
09258       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"pan"</span>)) <span class="keywordflow">return</span> save_pandore(filename);
09259       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"bmp"</span>)) <span class="keywordflow">return</span> save_bmp(filename);
09260       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"png"</span>)) <span class="keywordflow">return</span> save_png(filename);
09261       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"jpg"</span>) ||
09262           !cimg::strcasecmp(ext,<span class="stringliteral">"jpeg"</span>)) <span class="keywordflow">return</span> save_jpeg(filename);
09263       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"rgba"</span>)) <span class="keywordflow">return</span> save_rgba(filename);
09264       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"rgb"</span>)) <span class="keywordflow">return</span> save_rgb(filename);
09265       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"raw"</span>) || ext[0]==<span class="charliteral">'\0'</span>) <span class="keywordflow">return</span> save_raw(filename);
09266       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"pgm"</span>) || 
09267           !cimg::strcasecmp(ext,<span class="stringliteral">"ppm"</span>) || 
09268           !cimg::strcasecmp(ext,<span class="stringliteral">"pnm"</span>)) <span class="keywordflow">return</span> save_pnm(filename);
09269       <span class="keywordflow">return</span> save_convert(filename);
09270     }
09271   
<a name="l09273"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_1">09273</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_ascii(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09274       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_ascii"</span>);
09275       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"w"</span>);
09276       std::fprintf(file,<span class="stringliteral">"%u %u %u %u\n"</span>,width,height,depth,dim);
09277       <span class="keyword">const</span> T* ptrs = data;
09278       cimg_mapYZV(*<span class="keyword">this</span>,y,z,v) {
09279         cimg_mapX(*<span class="keyword">this</span>,x) std::fprintf(file,<span class="stringliteral">"%g "</span>,(<span class="keywordtype">double</span>)*(ptrs++));
09280         std::fputc(<span class="charliteral">'\n'</span>,file);
09281       }
09282       cimg::fclose(file);
09283       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09284     }
09285 
<a name="l09287"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_2">09287</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_dlm(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09288       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_dlm"</span>);
09289       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"w"</span>);
09290       <span class="keyword">const</span> T* ptrs = data;
09291       cimg_mapYZV(*<span class="keyword">this</span>,y,z,v) {
09292         cimg_mapX(*<span class="keyword">this</span>,x) std::fprintf(file,<span class="stringliteral">"%g%s"</span>,(<span class="keywordtype">double</span>)*(ptrs++),(x==(<span class="keywordtype">int</span>)width-1)?<span class="stringliteral">""</span>:<span class="stringliteral">","</span>);
09293         std::fputc(<span class="charliteral">'\n'</span>,file);
09294       }
09295       cimg::fclose(file);
09296       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09297     }
09298 
<a name="l09300"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_3">09300</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_pnm(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09301       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_pnm"</span>);
09302       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename);
09303       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgStats.html">CImgStats</a> st(*<span class="keyword">this</span>,<span class="keyword">false</span>);
09304 
09305       <span class="keywordflow">if</span> (dim&gt;1 &amp;&amp; !cimg::strcasecmp(ext,<span class="stringliteral">"pgm"</span>)) {
09306                         get_norm_pointwise().<a class="code" href="structcimg__library_1_1CImg.html#z9_12">normalize</a>(0.0f,(<span class="keywordtype">float</span>)st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>).<a class="code" href="structcimg__library_1_1CImg.html#z21_3">save_pnm</a>(filename); 
09307                         <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
09308       }
09309       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09310       <span class="keyword">const</span> T 
09311         *ptrR = ptr(0,0,0,0),
09312         *ptrG = (dim&gt;=2)?ptr(0,0,0,1):ptrR,
09313         *ptrB = (dim&gt;=3)?ptr(0,0,0,2):ptrR;
09314       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buf_size = width*height*(dim==1?1:3);
09315 
09316       std::fprintf(file,<span class="stringliteral">"P%c\n# CREATOR: CImg : Original size=%ux%ux%ux%u\n%u %u\n%u\n"</span>,
09317                    (dim==1?<span class="charliteral">'5'</span>:<span class="charliteral">'6'</span>),width,height,depth,dim,width,height,(st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>)&lt;256?255:65535);
09318       
09319       <span class="keywordflow">switch</span>(dim) {
09320       <span class="keywordflow">case</span> 1: {
09321         <span class="keywordflow">if</span> ((st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>)&lt;256) { <span class="comment">// Binary PGM 8 bits</span>
09322           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrd = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[buf_size], *xptrd = ptrd;
09323           cimg_mapXY(*<span class="keyword">this</span>,x,y) *(xptrd++) = (<span class="keywordtype">unsigned</span> char)*(ptrR++);
09324           cimg::fwrite(ptrd,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),buf_size,file);
09325           <span class="keyword">delete</span>[] ptrd;
09326         } <span class="keywordflow">else</span> {             <span class="comment">// Binary PGM 16 bits</span>
09327           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrd = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[buf_size], *xptrd = ptrd;
09328           cimg_mapXY(*<span class="keyword">this</span>,x,y) *(xptrd++) = (<span class="keywordtype">unsigned</span> short)*(ptrR++);
09329           cimg::fwrite(ptrd,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),buf_size,file);
09330           <span class="keyword">delete</span>[] ptrd;
09331         }
09332       } <span class="keywordflow">break</span>;
09333       <span class="keywordflow">default</span>: {
09334         <span class="keywordflow">if</span> ((st.<a class="code" href="structcimg__library_1_1CImgStats.html#o1">max</a>)&lt;256) { <span class="comment">// Binary PPM 8 bits</span>
09335           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrd = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[buf_size], *xptrd = ptrd;
09336           cimg_mapXY(*<span class="keyword">this</span>,x,y) {
09337             *(xptrd++) = (<span class="keywordtype">unsigned</span> char)*(ptrR++);
09338             *(xptrd++) = (<span class="keywordtype">unsigned</span> char)*(ptrG++);
09339             *(xptrd++) = (<span class="keywordtype">unsigned</span> char)*(ptrB++);
09340           }
09341           cimg::fwrite(ptrd,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),buf_size,file);
09342           <span class="keyword">delete</span>[] ptrd;
09343         } <span class="keywordflow">else</span> {             <span class="comment">// Binary PPM 16 bits</span>
09344           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrd = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>[buf_size], *xptrd = ptrd;
09345           cimg_mapXY(*<span class="keyword">this</span>,x,y) {
09346             *(xptrd++) = (<span class="keywordtype">unsigned</span> short)*(ptrR++);
09347             *(xptrd++) = (<span class="keywordtype">unsigned</span> short)*(ptrG++);
09348             *(xptrd++) = (<span class="keywordtype">unsigned</span> short)*(ptrB++);
09349           }
09350           cimg::fwrite(ptrd,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>),buf_size,file);
09351           <span class="keyword">delete</span>[] ptrd;
09352         }
09353       } <span class="keywordflow">break</span>;
09354       }
09355       cimg::fclose(file);
09356       
09357       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09358     }
09359     
<a name="l09361"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_4">09361</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_analyze(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">float</span> *<span class="keyword">const</span> voxsize=NULL)<span class="keyword"> const </span>{
09362       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_analyze"</span>);
09363       std::FILE *file;
09364       <span class="keywordtype">char</span> header[348],hname[1024],iname[1024];
09365       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename);
09366       <span class="keywordtype">short</span> datatype=-1;
09367       std::memset(header,0,348);
09368       <span class="keywordflow">if</span> (!ext[0]) { std::sprintf(hname,<span class="stringliteral">"%s.hdr"</span>,filename); std::sprintf(iname,<span class="stringliteral">"%s.img"</span>,filename); }
09369       <span class="keywordflow">if</span> (!cimg::strncasecmp(ext,<span class="stringliteral">"hdr"</span>,3)) { 
09370         std::strcpy(hname,filename); std::strcpy(iname,filename); std::sprintf(iname+cimg::strlen(iname)-3,<span class="stringliteral">"img"</span>); 
09371       }
09372       <span class="keywordflow">if</span> (!cimg::strncasecmp(ext,<span class="stringliteral">"img"</span>,3)) {
09373         std::strcpy(hname,filename); std::strcpy(iname,filename); std::sprintf(hname+cimg::strlen(iname)-3,<span class="stringliteral">"hdr"</span>); 
09374       }
09375       ((<span class="keywordtype">int</span>*)(header))[0] = 348;
09376       std::sprintf(header+4,<span class="stringliteral">"CImg"</span>);
09377       std::sprintf(header+14,<span class="stringliteral">" "</span>);
09378       ((<span class="keywordtype">short</span>*)(header+36))[0] = 4096;
09379       ((<span class="keywordtype">char</span>*)(header+38))[0] = 114;
09380       ((<span class="keywordtype">short</span>*)(header+40))[0] = 4;
09381       ((<span class="keywordtype">short</span>*)(header+40))[1] = width;
09382       ((<span class="keywordtype">short</span>*)(header+40))[2] = height;
09383       ((<span class="keywordtype">short</span>*)(header+40))[3] = depth;
09384       ((<span class="keywordtype">short</span>*)(header+40))[4] = dim;
09385       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"unsigned char"</span>))  datatype = 2;
09386       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"short"</span>))          datatype = 4;
09387       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"int"</span>))            datatype = 8;
09388       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"float"</span>))          datatype = 16;
09389       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"double"</span>))         datatype = 64;
09390       ((<span class="keywordtype">short</span>*)(header+70))[0] = datatype;
09391       ((<span class="keywordtype">short</span>*)(header+72))[0] = <span class="keyword">sizeof</span>(T);
09392       ((<span class="keywordtype">float</span>*)(header+112))[0] = 1;
09393       ((<span class="keywordtype">float</span>*)(header+76))[0] = 0;
09394       <span class="keywordflow">if</span> (voxsize) {
09395         ((<span class="keywordtype">float</span>*)(header+76))[1] = voxsize[0];
09396         ((<span class="keywordtype">float</span>*)(header+76))[2] = voxsize[1];
09397         ((<span class="keywordtype">float</span>*)(header+76))[3] = voxsize[2];
09398       } <span class="keywordflow">else</span> ((<span class="keywordtype">float</span>*)(header+76))[1] = ((<span class="keywordtype">float</span>*)(header+76))[2] = ((<span class="keywordtype">float</span>*)(header+76))[3] = 1;
09399       file = cimg::fopen(hname,<span class="stringliteral">"wb"</span>);
09400       cimg::fwrite(header,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),348,file);
09401       cimg::fclose(file);
09402       file = cimg::fopen(iname,<span class="stringliteral">"wb"</span>);
09403       cimg::fwrite(data,<span class="keyword">sizeof</span>(T),size(),file);
09404       cimg::fclose(file);
09405       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09406     }
09407 
<a name="l09409"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_5">09409</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_raw(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09410       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_raw"</span>);      
09411       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> shared(1);
09412       shared[0].width = width;
09413       shared[0].height = height;
09414       shared[0].depth = depth;
09415       shared[0].dim = dim;
09416       shared[0].<a class="code" href="structcimg__library_1_1CImgl.html#o1">data</a> = data;
09417       shared.<a class="code" href="structcimg__library_1_1CImgl.html#z33_2">save_raw</a>(filename);
09418       shared[0].width = shared[0].height = shared[0].depth = shared[0].dim = 0;
09419       shared[0].<a class="code" href="structcimg__library_1_1CImgl.html#o1">data</a> = NULL;
09420       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09421     }
09422  
09424 
<a name="l09430"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_6">09430</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_convert(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09431       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_convert"</span>);
09432       <span class="keyword">static</span> <span class="keywordtype">bool</span> first_time = <span class="keyword">true</span>;
09433       <span class="keywordtype">char</span> command[512],filetmp[512];
09434       <span class="keywordflow">if</span> (first_time) { std::srand((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)::time(NULL)); first_time = <span class="keyword">false</span>; }
09435       std::FILE *file = NULL;
09436       <span class="keywordflow">do</span> {
09437         <span class="keywordflow">if</span> (file) std::fclose(file);
09438         std::sprintf(filetmp,<span class="stringliteral">"%s/CImg%.4d.rgba"</span>,cimg::temporary_path(),std::rand()%10000);
09439         file = std::fopen(filetmp,<span class="stringliteral">"rb"</span>);
09440       } <span class="keywordflow">while</span> (file);
09441       save_rgba(filetmp);
09442       std::sprintf(command,<span class="stringliteral">"\"%s\" -depth 8 -size %ux%u -quality 100%% \"%s\" %s"</span>,
09443                    cimg::convert_path(),width,height,filetmp,filename);
09444       cimg::system(command);
09445       file = std::fopen(filename,<span class="stringliteral">"rb"</span>);
09446       <span class="keywordflow">if</span> (!file) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save_convert() : Failed to save image '%s' with 'convert'.\n"</span>
09447                                        <span class="stringliteral">"Check that you have installed the ImageMagick package in a standart directory."</span>,
09448                                        pixel_type(),filename);
09449       <span class="keywordflow">if</span> (file) cimg::fclose(file);
09450       std::remove(filetmp);
09451       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09452     }
09453     
<a name="l09455"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_7">09455</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_inr(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">float</span> *<span class="keyword">const</span> voxsize = NULL)<span class="keyword"> const </span>{
09456       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_inr"</span>);
09457       <span class="keywordtype">int</span> inrpixsize=-1;
09458       <span class="keyword">const</span> <span class="keywordtype">char</span> *inrtype = <span class="stringliteral">"unsigned fixed\nPIXSIZE=8 bits\nSCALE=2**0"</span>;
09459       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"unsigned char"</span>))  { inrtype = <span class="stringliteral">"unsigned fixed\nPIXSIZE=8 bits\nSCALE=2**0"</span>; inrpixsize = 1; }
09460       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"char"</span>))           { inrtype = <span class="stringliteral">"fixed\nPIXSIZE=8 bits\nSCALE=2**0"</span>; inrpixsize = 1; }
09461       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"unsigned short"</span>)) { inrtype = <span class="stringliteral">"unsigned fixed\nPIXSIZE=16 bits\nSCALE=2**0"</span>;inrpixsize = 2; }
09462       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"short"</span>))          { inrtype = <span class="stringliteral">"fixed\nPIXSIZE=16 bits\nSCALE=2**0"</span>; inrpixsize = 2; }
09463       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"unsigned int"</span>))   { inrtype = <span class="stringliteral">"unsigned fixed\nPIXSIZE=32 bits\nSCALE=2**0"</span>;inrpixsize = 4; }
09464       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"int"</span>))            { inrtype = <span class="stringliteral">"fixed\nPIXSIZE=32 bits\nSCALE=2**0"</span>; inrpixsize = 4; }
09465       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"float"</span>))          { inrtype = <span class="stringliteral">"float\nPIXSIZE=32 bits"</span>; inrpixsize = 4; }
09466       <span class="keywordflow">if</span> (!cimg::strcasecmp(pixel_type(),<span class="stringliteral">"double"</span>))         { inrtype = <span class="stringliteral">"float\nPIXSIZE=64 bits"</span>; inrpixsize = 8; }
09467       <span class="keywordflow">if</span> (inrpixsize&lt;=0) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save_inr() : Don't know how to save images of '%s'"</span>,pixel_type(),pixel_type());
09468       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09469       <span class="keywordtype">char</span> header[257];      
09470       <span class="keywordtype">int</span> err = std::sprintf(header,<span class="stringliteral">"#INRIMAGE-4#{\nXDIM=%u\nYDIM=%u\nZDIM=%u\nVDIM=%u\n"</span>,width,height,depth,dim);
09471       <span class="keywordflow">if</span> (voxsize) err += std::sprintf(header+err,<span class="stringliteral">"VX=%g\nVY=%g\nVZ=%g\n"</span>,voxsize[0],voxsize[1],voxsize[2]);
09472       err += std::sprintf(header+err,<span class="stringliteral">"TYPE=%s\nCPU=%s\n"</span>,inrtype,cimg::endian()?<span class="stringliteral">"sun"</span>:<span class="stringliteral">"decm"</span>);
09473       std::memset(header+err,<span class="charliteral">'\n'</span>,252-err);
09474       std::memcpy(header+252,<span class="stringliteral">"##}\n"</span>,4);
09475       cimg::fwrite(header,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),256,file);
09476       cimg_mapXYZ(*<span class="keyword">this</span>,x,y,z) cimg_mapV(*<span class="keyword">this</span>,k) cimg::fwrite(&amp;((*<span class="keyword">this</span>)(x,y,z,k)),inrpixsize,1,file);
09477       cimg::fclose(file);
09478       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09479     }
09480 
09481 <span class="preprocessor">#define cimg_save_pandore_case(sy,sz,sv,stype,id)                           \</span>
09482 <span class="preprocessor">   if (!saved &amp;&amp; (sy?(sy==height):true) &amp;&amp; (sz?(sz==depth):true) &amp;&amp; (sv?(sv==dim):true) &amp;&amp; !strcmp(stype,pixel_type())) { \</span>
09483 <span class="preprocessor">      unsigned int *iheader = (unsigned int*)(header+12);                   \</span>
09484 <span class="preprocessor">      nbdims = _save_pandore_header_length((*iheader=id),dims);             \</span>
09485 <span class="preprocessor">      cimg::fwrite(header,sizeof(unsigned char),36,file);                   \</span>
09486 <span class="preprocessor">      cimg::fwrite(dims,sizeof(unsigned int),nbdims,file);                  \</span>
09487 <span class="preprocessor">      if (id==2 || id==5 || id==8 || id==16 || id==19 || id==22 || id==26 || id==30) { \</span>
09488 <span class="preprocessor">        unsigned char *buffer = new unsigned char[size()];                  \</span>
09489 <span class="preprocessor">        T *ptrs = ptr();                                                    \</span>
09490 <span class="preprocessor">        cimg_mapoff(*this,off) *(buffer++)=(unsigned char)(*(ptrs++));      \</span>
09491 <span class="preprocessor">        buffer-=size();                                                     \</span>
09492 <span class="preprocessor">        cimg::fwrite(buffer,sizeof(unsigned char),size(),file);             \</span>
09493 <span class="preprocessor">        delete[] buffer;                                                    \</span>
09494 <span class="preprocessor">      }                                                                     \</span>
09495 <span class="preprocessor">      if (id==3 || id==6 || id==9 || id==17 || id==20 || id==23 || id==27 || id==31) { \</span>
09496 <span class="preprocessor">        unsigned long *buffer = new unsigned long[size()];                  \</span>
09497 <span class="preprocessor">        T *ptrs = ptr();                                                    \</span>
09498 <span class="preprocessor">        cimg_mapoff(*this,off) *(buffer++)=(long)(*(ptrs++));               \</span>
09499 <span class="preprocessor">        buffer-=size();                                                     \</span>
09500 <span class="preprocessor">        cimg::fwrite(buffer,sizeof(long),size(),file);                      \</span>
09501 <span class="preprocessor">        delete[] buffer;                                                    \</span>
09502 <span class="preprocessor">      }                                                                     \</span>
09503 <span class="preprocessor">      if (id==4 || id==7 || id==10 || id==18 || id==21 || id==25 || id==29 || id==33) { \</span>
09504 <span class="preprocessor">        float *buffer = new float[size()];                                  \</span>
09505 <span class="preprocessor">        T *ptrs = ptr();                                                    \</span>
09506 <span class="preprocessor">        cimg_mapoff(*this,off) *(buffer++)=(float)(*(ptrs++));              \</span>
09507 <span class="preprocessor">        buffer-=size();                                                     \</span>
09508 <span class="preprocessor">        cimg::fwrite(buffer,sizeof(float),size(),file);                     \</span>
09509 <span class="preprocessor">        delete[] buffer;                                                    \</span>
09510 <span class="preprocessor">      }                                                                     \</span>
09511 <span class="preprocessor">      saved = true;                                                         \</span>
09512 <span class="preprocessor">    }</span>
09513 <span class="preprocessor"></span>
09514     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> _save_pandore_header_length(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *dims)<span class="keyword"> const </span>{
09515       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbdims=0;
09516       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==2 || <span class="keywordtype">id</span>==3 || <span class="keywordtype">id</span>==4)    { dims[0]=1; dims[1]=width; nbdims=2; }
09517       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==5 || <span class="keywordtype">id</span>==6 || <span class="keywordtype">id</span>==7)    { dims[0]=1; dims[1]=height; dims[2]=width; nbdims=3; }
09518       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==8 || <span class="keywordtype">id</span>==9 || <span class="keywordtype">id</span>==10)   { dims[0]=dim; dims[1]=depth; dims[2]=height; dims[3]=width; nbdims=4; }
09519       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==16 || <span class="keywordtype">id</span>==17 || <span class="keywordtype">id</span>==18) { dims[0]=3; dims[1]=height; dims[2]=width; dims[3]=1; nbdims=4; }
09520       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==19 || <span class="keywordtype">id</span>==20 || <span class="keywordtype">id</span>==21) { dims[0]=3; dims[1]=depth; dims[2]=height; dims[3]=width; dims[4]=0; nbdims=5; }
09521       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==22 || <span class="keywordtype">id</span>==23 || <span class="keywordtype">id</span>==25) { dims[0]=dim; dims[1]=width; nbdims=2; }
09522       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==26 || <span class="keywordtype">id</span>==27 || <span class="keywordtype">id</span>==29) { dims[0]=dim; dims[1]=height; dims[2]=width; nbdims=3; }
09523       <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==30 || <span class="keywordtype">id</span>==31 || <span class="keywordtype">id</span>==33) { dims[0]=dim; dims[1]=depth; dims[2]=height; dims[3]=width; nbdims=4; }
09524       <span class="keywordflow">return</span> nbdims;
09525     }    
09526 
<a name="l09528"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_9">09528</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_pandore(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)<span class="keyword"> const </span>{
09529       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_pandore"</span>);
09530       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09531       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> header[36] = { <span class="charliteral">'P'</span>,<span class="charliteral">'A'</span>,<span class="charliteral">'N'</span>,<span class="charliteral">'D'</span>,<span class="charliteral">'O'</span>,<span class="charliteral">'R'</span>,<span class="charliteral">'E'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'4'</span>,0,0,0,
09532                                    0,0,0,0,<span class="charliteral">'C'</span>,<span class="charliteral">'I'</span>,<span class="charliteral">'m'</span>,<span class="charliteral">'g'</span>,0,0,0,0,0,
09533                                    <span class="charliteral">'2'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'/'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'1'</span>,<span class="charliteral">'/'</span>,<span class="charliteral">'0'</span>,<span class="charliteral">'1'</span>,
09534                                    0 };
09535       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nbdims,dims[5];
09536       <span class="keywordtype">bool</span> saved=<span class="keyword">false</span>;
09537       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"unsigned char"</span>,2);
09538       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"char"</span>,3);
09539       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"short"</span>,3);
09540       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"unsigned short"</span>,3);
09541       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"unsigned int"</span>,3);
09542       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"int"</span>,3);
09543       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"unsigned long"</span>,4);
09544       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"long"</span>,3);
09545       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"float"</span>,4);
09546       cimg_save_pandore_case(1,1,1,<span class="stringliteral">"double"</span>,4);
09547  
09548       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"unsigned char"</span>,5);
09549       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"char"</span>,6);
09550       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"short"</span>,6);
09551       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"unsigned short"</span>,6);
09552       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"unsigned int"</span>,6);
09553       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"int"</span>,6);
09554       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"unsigned long"</span>,7);
09555       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"long"</span>,6);
09556       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"float"</span>,7);
09557       cimg_save_pandore_case(0,1,1,<span class="stringliteral">"double"</span>,7);
09558 
09559       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"unsigned char"</span>,8);
09560       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"char"</span>,9);
09561       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"short"</span>,9);
09562       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"unsigned short"</span>,9);
09563       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"unsigned int"</span>,9);
09564       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"int"</span>,9);
09565       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"unsigned long"</span>,10);
09566       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"long"</span>,9);
09567       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"float"</span>,10);
09568       cimg_save_pandore_case(0,0,1,<span class="stringliteral">"double"</span>,10);
09569       
09570       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"unsigned char"</span>,16);
09571       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"char"</span>,17);
09572       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"short"</span>,17);
09573       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"unsigned short"</span>,17);
09574       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"unsigned int"</span>,17);
09575       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"int"</span>,17);
09576       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"unsigned long"</span>,18);
09577       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"long"</span>,17);
09578       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"float"</span>,18);
09579       cimg_save_pandore_case(0,1,3,<span class="stringliteral">"double"</span>,18);
09580 
09581       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"unsigned char"</span>,19);
09582       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"char"</span>,20);
09583       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"short"</span>,20);
09584       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"unsigned short"</span>,20);
09585       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"unsigned int"</span>,20);
09586       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"int"</span>,20);
09587       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"unsigned long"</span>,21);
09588       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"long"</span>,20);
09589       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"float"</span>,21);
09590       cimg_save_pandore_case(0,0,3,<span class="stringliteral">"double"</span>,21);
09591      
09592       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"unsigned char"</span>,22);
09593       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"char"</span>,23);
09594       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"short"</span>,23);
09595       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"unsigned short"</span>,23);
09596       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"unsigned int"</span>,23);
09597       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"int"</span>,23);
09598       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"unsigned long"</span>,25);
09599       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"long"</span>,23);
09600       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"float"</span>,25);
09601       cimg_save_pandore_case(1,1,0,<span class="stringliteral">"double"</span>,25);
09602  
09603       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"unsigned char"</span>,26);
09604       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"char"</span>,27);
09605       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"short"</span>,27);
09606       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"unsigned short"</span>,27);
09607       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"unsigned int"</span>,27);
09608       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"int"</span>,27);
09609       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"unsigned long"</span>,29);
09610       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"long"</span>,27);
09611       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"float"</span>,29);
09612       cimg_save_pandore_case(0,1,0,<span class="stringliteral">"double"</span>,29);
09613 
09614       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"unsigned char"</span>,30);
09615       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"char"</span>,31);
09616       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"short"</span>,31);
09617       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"unsigned short"</span>,31);
09618       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"unsigned int"</span>,31);
09619       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"int"</span>,31);
09620       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"unsigned long"</span>,33);
09621       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"long"</span>,31);
09622       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"float"</span>,33);
09623       cimg_save_pandore_case(0,0,0,<span class="stringliteral">"double"</span>,33);
09624 
09625       cimg::fclose(file);
09626       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09627     }
09628 
<a name="l09630"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_10">09630</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_bmp(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)<span class="keyword"> const </span>{
09631       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_bmp"</span>);
09632       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09633       
09634       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> header[54]={0}, align_buf[4]={0};
09635       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
09636         align     = (4-(3*width)%4)%4,
09637         buf_size  = (3*width+align)*dimy(),
09638         file_size = 54+buf_size;
09639       header[0] = <span class="charliteral">'B'</span>; header[1] = <span class="charliteral">'M'</span>;
09640       header[0x02]=file_size&amp;0xFF; header[0x03]=(file_size&gt;&gt;8)&amp;0xFF;
09641       header[0x04]=(file_size&gt;&gt;16)&amp;0xFF; header[0x05]=(file_size&gt;&gt;24)&amp;0xFF;
09642       header[0x0A]=0x36;
09643       header[0x0E]=0x28;
09644       header[0x12]=width&amp;0xFF; header[0x13]=(width&gt;&gt;8)&amp;0xFF;
09645       header[0x14]=(width&gt;&gt;16)&amp;0xFF; header[0x15]=(width&gt;&gt;24)&amp;0xFF;
09646       header[0x16]=height&amp;0xFF; header[0x17]=(height&gt;&gt;8)&amp;0xFF;
09647       header[0x18]=(height&gt;&gt;16)&amp;0xFF; header[0x19]=(height&gt;&gt;24)&amp;0xFF;
09648       header[0x1A]=1;  header[0x1B]=0;
09649       header[0x1C]=24; header[0x1D]=0;
09650       header[0x22]=buf_size&amp;0xFF; header[0x23]=(buf_size&gt;&gt;8)&amp;0xFF;
09651       header[0x24]=(buf_size&gt;&gt;16)&amp;0xFF; header[0x25]=(buf_size&gt;&gt;24)&amp;0xFF;
09652       header[0x27]=0x1; header[0x2B]=0x1;
09653       cimg::fwrite(header,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),54,file);
09654 
09655       <span class="keyword">const</span> T
09656         *pR = ptr(0,height-1,0,0),
09657         *pG = (dim&gt;=2)?ptr(0,height-1,0,1):pR, 
09658         *pB = (dim&gt;=3)?ptr(0,height-1,0,2):pR;
09659 
09660       cimg_mapY(*<span class="keyword">this</span>,y) {
09661         cimg_mapX(*<span class="keyword">this</span>,x) {
09662           std::fputc((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(*(pB++)),file);
09663           std::fputc((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(*(pG++)),file);
09664           std::fputc((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(*(pR++)),file);
09665         }
09666         std::fwrite(align_buf,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),align,file);
09667         pR-=2*width; pG-=2*width; pB-=2*width;  
09668       }      
09669       cimg::fclose(file);
09670       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09671     }
09672     
09674     <span class="comment">// Most of this function has been written by Eric Fausett</span>
<a name="l09689"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_11">09689</a> <span class="comment"></span>    <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_png(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keyword">const</span> <span class="keywordtype">bool</span> png16=<span class="keyword">false</span>)<span class="keyword"> const </span>{
09690       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_png"</span>);
09691 <span class="preprocessor">#ifndef cimg_use_png</span>
09692 <span class="preprocessor"></span>      <span class="keywordflow">return</span> save_convert(filename);
09693 <span class="preprocessor">#else</span>
09694 <span class="preprocessor"></span>      std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09695       
09696       <span class="comment">// Setup PNG structures for write</span>
09697       png_voidp user_error_ptr=0;
09698       png_error_ptr user_error_fn=0, user_warning_fn=0;
09699       png_structp png_ptr = png_create_write_struct(PNG_LIBPNG_VER_STRING,
09700                                                     user_error_ptr, user_error_fn, user_warning_fn);
09701       <span class="keywordflow">if</span>(!png_ptr){
09702         cimg::fclose(file);
09703         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save_png() : trouble initializing 'png_ptr' data structure"</span>,pixel_type());
09704       }
09705       png_infop info_ptr = png_create_info_struct(png_ptr);
09706       <span class="keywordflow">if</span>(!info_ptr){
09707         png_destroy_write_struct(&amp;png_ptr,(png_infopp)NULL);
09708         cimg::fclose(file);
09709         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save_png() : trouble initializing 'info_ptr' data structure"</span>,pixel_type());
09710       }
09711       <span class="keywordflow">if</span> (setjmp(png_jmpbuf(png_ptr))){
09712         png_destroy_write_struct(&amp;png_ptr, &amp;info_ptr);
09713         cimg::fclose(file);
09714         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save_png() : unspecified error reading PNG file '%s'"</span>,pixel_type(),filename);
09715       }
09716       
09717       png_init_io(png_ptr, file);      
09718       png_uint_32 width = dimx();
09719       png_uint_32 height = dimy();
09720       <span class="keyword">const</span> <span class="keywordtype">int</span> bit_depth = png16?16:8;
09721       <span class="keywordtype">int</span> color_type;
09722       <span class="keywordflow">switch</span> (dimv()) {
09723       <span class="keywordflow">case</span> 1: color_type = PNG_COLOR_TYPE_GRAY; <span class="keywordflow">break</span>;
09724       <span class="keywordflow">case</span> 2: color_type = PNG_COLOR_TYPE_GRAY_ALPHA; <span class="keywordflow">break</span>;
09725       <span class="keywordflow">case</span> 3: color_type = PNG_COLOR_TYPE_RGB; <span class="keywordflow">break</span>;
09726       <span class="keywordflow">default</span>: color_type = PNG_COLOR_TYPE_RGB_ALPHA;
09727       }
09728       <span class="keyword">const</span> <span class="keywordtype">int</span> interlace_type = PNG_INTERLACE_NONE;
09729       <span class="keyword">const</span> <span class="keywordtype">int</span> compression_type = PNG_COMPRESSION_TYPE_DEFAULT;
09730       <span class="keyword">const</span> <span class="keywordtype">int</span> filter_method = PNG_FILTER_TYPE_DEFAULT;
09731       png_set_IHDR(png_ptr, info_ptr, width, height, bit_depth, color_type, interlace_type,
09732                    compression_type, filter_method);
09733       png_write_info(png_ptr, info_ptr);
09734       <span class="keyword">const</span> <span class="keywordtype">int</span> byte_depth = bit_depth&gt;&gt;3;
09735       <span class="keyword">const</span> <span class="keywordtype">int</span> numChan = dimv()&gt;4?4:dimv();
09736       <span class="keyword">const</span> <span class="keywordtype">int</span> pixel_bit_depth_flag = numChan * (bit_depth-1);
09737       
09738       <span class="comment">// Allocate Memory for Image Save and Fill pixel data</span>
09739       png_bytep *imgData = <span class="keyword">new</span> png_byte*[height];
09740       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row=0; row&lt;height; row++) imgData[row] = <span class="keyword">new</span> png_byte[byte_depth * numChan * width];
09741       <span class="keyword">const</span> T *pC0 = ptr(0,0,0,0);
09742       <span class="keywordflow">switch</span>(pixel_bit_depth_flag) {
09743       <span class="keywordflow">case</span> 7 :  { <span class="comment">// Gray 8-bit</span>
09744         cimg_mapY(*<span class="keyword">this</span>,y) {
09745           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrs = imgData[y];
09746           cimg_mapX(*<span class="keyword">this</span>,x) *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC0++);
09747         }
09748       } <span class="keywordflow">break</span>;
09749       <span class="keywordflow">case</span> 14: { <span class="comment">// Gray w/ Alpha 8-bit</span>
09750         <span class="keyword">const</span> T *pC1 = ptr(0,0,0,1);
09751         cimg_mapY(*<span class="keyword">this</span>,y) {
09752           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrs = imgData[y];
09753           cimg_mapX(*<span class="keyword">this</span>,x) {
09754             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC0++);
09755             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC1++);
09756           }
09757         }
09758       } <span class="keywordflow">break</span>;
09759       <span class="keywordflow">case</span> 21:  { <span class="comment">// RGB 8-bit</span>
09760         <span class="keyword">const</span> T *pC1 = ptr(0,0,0,1);
09761         <span class="keyword">const</span> T *pC2 = ptr(0,0,0,2);
09762         cimg_mapY(*<span class="keyword">this</span>,y) {
09763           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrs = imgData[y];
09764           cimg_mapX(*<span class="keyword">this</span>,x) {
09765             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC0++);
09766             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC1++);
09767             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC2++);
09768           }
09769         }
09770       } <span class="keywordflow">break</span>;
09771       <span class="keywordflow">case</span> 28: { <span class="comment">// RGB x/ Alpha 8-bit</span>
09772         <span class="keyword">const</span> T *pC1 = ptr(0,0,0,1);
09773         <span class="keyword">const</span> T *pC2 = ptr(0,0,0,2);
09774         <span class="keyword">const</span> T *pC3 = ptr(0,0,0,3);
09775         cimg_mapY(*<span class="keyword">this</span>,y){
09776           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrs = imgData[y];
09777           cimg_mapX(*<span class="keyword">this</span>,x){
09778             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC0++);
09779             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC1++);
09780             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC2++);
09781             *(ptrs++) = (<span class="keywordtype">unsigned</span> char)*(pC3++);
09782           }
09783         }
09784       } <span class="keywordflow">break</span>;
09785       <span class="keywordflow">case</span> 15: { <span class="comment">// Gray 16-bit</span>
09786         cimg_mapY(*<span class="keyword">this</span>,y){
09787           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrs = reinterpret_cast&lt;unsigned short*&gt;(imgData[y]);
09788           cimg_mapX(*<span class="keyword">this</span>,x) *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC0++);
09789         }
09790       } <span class="keywordflow">break</span>;
09791       <span class="keywordflow">case</span> 30: { <span class="comment">// Gray w/ Alpha 16-bit</span>
09792         <span class="keyword">const</span> T *pC1 = ptr(0,0,0,1);
09793         cimg_mapY(*<span class="keyword">this</span>,y){
09794           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrs = reinterpret_cast&lt;unsigned short*&gt;(imgData[y]);
09795           cimg_mapX(*<span class="keyword">this</span>,x) {
09796             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC0++);
09797             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC1++);
09798           }
09799         }
09800       } <span class="keywordflow">break</span>;
09801       <span class="keywordflow">case</span> 45: { <span class="comment">// RGB 16-bit</span>
09802         <span class="keyword">const</span> T *pC1 = ptr(0,0,0,1);
09803         <span class="keyword">const</span> T *pC2 = ptr(0,0,0,2);
09804         cimg_mapY(*<span class="keyword">this</span>,y) {
09805           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrs = reinterpret_cast&lt;unsigned short*&gt;(imgData[y]);
09806           cimg_mapX(*<span class="keyword">this</span>,x) {
09807             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC0++);
09808             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC1++);
09809             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC2++);
09810           }
09811         }
09812       } <span class="keywordflow">break</span>;
09813       <span class="keywordflow">case</span> 60: { <span class="comment">// RGB x/ Alpha 16-bit</span>
09814         <span class="keyword">const</span> T *pC1 = ptr(0,0,0,1);
09815         <span class="keyword">const</span> T *pC2 = ptr(0,0,0,2);
09816         <span class="keyword">const</span> T *pC3 = ptr(0,0,0,3);
09817         cimg_mapY(*<span class="keyword">this</span>,y) {
09818           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ptrs = reinterpret_cast&lt;unsigned short*&gt;(imgData[y]);
09819           cimg_mapX(*<span class="keyword">this</span>,x) {
09820             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC0++);
09821             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC1++);
09822             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC2++);
09823             *(ptrs++) = (<span class="keywordtype">unsigned</span> short)*(pC3++);
09824           }
09825         }
09826       } <span class="keywordflow">break</span>;
09827       <span class="keywordflow">default</span>:
09828         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::save_png() : unspecified error reading PNG file '%s'"</span>,pixel_type(),filename);
09829         <span class="keywordflow">break</span>;
09830       }
09831       png_write_image(png_ptr, imgData);      
09832       png_write_end(png_ptr, info_ptr);      
09833       png_destroy_write_struct(&amp;png_ptr, &amp;info_ptr);
09834       
09835       <span class="comment">// Deallocate Image Write Memory</span>
09836       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=0; n&lt;height; n++) <span class="keyword">delete</span>[] imgData[n];
09837       <span class="keyword">delete</span>[] imgData;      
09838       cimg::fclose(file);
09839       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09840 <span class="preprocessor">#endif</span>
09841 <span class="preprocessor"></span>    }
09842 
<a name="l09844"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_12">09844</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; save_jpeg(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> quality=100)<span class="keyword"> const </span>{
09845       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_jpeg"</span>);
09846 <span class="preprocessor">#ifndef cimg_use_jpeg</span>
09847 <span class="preprocessor"></span>      <span class="keywordflow">return</span> save_convert(filename);
09848 <span class="preprocessor">#else</span>
09849 <span class="preprocessor"></span>      
09850       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[width*height*3], *buf2 = buf;
09851       <span class="keyword">const</span> T *ptr_r = ptr(0,0,0,0),
09852         *ptr_g = ptr(0,0,0,dim&gt;1?1:0),
09853         *ptr_b = ptr(0,0,0,dim&gt;2?2:0);
09854       cimg_mapXY(*<span class="keyword">this</span>,x,y) {
09855         *(buf2++) = (<span class="keywordtype">unsigned</span> char)*(ptr_r++);
09856         *(buf2++) = (<span class="keywordtype">unsigned</span> char)*(ptr_g++);
09857         *(buf2++) = (<span class="keywordtype">unsigned</span> char)*(ptr_b++);
09858       }
09859       
09860       <span class="keyword">struct </span>jpeg_compress_struct cinfo;
09861       <span class="keyword">struct </span>jpeg_error_mgr jerr;
09862       cinfo.err = jpeg_std_error(&amp;jerr);
09863       jpeg_create_compress(&amp;cinfo);
09864       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09865       jpeg_stdio_dest(&amp;cinfo,file);
09866       cinfo.image_width = width;
09867       cinfo.image_height = height;
09868       cinfo.input_components = 3;
09869       cinfo.in_color_space = JCS_RGB;
09870       jpeg_set_defaults(&amp;cinfo);
09871       jpeg_set_quality(&amp;cinfo,quality&lt;100?quality:100,TRUE);
09872       jpeg_start_compress(&amp;cinfo,TRUE);
09873       
09874       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row_stride = width*3;
09875       JSAMPROW row_pointer[1];
09876       <span class="keywordflow">while</span> (cinfo.next_scanline &lt; cinfo.image_height) {
09877         row_pointer[0] = &amp;buf[cinfo.next_scanline*row_stride];
09878         jpeg_write_scanlines(&amp;cinfo,row_pointer,1);
09879       }
09880       jpeg_finish_compress(&amp;cinfo);
09881       <span class="keyword">delete</span>[] buf;
09882       cimg::fclose(file);
09883       jpeg_destroy_compress(&amp;cinfo);
09884       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09885 <span class="preprocessor">#endif</span>
09886 <span class="preprocessor"></span>    }
09887 
<a name="l09889"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_13">09889</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_rgba(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09890       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_rgba"</span>);
09891       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09892       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wh = width*height;
09893       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[4*wh], *nbuffer=buffer;
09894       <span class="keyword">const</span> T 
09895         *ptr1 = ptr(0,0,0,0),
09896         *ptr2 = dim&gt;1?ptr(0,0,0,1):ptr1,
09897         *ptr3 = dim&gt;2?ptr(0,0,0,2):ptr1,
09898         *ptr4 = dim&gt;3?ptr(0,0,0,3):NULL;
09899       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;wh; k++) {
09900         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(*(ptr1++));
09901         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(*(ptr2++));
09902         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(*(ptr3++));
09903         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(ptr4?(*(ptr4++)):255);
09904       }
09905       cimg::fwrite(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),4*wh,file);
09906       cimg::fclose(file);
09907       <span class="keyword">delete</span>[] buffer;
09908       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09909     }
09910     
09911 
<a name="l09913"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_14">09913</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; save_rgb(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
09914       cimg_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImg&lt;T&gt;::save_rgb"</span>);
09915       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
09916       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wh = width*height;
09917       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[3*wh], *nbuffer=buffer;
09918       <span class="keyword">const</span> T 
09919         *ptr1 = ptr(0,0,0,0),
09920         *ptr2 = dim&gt;1?ptr(0,0,0,1):ptr1,
09921         *ptr3 = dim&gt;2?ptr(0,0,0,2):ptr1;
09922       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;wh; k++) {
09923         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(*(ptr1++));
09924         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(*(ptr2++));
09925         *(nbuffer++) = (<span class="keywordtype">unsigned</span> char)(*(ptr3++));
09926       }
09927       cimg::fwrite(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>),3*wh,file);
09928       cimg::fclose(file);
09929       <span class="keyword">delete</span>[] buffer;
09930       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
09931     }
09932     
<a name="l09934"></a><a class="code" href="structcimg__library_1_1CImg.html#z21_30">09934</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a> get_logo40x38() { 
09935       <span class="keyword">static</span> <span class="keywordtype">bool</span> first_time = <span class="keyword">true</span>;
09936       <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> res(40,38,1,3);
09937       <span class="keywordflow">if</span> (first_time) {
09938         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptrs = cimg::logo40x38;
09939         T *ptr1 = res.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,0), *ptr2 = res.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,1), *ptr3 = res.<a class="code" href="structcimg__library_1_1CImg.html#z3_6">ptr</a>(0,0,0,2);
09940         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> off = 0; off&lt;res.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*res.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>;) {
09941           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> n = *(ptrs++), r = *(ptrs++), g = *(ptrs++), b = *(ptrs++);
09942           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=0; l&lt;n; off++,l++) { *(ptr1++) = (T)r; *(ptr2++) = (T)g; *(ptr3++) = (T)b; }
09943         }
09944         first_time = <span class="keyword">false</span>;
09945       }      
09946       <span class="keywordflow">return</span> res;
09947     }
09948        
09950     <span class="comment">//------------------------------------------</span>
09951     <span class="comment">//------------------------------------------</span>
09952     <span class="comment">//</span>
09954 <span class="comment"></span>
09955     <span class="comment">//------------------------------------------</span>
09956     <span class="comment">//------------------------------------------</span>
09957     <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; swap(<a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&amp; img) {
09958       cimg::swap(width,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>);
09959       cimg::swap(height,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>);
09960       cimg::swap(depth,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>);
09961       cimg::swap(dim,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
09962       cimg::swap(data,img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>);
09963       <span class="keywordflow">return</span> img;
09964     }
09965 
09966 <span class="preprocessor">#ifdef cimg_plugin</span>
09967 <span class="preprocessor"></span><span class="preprocessor">#include cimg_plugin</span>
09968 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
09969 <span class="preprocessor"></span>    
09971   };
09972 
09973 
09974   <span class="comment">/*-------------------------------------------------------</span>
09975 <span class="comment">    </span>
09976 <span class="comment"></span>
09977 <span class="comment"></span>
09978 <span class="comment"></span>
09979 <span class="comment">  Definition of the CImgl&lt;&gt; structure</span>
09980 <span class="comment"></span>
09981 <span class="comment"></span>
09982 <span class="comment"></span>
09983 <span class="comment"></span>
09984 <span class="comment">  ------------------------------------------------------*/</span>
09985 
<a name="l09987"></a><a class="code" href="structcimg__library_1_1CImgl.html">09987</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> {       
09989 
<a name="l09992"></a><a class="code" href="structcimg__library_1_1CImgl.html#o0">09992</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size;
09993     
09995 
<a name="l09999"></a><a class="code" href="structcimg__library_1_1CImgl.html#o1">09999</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> *data;                      
10000     
10001     <span class="comment">//------------------------------------------</span>
10002     <span class="comment">//------------------------------------------</span>
10003     <span class="comment">//</span>
10005 <span class="comment"></span>
10006     <span class="comment">//------------------------------------------</span>
10007     <span class="comment">//------------------------------------------</span>
10008     
<a name="l10010"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_14">10010</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* pixel_type() { T val; <span class="keywordflow">return</span> cimg::get_type(val); }
10011     
<a name="l10013"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_0">10013</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width=0,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> height=1,
10014           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth=1, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim=1):size(n) {
10015       <span class="keywordflow">if</span> (n) {
10016         data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[(n/cimg::lblock+1)*cimg::lblock];
10017         cimgl_map(*<span class="keyword">this</span>,l) data[l]=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,depth,dim);
10018       } <span class="keywordflow">else</span> data = NULL;
10019     }
10020 
<a name="l10022"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_1">10022</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> width,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> height,
10023           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim,<span class="keyword">const</span> T&amp; val):size(n) {
10024       <span class="keywordflow">if</span> (n) {
10025         data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[(n/cimg::lblock+1)*cimg::lblock];
10026         cimgl_map(*<span class="keyword">this</span>,l) data[l]=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(width,height,depth,dim,val);
10027       } <span class="keywordflow">else</span> data = NULL;
10028     }
10029     
10030     <span class="comment">// ! Create a list of \p n copy of the input image.</span>
10031     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n, <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img):size(n) {
10032       <span class="keywordflow">if</span> (n) {
10033         data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[(n/cimg::lblock+1)*cimg::lblock];
10034         cimgl_map(*<span class="keyword">this</span>,l) data[l]=img;
10035       } else data = NULL;
10036     }
10037     
<a name="l10039"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_3">10039</a>     template&lt;typename t&gt; <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(const <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&lt;t&gt;&amp; list):size(list.size) {
10040       <span class="keywordflow">if</span> (size) {
10041         data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[(size/cimg::lblock+1)*cimg::lblock];
10042         cimgl_map(*<span class="keyword">this</span>,l) data[l] = list[l];
10043       } <span class="keywordflow">else</span> data = NULL;
10044     }
10045     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list):size(list.size) {
10046       <span class="keywordflow">if</span> (size&gt;0) {
10047         data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[(size/cimg::lblock+1)*cimg::lblock];
10048         cimgl_map(*<span class="keyword">this</span>,l) data[l] = list[l];
10049       } else data = NULL;
10050     }
10051 
<a name="l10053"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_5">10053</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(const <span class="keywordtype">char</span>* filename):size(0),data(NULL) { load(filename).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
10054     
<a name="l10056"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_6">10056</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img):size(0),data(NULL) { <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(1,img).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
10057 
<a name="l10059"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_7">10059</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img1,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img2):size(2) {
10060       data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[cimg::lblock];
10061       data[0] = img1;
10062       data[1] = img2;
10063     }
10064 
<a name="l10066"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_8">10066</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img1,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img2,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img3):size(3) {
10067       data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[cimg::lblock];
10068       data[0] = img1;
10069       data[1] = img2;
10070       data[2] = img3;
10071     }
10072 
<a name="l10074"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_9">10074</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img1,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img2,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img3,<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img4):size(4) {
10075       data = <span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[cimg::lblock];
10076       data[0] = img1;
10077       data[1] = img2;
10078       data[2] = img3;
10079       data[3] = img4;
10080     }
10081     
<a name="l10083"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_10">10083</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; list) { 
10084       <span class="keywordflow">if</span> (list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>&gt;size) <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(list).<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); 
10085       size = list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>;
10086       cimgl_map(*<span class="keyword">this</span>,l) data[l] = list[l];
10087       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10088     }
10089 
10090     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list) { 
10091       <span class="keywordflow">if</span> (&amp;list==<span class="keyword">this</span>) <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
10092       <span class="keywordflow">if</span> (list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>&gt;size) <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(list).<a class="code" href="structcimg__library_1_1CImgl.html#z33_11">swap</a>(*<span class="keyword">this</span>);
10093       size = list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>;
10094       cimgl_map(*<span class="keyword">this</span>,l) data[l] = list[l];
10095       return *this;
10096     }
10097     
<a name="l10099"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_12">10099</a>     ~<a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>() { <span class="keywordflow">if</span> (data) <span class="keyword">delete</span>[] data; }
10100     
<a name="l10102"></a><a class="code" href="structcimg__library_1_1CImgl.html#z25_13">10102</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; empty() { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>().<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(*<span class="keyword">this</span>); }
10103     
10105     <span class="comment">//------------------------------------------</span>
10106     <span class="comment">//------------------------------------------</span>
10107     <span class="comment">//</span>
10109 <span class="comment"></span>
10110     <span class="comment">//------------------------------------------</span>
10111     <span class="comment">//------------------------------------------</span>
10112     
<a name="l10114"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_0">10114</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator+=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; list) {
10115       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sizemax = min(size,list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>);
10116       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=0; l&lt;sizemax; l++) (*this)[l]+=list[l];
10117       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10118     }
10119     
<a name="l10121"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_1">10121</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator-=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;t&gt;</a>&amp; list) {
10122       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sizemax = min(size,list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>);
10123       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=0; l&lt;sizemax; l++) (*this)[l]-=list[l];
10124       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10125     }
10126     
<a name="l10128"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_2">10128</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator+=(<span class="keyword">const</span> T&amp; val) { cimgl_map(*<span class="keyword">this</span>,l) (*this)[l]+=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
10129     
<a name="l10131"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_3">10131</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator-=(<span class="keyword">const</span> T&amp; val) { cimgl_map(*<span class="keyword">this</span>,l) (*this)[l]-=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
10132     
<a name="l10134"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_4">10134</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator*=(<span class="keyword">const</span> <span class="keywordtype">double</span> val) { cimgl_map(*<span class="keyword">this</span>,l) (*this)[l]*=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
10135     
<a name="l10137"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_5">10137</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; operator/=(<span class="keyword">const</span> <span class="keywordtype">double</span> val) { cimgl_map(*<span class="keyword">this</span>,l) (*this)[l]/=val; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
10138     
<a name="l10140"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_6">10140</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator+(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this)+=val;  }
10141     
<a name="l10143"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_7">10143</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator*(<span class="keyword">const</span> <span class="keywordtype">double</span> val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this)*=val;  }
10144     
<a name="l10146"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_8">10146</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator-(<span class="keyword">const</span> T&amp; val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this)-=val;  }
10147     
<a name="l10149"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_9">10149</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator/(<span class="keyword">const</span> <span class="keywordtype">double</span> val)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this)/=val;  }
10150     
<a name="l10152"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_10">10152</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator+(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; list)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this)+=list; }
10153 
<a name="l10155"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_11">10155</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator-(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; list)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this)-=list; }
10156     
<a name="l10158"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_12">10158</a>     <span class="keyword">friend</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator+(<span class="keyword">const</span> T&amp; val, <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; list) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(list)+=val; }
10159     
<a name="l10161"></a><a class="code" href="structcimg__library_1_1CImgl.html#z27_13">10161</a>     <span class="keyword">friend</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> operator*(<span class="keyword">const</span> <span class="keywordtype">double</span> val, <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; list) { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(list)*=val; }
10162   
10164     <span class="comment">//------------------------------------------</span>
10165     <span class="comment">//------------------------------------------</span>
10166     <span class="comment">//</span>
10168 <span class="comment"></span>
10169     <span class="comment">//------------------------------------------</span>
10170     <span class="comment">//------------------------------------------</span>
10171     
<a name="l10173"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_0">10173</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; operator[](<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos)<span class="keyword"> const </span>{
10174 <span class="preprocessor">#if cimg_debug&gt;1</span>
10175 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (pos&gt;=size) {
10176         cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImgl&lt;%s&gt;::operator[] : bad list position %u, in a list of %u images"</span>,pixel_type(),pos,size);
10177         <span class="keywordflow">return</span> *data;
10178       }
10179 <span class="preprocessor">#endif</span>
10180 <span class="preprocessor"></span>      <span class="keywordflow">return</span> data[pos];
10181     }
10182     
<a name="l10184"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_1">10184</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; operator()(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (*this)[pos]; }
10185     
<a name="l10187"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_2">10187</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; insert(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos) {
10188       <span class="keywordflow">if</span> (pos&gt;size) 
10189         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImgl&lt;%s&gt;::insert() : Can't insert at position %u into a list with %u elements"</span>,
10190                                     pixel_type(),pos,size);
10191       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> *new_data = (!((++size)%cimg::lblock) || !data)?<span class="keyword">new</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>[(size/cimg::lblock+1)*cimg::lblock]:NULL;
10192       <span class="keywordflow">if</span> (!data) { data=new_data; *data=img; }
10193       <span class="keywordflow">else</span> {
10194         <span class="keywordflow">if</span> (new_data) {
10195           std::memcpy(new_data,data,<span class="keyword">sizeof</span>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>)*pos);
10196           <span class="keywordflow">if</span> (pos!=size-1) std::memcpy(new_data+pos+1,data+pos,<span class="keyword">sizeof</span>(CImg&lt;T&gt;)*(size-1-pos));
10197           std::memset(data,0,<span class="keyword">sizeof</span>(CImg&lt;T&gt;)*(size-1));
10198           <span class="keyword">delete</span>[] data;
10199           data = new_data;
10200         }
10201         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos!=size-1) memmove(data+pos+1,data+pos,<span class="keyword">sizeof</span>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>)*(size-1-pos));
10202         data[pos].<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> = NULL;
10203         data[pos] = img;
10204       }
10205       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10206     }
10207     
<a name="l10209"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_3">10209</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; insert(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img) { <span class="keywordflow">return</span> insert(img,size); }
10210     
<a name="l10212"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_4">10212</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; insert(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos) { 
10213       <span class="keywordflow">if</span> (<span class="keyword">this</span>!=&amp;list) cimgl_map(list,l) insert(list[l],pos+l);
10214       <span class="keywordflow">else</span> insert(<a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(list),pos);
10215       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
10216     }
10217     
<a name="l10219"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_5">10219</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; insert(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>&amp; list) { <span class="keywordflow">return</span> insert(list,size); }
10220     
<a name="l10222"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_6">10222</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; remove(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos) {
10223       <span class="keywordflow">if</span> (pos&gt;=size) { 
10224         cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImgl&lt;%s&gt;::remove() : Can't remove an image from a list (%p,%u), at position %u"</span>,
10225                    pixel_type(),data,size,pos);
10226         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10227       }
10228       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> tmp; tmp.<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>(data[pos]); <span class="comment">// the image to remove will be freed</span>
10229       size--;
10230       <span class="keywordflow">if</span> (pos!=size) { 
10231         memmove(data+pos,data+pos+1,<span class="keyword">sizeof</span>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>)*(size-pos));
10232         CImg&lt;T&gt; &amp;tmp = data[size];
10233         tmp.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> = tmp.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> = tmp.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a> = tmp.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a> = 0;
10234         tmp.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> = NULL;
10235       }
10236       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10237     }
10238 
<a name="l10240"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_7">10240</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; remove() { 
10241       <span class="keywordflow">if</span> (size) <span class="keywordflow">return</span> remove(size-1); 
10242       cimg::warn(<span class="keyword">true</span>,<span class="stringliteral">"CImgl&lt;%s&gt;::remove() : List is empty"</span>,pixel_type());
10243       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10244     }
10245 
<a name="l10247"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_8">10247</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; reverse() {
10248       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=0; l&lt;size/2; l++) (*this)[l].<a class="code" href="structcimg__library_1_1CImg.html#z23_0">swap</a>((*<span class="keyword">this</span>)[size-1-l]);
10249       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10250     }
10251     
<a name="l10253"></a><a class="code" href="structcimg__library_1_1CImgl.html#z29_9">10253</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; get_reverse() { <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this).reverse(); }
10254 
10256     <span class="comment">//------------------------------------------</span>
10257     <span class="comment">//------------------------------------------</span>
10258     <span class="comment">//</span>
10260 <span class="comment"></span>
10261     <span class="comment">//------------------------------------------</span>
10262     <span class="comment">//------------------------------------------</span>
10263     
<a name="l10265"></a><a class="code" href="structcimg__library_1_1CImgl.html#z31_0">10265</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; FFT(<span class="keyword">const</span> <span class="keywordtype">char</span> axe, <span class="keyword">const</span> <span class="keywordtype">bool</span> inverse=<span class="keyword">false</span>) {
10266       <span class="keywordflow">if</span> (size&lt;2) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Instance have less than 2 images"</span>,pixel_type());
10267       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> &amp;Ir = data[0], &amp;Ii = data[1];
10268       cimg_test(Ir,<span class="stringliteral">"CImg&lt;T&gt;::FFT"</span>); cimg_test(Ii,<span class="stringliteral">"CImg&lt;T&gt;::FFT"</span>);
10269       <span class="keywordflow">if</span> (Ir.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> || Ir.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> || Ir.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a> || Ir.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>)
10270         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Real and Imaginary parts of the instance have different dimensions"</span>,
10271                                     pixel_type());
10272       <span class="keywordflow">switch</span> (cimg::uncase(axe)) {
10273       <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: { <span class="comment">// Fourier along X</span>
10274         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N = Ir.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>, N2 = (N&gt;&gt;1);
10275         <span class="keywordflow">if</span> (((N-1)&amp;N) &amp;&amp; N!=1) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Dimension of instance image along 'x' is %d != 2^N"</span>,
10276                                                            pixel_type(),N);
10277         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0,j=0; i&lt;N2; i++) {
10278           <span class="keywordflow">if</span> (j&gt;i) cimg_mapYZV(Ir,y,z,v) { cimg::swap(Ir(i,y,z,v),Ir(j,y,z,v)); cimg::swap(Ii(i,y,z,v),Ii(j,y,z,v));
10279           <span class="keywordflow">if</span> (j&lt;N2) { 
10280             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ri = N-1-i, rj = N-1-j;
10281             cimg::swap(Ir(ri,y,z,v),Ir(rj,y,z,v)); cimg::swap(Ii(ri,y,z,v),Ii(rj,y,z,v)); 
10282           }}
10283           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=N, n=N2; (j+=n)&gt;=m; j-=m, m=n, n&gt;&gt;=1);
10284         }
10285         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta=2; delta&lt;=N; delta&lt;&lt;=1) {
10286           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta2 = (delta&gt;&gt;1);
10287           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;N; i+=delta) {
10288             <span class="keywordtype">float</span> wr = 1, wi = 0;
10289             <span class="keyword">const</span> <span class="keywordtype">float</span> angle = (float)((inverse?+1:-1)*2*cimg::PI/delta),
10290                         ca = (float)std::cos(angle),
10291                         sa = (float)std::sin(angle);
10292             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;delta2; k++) {
10293               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + k, nj = j + delta2;
10294               cimg_mapYZV(Ir,y,z,k) {
10295                 T &amp;ir = Ir(j,y,z,k), &amp;ii = Ii(j,y,z,k), &amp;nir = Ir(nj,y,z,k), &amp;nii = Ii(nj,y,z,k);              
10296                 <span class="keyword">const</span> T tmpr = wr*nir - wi*nii, tmpi = wr*nii + wi*nir;
10297                 nir = ir - tmpr; nii = ii - tmpi;
10298                 ir += tmpr; ii += tmpi;
10299               }
10300               <span class="keyword">const</span> <span class="keywordtype">float</span> nwr = wr*ca-wi*sa;
10301               wi = wi*ca + wr*sa;
10302               wr = nwr;       
10303             }
10304           }       
10305         }
10306         <span class="keywordflow">if</span> (inverse) (*this)/=N;
10307       } <span class="keywordflow">break</span>;
10308 
10309       <span class="keywordflow">case</span> <span class="charliteral">'y'</span>: { <span class="comment">// Fourier along Y</span>
10310         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N = Ir.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>, N2 = (N&gt;&gt;1);
10311         <span class="keywordflow">if</span> (((N-1)&amp;N) &amp;&amp; N!=1) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Dimension of instance image(s) along 'y' is %d != 2^N"</span>,
10312                                                            pixel_type(),N);
10313         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0,j=0; i&lt;N2; i++) {
10314           <span class="keywordflow">if</span> (j&gt;i) cimg_mapXZV(Ir,x,z,v) { cimg::swap(Ir(x,i,z,v),Ir(x,j,z,v)); cimg::swap(Ii(x,i,z,v),Ii(x,j,z,v));
10315           <span class="keywordflow">if</span> (j&lt;N2) { 
10316             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ri = N-1-i, rj = N-1-j;
10317             cimg::swap(Ir(x,ri,z,v),Ir(x,rj,z,v)); cimg::swap(Ii(x,ri,z,v),Ii(x,rj,z,v)); 
10318           }}
10319           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=N, n=N2; (j+=n)&gt;=m; j-=m, m=n, n&gt;&gt;=1);
10320         }
10321         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta=2; delta&lt;=N; delta&lt;&lt;=1) {
10322           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta2 = (delta&gt;&gt;1);
10323           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;N; i+=delta) {
10324             <span class="keywordtype">float</span> wr = 1, wi = 0;
10325             <span class="keyword">const</span> <span class="keywordtype">float</span> angle = (float)((inverse?+1:-1)*2*cimg::PI/delta),
10326                         ca = (float)std::cos(angle), sa = (float)std::sin(angle);
10327             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;delta2; k++) {
10328               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + k, nj = j + delta2;
10329               cimg_mapXZV(Ir,x,z,k) {
10330                 T &amp;ir = Ir(x,j,z,k), &amp;ii = Ii(x,j,z,k), &amp;nir = Ir(x,nj,z,k), &amp;nii = Ii(x,nj,z,k);              
10331                 <span class="keyword">const</span> T tmpr = wr*nir - wi*nii, tmpi = wr*nii + wi*nir;
10332                 nir = ir - tmpr; nii = ii - tmpi;
10333                 ir += tmpr; ii += tmpi;
10334               }
10335               <span class="keyword">const</span> <span class="keywordtype">float</span> nwr = wr*ca-wi*sa;
10336               wi = wi*ca + wr*sa;
10337               wr = nwr;       
10338             }
10339           }       
10340         }
10341         <span class="keywordflow">if</span> (inverse) (*this)/=N;
10342       } <span class="keywordflow">break</span>;
10343 
10344       <span class="keywordflow">case</span> <span class="charliteral">'z'</span>: { <span class="comment">// Fourier along Z</span>
10345         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N = Ir.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>, N2 = (N&gt;&gt;1);
10346         <span class="keywordflow">if</span> (((N-1)&amp;N) &amp;&amp; N!=1) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Dimension of instance image(s) along 'z' is %d != 2^N"</span>,
10347                                                            pixel_type(),N);
10348         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0,j=0; i&lt;N2; i++) {
10349           <span class="keywordflow">if</span> (j&gt;i) cimg_mapXYV(Ir,x,y,v) { cimg::swap(Ir(x,y,i,v),Ir(x,y,j,v)); cimg::swap(Ii(x,y,i,v),Ii(x,y,j,v));
10350           <span class="keywordflow">if</span> (j&lt;N2) { 
10351             <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ri = N-1-i, rj = N-1-j;
10352             cimg::swap(Ir(x,y,ri,v),Ir(x,y,rj,v)); cimg::swap(Ii(x,y,ri,v),Ii(x,y,rj,v)); 
10353           }}
10354           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=N, n=N2; (j+=n)&gt;=m; j-=m, m=n, n&gt;&gt;=1);
10355         }
10356         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta=2; delta&lt;=N; delta&lt;&lt;=1) {
10357           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> delta2 = (delta&gt;&gt;1);
10358           <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;N; i+=delta) {
10359             <span class="keywordtype">float</span> wr = 1, wi = 0;
10360             <span class="keyword">const</span> <span class="keywordtype">float</span> angle = (float)((inverse?+1:-1)*2*cimg::PI/delta),
10361                         ca = (float)std::cos(angle), sa = (float)std::sin(angle);
10362             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0; k&lt;delta2; k++) {
10363               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = i + k, nj = j + delta2;
10364               cimg_mapXYV(Ir,x,y,k) {
10365                 T &amp;ir = Ir(x,y,j,k), &amp;ii = Ii(x,y,j,k), &amp;nir = Ir(x,y,nj,k), &amp;nii = Ii(x,y,nj,k);              
10366                 <span class="keyword">const</span> T tmpr = wr*nir - wi*nii, tmpi = wr*nii + wi*nir;
10367                 nir = ir - tmpr; nii = ii - tmpi;
10368                 ir += tmpr; ii += tmpi;
10369               }
10370               <span class="keyword">const</span> <span class="keywordtype">float</span> nwr = wr*ca-wi*sa;
10371               wi = wi*ca + wr*sa;
10372               wr = nwr;       
10373             }
10374           }       
10375         }
10376         <span class="keywordflow">if</span> (inverse) (*this)/=N;
10377       } <span class="keywordflow">break</span>;
10378 
10379       <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : unknown axe '%c', must be 'x','y' or 'z'"</span>);
10380       }
10381       <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
10382     }
10383 
<a name="l10385"></a><a class="code" href="structcimg__library_1_1CImgl.html#z31_1">10385</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; FFT(<span class="keyword">const</span> <span class="keywordtype">bool</span> inverse=<span class="keyword">false</span>) {
10386       <span class="keywordflow">if</span> (size&lt;2) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Instance have less than 2 images"</span>,pixel_type());
10387       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> &amp;Ir = data[0], &amp;Ii = data[1];
10388       cimg_test(Ir,<span class="stringliteral">"CImg&lt;T&gt;::FFT"</span>); cimg_test(Ii,<span class="stringliteral">"CImg&lt;T&gt;::FFT"</span>);
10389       <span class="keywordflow">if</span> (Ir.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a> || Ir.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a> || Ir.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a> || Ir.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=Ii.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>)
10390         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgInstanceException.html">CImgInstanceException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::FFT() : Real and Imaginary parts of the instance have different dimensions"</span>,
10391                                     pixel_type());
10392       <span class="keywordflow">if</span> (Ir.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>&gt;1)  FFT(<span class="charliteral">'z'</span>,inverse);
10393       <span class="keywordflow">if</span> (Ir.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>&gt;1) FFT(<span class="charliteral">'y'</span>,inverse);
10394       <span class="keywordflow">if</span> (Ir.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>&gt;1)  FFT(<span class="charliteral">'x'</span>,inverse);
10395       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10396     }
10397     
<a name="l10399"></a><a class="code" href="structcimg__library_1_1CImgl.html#z31_2">10399</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> get_FFT(<span class="keyword">const</span> <span class="keywordtype">bool</span> inverse=<span class="keyword">false</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this).FFT(inverse); }
10400 
<a name="l10402"></a><a class="code" href="structcimg__library_1_1CImgl.html#z31_3">10402</a>     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> get_FFT(<span class="keyword">const</span> <span class="keywordtype">char</span> axe,<span class="keyword">const</span> <span class="keywordtype">bool</span> inverse=<span class="keyword">false</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(*this).FFT(axe,inverse); }
10403         
10405     <span class="comment">//------------------------------------------</span>
10406     <span class="comment">//------------------------------------------</span>
10407     <span class="comment">//</span>
10409 <span class="comment"></span>
10410     <span class="comment">//------------------------------------------</span>
10411     <span class="comment">//------------------------------------------</span>
10412     
<a name="l10414"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_0">10414</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; print(<span class="keyword">const</span> <span class="keywordtype">char</span>* title=NULL,<span class="keyword">const</span> <span class="keywordtype">int</span> print_flag=1)<span class="keyword"> const </span>{ 
10415       <span class="keywordtype">char</span> tmp[1024];
10416       std::fprintf(stderr,<span class="stringliteral">"%-8s(this=%p) : { size=%u, data=%p }\n"</span>,title?title:<span class="stringliteral">"CImgl"</span>,(<span class="keywordtype">void</span>*)<span class="keyword">this</span>,size,(<span class="keywordtype">void</span>*)data);
10417       <span class="keywordflow">if</span> (print_flag&gt;0) cimgl_map(*<span class="keyword">this</span>,l) {
10418         std::sprintf(tmp,<span class="stringliteral">"%s[%d]"</span>,title?title:<span class="stringliteral">"CImgl"</span>,l);
10419         data[l].<a class="code" href="structcimg__library_1_1CImg.html#z3_23">print</a>(tmp,print_flag);
10420       }
10421       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10422     }
10424 <span class="preprocessor">#define cimg_load_raw_case(Ts,Tss)                                               \</span>
10425 <span class="preprocessor">  if (!loaded &amp;&amp; !cimg::strcasecmp(Ts,tmp2)) for (unsigned int l=0; l&lt;n; l++) {  \</span>
10426 <span class="preprocessor">      const bool endian = cimg::endian();                               \</span>
10427 <span class="preprocessor">      j=0; while((i=std::fgetc(file))!='\n') tmp[j++]=(char)i; tmp[j]='\0';  \</span>
10428 <span class="preprocessor">      std::sscanf(tmp,"%u %u %u %u",&amp;w,&amp;h,&amp;z,&amp;k);                       \</span>
10429 <span class="preprocessor">      if (w*h*z*k&gt;0) {                                                  \</span>
10430 <span class="preprocessor">        Tss *buf = new Tss[w*h*z*k]; cimg::fread(buf,sizeof(Tss),w*h*z*k,file);\</span>
10431 <span class="preprocessor">        if (endian) cimg::endian_swap(buf,w*h*z*k);                     \</span>
10432 <span class="preprocessor">        CImg&lt;T&gt; idest(w,h,z,k); cimg_mapoff(idest,off)                  \</span>
10433 <span class="preprocessor">                          idest[off] = (T)(buf[off]); idest.swap(res[l]); \</span>
10434 <span class="preprocessor">        delete[] buf;                                                   \</span>
10435 <span class="preprocessor">       }                                                                \</span>
10436 <span class="preprocessor">      loaded = true;                                                    \</span>
10437 <span class="preprocessor">    }</span>
10438 <span class="preprocessor"></span>
10439     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> load_raw(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
10440       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> uchar;
10441       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ushort;
10442       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uint;  
10443       <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulong; 
10444       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"rb"</span>);
10445       <span class="keywordtype">char</span> tmp[256],tmp2[256];
10446       <span class="keywordtype">int</span> i;
10447       <span class="keywordtype">bool</span> loaded = <span class="keyword">false</span>;
10448       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n,j,w,h,z,k,err;
10449       j=0; <span class="keywordflow">while</span>((i=std::fgetc(file))!=<span class="charliteral">'\n'</span> &amp;&amp; i!=EOF) tmp[j++]=i; tmp[j]=<span class="charliteral">'\0'</span>;
10450       err=std::sscanf(tmp,<span class="stringliteral">"%u#%255[A-Za-z ]"</span>,&amp;n,tmp2);
10451       <span class="keywordflow">if</span> (err!=2) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImgl&lt;%s&gt;::load_raw() : file '%s', Unknow .raw header"</span>,pixel_type(),filename);
10452       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res(n);
10453       cimg_load_raw_case(<span class="stringliteral">"unsigned char"</span>,uchar);
10454       cimg_load_raw_case(<span class="stringliteral">"uchar"</span>,uchar);
10455       cimg_load_raw_case(<span class="stringliteral">"char"</span>,<span class="keywordtype">char</span>);
10456       cimg_load_raw_case(<span class="stringliteral">"unsigned short"</span>,ushort);
10457       cimg_load_raw_case(<span class="stringliteral">"ushort"</span>,ushort);
10458       cimg_load_raw_case(<span class="stringliteral">"short"</span>,<span class="keywordtype">short</span>);
10459       cimg_load_raw_case(<span class="stringliteral">"unsigned int"</span>,uint);
10460       cimg_load_raw_case(<span class="stringliteral">"uint"</span>,uint);
10461       cimg_load_raw_case(<span class="stringliteral">"int"</span>,<span class="keywordtype">int</span>);
10462       cimg_load_raw_case(<span class="stringliteral">"unsigned long"</span>,ulong);
10463       cimg_load_raw_case(<span class="stringliteral">"ulong"</span>,ulong);
10464       cimg_load_raw_case(<span class="stringliteral">"long"</span>,<span class="keywordtype">long</span>);
10465       cimg_load_raw_case(<span class="stringliteral">"float"</span>,<span class="keywordtype">float</span>);
10466       cimg_load_raw_case(<span class="stringliteral">"double"</span>,<span class="keywordtype">double</span>);
10467       <span class="keywordflow">if</span> (!loaded) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgIOException.html">CImgIOException</a>(<span class="stringliteral">"CImgl&lt;%s&gt;::load_raw() : file '%s', can't read images of %s"</span>,pixel_type(),filename,tmp2);
10468       cimg::fclose(file);
10469       <span class="keywordflow">return</span> res;
10470     }
10471 
<a name="l10473"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_13">10473</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> load(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
10474       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a> res;
10475       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename);
10476       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"raw"</span>) || !ext[0]) <span class="keywordflow">return</span> load_raw(filename); <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(filename);
10477     }
10478 
10479 
10481 
<a name="l10484"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_1">10484</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; save(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
10485       cimgl_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImgl&lt;T&gt;::save"</span>);
10486       <span class="keyword">const</span> <span class="keywordtype">char</span> *ext = cimg::filename_split(filename);
10487       <span class="keywordflow">if</span> (!cimg::strcasecmp(ext,<span class="stringliteral">"raw"</span>) || !ext[0]) <span class="keywordflow">return</span> save_raw(filename);
10488       <span class="keywordflow">else</span> {
10489         <span class="keywordflow">if</span> (size==1) data[0].<a class="code" href="structcimg__library_1_1CImg.html#z21_0">save</a>(filename,-1);
10490         <span class="keywordflow">else</span> cimgl_map(*<span class="keyword">this</span>,l) data[l].<a class="code" href="structcimg__library_1_1CImg.html#z21_0">save</a>(filename,l);
10491       }
10492       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10493     }
10494 
10496 
<a name="l10501"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_2">10501</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; save_raw(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)<span class="keyword"> const </span>{
10502       cimgl_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImgl&lt;T&gt;::save_raw"</span>);
10503       std::FILE *file = cimg::fopen(filename,<span class="stringliteral">"wb"</span>);
10504       std::fprintf(file,<span class="stringliteral">"%u#%s\n"</span>,size,pixel_type());
10505       cimgl_map(*<span class="keyword">this</span>,l) {
10506         <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img = data[l];
10507         std::fprintf(file,<span class="stringliteral">"%u %u %u %u\n"</span>,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
10508         <span class="keywordflow">if</span> (img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>) {
10509           <span class="keywordflow">if</span> (cimg::endian()) {
10510             <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> tmp(img);
10511             cimg::endian_swap(tmp.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,tmp.<a class="code" href="structcimg__library_1_1CImg.html#z3_0">size</a>());
10512             cimg::fwrite(tmp.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(T),img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,file);
10513           } <span class="keywordflow">else</span> cimg::fwrite(img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(T),img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>*img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>,file);
10514         }
10515       }
10516       cimg::fclose(file);
10517       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10518     }  
10519 
10521 
<a name="l10526"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_3">10526</a>     <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> get_append(<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'c'</span>)<span class="keyword"> const </span>{
10527       cimgl_test(*<span class="keyword">this</span>,<span class="stringliteral">"CImgl&lt;T&gt;::get_append"</span>);
10528       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx=0,dy=0,dz=0,dv=0,pos=0;
10529       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a> res;
10530       <span class="keywordflow">switch</span>(cimg::uncase(axe)) {
10531       <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: {
10532         cimgl_map(*<span class="keyword">this</span>,l) {
10533           <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img = (*this)[l];
10534           dx += img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
10535           dy = cimg::max(dy,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>);
10536           dz = cimg::max(dz,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>);
10537           dv = cimg::max(dv,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
10538         }
10539         res = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(dx,dy,dz,dv,0);
10540         <span class="keywordflow">switch</span> (cimg::uncase(align)) {
10541         <span class="keywordflow">case</span> <span class="charliteral">'p'</span> : { cimgl_map(*<span class="keyword">this</span>,ll) { res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],pos,0,0,0); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; }} <span class="keywordflow">break</span>;
10542         <span class="keywordflow">case</span> <span class="charliteral">'n'</span> : { cimgl_map(*<span class="keyword">this</span>,ll) { 
10543               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],pos,dy-(*<span class="keyword">this</span>)[ll].height,dz-(*<span class="keyword">this</span>)[ll].depth,dv-(*<span class="keyword">this</span>)[ll].dim); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>;
10544             }} <span class="keywordflow">break</span>;
10545         <span class="keywordflow">default</span>  : { cimgl_map(*<span class="keyword">this</span>,ll) {
10546               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],pos,(dy-(*<span class="keyword">this</span>)[ll].height)/2,(dz-(*<span class="keyword">this</span>)[ll].depth)/2,(dv-(*<span class="keyword">this</span>)[ll].dim)/2);
10547               pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; 
10548             }} <span class="keywordflow">break</span>;
10549         }
10550       } <span class="keywordflow">break</span>;
10551       <span class="keywordflow">case</span> <span class="charliteral">'y'</span>: {
10552         cimgl_map(*<span class="keyword">this</span>,l) {
10553           <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img = (*this)[l];
10554           dx = cimg::max(dx,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>);
10555           dy += img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>;
10556           dz = cimg::max(dz,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>);
10557           dv = cimg::max(dv,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
10558         }
10559         res = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(dx,dy,dz,dv,0);
10560         <span class="keywordflow">switch</span> (cimg::uncase(align)) {
10561         <span class="keywordflow">case</span> <span class="charliteral">'p'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],0,pos,0,0); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; }} <span class="keywordflow">break</span>;
10562         <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { 
10563               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],dx-(*<span class="keyword">this</span>)[ll].width,pos,dz-(*<span class="keyword">this</span>)[ll].depth,dv-(*<span class="keyword">this</span>)[ll].dim); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>;
10564             }} <span class="keywordflow">break</span>;
10565         <span class="keywordflow">default</span> : { cimgl_map(*<span class="keyword">this</span>,ll) { 
10566               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],(dx-(*<span class="keyword">this</span>)[ll].width)/2,pos,(dz-(*<span class="keyword">this</span>)[ll].depth)/2,(dv-(*<span class="keyword">this</span>)[ll].dim)/2);
10567               pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; 
10568             }} <span class="keywordflow">break</span>;
10569         }
10570       } <span class="keywordflow">break</span>;
10571       <span class="keywordflow">case</span> <span class="charliteral">'z'</span>: {
10572         cimgl_map(*<span class="keyword">this</span>,l) {
10573           <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img = (*this)[l];
10574           dx = cimg::max(dx,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>);
10575           dy = cimg::max(dy,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>);
10576           dz += img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>;
10577           dv = cimg::max(dv,img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>);
10578         }
10579         res = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(dx,dy,dz,dv,0);
10580         <span class="keywordflow">switch</span> (cimg::uncase(align)) {
10581         <span class="keywordflow">case</span> <span class="charliteral">'p'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],0,0,pos,0); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>; }} <span class="keywordflow">break</span>;
10582         <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { 
10583               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],dx-(*<span class="keyword">this</span>)[ll].width,dy-(*<span class="keyword">this</span>)[ll].height,pos,dv-(*<span class="keyword">this</span>)[ll].dim); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>;
10584             }} <span class="keywordflow">break</span>;
10585         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { 
10586               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],(dx-(*<span class="keyword">this</span>)[ll].width)/2,(dy-(*<span class="keyword">this</span>)[ll].height)/2,pos,(dv-(*<span class="keyword">this</span>)[ll].dim)/2);
10587               pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>; 
10588             }} <span class="keywordflow">break</span>;
10589         }
10590       } <span class="keywordflow">break</span>;
10591       <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: {
10592         cimgl_map(*<span class="keyword">this</span>,l) {
10593           <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img = (*this)[l];
10594           dx = cimg::max(dx,img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>);
10595           dy = cimg::max(dy,img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>);
10596           dz = cimg::max(dz,img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>);
10597           dv += img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>;
10598         }
10599         res = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>(dx,dy,dz,dv,0);
10600         <span class="keywordflow">switch</span> (cimg::uncase(align)) {
10601         <span class="keywordflow">case</span> <span class="charliteral">'p'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],0,0,0,pos); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>; }} <span class="keywordflow">break</span>;
10602         <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { 
10603               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],dx-(*<span class="keyword">this</span>)[ll].width,dy-(*<span class="keyword">this</span>)[ll].height,dz-(*<span class="keyword">this</span>)[ll].depth,pos); pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>;
10604             }} <span class="keywordflow">break</span>;
10605         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>: { cimgl_map(*<span class="keyword">this</span>,ll) { 
10606               res.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>((*<span class="keyword">this</span>)[ll],(dx-(*<span class="keyword">this</span>)[ll].width)/2,(dy-(*<span class="keyword">this</span>)[ll].height)/2,(dz-(*<span class="keyword">this</span>)[ll].depth)/2,pos);
10607               pos+=(*this)[ll].<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>; 
10608             }} <span class="keywordflow">break</span>;
10609         }
10610       } <span class="keywordflow">break</span>;
10611       <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImg&lt;%s&gt;::get_append() : unknow axe '%c', must be 'x','y','z' or 'v'"</span>,pixel_type(),axe);
10612       }
10613       <span class="keywordflow">return</span> res;
10614     }
10615 
10616     <span class="comment">// Create an auto-cropped font (along the X axis) from a input font \p font.</span>
10617     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_crop_font(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> padding=1)<span class="keyword"> const </span>{
10618       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res;
10619       cimgl_map(*<span class="keyword">this</span>,l) {
10620         <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; letter = (*this)[l];
10621         <span class="keywordtype">int</span> xmin=letter.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>, xmax = 0;
10622         cimg_mapXY(letter,x,y) if (letter(x,y)) { <span class="keywordflow">if</span> (x&lt;xmin) xmin=x; if (x&gt;xmax) xmax=x; }
10623         <span class="keywordflow">if</span> (xmin&gt;xmax) res.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(CImg&lt;T&gt;(4*padding,(*<span class="keyword">this</span>)[<span class="charliteral">' '</span>].height,1,(*<span class="keyword">this</span>)[<span class="charliteral">' '</span>].dim,0));
10624         <span class="keywordflow">else</span> res.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(letter.<a class="code" href="structcimg__library_1_1CImg.html#z9_32">get_crop</a>(xmin,0,xmax+padding,letter.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>));
10625       }
10626       <span class="keywordflow">return</span> res;
10627     }
10628     
10629     CImgl&lt;T&gt;&amp; crop_font(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> padding=1) {
10630       <span class="keywordflow">return</span> get_crop_font(padding).<a class="code" href="structcimg__library_1_1CImgl.html#z33_11">swap</a>(*<span class="keyword">this</span>);
10631     }
10632 
10634 
<a name="l10638"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_14">10638</a>     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_font(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<span class="keyword">const</span> font,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> w,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> h,
10639                              <span class="keyword">const</span> <span class="keywordtype">int</span> padding=1) {
10640       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> res = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(256,w,h,1,3).<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a>(256,w,h,1,1));
10641       <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ptr = font;
10642       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> m = 0, val = 0;
10643       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y=0; y&lt;h; y++)
10644         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x=0; x&lt;256*w; x++) {
10645           m&gt;&gt;=1; <span class="keywordflow">if</span> (!m) { m=0x80000000; val = *(ptr++); }
10646           <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img = res[x/w], &amp;mask = res[x/w+256];
10647           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xm = x%w;
10648           img(xm,y,0) = img(xm,y,1) = img(xm,y,2) = mask(xm,y,0) = (T)((val&amp;m)?1:0);
10649         }
10650       <span class="keywordflow">if</span> (padding&gt;=0) <span class="keywordflow">return</span> res.<a class="code" href="structcimg__library_1_1CImgl.html#z33_4">get_crop_font</a>(padding);
10651       <span class="keywordflow">return</span> res;
10652     }
10653 
10654     <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> get_font10x13(<span class="keyword">const</span> <span class="keywordtype">bool</span> fixed_size = <span class="keyword">false</span>) {
10655       <span class="keyword">static</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;T&gt;</a> nfixed, fixed;
10656       <span class="keywordflow">if</span> (fixed_size) {
10657         <span class="keywordflow">if</span> (!fixed.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>) fixed = get_font(cimg::font10x13,10,13,-1);
10658         <span class="keywordflow">return</span> fixed;
10659       } 
10660       <span class="keywordflow">if</span> (!nfixed.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>) nfixed = get_font(cimg::font10x13,10,13,1);
10661       <span class="keywordflow">return</span> nfixed;
10662     }
10663 
10664     <span class="keyword">static</span> CImgl&lt;T&gt; get_font7x11(<span class="keyword">const</span> <span class="keywordtype">bool</span> fixed_size = <span class="keyword">false</span>) {
10665       <span class="keyword">static</span> CImgl&lt;T&gt; nfixed, fixed;
10666       <span class="keywordflow">if</span> (fixed_size) {
10667         <span class="keywordflow">if</span> (!fixed.size) fixed = get_font(cimg::font7x11,7,11,-1);
10668         <span class="keywordflow">return</span> fixed;
10669       } 
10670       <span class="keywordflow">if</span> (!nfixed.size) nfixed = get_font(cimg::font7x11,7,11,1);
10671       <span class="keywordflow">return</span> nfixed;
10672     }
10673     
10675 
<a name="l10684"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_6">10684</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; display(<a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>&amp; disp,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'c'</span>)<span class="keyword"> const </span>{ 
10685       get_append(axe,align).<a class="code" href="structcimg__library_1_1CImgl.html#z33_6">display</a>(disp); <span class="keywordflow">return</span> *<span class="keyword">this</span>; 
10686     }
10687 
10689 
<a name="l10698"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_7">10698</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; display(<a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a>* disp,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'c'</span>)<span class="keyword"> const </span>{ 
10699       <span class="keywordflow">if</span> (!disp) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImgl&lt;%s&gt;::display() : given display pointer is (null)"</span>,pixel_type());
10700       <span class="keywordflow">else</span> display(*disp,axe,align);
10701       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10702     }
10703 
10705 
<a name="l10718"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_8">10718</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; display(<span class="keyword">const</span> <span class="keywordtype">char</span>* title,<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'c'</span>,
10719                          <span class="keyword">const</span> <span class="keywordtype">int</span> min_size=128,<span class="keyword">const</span> <span class="keywordtype">int</span> max_size=1024)<span class="keyword"> const </span>{
10720       get_append(axe,align).<a class="code" href="structcimg__library_1_1CImgl.html#z33_6">display</a>(title,min_size,max_size);
10721       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10722     }
10723 
10725 
<a name="l10737"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_9">10737</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; display(<span class="keyword">const</span> <span class="keywordtype">char</span> axe=<span class="charliteral">'x'</span>,<span class="keyword">const</span> <span class="keywordtype">char</span> align=<span class="charliteral">'c'</span>,
10738                          <span class="keyword">const</span> <span class="keywordtype">int</span> min_size=128,<span class="keyword">const</span> <span class="keywordtype">int</span> max_size=1024)<span class="keyword"> const </span>{
10739       <span class="keywordflow">return</span> display(<span class="stringliteral">""</span>,axe,align,min_size,max_size); 
10740     }
10741 
10743 
<a name="l10746"></a><a class="code" href="structcimg__library_1_1CImgl.html#z33_10">10746</a>     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; wait(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> milliseconds)<span class="keyword"> const </span>{ cimg::wait(milliseconds); <span class="keywordflow">return</span> *<span class="keyword">this</span>;  }
10747     
10748     <span class="comment">// Swap fields of two CImgl instances.</span>
10749     <a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; swap(<a class="code" href="structcimg__library_1_1CImgl.html">CImgl</a>&amp; list) {
10750       cimg::swap(size,list.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>);
10751       cimg::swap(data,list.<a class="code" href="structcimg__library_1_1CImgl.html#o1">data</a>);
10752       <span class="keywordflow">return</span> list;
10753     }
10754 
10755 <span class="preprocessor">#ifdef cimgl_plugin</span>
10756 <span class="preprocessor"></span><span class="preprocessor">#include cimgl_plugin</span>
10757 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
10758 <span class="preprocessor"></span>   
10760   };
10761 
10762 
10764 
<a name="l10770"></a><a class="code" href="structcimg__library_1_1CImgROI.html">10770</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct </span><a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a> : <span class="keyword">public</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg</a>&lt;T&gt; {
10771     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dx,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dy,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dz,<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dv,T *<span class="keyword">const</span> pdata) {
10772       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::width = dx; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::height = dy; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::depth = dz; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::dim = dv; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::data = pdata;
10773     }
10774     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a>(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a>&amp; roi):<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>() {
10775       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::width = roi.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::height = roi.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::depth = roi.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::dim = roi.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>; 
10776       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::data = roi.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>;
10777     }
10778     ~<a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a>() { <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::width=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::height=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::depth=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::dim=0; <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::data=NULL;}
10779     
<a name="l10780"></a><a class="code" href="structcimg__library_1_1CImgROI.html#a3">10780</a>     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt; <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI&lt;T&gt;</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; img) { 
10781       <span class="keywordflow">if</span> (img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::width || img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::height ||
10782           img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::depth || img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::dim)
10783         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImgROI&lt;%s&gt;::operator=() : Affectation to CImgROI instances must supply "</span>
10784                                     <span class="stringliteral">"data with same dimensions"</span>,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::pixel_type());
10785       <span class="keyword">const</span> t* ptrs = img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a> + <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;::size</a>();
10786       <span class="keywordflow">for</span> (T *ptrd = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::data+<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;::size</a>(); ptrd&gt;<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::data; ) *(--ptrd) = (T)*(--ptrs);
10787       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10788     }
10789 
10790     <a class="code" href="structcimg__library_1_1CImgROI.html">CImgROI</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>&amp; img) {
10791       <span class="keywordflow">if</span> (&amp;img==<span class="keyword">this</span>) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10792       <span class="keywordflow">if</span> (img.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::width || img.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::height ||
10793           img.<a class="code" href="structcimg__library_1_1CImg.html#o2">depth</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::depth || img.<a class="code" href="structcimg__library_1_1CImg.html#o3">dim</a>!=<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::dim)
10794         <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"CImgROI&lt;%s&gt;::operator=() : Affectation to CImgROI instances must supply "</span>
10795                                     <span class="stringliteral">"data with same dimensions"</span>,<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::pixel_type());
10796       std::memcpy(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::data,img.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>,<span class="keyword">sizeof</span>(T)*<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;T&gt;</a>::size());
10797       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
10798     }
10799     
10800   };
10801 
10802 <span class="keyword">namespace </span>cimg {
10803   
10805 
10821   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> t&gt;
<a name="l10822"></a><a class="code" href="namespacecimg__library_1_1cimg.html#a99">10822</a>   <span class="keyword">static</span> <span class="keywordtype">int</span> dialog(<span class="keyword">const</span> <span class="keywordtype">char</span> *title,<span class="keyword">const</span> <span class="keywordtype">char</span> *msg,
10823                     <span class="keyword">const</span> <span class="keywordtype">char</span> *button1_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button2_txt,
10824                     <span class="keyword">const</span> <span class="keywordtype">char</span> *button3_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button4_txt,
10825                     <span class="keyword">const</span> <span class="keywordtype">char</span> *button5_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button6_txt,
10826                     <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;t&gt;</a>&amp; logo) {
10827 <span class="preprocessor">#if cimg_display_type!=0</span>
10828 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
10829       black[3]={0,0,0}, white[3]={255,255,255}, gray[3]={200,200,200}, gray2[3]={150,150,150};
10830       
10831       <span class="comment">// Create buttons and canvas graphics</span>
10832       <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;unsigned char&gt;</a> buttons, cbuttons, sbuttons;
10833       <span class="keyword">const</span> <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;unsigned char&gt;</a> tahoma = <a class="code" href="structcimg__library_1_1CImgl.html">CImgl&lt;unsigned char&gt;::get_font10x13</a>(<span class="keyword">false</span>);
10834       <span class="keywordflow">if</span> (button1_txt) { buttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().draw_text(button1_txt,0,0,black,gray,tahoma));
10835       <span class="keywordflow">if</span> (button2_txt) { buttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().draw_text(button2_txt,0,0,black,gray,tahoma));
10836       <span class="keywordflow">if</span> (button3_txt) { buttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().draw_text(button3_txt,0,0,black,gray,tahoma));
10837       <span class="keywordflow">if</span> (button4_txt) { buttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().draw_text(button4_txt,0,0,black,gray,tahoma));
10838       <span class="keywordflow">if</span> (button5_txt) { buttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().draw_text(button5_txt,0,0,black,gray,tahoma));
10839       <span class="keywordflow">if</span> (button6_txt) { buttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().draw_text(button6_txt,0,0,black,gray,tahoma));
10840       }}}}}}
10841       <span class="keywordflow">if</span> (!buttons.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>) <span class="keywordflow">throw</span> <a class="code" href="structcimg__library_1_1CImgArgumentException.html">CImgArgumentException</a>(<span class="stringliteral">"cimg::dialog() : No buttons have been defined. At least one is necessary"</span>);
10842       
10843       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bw=0, bh=0;
10844       cimgl_map(buttons,l) { bw = cimg::max(bw,buttons[l].width); bh = cimg::max(bh,buttons[l].height); }
10845       bw+=8; bh+=8;
10846       <span class="keywordflow">if</span> (bw&lt;64) bw=64;
10847       <span class="keywordflow">if</span> (bw&gt;128) bw=128;
10848       <span class="keywordflow">if</span> (bh&lt;24) bh=24;
10849       <span class="keywordflow">if</span> (bh&gt;48) bh=48;
10850       
10851       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> button = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(bw,bh,1,3).
10852         draw_rectangle(0,0,bw-1,bh-1,gray).
10853         draw_line(0,0,bw-1,0,white).draw_line(0,bh-1,0,0,white).
10854         draw_line(bw-1,0,bw-1,bh-1,black).draw_line(bw-1,bh-1,0,bh-1,black).
10855         draw_line(1,bh-2,bw-2,bh-2,gray2).draw_line(bw-2,bh-2,bw-2,1,gray2);
10856       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> sbutton = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(bw,bh,1,3).
10857         draw_rectangle(0,0,bw-1,bh-1,gray).
10858         draw_line(0,0,bw-1,0,black).draw_line(bw-1,0,bw-1,bh-1,black).
10859         draw_line(bw-1,bh-1,0,bh-1,black).draw_line(0,bh-1,0,0,black).
10860         draw_line(1,1,bw-2,1,white).draw_line(1,bh-2,1,1,white).
10861         draw_line(bw-2,1,bw-2,bh-2,black).draw_line(bw-2,bh-2,1,bh-2,black).
10862         draw_line(2,bh-3,bw-3,bh-3,gray2).draw_line(bw-3,bh-3,bw-3,2,gray2).
10863         draw_line(4,4,bw-5,4,black,0xAAAAAAAA).draw_line(bw-5,4,bw-5,bh-5,black,0xAAAAAAAA).
10864         draw_line(bw-5,bh-5,4,bh-5,black,0xAAAAAAAA).draw_line(4,bh-5,4,4,black,0xAAAAAAAA);
10865       <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> cbutton = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(bw,bh,1,3).
10866         draw_rectangle(0,0,bw-1,bh-1,black).draw_rectangle(1,1,bw-2,bh-2,gray2).draw_rectangle(2,2,bw-3,bh-3,gray).
10867         draw_line(4,4,bw-5,4,black,0xAAAAAAAA).draw_line(bw-5,4,bw-5,bh-5,black,0xAAAAAAAA).
10868         draw_line(bw-5,bh-5,4,bh-5,black,0xAAAAAAAA).draw_line(4,bh-5,4,4,black,0xAAAAAAAA);
10869 
10870         cimgl_map(buttons,ll) {
10871           cbuttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(cbutton).draw_image(buttons[ll],1+(bw-buttons[ll].dimx())/2,1+(bh-buttons[ll].dimy())/2));
10872           sbuttons.<a class="code" href="structcimg__library_1_1CImgl.html#z29_2">insert</a>(<a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(sbutton).draw_image(buttons[ll],(bw-buttons[ll].dimx())/2,(bh-buttons[ll].dimy())/2));
10873           buttons[ll] = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(button).draw_image(buttons[ll],(bw-buttons[ll].dimx())/2,(bh-buttons[ll].dimy())/2);
10874         }
10875         
10876         <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a> canvas;
10877         <span class="keywordflow">if</span> (msg) canvas = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>().<a class="code" href="structcimg__library_1_1CImg.html#z13_19">draw_text</a>(msg,0,0,black,gray,tahoma);
10878         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> 
10879           bwall = (buttons.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>-1)*(12+bw) + bw,
10880           w = cimg::max(196U,36+logo.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>+canvas.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>, 24+bwall),
10881           h = cimg::max(96U,36+canvas.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>+bh,36+logo.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>+bh),
10882           lx = 12 + (canvas.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>?0:((w-24-logo.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>)/2)),
10883           ly = (h-12-bh-logo.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>)/2,
10884           tx = lx+logo.<a class="code" href="structcimg__library_1_1CImg.html#o0">width</a>+12,
10885           ty = (h-12-bh-canvas.<a class="code" href="structcimg__library_1_1CImg.html#o1">height</a>)/2,
10886           bx = (w-bwall)/2,
10887           by = h-12-bh;
10888         
10889         <span class="keywordflow">if</span> (canvas.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>)
10890           canvas = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(w,h,1,3).
10891             draw_rectangle(0,0,w-1,h-1,gray).
10892             draw_line(0,0,w-1,0,white).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(0,h-1,0,0,white).
10893             draw_line(w-1,0,w-1,h-1,black).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(w-1,h-1,0,h-1,black).
10894             draw_image(canvas,tx,ty);
10895         <span class="keywordflow">else</span> 
10896           canvas = <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(w,h,1,3).
10897             draw_rectangle(0,0,w-1,h-1,gray).
10898             draw_line(0,0,w-1,0,white).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(0,h-1,0,0,white).
10899             draw_line(w-1,0,w-1,h-1,black).<a class="code" href="structcimg__library_1_1CImg.html#z13_4">draw_line</a>(w-1,h-1,0,h-1,black);
10900         <span class="keywordflow">if</span> (logo.<a class="code" href="structcimg__library_1_1CImg.html#o4">data</a>) canvas.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>(logo,lx,ly);
10901         
10902         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xbuttons[6];
10903         cimgl_map(buttons,lll) { xbuttons[lll] = bx+(bw+12)*lll; canvas.<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>(buttons[lll],xbuttons[lll],by); }
10904         
10905         <span class="comment">// Open window and enter events loop  </span>
10906         <a class="code" href="structcimg__library_1_1CImgDisplay.html">CImgDisplay</a> disp(canvas,title?title:<span class="stringliteral">""</span>,0,3);
10907         <span class="keywordtype">bool</span> stopflag = <span class="keyword">false</span>, refresh = <span class="keyword">false</span>;
10908         <span class="keywordtype">int</span> oselected = -1, oclicked = -1, selected = -1, clicked = -1;
10909         <span class="keywordflow">while</span> (!disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o13">closed</a> &amp;&amp; !stopflag) {
10910           <span class="keywordflow">if</span> (refresh) {
10911             <span class="keywordflow">if</span> (clicked&gt;=0) <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(canvas).<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>(cbuttons[clicked],xbuttons[clicked],by).<a class="code" href="structcimg__library_1_1CImg.html#z19_0">display</a>(disp);
10912             <span class="keywordflow">else</span> {
10913               <span class="keywordflow">if</span> (selected&gt;=0) <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>(canvas).<a class="code" href="structcimg__library_1_1CImg.html#z13_8">draw_image</a>(sbuttons[selected],xbuttons[selected],by).<a class="code" href="structcimg__library_1_1CImg.html#z19_0">display</a>(disp);
10914               <span class="keywordflow">else</span> canvas.<a class="code" href="structcimg__library_1_1CImg.html#z19_0">display</a>(disp);
10915             }
10916             refresh = <span class="keyword">false</span>;
10917           }
10918           disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#a5">wait</a>(40);
10919           <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o14">resized</a>) disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#a7">resize</a>(disp);
10920           
10921           <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o11">button</a>&amp;1)  {
10922             oclicked = clicked;
10923             clicked = -1;
10924             cimgl_map(buttons,l)
10925               <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o10">mouse_y</a>&gt;=(int)by &amp;&amp; disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o10">mouse_y</a>&lt;(int)(by+bh) &amp;&amp;
10926                   disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o9">mouse_x</a>&gt;=(int)xbuttons[l] &amp;&amp; disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o9">mouse_x</a>&lt;(int)(xbuttons[l]+bw)) {
10927                 clicked = selected = l;
10928                 refresh = <span class="keyword">true</span>;
10929               }
10930             <span class="keywordflow">if</span> (clicked!=oclicked) refresh = <span class="keyword">true</span>;
10931           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clicked&gt;=0) stopflag = <span class="keyword">true</span>;
10932           
10933           <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o12">key</a>) {
10934             oselected = selected;
10935             <span class="keywordflow">switch</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o12">key</a>) {
10936             <span class="keywordflow">case</span> cimg::keyESC: selected=-1; stopflag=<span class="keyword">true</span>; <span class="keywordflow">break</span>;
10937             <span class="keywordflow">case</span> cimg::keyENTER: <span class="keywordflow">if</span> (selected&lt;0) selected=0; stopflag = <span class="keyword">true</span>; <span class="keywordflow">break</span>;
10938             <span class="keywordflow">case</span> cimg::keyTAB:
10939             <span class="keywordflow">case</span> cimg::keyARROWRIGHT:
10940             <span class="keywordflow">case</span> cimg::keyARROWDOWN: selected = (selected+1)%buttons.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>; <span class="keywordflow">break</span>;
10941             <span class="keywordflow">case</span> cimg::keyARROWLEFT:
10942             <span class="keywordflow">case</span> cimg::keyARROWUP: selected = (selected+buttons.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>-1)%buttons.<a class="code" href="structcimg__library_1_1CImgl.html#o0">size</a>; <span class="keywordflow">break</span>;
10943             }
10944             disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o12">key</a>=0;
10945             <span class="keywordflow">if</span> (selected!=oselected) refresh = <span class="keyword">true</span>;
10946           }
10947         }
10948         <span class="keywordflow">if</span> (disp.<a class="code" href="structcimg__library_1_1CImgDisplay.html#o13">closed</a>) selected = -1;
10949         <span class="keywordflow">return</span> selected;
10950 <span class="preprocessor">#else</span>
10951 <span class="preprocessor"></span>        std::fprintf(stderr,<span class="stringliteral">"&lt;%s&gt;\n\n%s\n\n"</span>,title,msg);
10952         <span class="keywordflow">return</span> -1;
10953 <span class="preprocessor">#endif</span>
10954 <span class="preprocessor"></span>  }
10955   
10956   <span class="keyword">static</span> <span class="keywordtype">int</span> dialog(<span class="keyword">const</span> <span class="keywordtype">char</span> *title,<span class="keyword">const</span> <span class="keywordtype">char</span> *msg,<span class="keyword">const</span> <span class="keywordtype">char</span> *button1_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button2_txt,
10957                     <span class="keyword">const</span> <span class="keywordtype">char</span> *button3_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button4_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button5_txt,<span class="keyword">const</span> <span class="keywordtype">char</span> *button6_txt) {
10958     <span class="keywordflow">return</span> dialog(title,msg,button1_txt,button2_txt,button3_txt,button4_txt,button5_txt,button6_txt,
10959                   <a class="code" href="structcimg__library_1_1CImg.html">CImg&lt;unsigned char&gt;</a>::get_logo40x38());
10960   }
10961 }
10962 
10963 }
10964 
10965 <span class="comment">// Overcome VisualC++ 6.0 and DMC compilers namespace bug</span>
10966 <span class="preprocessor">#if ( defined(_MSC_VER) || defined(__DMC__) ) &amp;&amp; defined(std)</span>
10967 <span class="preprocessor"></span><span class="preprocessor">#undef std</span>
10968 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
10969 <span class="preprocessor"></span>
10970 <span class="comment">/*--------------------------------------------------------------------------------------</span>
10971 <span class="comment"></span>
10972 <span class="comment"></span>
10973 <span class="comment"></span>
10974 <span class="comment">  Additional documentation for the generation of the reference page (using doxygen)</span>
10975 <span class="comment"></span>
10976 <span class="comment"></span>
10977 <span class="comment"></span>
10978 <span class="comment">  -------------------------------------------------------------------------------------*/</span>
10997 <span class="comment">//---------------------------------------------------------------------------------------------------------------</span>
10999 <span class="comment"></span>
11138 
11139 <span class="comment">//--------------------------------------------------------------------------------------------------------------------</span>
11141 <span class="comment"></span>
11212 
11213 <span class="comment">//--------------------------------------------------------------------------------------------------------------------</span>
11215 <span class="comment"></span>
11313 
11314 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11316 <span class="comment"></span>
11338 
11339 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11341 <span class="comment"></span>
11577 
11578 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11580 <span class="comment"></span>
11601 
11602 
11603 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11605 <span class="comment"></span>
11611 
11612 
11613 
11614 
11615 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11617 <span class="comment"></span>
11634 
11635 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11637 <span class="comment"></span>
11723 <span class="comment">//----------------------------------------------------------------------------------------------------</span>
11724 <span class="preprocessor">#endif</span>
11725 <span class="preprocessor"></span>
11726 <span class="comment">// Local Variables:</span>
11727 <span class="comment">// mode: c++</span>
11728 <span class="comment">// End:</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 09:51:35 2005 for The CImg Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9 </small></address>
</body>
</html>
